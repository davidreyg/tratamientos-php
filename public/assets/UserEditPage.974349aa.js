import{aD as F,aE as Q,W as R,Y as v,$ as B,a0 as d,b1 as V,a1 as w,r as L,k as $,o as b,e as g,w as S,a5 as t,ad as f,aX as j,aj as A,aF as M,f as O,a2 as o,aa as T,ay as z,ak as D,ae as I,au as q,ag as P}from"./index.1c6b0b02.js";import{_ as W}from"./SkeletonForm.e2cd831e.js";import{u as X}from"./establecimientoFetchAllQuery.98ad95e2.js";import{u as Y}from"./roleListQuery.3d85b5dd.js";import{U as h}from"./UserApi.4738f900.js";import{_ as G}from"./BaseCheckBoxGroup.16f64d79.js";import"./RoleApi.d3f05448.js";function H(a,s){const r=async()=>(await h.fetchOne(a)).data().data,{data:i,isLoading:c,isSuccess:n,isError:u,isFetching:m,refetch:l}=F([Q.USERS,a],r,{enabled:s});return{data:i,isLoading:c,isSuccess:n,isError:u,isFetching:m,refetch:l}}function J(){return R(({data:a,id:s})=>h.update(a,s))}const K={class:"col-12"},Z=v({__name:"UserEditForm",props:{user:{type:Object,required:!0}},emits:["submit","cancel"],setup(a,{emit:s}){const r=a,i=s,c=B().shape({name:d().trim().min(2).required().label("Usuario"),nombre_completo:d().trim().min(2).required().label("Nombre Completo"),cargo:d().trim().min(2).required().label("Cargo"),establecimiento_id:d().required().label("Establecimiento"),role_ids:V().of(d().required()).required().label("Roles")}),{handleSubmit:n,setErrors:u,resetForm:m}=w({validationSchema:c,initialValues:r.user}),l=L({limit:0}),{data:_}=X(l),E=$(()=>_.value?_.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{roles:y}=Y(),N=$(()=>y.value?y.value.map(e=>({label:e.display_name,value:Number(e.id)})):[]),{isLoading:U,mutate:C,reset:k}=J(),x=n(async e=>{C({data:e,id:Number(r.user.id)},{onSuccess:()=>{i("submit")},onError:p=>{m(),k.value(),u(p.data.errors)}})},e=>{console.log(e)});return(e,p)=>(b(),g(T,{loading:o(U),onSubmit:o(x),onCancel:p[0]||(p[0]=ae=>e.$emit("cancel"))},{default:S(()=>[t(f,{name:"nombre_completo",label:"Nombre Completo",class:"col-12"}),t(f,{name:"name",label:"Usuario",class:"col-xs-12 col-sm-6"}),t(j,{options:E.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento",loading:!1,required:""},null,8,["options"]),t(f,{name:"cargo",label:"Cargo",class:"col-xs-12 col-sm-6"}),A("div",K,[t(M,{spaced:""}),O(" Roles: ")]),t(G,{name:"role_ids",label:"Roles",options:N.value},null,8,["options"])]),_:1},8,["loading","onSubmit"]))}}),ee={class:"row"},ce=v({__name:"UserEditPage",props:{id:{type:Number,required:!0}},setup(a){const s=a,r=z(),{data:i,isSuccess:c,isFetching:n}=H(s.id,!0),u=()=>{P.success("Registro actualizado correctamente"),r.back()};return(m,l)=>(b(),D("div",ee,[o(n)?(b(),g(I,{key:0,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg"},{default:S(()=>[t(W,{class:"col-12",inputs:2})]),_:1})):q("",!0),o(c)&&!o(n)&&o(i)?(b(),g(Z,{key:1,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg",user:o(i),onSubmit:u,onCancel:l[0]||(l[0]=_=>m.$router.back())},null,8,["user"])):q("",!0)]))}});export{ce as default};
