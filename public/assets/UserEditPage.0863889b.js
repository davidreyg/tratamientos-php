import{aE as x,aF as F,W as Q,Y as v,$ as R,a0 as d,bb as B,a1 as V,k as $,o as b,e as f,w as h,a5 as o,ad as _,aW as w,aj as L,aS as j,f as A,a2 as r,aa as M,ay as O,ak as T,ae as W,au as S,ag as z}from"./index.149cbc01.js";import{_ as I}from"./SkeletonForm.23131a13.js";import{u as P}from"./establecimientoFetchAllQuery.b48f7d67.js";import{u as Y}from"./roleListQuery.c5ddfc67.js";import{U as q}from"./UserApi.dbf22e41.js";import{_ as D}from"./BaseCheckBoxGroup.8f15ef25.js";import"./RoleApi.ba865dd5.js";function G(a,s){const n=async()=>(await q.fetchOne(a)).data().data,{data:i,isLoading:c,isSuccess:l,isError:u,isFetching:m,refetch:t}=x([F.USERS,a],n,{enabled:s});return{data:i,isLoading:c,isSuccess:l,isError:u,isFetching:m,refetch:t}}function H(){return Q(({data:a,id:s})=>q.update(a,s))}const J={class:"col-12"},K=v({__name:"UserEditForm",props:{user:{type:Object,required:!0}},emits:["submit","cancel"],setup(a,{emit:s}){const n=a,i=s,c=R().shape({name:d().trim().min(2).required().label("Usuario"),nombre_completo:d().trim().min(2).required().label("Nombre Completo"),cargo:d().trim().min(2).required().label("Cargo"),establecimiento_id:d().required().label("Establecimiento"),role_ids:B().of(d().required()).required().label("Roles")}),{handleSubmit:l,setErrors:u,resetForm:m}=V({validationSchema:c,initialValues:n.user}),{data:t}=P(),g=$(()=>t.value?t.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{roles:y}=Y(),E=$(()=>y.value?y.value.map(e=>({label:e.display_name,value:Number(e.id)})):[]),{isLoading:N,mutate:U,reset:C}=H(),k=l(async e=>{U({data:e,id:Number(n.user.id)},{onSuccess:()=>{i("submit")},onError:p=>{m(),C.value(),u(p.data.errors)}})},e=>{console.log(e)});return(e,p)=>(b(),f(M,{loading:r(N),onSubmit:r(k),onCancel:p[0]||(p[0]=Z=>e.$emit("cancel"))},{default:h(()=>[o(_,{name:"nombre_completo",label:"Nombre Completo",class:"col-12"}),o(_,{name:"name",label:"Usuario",class:"col-xs-12 col-sm-6"}),o(w,{options:g.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento",loading:!1,required:""},null,8,["options"]),o(_,{name:"cargo",label:"Cargo",class:"col-xs-12 col-sm-6"}),L("div",J,[o(j,{spaced:""}),A(" Roles: ")]),o(D,{name:"role_ids",label:"Roles",options:E.value},null,8,["options"])]),_:1},8,["loading","onSubmit"]))}}),X={class:"row"},ie=v({__name:"UserEditPage",props:{id:{type:Number,required:!0}},setup(a){const s=a,n=O(),{data:i,isSuccess:c,isFetching:l}=G(s.id,!0),u=()=>{z.success("Registro actualizado correctamente"),n.back()};return(m,t)=>(b(),T("div",X,[r(l)?(b(),f(W,{key:0,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg"},{default:h(()=>[o(I,{class:"col-12",inputs:2})]),_:1})):S("",!0),r(c)&&!r(l)&&r(i)?(b(),f(K,{key:1,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg",user:r(i),onSubmit:u,onCancel:t[0]||(t[0]=g=>m.$router.back())},null,8,["user"])):S("",!0)]))}});export{ie as default};
