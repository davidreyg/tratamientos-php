import{aE as X,aF as Y,W as L,Y as w,o as g,e as $,w as f,a5 as s,ad as v,b3 as G,aj as C,b8 as Z,b9 as ee,f as A,at as B,a2 as d,ba as ae,a3 as oe,bd as le,av as H,bc as te,k as z,a1 as ie,ag as se,H as O,ak as D,aK as ne,aW as Q,au as x,aX as V,ac as R,ab as P,a$ as re,be as de,r as S,b0 as U,bf as ce,$ as j,a_ as ue,bg as me,aU as N,a0 as I,bh as T,bi as be,aM as ve,aI as pe}from"./index.d215a0e8.js";import{O as M}from"./laboratorio.store.b1e5eaea.js";import{_ as fe}from"./BaseTable.b5a45280.js";function Fe(a){const _=async()=>(await M.fetchAll(a.value)).data(),{data:c,isLoading:i,isSuccess:y,isError:m,isFetching:u,refetch:e}=X([Y.ORDEN_ALL,a==null?void 0:a.value],_,{keepPreviousData:!0});return{data:c,isLoading:i,isSuccess:y,isError:m,isFetching:u,refetch:e}}function Oe(){return L(a=>M.registrar(a))}function _e(){return L(({id:a,data:_})=>M.updateExamens(a,_))}const he=C("div",{class:"col-12 text-bold text-italic"},"Datos Generales:",-1),ge=C("div",{class:"col-12 text-bold text-italic"}," Datos del Establecimiento de Origen: ",-1),ye=C("div",{class:"col-12 text-bold text-italic"},"Datos del Medico:",-1),qe=C("div",{class:"col-12 text-bold text-italic"},"Datos del paciente:",-1),De=w({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},setup(a){return(_,c)=>(g(),$(G,{class:"row"},{default:f(()=>[he,s(v,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.diagnostico},null,8,["value"]),s(v,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.CI10},null,8,["value"]),s(v,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.CPN},null,8,["value"]),s(v,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.EG},null,8,["value"]),s(v,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.codigo_atencion},null,8,["value"]),s(v,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.fecha_registro},null,8,["value"]),ge,s(v,{name:"establecimiento_tipo",class:"col-xs-12 col-sm-4",label:"Tipo de Establecimiento",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.establecimiento?"Jurisdiccion":"Externo"},null,8,["value"]),s(v,{name:"establecimiento_id",class:"col-xs-12 col-sm-8",label:"Establecimiento Origen",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.establecimiento?a.orden.establecimiento.data.nombre:a.orden.establecimiento_otro},null,8,["value"]),ye,s(v,{name:"medico",label:"Nombre",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.medico},null,8,["value"]),qe,s(v,{name:"paciente",label:"Nombre",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.paciente.data.nombre_completo},null,8,["value"]),s(v,{name:"documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.paciente.data.numero_documento},null,8,["value"])]),_:1}))}}),$e=w({__name:"BaseCheckBox",props:{name:{type:String,required:!0},label:{type:String,required:!0}},setup(a){const c=Z(a,"name"),{value:i,handleChange:y,errorMessage:m}=ee(c);return(u,e)=>(g(),$(te,{color:"black",borderless:"",error:!!d(m),"bottom-slots":"","hide-bottom-space":!d(m)},{error:f(()=>[A(B(d(m)),1)]),default:f(()=>[s(le,ae(u.$attrs,{modelValue:d(i),"onUpdate:modelValue":[e[0]||(e[0]=n=>oe(i)?i.value=n:null),e[1]||(e[1]=n=>d(y)(n))],label:a.label}),null,16,["modelValue","label"]),H(u.$slots,"default")]),_:3},8,["error","hide-bottom-space"]))}}),xe={key:0,class:"row q-mt-md"},we={class:"row"},Ce=w({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},examens:{type:Array,required:!0},ordenId:{type:Number,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!0}},emits:["submit","cancel"],setup(a,{emit:_}){const c=_,i=a,y=z(()=>i.examens?i.examens.map(r=>({label:r.nombre,value:Number(r.id)})):[]),{handleSubmit:m,setFieldValue:u,values:e}=ie({validationSchema:i.validationSchema,initialValues:i.initialValues}),{mutateAsync:n,reset:o,isLoading:b}=_e(),h=m(async(r,{setErrors:t})=>{await n({id:i.ordenId,data:r},{onSuccess:()=>{se.success("Resultados actualizados correctamente"),c("submit"),o.value()},onError:p=>{o.value(),t(p.data.errors)}})},r=>console.log(r)),W=r=>{let t;return!!e.pivot[r].minimo&&!!e.pivot[r].minimo&&(t=`Min: ${e.pivot[r].minimo} - Max: ${e.pivot[r].maximo}`),t},J=r=>{let t;return!!e.pivot[r].minimo&&!!e.pivot[r].minimo&&(e.pivot[r].resultado>e.pivot[r].minimo&&e.pivot[r].resultado<e.pivot[r].maximo?t="green-2":t="red-2"),t},K=r=>{const t="pivot["+r+"].is_canceled",p=e.pivot[r].is_canceled;u(t,!p)};return i.fields.forEach((r,t)=>{O(()=>e.pivot[t].unidad_id,p=>{if(p){const l=i.examens.find(q=>q.id==e.pivot[t].examen_id);if(!!l&&!!p){const q=l.pivot.find(F=>F.unidad_id===p),k="pivot["+t+"].minimo",E="pivot["+t+"].maximo";q&&(u(k,q.minimo),u(E,q.maximo))}}},{deep:!0,immediate:!0}),O(()=>e.pivot[t].is_canceled,p=>{const l="pivot["+t+"].minimo",q="pivot["+t+"].maximo";p&&(u(l,void 0),u(q,void 0))},{deep:!0,immediate:!0}),O(()=>e.pivot[t].is_enabled,p=>{const l="pivot["+t+"].minimo",q="pivot["+t+"].maximo",k="pivot["+t+"].resultado",E="pivot["+t+"].unidad_id",F="pivot["+t+"].motivo";p||(u(l,void 0),u(q,void 0),u(k,null),u(E,null),u(F,null))},{deep:!0,immediate:!0})}),(r,t)=>(g(),$(G,{onSubmit:de(d(h),["prevent"])},{default:f(()=>[(g(!0),D(re,null,ne(a.fields,(p,l)=>(g(),D("div",{key:l,class:"row q-col-gutter-sm q-mb-sm"},[s(Q,{label:"Examen",name:`pivot[${l}].examen_id`,options:y.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),d(e).pivot[l].is_canceled?(g(),$(v,{key:0,name:`pivot[${l}].motivo`,label:"Motivo",class:"col-4",required:"",disable:!d(e).pivot[l].is_enabled},null,8,["name","disable"])):x("",!0),d(e).pivot[l].is_canceled?x("",!0):(g(),$(v,{key:1,name:`pivot[${l}].resultado`,"bg-color":J(l),label:"Resultado",class:"col-2",required:"",disable:!d(e).pivot[l].is_enabled},null,8,["name","bg-color","disable"])),d(e).pivot[l].is_canceled?x("",!0):(g(),$(Q,{key:2,label:"Unidad",name:`pivot[${l}].unidad_id`,options:d(e).pivot[l].unidads,hint:W(l),class:"col-2",required:"",disable:!d(e).pivot[l].is_enabled},null,8,["name","options","hint","disable"])),s(v,{label:"Fecha",type:"date",name:`pivot[${l}].fecha_resultado`,required:"",class:"col-2",disable:!d(e).pivot[l].is_enabled},null,8,["name","disable"]),s(P,{class:"col-2 self-center justify-center"},{default:f(()=>[s($e,{name:`pivot[${l}].is_enabled`,label:"",dense:""},{default:f(()=>[s(V,null,{default:f(()=>[A(B(d(e).pivot[l].is_enabled?"Deshabilitar.":"Habilitar."),1)]),_:2},1024)]),_:2},1032,["name"]),s(R,{icon:d(e).pivot[l].is_canceled?"fas fa-pen":"fas fa-ban",color:d(e).pivot[l].is_canceled?"warning":"negative",disable:!d(e).pivot[l].is_enabled,round:"",flat:"",size:"sm",onClick:q=>K(l)},{default:f(()=>[s(V,null,{default:f(()=>[A(B(d(e).pivot[l].is_canceled?"Registrar datos.":"Cancelar examen."),1)]),_:2},1024)]),_:2},1032,["icon","color","disable","onClick"])]),_:2},1024)]))),128)),a.withObservaciones?(g(),D("div",xe,[s(v,{label:"Observaciones",type:"textarea",name:"observaciones",class:"col-12"})])):x("",!0),C("div",we,[s(P,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:f(()=>[s(R,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:t[0]||(t[0]=p=>r.$emit("cancel"))}),s(R,{label:"Guardar",type:"submit",icon:"fas fa-floppy-disk",color:"primary",loading:d(b),"no-caps":""},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))}}),Re=w({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!1,default:!1}},emits:["submit","cancel"],setup(a){const _=z(()=>c.orden.examens.data?c.orden.examens.data.map(n=>({label:n.nombre,value:Number(n.id)})):[]),c=a,i=S([]),y=S(),m=S();i.value=c.orden.pivot.map(n=>{let o=[];const b=c.orden.examens.data.find(h=>Number(h.id)==n.examen_id);return o=[{label:"Examen",name:"examen_id",type:"select",options:_.value},{label:"Resultado",name:"resultado",type:"string"},{label:"Unidad",name:"unidad_id",type:"select",options:b?b.unidads.data.map(h=>({label:h.nombre,value:Number(h.id)})):[]},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Acciones",name:"actions",type:"array"}],o});const u=U().of(ce(()=>{let n={};return n={examen_id:me().required().label("Examen"),resultado:N().positive().when(["is_enabled","is_canceled"],{is:(o,b)=>o&&!b,then:o=>o.required(),otherwise:o=>o.nullable()}).transform((o,b)=>b===""?void 0:o).typeError("Debe ingresar un numero").label("Resultado"),fecha_resultado:I().required().label("Fecha"),unidad_id:N().when(["is_enabled","is_canceled"],{is:(o,b)=>o&&!b,then:o=>o.required(),otherwise:o=>o.nullable()}).label("Unidad"),is_canceled:T().required().label("Cancelado?"),is_enabled:T().required().label("Hablitad?"),motivo:I().when(["is_enabled","is_canceled"],{is:!0,then:o=>o.required(),otherwise:o=>o.nullable()}).label("Motivo"),minimo:N(),maximo:N(),unidads:U()},j().shape(n)}));y.value=j().shape({pivot:u});const e=c.orden.pivot.map(n=>{var b;const o=c.orden.examens.data.find(h=>Number(h.id)==n.examen_id);return{examen_id:n.examen_id,resultado:n.resultado,fecha_resultado:(b=n.fecha_resultado)!=null?b:ue.now().toISODate(),unidad_id:n.unidad_id,is_canceled:n.is_canceled,is_enabled:!0,motivo:n.motivo,unidads:o?o.unidads.data.map(h=>({label:h.nombre,value:Number(h.id)})):[]}});return m.value={pivot:e,observaciones:c.orden.observaciones},(n,o)=>i.value.length>0&&y.value?(g(),$(Ce,{key:0,fields:i.value,"validation-schema":y.value,"initial-values":m.value,"orden-id":Number(a.orden.id),examens:c.orden.examens.data,"with-observaciones":a.withObservaciones,onCancel:o[0]||(o[0]=b=>n.$emit("cancel")),onSubmit:o[1]||(o[1]=b=>n.$emit("submit"))},null,8,["fields","validation-schema","initial-values","orden-id","examens","with-observaciones"])):x("",!0)}}),Se=w({__name:"OrdenTable",props:{ordens:{type:Array,required:!0}},setup(a){const{formatDate:_}=pe(),c=[{name:"index",label:"#",field:"index"},{name:"fecha_registro",align:"left",label:"Fecha Registro",field:"fecha_registro",format:i=>_(i)},{name:"medico",align:"center",label:"Medico",field:"medico"},{name:"diagnostico",align:"center",label:"Diagnostico",field:"diagnostico"},{name:"paciente",align:"center",label:"Paciente",field:i=>i.paciente.data.nombre_completo},{name:"documento",align:"center",label:"N\xB0 Documento",field:i=>i.paciente.data.numero_documento},{name:"codigo_atencion",align:"center",label:"Codigo Atenci\xF3n",field:"codigo_atencion"},{name:"estado",align:"center",label:"Estado",field:"estado",sortable:!0},{name:"actions",align:"right",label:"Acciones",field:"actions"}];return(i,y)=>(g(),$(fe,{data:a.ordens,columns:c,"row-key":"id"},{"body-cell-estado":f(({props:m})=>[s(ve,{props:m},{default:f(()=>[s(be,{color:m.row.estado_detalle.color,label:m.row.estado_detalle.label},null,8,["color","label"])]),_:2},1032,["props"])]),customActions:f(({props:m})=>[H(i.$slots,"custom-actions",{props:m})]),_:3},8,["data"]))}});export{Se as _,Oe as a,De as b,Re as c,Fe as u};
