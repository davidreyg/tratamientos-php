import{W as K,Y as R,r as I,k as A,$ as V,a0 as r,b1 as Q,aV as g,a1 as G,ag as Z,H as ee,o as p,e as v,w as t,a5 as a,ad as l,aX as M,aY as O,f as k,ac as D,aj as N,aF as ae,a2 as i,au as U,aa as te,ba as oe,aU as ie,aI as B,bb as se,ak as ne,ab as re,bh as le,bi as ce,bc as T,a6 as ue,ae as me}from"./index.1c6b0b02.js";import{u as de}from"./establecimientoFetchAllQuery.98ad95e2.js";import{u as be}from"./examenFetchAllQuery.217605d3.js";import{O as pe}from"./OrdenApi.2f1508d0.js";import{u as _e}from"./paqueteFetchAllQuery.a750591a.js";import{_ as fe}from"./ExamenCardList.3d78d6a7.js";import{_ as qe}from"./BaseCheckBoxGroup.16f64d79.js";import{u as L}from"./laboratorio.store.19e53ab5.js";import"./ExamenApi.44d6bbd2.js";import"./PaqueteApi.a548d303.js";function xe(){return K(h=>pe.create(h))}const ge={class:"col-12"},ve={class:"col-12"},he={class:"col-12 row q-col-gutter-sm"},Ce=R({__name:"OrdenCreateForm",props:{pacienteId:{type:Number,required:!0}},emits:["submit"],setup(h,{emit:C}){const y=h,m=C,S=I({limit:0,search:"is_active:1",searchJoin:"and"}),{data:u}=be(S),{data:d}=_e(),$=A(()=>d.value?d.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),F=I({limit:0}),{data:E}=de(F),c=A(()=>E.value?E.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),b=V().shape({diagnostico:r().trim().min(2).required().label("Diagnostico"),CI10:r().trim().min(2).required().label("CI10"),CPN:r().trim().min(2).required().label("CPN"),EG:r().trim().min(2).required().label("EG"),codigo_atencion:r().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:r().trim().required().label("Fecha de Registro"),medico:r().trim().required().label("M\xE9dico"),examen_ids:Q().of(g().required()).required().label("Examenes"),item_ids:Q().of(g().required()).required().label("Items"),paquete_ids:Q().of(g().required()).required().label("Paquetes"),establecimiento_id:g().when([],{is:()=>f.value,then:e=>e.required(),otherwise:e=>e.optional()}).label("Establecimiento Institucional"),establecimiento_otro:r().when([],{is:()=>!f.value,then:e=>e.required(),otherwise:e=>e.optional()}).label("Otro Establecimiento")}),{values:_,setFieldValue:w,handleSubmit:j}=G({validationSchema:b,initialValues:{examen_ids:[],paquete_ids:[],paciente_id:y.pacienteId}}),f=I(!0),{mutateAsync:Y,reset:z,isLoading:H}=xe(),J=j(async(e,{setErrors:o,resetForm:s})=>{await Y(e,{onSuccess:()=>{Z.success("Orden registrada correctamente."),s(),m("submit")},onError:n=>{z.value(),o(n.data.errors)}})});ee(()=>_.examen_ids,e=>{var o;if(e){const s=(o=d.value)==null?void 0:o.filter(q=>q.examen_ids.every(x=>e.includes(x)));w("paquete_ids",(s==null?void 0:s.map(q=>Number(q.id)))||[]);let n=[];u.value&&(n=[],e.forEach(q=>{const x=u.value.find(P=>Number(P.id)===q);if(x&&x.items.data.length>0){const P=x.items.data.map(X=>Number(X.id));n.push(...P)}}),w("item_ids",[...new Set(n)]),console.log(_.item_ids))}});const W=e=>{var o;if(e){const s=(o=d.value)==null?void 0:o.filter(n=>e.includes(Number(n.id))).map(n=>n.examen_ids).flat();w("examen_ids",[...new Set(s)])}};return(e,o)=>(p(),v(te,{loading:i(H),onSubmit:i(J)},{default:t(()=>[a(l,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:""}),f.value?(p(),v(M,{key:0,options:c.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:""},{after:t(()=>[a(D,{round:"",flat:"",icon:"fas fa-building-circle-arrow-right",color:"primary",onClick:o[0]||(o[0]=s=>f.value=!1)},{default:t(()=>[a(O,null,{default:t(()=>[k(" Otro establecimiento ")]),_:1})]),_:1})]),_:1},8,["options"])):(p(),v(l,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:""},{after:t(()=>[a(D,{round:"",flat:"",icon:"fas fa-building-circle-xmark",color:"negative",onClick:o[1]||(o[1]=s=>f.value=!0)},{default:t(()=>[a(O,null,{default:t(()=>[k(" Establecimiento institucional")]),_:1})]),_:1})]),_:1})),a(l,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:""}),a(l,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:""}),a(l,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:""}),a(l,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:""}),a(l,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:""}),a(l,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:""}),N("div",ge,[a(ae,{spaced:""}),k(" Paquetes")]),N("div",ve,[a(qe,{name:"paquete_ids",label:"Paquetes",options:$.value,onUpdate:W},null,8,["options"])]),N("div",he,[i(u)?(p(),v(fe,{key:0,examens:i(u)},null,8,["examens"])):U("",!0)])]),_:1},8,["loading","onSubmit"]))}}),ye={class:"row q-col-gutter-md"},Ee={class:"col-12"},De=R({__name:"RegistrarOrdenPage",setup(h){const{fetchPaciente:C,$reset:y}=L(),{paciente:m,isPacienteLoading:S}=oe(L()),{data:u}=ie(),d=A(()=>u.value?u.value.map(c=>({label:c.nombre,value:c.id})):[]),$=V().shape({numero_documento:g().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:r().required().label("Tipo de Documento")}),{handleSubmit:F}=G({validationSchema:$}),E=F(async c=>{await C(c.numero_documento),m.value?B.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}):B.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})});return se(()=>{y()}),(c,b)=>(p(),ne("div",ye,[a(le,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:i(E)},{default:t(()=>[a(M,{options:d.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),a(l,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),a(re,{class:"col-auto justify-center"},{default:t(()=>[a(D,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:i(S)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),N("div",Ee,[a(T,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear",class:"bg-purple-2"},{default:t(()=>[a(ce,{class:"bg-purple-1",paciente:i(m),onCancel:i(y),onSubmit:b[0]||(b[0]=_=>i(C)(_))},null,8,["paciente","onCancel"])]),_:1}),i(m)?(p(),v(T,{key:0,icon:"fas fa-vials",label:"Datos de la Orden de Lab.",caption:"Editar / Crear"},{default:t(()=>[a(me,null,{default:t(()=>[a(ue,null,{default:t(()=>[a(Ce,{"paciente-id":Number(i(m).id),onSubmit:b[1]||(b[1]=_=>c.$router.push({name:"laboratorio.registrar"}))},null,8,["paciente-id"])]),_:1})]),_:1})]),_:1})):U("",!0)])]))}});export{De as default};
