import{aH as me,aI as pe,W as ve,Y as W,k,r as M,$ as B,a0 as L,aV as u,b0 as be,b1 as j,a1 as _e,b2 as I,o as l,ak as c,a5 as s,w as r,aX as C,ad as x,a2 as a,aj as h,b3 as O,ac as w,at as T,au as g,aQ as P,a9 as z,f as Y,aE as D,aK as X,e as S,a8 as H,x as fe,a7 as K,aa as xe,ag as Q,b4 as he,ay as ge,ae as ye}from"./index.c8292963.js";import{_ as $e}from"./SkeletonForm.af029b17.js";import{u as qe}from"./categoriaFetchAllQuery.1bb289be.js";import{E as G}from"./ExamenApi.6a42cf46.js";import{u as Ee,a as ke}from"./respuestaFetchAllQuery.850e19de.js";import{u as Ce}from"./unidadFetchAllQuery.e159dcb5.js";import{_ as we}from"./BaseCheckBox.91937ad9.js";import"./CategoriaApi.6dbb760e.js";import"./UnidadApi.c7042b08.js";function Se(n,d){const v=async()=>(await G.fetchOne(n)).data().data,{data:m,isLoading:b,isSuccess:_,isError:f,isFetching:y,refetch:p}=me([pe.EXAMEN_ALL,n],v,{enabled:d});return{data:m,isLoading:b,isSuccess:_,isError:f,isFetching:y,refetch:p}}function Ue(){return ve(({data:n,id:d})=>G.update(n,d))}const Qe={class:"row"},Ne={key:0,class:"col-xs-12 col-sm-12"},Fe={class:"row"},Re={key:0,class:"text-red text-italic"},Ve={class:"row q-col-gutter-sm q-mb-sm"},Ae={class:"col-auto self-center"},Me={key:1,class:"col-xs-12 col-sm-12"},Be={class:"row"},Le={key:0,class:"text-red text-italic"},je={class:"row q-col-gutter-sm q-mb-sm"},Ie={class:"col-4 self-center"},Oe=W({__name:"ExamenEditForm",props:{examen:{type:Object,required:!0}},emits:["submit","cancel"],setup(n,{emit:d}){const v=n,m=d,{data:b}=qe(),_=k(()=>b.value?b.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:f}=Ee(),y=k(()=>f.value?Object.values(f.value).map(e=>({label:e,value:e})):[]),{data:p}=Ce(),U=k(()=>p.value?Object.values(p.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:N}=ke(),F=k(()=>N.value?Object.values(N.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),$=M(),q=M(),J=B().shape({nombre:L().trim().min(2).required().label("Nombre"),codigo:u().typeError("Codigo debe ser un numero").positive().required().label("Codigo"),tipo:L().trim().min(2).required().label("Tipo"),categoria_id:u().required().label("Categoria"),is_active:be().required().label("\xBFActivo?"),precio:u().typeError("Precio debe ser un numero").positive().required().label("Precio"),pivot:j().when(["tipo"],{is:e=>e==="unidad",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(B({unidad_id:u().typeError("Unidad debe ser un numero").positive().required().label("Unidad"),examen_id:u().typeError("Examen debe ser un numero").positive().label("Examen"),minimo:u().typeError("Minimo debe ser un numero").positive().required().label("Minimo"),maximo:u().typeError("Maximo debe ser un numero").positive().required().label("Maximo")})).label("Unidades"),respuesta_ids:j().when(["tipo"],{is:e=>e==="respuesta",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(u().required()).label("Respuestas")}),{handleSubmit:Z,setErrors:ee,values:R,errors:E}=_e({validationSchema:J,initialValues:{...v.examen}}),{remove:se,push:ae,fields:V}=I("pivot"),{remove:te,push:oe,fields:A}=I("respuesta_ids"),re=e=>{if(V.value.some(o=>o.value.unidad_id===e.value)){Q.warn("Ya has agregado este item");return}ae({unidad_id:Number(e.value)}),$.value=void 0},le=e=>{if(A.value.some(o=>o.value===e.value)){Q.warn("Ya has agregado este item");return}oe(Number(e.value)),q.value=void 0},{isLoading:ie,mutate:ne,reset:ue}=Ue(),ce=Z(async e=>{ne({data:e,id:v.examen.id},{onSuccess:()=>{m("submit")},onError:t=>{ue.value(),ee(t.data.errors)}})},e=>{console.log(e.errors)});return(e,t)=>(l(),c("div",Qe,[s(xe,{class:"col-xs-12 col-sm-10",loading:a(ie),onSubmit:a(ce),onCancel:t[4]||(t[4]=o=>e.$emit("cancel"))},{default:r(()=>[s(C,{options:_.value,name:"categoria_id",label:"Categoria",class:"col-xs-12 col-sm-6"},null,8,["options"]),s(x,{name:"codigo",label:"Codigo",class:"col-xs-12 col-sm-6"}),s(x,{name:"nombre",label:"Nombre",class:"col-xs-12 col-sm-9"}),s(x,{name:"precio",label:"Precio",class:"col-xs-12 col-sm-3"}),s(we,{name:"is_active",label:"\xBFActivo?",class:"col-xs-12 col-sm-6"}),s(C,{options:y.value,name:"tipo",label:"Tipo",class:"col-xs-12 col-sm-6"},null,8,["options"]),a(R).tipo==="unidad"?(l(),c("div",Ne,[h("div",Fe,[s(O,{modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=o=>$.value=o),options:U.value,borderless:"",dense:"",name:"unidadees1",label:"Unidades",class:"col-4 q-mb-md"},{after:r(()=>[s(w,{disable:!$.value,round:"",dense:"",icon:"add",color:"positive",onClick:t[0]||(t[0]=o=>re($.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),a(E).pivot?(l(),c("div",Re,T(a(E).pivot),1)):g("",!0),s(P,{bordered:""},{default:r(()=>[s(z,{header:""},{default:r(()=>[Y("Seleccionar Unidades")]),_:1}),(l(!0),c(D,null,X(a(V),(o,i)=>(l(),S(K,{key:i},{default:r(()=>[s(H,null,{default:r(()=>[h("div",Ve,[fe(s(x,{label:"examen",name:`pivot[${i}].examen_id`,class:"col-3",required:""},null,8,["name"]),[[he,!1]]),s(C,{label:"Unidades",name:`pivot[${i}].unidad_id`,options:U.value,class:"col-3",required:""},null,8,["name","options"]),s(x,{name:`pivot[${i}].minimo`,label:"Minimo",class:"col-4"},null,8,["name"]),s(x,{name:`pivot[${i}].maximo`,label:"Maximo",class:"col-4"},null,8,["name"]),h("div",Ae,[s(w,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:de=>a(se)(i)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):g("",!0),a(R).tipo==="respuesta"?(l(),c("div",Me,[h("div",Be,[s(O,{modelValue:q.value,"onUpdate:modelValue":t[3]||(t[3]=o=>q.value=o),options:F.value,borderless:"",dense:"",name:"respuestas1",label:"Respuesta",class:"col-4 q-mb-md"},{after:r(()=>[s(w,{disable:!q.value,round:"",dense:"",icon:"add",color:"positive",onClick:t[2]||(t[2]=o=>le(q.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),a(E).respuesta_ids?(l(),c("div",Le,T(a(E).respuesta_ids),1)):g("",!0),s(P,{bordered:""},{default:r(()=>[s(z,{header:""},{default:r(()=>[Y("Seleccionar Respuestas")]),_:1}),(l(!0),c(D,null,X(a(A),(o,i)=>(l(),S(K,{key:i},{default:r(()=>[s(H,null,{default:r(()=>[h("div",je,[s(C,{label:"Respuesta",name:`respuesta_ids[${i}]`,options:F.value,class:"col-8",required:""},null,8,["name","options"]),h("div",Ie,[s(w,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:de=>a(te)(i)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):g("",!0)]),_:1},8,["loading","onSubmit"])]))}}),Te={class:"row"},Je=W({__name:"ExamenEditPage",props:{id:{type:Number,required:!0}},setup(n){const d=n,v=ge(),{data:m,isSuccess:b,isFetching:_}=Se(d.id,!0),f=()=>{Q.success("Registro actualizado correctamente"),v.back()};return(y,p)=>(l(),c("div",Te,[a(_)?(l(),S(ye,{key:0,class:"col-xs-12 col-sm-10 q-pa-lg"},{default:r(()=>[s($e,{class:"col-12",inputs:3})]),_:1})):g("",!0),a(b)&&!a(_)&&a(m)?(l(),S(Oe,{key:1,class:"col-xs-12 col-sm-10",examen:a(m),gol:a(m),onSubmit:f,onCancel:p[0]||(p[0]=U=>y.$router.back())},null,8,["examen","gol"])):g("",!0)]))}});export{Je as default};
