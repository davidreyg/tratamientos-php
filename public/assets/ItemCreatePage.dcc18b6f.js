import{W as fe,Y as X,k as n,r as C,$ as O,a0 as g,aV as u,b6 as T,a1 as he,b7 as j,ag as S,o as r,ak as d,a5 as a,w as i,aX as c,ad as k,a2 as o,aj as p,b8 as B,ac as x,at as L,au as v,aQ as Y,a9 as z,f as D,aE as J,aK as K,e as h,a8 as P,a7 as W,aa as $e}from"./index.747a1a42.js";import{u as ye}from"./examenFetchAllQuery.a8190778.js";import{u as qe,a as ge}from"./unidadTiposFetchAllQuery.41287df2.js";import{I as ke}from"./ItemApi.55d4bb01.js";import{u as xe}from"./respuestaFetchAllQuery.39f9c11e.js";import{u as we}from"./seccionFetchAllQuery.c35f1564.js";import{u as Ce}from"./operadoresFetchAllQuery.9261c9cb.js";import{u as Se}from"./unidadFetchAllQuery.650df9b6.js";import"./ExamenApi.90f33f4e.js";import"./UnidadApi.2c352d38.js";import"./RespuestaApi.4798ebd4.js";import"./SeccionApi.7ddde17c.js";function Ue(){return fe(w=>ke.create(w))}const Qe={class:"row"},Ne={key:0,class:"col-xs-12 col-sm-12"},Ee={class:"row"},Ve={key:0,class:"text-red text-italic"},Fe={class:"row q-col-gutter-sm q-mb-sm"},Re={class:"col-auto self-center"},Ae={key:1,class:"col-xs-12 col-sm-12"},Ie={class:"row"},Me={key:0,class:"text-red text-italic"},Oe={class:"row q-col-gutter-sm q-mb-sm"},Te={class:"col-4 self-center"},je=X({__name:"ItemCreateForm",emits:["submit","cancel"],setup(w,{emit:$}){const m=$,{data:y}=we(),G=n(()=>y.value?y.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),H=C({limit:0,search:"is_active:1",searchJoin:"and"}),{data:U}=ye(H),Z=n(()=>U.value?U.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:Q}=qe(),ee=n(()=>Q.value?Object.values(Q.value).map(e=>({label:e,value:e})):[]),{data:N}=Se(),E=n(()=>N.value?Object.values(N.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:V}=xe(),F=n(()=>V.value?Object.values(V.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:R}=ge(),ae=n(()=>R.value?Object.values(R.value).map(e=>({label:e,value:e})):[]),{data:A}=Ce(),se=n(()=>A.value?Object.entries(A.value).map(([e,s])=>({label:`${s} (${e})`,value:e})):[]),oe=O().shape({nombre:g().trim().min(2).required().label("Nombre"),codigo:u().typeError("Codigo debe ser un numero").positive().required().label("Codigo"),tipo:g().trim().min(2).required().label("Tipo"),seccion_id:u().required().label("Seccion"),examen_id:u().required().label("Examen"),pivot:T().when(["tipo"],{is:e=>e==="unidad",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(O({unidad_id:u().typeError("Unidad debe ser un numero").positive().required().label("Unidad"),minimo:u().typeError("Minimo debe ser un numero").min(0).required().label("Minimo"),maximo:u().typeError("Maximo debe ser un numero").positive().when(["tipo"],{is:e=>e==="multivalor",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Maximo"),tipo:g().required().label("Tipo"),operador:g().when(["tipo"],{is:e=>e==="operador",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Operador")})).label("Unidades"),respuesta_ids:T().when(["tipo"],{is:e=>e==="respuesta",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(u().required()).label("Respuestas")}),{handleSubmit:te,setErrors:le,values:b,errors:q}=he({validationSchema:oe}),_=C(),f=C(),{remove:re,push:ie,fields:I}=j("pivot"),{remove:ne,push:ue,fields:M}=j("respuesta_ids"),de=e=>{if(I.value.some(l=>l.value.unidad_id===e.value)){S.warn("Ya has agregado este item");return}ie({unidad_id:Number(e.value)}),_.value=void 0},ce=e=>{if(M.value.some(l=>l.value===e.value)){S.warn("Ya has agregado este item");return}ue(Number(e.value)),f.value=void 0},{isLoading:me,mutate:pe,reset:ve}=Ue(),be=te(async e=>{pe(e,{onSuccess:()=>{S.success(),m("submit")},onError:s=>{ve.value(),le(s.data.errors)}})},e=>{console.log(e.errors)});return(e,s)=>(r(),d("div",Qe,[a($e,{class:"col-xs-12 col-sm-10",loading:o(me),onSubmit:o(be),onCancel:s[4]||(s[4]=l=>e.$emit("cancel"))},{default:i(()=>[a(c,{options:Z.value,name:"examen_id",label:"Examen",class:"col-12"},null,8,["options"]),a(c,{options:G.value,name:"seccion_id",label:"Seccion",class:"col-xs-12 col-sm-6"},null,8,["options"]),a(k,{name:"codigo",label:"Codigo",class:"col-xs-12 col-sm-6"}),a(k,{name:"nombre",label:"Nombre",class:"col-xs-12 col-sm-6"}),a(c,{options:ee.value,name:"tipo",label:"Tipo",class:"col-xs-12 col-sm-6"},null,8,["options"]),o(b).tipo==="unidad"?(r(),d("div",Ne,[p("div",Ee,[a(B,{modelValue:_.value,"onUpdate:modelValue":s[1]||(s[1]=l=>_.value=l),options:E.value,borderless:"",dense:"",name:"unidadees1",label:"Unidades",class:"col-4 q-mb-md"},{after:i(()=>[a(x,{disable:!_.value,round:"",dense:"",icon:"add",color:"positive",onClick:s[0]||(s[0]=l=>de(_.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),o(q).pivot?(r(),d("div",Ve,L(o(q).pivot),1)):v("",!0),a(Y,{bordered:""},{default:i(()=>[a(z,{header:""},{default:i(()=>[D("Seleccionar Unidades")]),_:1}),(r(!0),d(J,null,K(o(I),(l,t)=>(r(),h(W,{key:t},{default:i(()=>[a(P,null,{default:i(()=>[p("div",Fe,[a(c,{label:"Unidades",name:`pivot[${t}].unidad_id`,options:E.value,class:"col-2",required:""},null,8,["name","options"]),o(b).pivot[t].tipo==="operador"?(r(),h(c,{key:0,name:`pivot[${t}].operador`,options:se.value,label:"Operador",class:"col-3"},null,8,["name","options"])):v("",!0),a(k,{name:`pivot[${t}].minimo`,label:o(b).pivot[t].tipo==="multivalor"?"Minimo":"Valor",class:"col-3"},null,8,["name","label"]),o(b).pivot[t].tipo==="multivalor"?(r(),h(k,{key:1,name:`pivot[${t}].maximo`,label:"Maximo",class:"col-3"},null,8,["name"])):v("",!0),a(c,{options:ae.value,name:`pivot[${t}].tipo`,label:"Tipo",class:"col-3"},null,8,["options","name"]),p("div",Re,[a(x,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:_e=>o(re)(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):v("",!0),o(b).tipo==="respuesta"?(r(),d("div",Ae,[p("div",Ie,[a(B,{modelValue:f.value,"onUpdate:modelValue":s[3]||(s[3]=l=>f.value=l),options:F.value,borderless:"",dense:"",name:"respuestas1",label:"Respuesta",class:"col-4 q-mb-md"},{after:i(()=>[a(x,{disable:!f.value,round:"",dense:"",icon:"add",color:"positive",onClick:s[2]||(s[2]=l=>ce(f.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),o(q).respuesta_ids?(r(),d("div",Me,L(o(q).respuesta_ids),1)):v("",!0),a(Y,{bordered:""},{default:i(()=>[a(z,{header:""},{default:i(()=>[D("Seleccionar Respuestas")]),_:1}),(r(!0),d(J,null,K(o(M),(l,t)=>(r(),h(W,{key:t},{default:i(()=>[a(P,null,{default:i(()=>[p("div",Oe,[a(c,{label:"Respuesta",name:`respuesta_ids[${t}]`,options:F.value,class:"col-8",required:""},null,8,["name","options"]),p("div",Te,[a(x,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:_e=>o(ne)(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):v("",!0)]),_:1},8,["loading","onSubmit"])]))}}),Ze=X({__name:"ItemCreatePage",setup(w){return($,m)=>(r(),h(je,{onSubmit:m[0]||(m[0]=y=>$.$router.back()),onCancel:m[1]||(m[1]=y=>$.$router.back())}))}});export{Ze as default};
