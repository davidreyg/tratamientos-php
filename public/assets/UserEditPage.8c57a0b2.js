import{aH as F,aI as Q,W as R,Y as v,$ as B,a0 as d,b6 as V,a1 as w,r as L,k as $,o as b,e as g,w as S,a5 as t,ad as f,aX as j,aj as A,aD as I,f as M,a2 as o,aa as O,ay as T,ak as z,ae as D,au as q,ag as H}from"./index.cb32cbc7.js";import{_ as P}from"./SkeletonForm.61e192aa.js";import{u as W}from"./establecimientoFetchAllQuery.cb226b97.js";import{u as X}from"./roleListQuery.d7a9e48d.js";import{U as h}from"./UserApi.06ac89fe.js";import{_ as Y}from"./BaseCheckBoxGroup.e5d846c6.js";import"./EstablecimientoApi.39440998.js";import"./RoleApi.ae2506b8.js";function G(a,s){const r=async()=>(await h.fetchOne(a)).data().data,{data:i,isLoading:c,isSuccess:n,isError:u,isFetching:m,refetch:l}=F([Q.USERS,a],r,{enabled:s});return{data:i,isLoading:c,isSuccess:n,isError:u,isFetching:m,refetch:l}}function J(){return R(({data:a,id:s})=>h.update(a,s))}const K={class:"col-12"},Z=v({__name:"UserEditForm",props:{user:{type:Object,required:!0}},emits:["submit","cancel"],setup(a,{emit:s}){const r=a,i=s,c=B().shape({name:d().trim().min(2).required().label("Usuario"),nombre_completo:d().trim().min(2).required().label("Nombre Completo"),cargo:d().trim().min(2).required().label("Cargo"),establecimiento_id:d().required().label("Establecimiento"),role_ids:V().of(d().required()).required().label("Roles")}),{handleSubmit:n,setErrors:u,resetForm:m}=w({validationSchema:c,initialValues:r.user}),l=L({limit:0}),{data:_}=W(l),N=$(()=>_.value?_.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{roles:y}=X(),U=$(()=>y.value?y.value.map(e=>({label:e.display_name,value:Number(e.id)})):[]),{isLoading:C,mutate:E,reset:k}=J(),x=n(async e=>{E({data:e,id:Number(r.user.id)},{onSuccess:()=>{i("submit")},onError:p=>{m(),k.value(),u(p.data.errors)}})},e=>{console.log(e)});return(e,p)=>(b(),g(O,{loading:o(C),onSubmit:o(x),onCancel:p[0]||(p[0]=ae=>e.$emit("cancel"))},{default:S(()=>[t(f,{name:"nombre_completo",label:"Nombre Completo",class:"col-12"}),t(f,{name:"name",label:"Usuario",class:"col-xs-12 col-sm-6"}),t(j,{options:N.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento",loading:!1,required:""},null,8,["options"]),t(f,{name:"cargo",label:"Cargo",class:"col-xs-12 col-sm-6"}),A("div",K,[t(I,{spaced:""}),M(" Roles: ")]),t(Y,{name:"role_ids",label:"Roles",options:U.value},null,8,["options"])]),_:1},8,["loading","onSubmit"]))}}),ee={class:"row"},ue=v({__name:"UserEditPage",props:{id:{type:Number,required:!0}},setup(a){const s=a,r=T(),{data:i,isSuccess:c,isFetching:n}=G(s.id,!0),u=()=>{H.success("Registro actualizado correctamente"),r.back()};return(m,l)=>(b(),z("div",ee,[o(n)?(b(),g(D,{key:0,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg"},{default:S(()=>[t(P,{class:"col-12",inputs:2})]),_:1})):q("",!0),o(c)&&!o(n)&&o(i)?(b(),g(Z,{key:1,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg",user:o(i),onSubmit:u,onCancel:l[0]||(l[0]=_=>m.$router.back())},null,8,["user"])):q("",!0)]))}});export{ue as default};
