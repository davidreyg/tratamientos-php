import{aE as F,aF as Q,W as R,Y as q,$ as B,a0 as d,b1 as V,a1 as w,r as L,k as $,o as b,e as g,w as v,a5 as t,ad as f,aW as j,aj as A,aS as M,f as O,a2 as o,aa as T,ay as W,ak as z,ae as I,au as S,ag as P}from"./index.a85a2474.js";import{_ as Y}from"./SkeletonForm.3a275675.js";import{u as D}from"./establecimientoFetchAllQuery.cdc78054.js";import{u as G}from"./roleListQuery.28355935.js";import{U as h}from"./UserApi.bdfb09d8.js";import{_ as H}from"./BaseCheckBoxGroup.1171d2cd.js";import"./RoleApi.67aeb307.js";function J(a,s){const r=async()=>(await h.fetchOne(a)).data().data,{data:i,isLoading:c,isSuccess:n,isError:u,isFetching:m,refetch:l}=F([Q.USERS,a],r,{enabled:s});return{data:i,isLoading:c,isSuccess:n,isError:u,isFetching:m,refetch:l}}function K(){return R(({data:a,id:s})=>h.update(a,s))}const X={class:"col-12"},Z=q({__name:"UserEditForm",props:{user:{type:Object,required:!0}},emits:["submit","cancel"],setup(a,{emit:s}){const r=a,i=s,c=B().shape({name:d().trim().min(2).required().label("Usuario"),nombre_completo:d().trim().min(2).required().label("Nombre Completo"),cargo:d().trim().min(2).required().label("Cargo"),establecimiento_id:d().required().label("Establecimiento"),role_ids:V().of(d().required()).required().label("Roles")}),{handleSubmit:n,setErrors:u,resetForm:m}=w({validationSchema:c,initialValues:r.user}),l=L({limit:0}),{data:_}=D(l),E=$(()=>_.value?_.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{roles:y}=G(),N=$(()=>y.value?y.value.map(e=>({label:e.display_name,value:Number(e.id)})):[]),{isLoading:U,mutate:C,reset:k}=K(),x=n(async e=>{C({data:e,id:Number(r.user.id)},{onSuccess:()=>{i("submit")},onError:p=>{m(),k.value(),u(p.data.errors)}})},e=>{console.log(e)});return(e,p)=>(b(),g(T,{loading:o(U),onSubmit:o(x),onCancel:p[0]||(p[0]=ae=>e.$emit("cancel"))},{default:v(()=>[t(f,{name:"nombre_completo",label:"Nombre Completo",class:"col-12"}),t(f,{name:"name",label:"Usuario",class:"col-xs-12 col-sm-6"}),t(j,{options:E.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento",loading:!1,required:""},null,8,["options"]),t(f,{name:"cargo",label:"Cargo",class:"col-xs-12 col-sm-6"}),A("div",X,[t(M,{spaced:""}),O(" Roles: ")]),t(H,{name:"role_ids",label:"Roles",options:N.value},null,8,["options"])]),_:1},8,["loading","onSubmit"]))}}),ee={class:"row"},ce=q({__name:"UserEditPage",props:{id:{type:Number,required:!0}},setup(a){const s=a,r=W(),{data:i,isSuccess:c,isFetching:n}=J(s.id,!0),u=()=>{P.success("Registro actualizado correctamente"),r.back()};return(m,l)=>(b(),z("div",ee,[o(n)?(b(),g(I,{key:0,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg"},{default:v(()=>[t(Y,{class:"col-12",inputs:2})]),_:1})):S("",!0),o(c)&&!o(n)&&o(i)?(b(),g(Z,{key:1,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg",user:o(i),onSubmit:u,onCancel:l[0]||(l[0]=_=>m.$router.back())},null,8,["user"])):S("",!0)]))}});export{ce as default};
