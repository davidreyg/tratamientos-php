import{by as A,U as G,j as z,f as b,W as f,a5 as Q,K as ne,a1 as oe,g as H,c as ie,V as j,bz as Z,bA as le,aL as ce,X as M,ae as ue,af as de,p as pe,a6 as me,ag as ve,h as $,M as fe,m as _,q as C,u as d,i as ee,bB as _e,ar as he,d as be,D as q,C as v,B as s,A as p,ao as N,ap as E,b7 as te,_ as ge,H as L,G as R,am as S,al as T,F as U,O as F,E as P,bC as ye,bD as X,at as xe,y as Se,bE as qe}from"./index.8e1e529b.js";import{u as Ce,d as ke,a as we,b as Fe,c as $e}from"./use-panel.3d95f99b.js";import{L as Ie}from"./SaveTokenInLSTask.c0d2eb3c.js";import{b as Pe,u as Ee,_ as k,a as Ae}from"./BaseInput.5767a8ad.js";import{_ as Qe}from"./BaseSelect.229e0648.js";import{c as Te,a as w,e as Y}from"./index.esm.4940542b.js";import{a as O,u as ae}from"./index.1c9af67c.js";import{Q as W}from"./QueryTypes.b72dec59.js";import{Q as K}from"./QSkeleton.c3a56f41.js";import{_ as Ne}from"./PeriodCreateForm.31e7dbdc.js";import"./QSelect.0d489ee9.js";import"./QField.57308312.js";import"./rtl.b51694b1.js";import"./datetime.b26a663f.js";import"./BaseCheckBox.247ce6e4.js";import"./BaseDatePicker.ea74c138.js";import"./index.005144a5.js";import"./PeriodApi.1278f97e.js";class Le{static async run(){try{return(await A.checkFolderPermissions()).data().data}catch(t){throw t}}}class Re{static async run(){try{return(await A.checkPhpRequirements()).data().data}catch(t){throw t}}}class De{static async run(){try{return(await A.getFaculties()).data().data}catch(t){throw t}}}class Be{static async run(t){try{return(await A.createCapellanAndUser(t)).data().data}catch(a){throw a}}}class Ve{static async run(t){try{await A.setStep(t)}catch(a){throw a}}}var re=G({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:t}){const{proxy:{$q:a}}=H(),o=z(null),r=b(()=>e.stepper.modelValue===e.step.name),i=b(()=>{const n=e.step.disable;return n===!0||n===""}),l=b(()=>{const n=e.step.error;return n===!0||n===""}),c=b(()=>{const n=e.step.done;return i.value===!1&&(n===!0||n==="")}),h=b(()=>{const n=e.step.headerNav,m=n===!0||n===""||n===void 0;return i.value===!1&&e.stepper.headerNav&&m}),g=b(()=>e.step.prefix&&(r.value===!1||e.stepper.activeIcon==="none")&&(l.value===!1||e.stepper.errorIcon==="none")&&(c.value===!1||e.stepper.doneIcon==="none")),x=b(()=>{const n=e.step.icon||e.stepper.inactiveIcon;if(r.value===!0){const m=e.step.activeIcon||e.stepper.activeIcon;return m==="none"?n:m||a.iconSet.stepper.active}if(l.value===!0){const m=e.step.errorIcon||e.stepper.errorIcon;return m==="none"?n:m||a.iconSet.stepper.error}if(i.value===!1&&c.value===!0){const m=e.step.doneIcon||e.stepper.doneIcon;return m==="none"?n:m||a.iconSet.stepper.done}return n}),u=b(()=>{const n=l.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(r.value===!0){const m=e.step.activeColor||e.stepper.activeColor||e.step.color;return m!==void 0?m:n}return n!==void 0?n:i.value===!1&&c.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),y=b(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(u.value!==void 0?` text-${u.value}`:"")+(l.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(g.value===!0?"prefix":"icon"):"")+(r.value===!0?" q-stepper__tab--active":"")+(c.value===!0?" q-stepper__tab--done":"")+(h.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(i.value===!0?" q-stepper__tab--disabled":"")),D=b(()=>e.stepper.headerNav!==!0?!1:h.value);function B(){o.value!==null&&o.value.focus(),r.value===!1&&e.goToPanel(e.step.name)}function V(n){n.keyCode===13&&r.value===!1&&e.goToPanel(e.step.name)}return()=>{const n={class:y.value};h.value===!0&&(n.onClick=B,n.onKeyup=V,Object.assign(n,i.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:t.tabindex||0}));const m=[f("div",{class:"q-focus-helper",tabindex:-1,ref:o}),f("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[f("span",{class:"row flex-center"},[g.value===!0?e.step.prefix:f(Q,{name:x.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const I=[f("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&I.push(f("div",{class:"q-stepper__caption"},e.step.caption)),m.push(f("div",{class:"q-stepper__label q-stepper__line relative-position"},I))}return ne(f("div",n,m),[[oe,D.value]])}}});function se(e){return f("div",{class:"q-stepper__step-content"},[f("div",{class:"q-stepper__step-inner"},M(e.default))])}const J={setup(e,{slots:t}){return()=>se(t)}};var je=G({name:"QStep",props:{...Ce,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:t,emit:a}){const{proxy:{$q:o}}=H(),r=ie(Z,j);if(r===j)return console.error("QStep needs to be a child of QStepper"),j;const{getCacheWithFn:i}=ke(),l=z(null),c=b(()=>r.value.modelValue===e.name),h=b(()=>o.platform.is.ios!==!0&&o.platform.is.chrome===!0||c.value!==!0||r.value.vertical!==!0?{}:{onScroll(u){const{target:y}=u;y.scrollTop>0&&(y.scrollTop=0),e.onScroll!==void 0&&a("scroll",u)}}),g=b(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function x(){const u=r.value.vertical;return u===!0&&r.value.keepAlive===!0?f(ce,r.value.keepAliveProps.value,c.value===!0?[f(r.value.needsUniqueKeepAliveWrapper.value===!0?i(g.value,()=>({...J,name:g.value})):J,{key:g.value},t.default)]:void 0):u!==!0||c.value===!0?se(t):void 0}return()=>f("div",{ref:l,class:"q-stepper__step",role:"tabpanel",...h.value},r.value.vertical===!0?[f(re,{stepper:r.value,step:e,goToPanel:r.value.goToPanel}),r.value.animated===!0?f(le,x):x()]:[x()])}});const Ke=/(-\w)/g;function Me(e){const t={};for(const a in e){const o=a.replace(Ke,r=>r[1].toUpperCase());t[o]=e[a]}return t}var Ue=G({name:"QStepper",props:{...ue,...we,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:Fe,setup(e,{slots:t}){const a=H(),o=de(e,a.proxy.$q),{updatePanelsList:r,isValidPanelName:i,updatePanelIndex:l,getPanelContent:c,getPanels:h,panelDirectives:g,goToPanel:x,keepAliveProps:u,needsUniqueKeepAliveWrapper:y}=$e();pe(Z,b(()=>({goToPanel:x,keepAliveProps:u,needsUniqueKeepAliveWrapper:y,...e})));const D=b(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(o.value===!0?" q-stepper--dark q-dark":"")),B=b(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function V(){const n=M(t.message,[]);if(e.vertical===!0){i(e.modelValue)&&l();const m=f("div",{class:"q-stepper__content"},M(t.default));return n===void 0?[m]:n.concat(m)}return[f("div",{class:B.value},h().map(m=>{const I=Me(m.props);return f(re,{key:I.name,stepper:e,step:I,goToPanel:x})})),n,ve("div",{class:"q-stepper__content q-panel-parent"},c(),"cont",e.swipeable,()=>g.value)]}return()=>(r(t),f("div",{class:D.value},me(t.navigation,V())))}});const Ge=$({__name:"BaseRadio",props:{options:{type:Array,required:!0},name:{type:String,required:!0},label:{type:String,required:!0}},setup(e){const t=e,a=fe(t,"name"),{value:o}=Pe(a,void 0,{type:"radio",initialValue:t.options[0].value});return(r,i)=>(_(),C(_e,{modelValue:d(o),"onUpdate:modelValue":i[0]||(i[0]=l=>ee(o)?o.value=l:null),type:"radio",options:e.options,inline:"",name:a.value},null,8,["modelValue","options","name"]))}});function ze(){const{data:e,isLoading:t,isError:a,isSuccess:o,refetch:r,isFetched:i}=O([W.CHECK_FOLDER_PERMISSIONS],()=>Le.run(),{select:l=>l});return{permissions:e,isLoading:t,isError:a,isSuccess:o,refetch:r,isFetched:i}}function He(){const{data:e,isLoading:t,error:a,isSuccess:o,refetch:r,isFetched:i}=O([W.CHECK_PHP_REQUIREMENTS],()=>Re.run(),{enabled:!1,select:l=>l});return{requirements:e,isLoading:t,error:a,isSuccess:o,refetch:r,isFetched:i}}function Oe(){const{data:e,isLoading:t,error:a,isSuccess:o,refetch:r,isFetched:i}=O([W.ACADEMIC_ENTITY_ALL,"faculties"],()=>De.run());return{data:e,isLoading:t,error:a,isSuccess:o,refetch:r,isFetched:i}}function We(){return ae(e=>Be.run(e))}function Xe(){return ae(e=>Ve.run(e))}const Ye={class:"row"},Je={class:"col-12 row q-col-gutter-y-lg"},Ze=v("div",{class:"col-12"},[v("div",{class:"text-h5 text-bold"},"Informaci\xF3n de la cuenta."),v("div",{class:"text-subtitle2"}," Los detalles a continuaci\xF3n se utilizar\xE1n para crear la cuenta principal de administrador. Tambi\xE9n puede cambiar los detalles en cualquier momento despu\xE9s de iniciar sesi\xF3n. ")],-1),et={class:"col-12"},tt=$({__name:"CapellanStep",emits:["next"],setup(e,{emit:t}){const{data:a}=Oe(),o=t,r=Te().shape({names:w().trim().min(2).required().label("Nombres"),username:w().trim().min(2).required().label("Nombre del usuario"),password:w().trim().min(2).required().label("Contrase\xF1a"),surnames:w().trim().required().label("Apellidos"),email:w().trim().email().required().label("Correo"),gender:w().trim().required().label("G\xE9nero"),academic_entity_id:w().trim().required().label("Facultad"),phone:Y().typeError("Celular debe ser un numero").test("len","Celular debe tener 9 d\xEDgitos",u=>(u==null?void 0:u.toString().length)===9).integer().positive().required().label("Celular"),university_code:Y().typeError("C\xF3digo universitario debe ser un numero").integer().test("len","C\xF3digo universitario debe tener 9 d\xEDgitos",u=>(u==null?void 0:u.toString().length)===9).positive().required().label("C\xF3digo universitario")}),{handleSubmit:i,setErrors:l}=Ee({validationSchema:r}),{isLoading:c,mutateAsync:h}=We(),g=i(async u=>{await h(u,{onSuccess:async()=>{await Ie.run({name:u.username,password:u.password}),o("next"),he.success("Usuario guardado correctamente..")},onError:y=>{y.data.errors&&l(y.data.errors)}})}),x=z([]);return be(a,u=>{u&&(x.value=u.filter(y=>y.parent_id===1).map(y=>({label:y.abbreviation||y.name,value:y.id})))},{immediate:!0}),(u,y)=>(_(),q("div",Ye,[v("div",Je,[Ze,s(Ae,{class:"col-12",onSubmit:d(g)},{actions:p(()=>[s(N,{class:"col-12 justify-start q-pa-none q-pt-md"},{default:p(()=>[s(E,{color:"primary",loading:d(c),type:"submit",icon:"fas fa-floppy-disk",label:"Guardar y Continuar","no-caps":""},null,8,["loading"])]),_:1})]),default:p(()=>[s(k,{name:"names",label:"Nombres",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),s(k,{name:"surnames",label:"Apellidos",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),s(k,{name:"email",label:"Correo",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),s(k,{name:"phone",label:"Celular",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),s(k,{name:"university_code",label:"C\xF3digo Universitario",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),s(Qe,{options:x.value,name:"academic_entity_id",class:"col-xs-12 col-sm-6",label:"Facultad",loading:d(c),required:""},null,8,["options","loading"]),s(Ge,{class:"col-xs-12 col-sm-6 col-md-6",name:"gender",label:"G\xE9nero",required:"",options:[{label:"Masculino",value:"Masculino"},{label:"Femenino",value:"Femenino"}]}),v("div",et,[s(te)]),s(k,{name:"username",label:"Nombre de usuario",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),s(k,{name:"password",type:"password",label:"Contrase\xF1a",required:"",class:"col-xs-12 col-sm-6 col-md-6"})]),_:1},8,["onSubmit"])])]))}}),at={};function rt(e,t){return _(),q("div",null,[(_(),q(L,null,R(3,a=>s(T,{key:a,dense:""},{default:p(()=>[s(S,null,{default:p(()=>[s(K,{type:"text",width:"50%"})]),_:1}),s(S,{side:""},{default:p(()=>[s(K,{width:"25px"})]),_:1}),s(S,{avatar:""},{default:p(()=>[s(K,{type:"QAvatar",size:"25px"})]),_:1})]),_:2},1024)),64))])}var st=ge(at,[["render",rt]]);const nt={class:"row"},ot={class:"col-xs-12 col-sm-10 col-md-9 row q-col-gutter-y-lg"},it=v("div",{class:"col-12"},[v("div",{class:"text-h5 text-bold"},"Permisos de las carpetas."),v("div",{class:"text-subtitle2"}," A continuaci\xF3n se muestra la lista de permisos de carpeta necesarios para que la aplicaci\xF3n funcione. Si la verificaci\xF3n de permisos falla, aseg\xFArese de actualizar los permisos de su carpeta. ")],-1),lt={key:1,class:"justify-start col-12"},ct=$({__name:"FolderPermissionsStep",emits:["next","back"],setup(e){const{permissions:t,isFetched:a,isLoading:o,isError:r}=ze();return(i,l)=>(_(),q("div",nt,[v("div",ot,[it,d(o)?(_(),C(st,{key:0,class:"col-12 justify-start"})):U("",!0),d(a)&&!d(o)&&d(t)?(_(),q("div",lt,[(_(!0),q(L,null,R(d(t).permissions,(c,h)=>(_(),C(T,{key:h,dense:""},{default:p(()=>[s(S,null,{default:p(()=>[F(P(c.folder),1)]),_:2},1024),s(S,{side:""},{default:p(()=>[F(P(c.current_permission),1)]),_:2},1024),s(S,{avatar:""},{default:p(()=>[s(Q,{color:c.isSet?"positive":"negative",name:c.isSet?"fas fa-circle-check":"fas fa-circle-xmark"},null,8,["color","name"])]),_:2},1024)]),_:2},1024))),128))])):U("",!0),s(N,{class:"justify-start col-12"},{default:p(()=>{var c;return[s(E,{color:"primary","no-caps":"",icon:"fas fa-arrow-right",label:"Continuar",disable:((c=d(t))==null?void 0:c.errors)||d(r),onClick:l[0]||(l[0]=h=>{var g;return((g=d(t))==null?void 0:g.errors)===!1&&i.$emit("next")})},null,8,["disable"])]}),_:1})])]))}}),ut={class:"row"},dt={class:"col-12 row q-col-gutter-y-lg"},pt=v("div",{class:"col-12"},[v("div",{class:"text-h5 text-bold"},"Iniciar periodo."),v("div",{class:"text-subtitle2"}," Por favor, ingresa la informaci\xF3n necesaria para definir el inicio y fin del periodo/ciclo. Esta informaci\xF3n ser\xE1 fundamental para la gesti\xF3n de las actividades en el sistema. ")],-1),mt=$({__name:"PeriodStep",setup(e){const{mutate:t,isLoading:a}=Xe(),o=async()=>{t({profile_complete:"COMPLETED"},{onSuccess:async()=>{window.location.reload()}})};return(r,i)=>(_(),q("div",ut,[v("div",dt,[pt,s(Ne,{class:"col-xs-12 col-sm-10 col-md-8",onSubmit:o},{actions:p(({isLoading:l})=>[s(N,{class:"col-12 justify-start q-pa-none q-pt-md"},{default:p(()=>[s(E,{color:"primary",loading:l||d(a),type:"submit",icon:"fas fa-floppy-disk",label:"Guardar y Continuar","no-caps":""},null,8,["loading"])]),_:2},1024)]),_:1})])]))}}),vt={class:"row"},ft={class:"col-xs-12 col-sm-10 col-md-9 row q-col-gutter-y-lg"},_t=v("div",{class:"col-12"},[v("div",{class:"text-h5 text-bold"},"Requisitos del sistema."),F(" Crater tiene algunos requisitos de servidor. Aseg\xFArese de que su servidor tenga la versi\xF3n de php requerida y todas las extensiones mencionadas a continuaci\xF3n. ")],-1),ht={key:0,class:"justify-start col-12"},bt=$({__name:"PhpRequirementsStep",emits:["next","back"],setup(e){const{refetch:t,requirements:a,isLoading:o,isFetched:r}=He(),i=b(()=>{var l;return!!(r.value===!1||((l=a.value)==null?void 0:l.phpSupportInfo.supported)===!1||a.value.errors)});return(l,c)=>(_(),q("div",vt,[v("div",ft,[_t,d(r)&&d(a)?(_(),q("div",ht,[s(T,{dense:""},{default:p(()=>[s(S,null,{default:p(()=>[F(" Php (version "+P(d(a).phpSupportInfo.minimum)+" requerida) ",1)]),_:1}),s(S,{side:""},{default:p(()=>[F(P(d(a).phpSupportInfo.current),1)]),_:1}),s(S,{avatar:""},{default:p(()=>[s(Q,{color:d(a).phpSupportInfo.supported?"positive":"negative",name:d(a).phpSupportInfo.supported?"fas fa-circle-check":"fas fa-circle-xmark"},null,8,["color","name"])]),_:1})]),_:1}),s(te,{spaced:"",inset:""}),(_(!0),q(L,null,R(d(a).requirements,(h,g)=>(_(),C(T,{key:g,dense:""},{default:p(()=>[s(S,null,{default:p(()=>[F(P(g),1)]),_:2},1024),s(S,{avatar:""},{default:p(()=>[s(Q,{color:h?"positive":"negative",name:h?"fas fa-circle-check":"fas fa-circle-xmark"},null,8,["color","name"])]),_:2},1024)]),_:2},1024))),128))])):U("",!0),s(N,{class:"justify-start col-12"},{default:p(()=>[i.value?(_(),C(E,{key:0,color:"primary","no-caps":"",label:"Comprobar Requerimientos",loading:d(o),onClick:c[0]||(c[0]=h=>d(t)())},null,8,["loading"])):(_(),C(E,{key:1,color:"primary","no-caps":"",icon:"fas fa-arrow-right",label:"Continuar",onClick:c[1]||(c[1]=h=>l.$emit("next"))}))]),_:1})])]))}}),gt={class:"row justify-center q-py-xl"},yt={class:"col-xs-11 col-sm-10"},xt={class:"row justify-center"},St={class:"col-xs-6 col-sm-5 col-md-4"},qt={class:"col-12 q-mt-xl"},Ct={components:{1:bt,2:ct,3:tt,4:mt}},Mt=$({...Ct,__name:"InstallationIndex",setup(e){const{currentStep:t}=ye(X()),{nextStep:a}=X();return(o,r)=>(_(),C(qe,{class:"bg-grey-4"},{default:p(()=>[v("div",gt,[v("div",yt,[v("div",xt,[v("div",St,[s(xe,{class:"",src:"/upeu-banner.webp"})]),v("div",qt,[s(Ue,{ref:"stepper",modelValue:d(t),"onUpdate:modelValue":r[1]||(r[1]=i=>ee(t)?t.value=i:null),color:"primary",animated:"","transition-duration":1e3,contracted:""},{default:p(()=>[(_(),q(L,null,R(4,(i,l)=>s(je,{key:l,name:i,title:"","done-icon":"fas fa-circle-check",icon:"fas fa-circle",done:l<d(t)},{default:p(()=>[(_(),C(Se(d(t)+""),{onNext:r[0]||(r[0]=c=>d(a)())},null,32))]),_:2},1032,["name","done"])),64))]),_:1},8,["modelValue"])])])])])]),_:1}))}});export{Mt as default};
