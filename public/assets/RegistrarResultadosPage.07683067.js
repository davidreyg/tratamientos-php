import{aE as oe,aF as te,W as Y,Y as R,o as y,e as q,w as d,a5 as a,ad as $,b3 as Z,aj as F,b8 as se,b9 as ie,f as D,at as L,a2 as n,ba as ne,a3 as re,bd as de,av as ee,bc as ce,k as ae,a1 as ue,ag as le,H as S,ak as M,aK as me,aW as V,au as x,aX as Q,ac as w,ab as T,a$ as be,be as ve,r as N,b0 as U,bf as fe,$ as j,a_ as pe,bg as _e,aU as O,a0 as G,bh as z,bi as ge,aM as ye,aI as he,b1 as $e,b2 as qe,am as H,ae as J,a6 as W,b5 as K,al as Ce}from"./index.f707d301.js";import{u as ke}from"./examenFetchAllQuery.02b4bc94.js";import{O as P,u as X}from"./laboratorio.store.01a9b9fd.js";import{_ as xe}from"./BaseTable.12d83a0d.js";function Ee(l){const p=async()=>(await P.fetchAll(l.value)).data(),{data:v,isLoading:i,isSuccess:C,isError:m,isFetching:c,refetch:e}=oe([te.ORDEN_ALL,l==null?void 0:l.value],p,{keepPreviousData:!0});return{data:v,isLoading:i,isSuccess:C,isError:m,isFetching:c,refetch:e}}function Ne(){return Y(({id:l,data:p})=>P.updateEstado(l,p))}function Re(){return Y(({id:l,data:p})=>P.updateExamens(l,p))}const Fe=F("div",{class:"col-12 text-bold text-italic"},"Datos Generales:",-1),Se=F("div",{class:"col-12 text-bold text-italic"}," Datos del Establecimiento de Origen: ",-1),we=F("div",{class:"col-12 text-bold text-italic"},"Datos del Medico:",-1),De=F("div",{class:"col-12 text-bold text-italic"},"Datos del paciente:",-1),Oe=R({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},setup(l){return(p,v)=>(y(),q(Z,{class:"row"},{default:d(()=>[Fe,a($,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.diagnostico},null,8,["value"]),a($,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.CI10},null,8,["value"]),a($,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.CPN},null,8,["value"]),a($,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.EG},null,8,["value"]),a($,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.codigo_atencion},null,8,["value"]),a($,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.fecha_registro},null,8,["value"]),Se,a($,{name:"establecimiento_tipo",class:"col-xs-12 col-sm-4",label:"Tipo de Establecimiento",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.establecimiento?"Jurisdiccion":"Externo"},null,8,["value"]),a($,{name:"establecimiento_id",class:"col-xs-12 col-sm-8",label:"Establecimiento Origen",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.establecimiento?l.orden.establecimiento.data.nombre:l.orden.establecimiento_otro},null,8,["value"]),we,a($,{name:"medico",label:"Nombre",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.medico},null,8,["value"]),De,a($,{name:"paciente",label:"Nombre",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.paciente.data.nombre_completo},null,8,["value"]),a($,{name:"documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.paciente.data.numero_documento},null,8,["value"])]),_:1}))}}),Qe=R({__name:"BaseCheckBox",props:{name:{type:String,required:!0},label:{type:String,required:!0}},setup(l){const v=se(l,"name"),{value:i,handleChange:C,errorMessage:m}=ie(v);return(c,e)=>(y(),q(ce,{color:"black",borderless:"",error:!!n(m),"bottom-slots":"","hide-bottom-space":!n(m)},{error:d(()=>[D(L(n(m)),1)]),default:d(()=>[a(de,ne(c.$attrs,{modelValue:n(i),"onUpdate:modelValue":[e[0]||(e[0]=b=>re(i)?i.value=b:null),e[1]||(e[1]=b=>n(C)(b))],label:l.label}),null,16,["modelValue","label"]),ee(c.$slots,"default")]),_:3},8,["error","hide-bottom-space"]))}}),Ae={class:"row"},Be=R({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},examens:{type:Array,required:!0},ordenId:{type:Number,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0}},emits:["submit","cancel"],setup(l,{emit:p}){const v=p,i=l,C=ae(()=>i.examens?i.examens.map(o=>({label:o.nombre,value:Number(o.id)})):[]),{handleSubmit:m,setFieldValue:c,values:e}=ue({validationSchema:i.validationSchema,initialValues:i.initialValues}),{mutateAsync:b,reset:_,isLoading:E}=Re(),f=m(async(o,{setErrors:t})=>{await b({id:i.ordenId,data:o},{onSuccess:()=>{le.success("Resultados actualizados correctamente"),v("submit"),_.value()},onError:u=>{_.value(),t(u.data.errors)}})},o=>console.log(o)),r=o=>{let t;return!!e.pivot[o].minimo&&!!e.pivot[o].minimo&&(t=`Min: ${e.pivot[o].minimo} - Max: ${e.pivot[o].maximo}`),t},g=o=>{let t;return!!e.pivot[o].minimo&&!!e.pivot[o].minimo&&(e.pivot[o].resultado>e.pivot[o].minimo&&e.pivot[o].resultado<e.pivot[o].maximo?t="green-2":t="red-2"),t},h=o=>{const t="pivot["+o+"].is_canceled",u=e.pivot[o].is_canceled;c(t,!u)};return i.fields.forEach((o,t)=>{S(()=>e.pivot[t].unidad_id,u=>{if(u){const s=i.examens.find(k=>k.id==e.pivot[t].examen_id);if(!!s&&!!u){const k=s.pivot.find(I=>I.unidad_id===u),A="pivot["+t+"].minimo",B="pivot["+t+"].maximo";k&&(c(A,k.minimo),c(B,k.maximo))}}},{deep:!0,immediate:!0}),S(()=>e.pivot[t].is_canceled,u=>{const s="pivot["+t+"].minimo",k="pivot["+t+"].maximo";u&&(c(s,void 0),c(k,void 0))},{deep:!0,immediate:!0}),S(()=>e.pivot[t].is_enabled,u=>{const s="pivot["+t+"].minimo",k="pivot["+t+"].maximo",A="pivot["+t+"].resultado",B="pivot["+t+"].unidad_id",I="pivot["+t+"].motivo";u||(c(s,void 0),c(k,void 0),c(A,null),c(B,null),c(I,null))},{deep:!0,immediate:!0})}),(o,t)=>(y(),q(Z,{onSubmit:ve(n(f),["prevent"])},{default:d(()=>[(y(!0),M(be,null,me(l.fields,(u,s)=>(y(),M("div",{key:s,class:"row q-col-gutter-sm q-mb-sm"},[a(V,{label:"Examen",name:`pivot[${s}].examen_id`,options:C.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),n(e).pivot[s].is_canceled?(y(),q($,{key:0,name:`pivot[${s}].motivo`,label:"Motivo",class:"col-4",required:"",disable:!n(e).pivot[s].is_enabled},null,8,["name","disable"])):x("",!0),n(e).pivot[s].is_canceled?x("",!0):(y(),q($,{key:1,name:`pivot[${s}].resultado`,"bg-color":g(s),label:"Resultado",class:"col-2",required:"",disable:!n(e).pivot[s].is_enabled},null,8,["name","bg-color","disable"])),n(e).pivot[s].is_canceled?x("",!0):(y(),q(V,{key:2,label:"Unidad",name:`pivot[${s}].unidad_id`,options:n(e).pivot[s].unidads,hint:r(s),class:"col-2",required:"",disable:!n(e).pivot[s].is_enabled},null,8,["name","options","hint","disable"])),a($,{label:"Fecha",type:"date",name:`pivot[${s}].fecha_resultado`,required:"",class:"col-2",disable:!n(e).pivot[s].is_enabled},null,8,["name","disable"]),a(T,{class:"col-2 self-center justify-center"},{default:d(()=>[a(Qe,{name:`pivot[${s}].is_enabled`,label:"",dense:""},{default:d(()=>[a(Q,null,{default:d(()=>[D(L(n(e).pivot[s].is_enabled?"Deshabilitar.":"Habilitar."),1)]),_:2},1024)]),_:2},1032,["name"]),a(w,{icon:n(e).pivot[s].is_canceled?"fas fa-pen":"fas fa-ban",color:n(e).pivot[s].is_canceled?"warning":"negative",disable:!n(e).pivot[s].is_enabled,round:"",flat:"",size:"sm",onClick:k=>h(s)},{default:d(()=>[a(Q,null,{default:d(()=>[D(L(n(e).pivot[s].is_canceled?"Registrar datos.":"Cancelar examen."),1)]),_:2},1024)]),_:2},1032,["icon","color","disable","onClick"])]),_:2},1024)]))),128)),F("div",Ae,[a(T,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:d(()=>[a(w,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:t[0]||(t[0]=u=>o.$emit("cancel"))}),a(w,{label:"Guardar",type:"submit",icon:"fas fa-floppy-disk",color:"primary",loading:n(E),"no-caps":""},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))}}),Ie=R({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0}},emits:["submit","cancel"],setup(l){const p=N({limit:0}),{data:v}=ke(p),i=ae(()=>v.value?v.value.map(b=>({label:b.nombre,value:Number(b.id)})):[]),C=l,m=N([]),c=N(),e=N();return S(()=>v.value,b=>{if(b){m.value=C.orden.pivot.map(f=>{let r=[];const g=b.find(h=>Number(h.id)==f.examen_id);return r=[{label:"Examen",name:"examen_id",type:"select",options:i.value},{label:"Resultado",name:"resultado",type:"string"},{label:"Unidad",name:"unidad_id",type:"select",options:g?g.unidads.data.map(h=>({label:h.nombre,value:Number(h.id)})):[]},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Acciones",name:"actions",type:"array"}],r});const _=U().of(fe(()=>{let f={};return f={examen_id:_e().required().label("Examen"),resultado:O().positive().when(["is_enabled","is_canceled"],{is:(r,g)=>r&&!g,then:r=>r.required(),otherwise:r=>r.nullable()}).transform((r,g)=>g===""?void 0:r).typeError("Debe ingresar un numero").label("Resultado"),fecha_resultado:G().required().label("Fecha"),unidad_id:O().when(["is_enabled","is_canceled"],{is:(r,g)=>r&&!g,then:r=>r.required(),otherwise:r=>r.nullable()}).label("Unidad"),is_canceled:z().required().label("Cancelado?"),is_enabled:z().required().label("Hablitad?"),motivo:G().when(["is_enabled","is_canceled"],{is:!0,then:r=>r.required(),otherwise:r=>r.nullable()}).label("Motivo"),minimo:O(),maximo:O(),unidads:U()},j().shape(f)}));c.value=j().shape({pivot:_});const E=C.orden.pivot.map(f=>{var g;const r=b.find(h=>Number(h.id)==f.examen_id);return{examen_id:f.examen_id,resultado:f.resultado,fecha_resultado:(g=f.fecha_resultado)!=null?g:pe.now().toISODate(),unidad_id:f.unidad_id,is_canceled:f.is_canceled,is_enabled:!0,motivo:f.motivo,unidads:r?r.unidads.data.map(h=>({label:h.nombre,value:Number(h.id)})):[]}});e.value={pivot:E}}},{immediate:!0}),(b,_)=>m.value.length>0&&c.value&&n(v)?(y(),q(Be,{key:0,fields:m.value,"validation-schema":c.value,"initial-values":e.value,"orden-id":Number(l.orden.id),examens:n(v),onCancel:_[0]||(_[0]=E=>b.$emit("cancel")),onSubmit:_[1]||(_[1]=E=>b.$emit("submit"))},null,8,["fields","validation-schema","initial-values","orden-id","examens"])):x("",!0)}}),Le=R({__name:"OrdenTable",props:{ordens:{type:Array,required:!0}},setup(l){const{formatDate:p}=he(),v=[{name:"index",label:"#",field:"index"},{name:"fecha_registro",align:"left",label:"Fecha Registro",field:"fecha_registro",format:i=>p(i)},{name:"medico",align:"center",label:"Medico",field:"medico"},{name:"diagnostico",align:"center",label:"Diagnostico",field:"diagnostico"},{name:"paciente",align:"center",label:"Paciente",field:i=>i.paciente.data.nombre_completo},{name:"documento",align:"center",label:"N\xB0 Documento",field:i=>i.paciente.data.numero_documento},{name:"codigo_atencion",align:"center",label:"Codigo Atenci\xF3n",field:"codigo_atencion"},{name:"estado",align:"center",label:"Estado",field:"estado",sortable:!0},{name:"actions",align:"right",label:"Acciones",field:"actions"}];return(i,C)=>(y(),q(xe,{data:l.ordens,columns:v,"row-key":"id"},{"body-cell-estado":d(({props:m})=>[a(ye,{props:m},{default:d(()=>[a(ge,{color:m.row.estado_detalle.color,label:m.row.estado_detalle.label},null,8,["color","label"])]),_:2},1032,["props"])]),customActions:d(({props:m})=>[ee(i.$slots,"custom-actions",{props:m})]),_:3},8,["data"]))}}),Me={class:"row q-col-gutter-md"},Pe={class:"col-12"},Ge=R({__name:"RegistrarResultadosPage",setup(l){const{$reset:p,fetchOrdenById:v}=X(),{ordenSeleccionada:i,isOrdenLoading:C}=$e(X()),m=N({search:"estado:0,1",searchJoin:"and",limit:0}),c=N(),{data:e,refetch:b}=Ee(m),_=N("list"),E=async o=>{c.value=o,await v(o),i.value&&(_.value="edit-examens")},{mutateAsync:f,isLoading:r}=Ne(),g=async(o,t)=>{c.value=o,await f({id:o,data:{estado:t}},{onSuccess:()=>{le.success("La orden se REGISTRO correctamente."),b.value(),_.value="list"},onError:u=>{console.log(u)}})},h=()=>{i.value=void 0};return qe(()=>{p()}),S(()=>i.value,o=>{o||(_.value="list")}),(o,t)=>(y(),M("div",Me,[F("div",Pe,[a(Ce,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=u=>_.value=u),animated:""},{default:d(()=>[a(H,{name:"list"},{default:d(()=>[n(e)?(y(),q(Le,{key:0,ordens:n(e).data},{"custom-actions":d(({props:u})=>[a(w,{color:"primary",icon:"fas fa-file-signature",round:"",flat:"",size:"sm",loading:n(C)&&c.value===Number(u.key),onClick:s=>E(Number(u.key))},{default:d(()=>[a(Q,null,{default:d(()=>[D("Editar resultados.")]),_:1})]),_:2},1032,["loading","onClick"]),u.row.estado===0?(y(),q(w,{key:0,color:"positive",icon:"fas fa-check-double",round:"",flat:"",size:"sm",loading:n(r)&&c.value===Number(u.key),onClick:s=>g(Number(u.key),1)},{default:d(()=>[a(Q,null,{default:d(()=>[D("Confirmar registro.")]),_:1})]),_:2},1032,["loading","onClick"])):x("",!0)]),_:1},8,["ordens"])):x("",!0)]),_:1}),a(H,{name:"edit-examens"},{default:d(()=>[n(i)?(y(),q(K,{key:0,icon:"fas fa-file-signature",label:"Datos de la orden."},{default:d(()=>[a(J,{class:"my-card"},{default:d(()=>[a(W,null,{default:d(()=>[a(Oe,{orden:n(i)},null,8,["orden"])]),_:1})]),_:1})]),_:1})):x("",!0),n(i)?(y(),q(K,{key:1,icon:"fas fa-vials",label:"Registrar resultados.",caption:"Editar / Crear","default-opened":""},{default:d(()=>[a(J,{class:"my-card"},{default:d(()=>[a(W,null,{default:d(()=>[a(Ie,{orden:n(i),onCancel:h,onSubmit:h},null,8,["orden"])]),_:1})]),_:1})]),_:1})):x("",!0)]),_:1})]),_:1},8,["modelValue"])])]))}});export{Ge as default};
