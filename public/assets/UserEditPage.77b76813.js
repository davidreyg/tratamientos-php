import{aG as F,aH as Q,U as R,X as v,Z as B,$ as d,b4 as V,a0 as w,r as j,j as $,o as b,d as g,w as S,a4 as t,ac as f,aW as L,ai as A,aC as M,e as O,a1 as o,a9 as T,ax as z,aj as G,ad as H,at as q,af as I}from"./index.0b61b42a.js";import{_ as P}from"./SkeletonForm.a34e76f0.js";import{u as W}from"./establecimientoFetchAllQuery.87bb6dd9.js";import{u as X}from"./roleListQuery.7ca5aaa1.js";import{U}from"./UserApi.21292d2c.js";import{_ as Z}from"./BaseCheckBoxGroup.cd7da833.js";import"./EstablecimientoApi.f30e0dee.js";import"./RoleApi.b85f5dd5.js";function D(a,s){const r=async()=>(await U.fetchOne(a)).data().data,{data:i,isLoading:c,isSuccess:n,isError:u,isFetching:m,refetch:l}=F([Q.USERS,a],r,{enabled:s});return{data:i,isLoading:c,isSuccess:n,isError:u,isFetching:m,refetch:l}}function J(){return R(({data:a,id:s})=>U.update(a,s))}const K={class:"col-12"},Y=v({__name:"UserEditForm",props:{user:{type:Object,required:!0}},emits:["submit","cancel"],setup(a,{emit:s}){const r=a,i=s,c=B().shape({name:d().trim().min(2).required().label("Usuario"),nombre_completo:d().trim().min(2).required().label("Nombre Completo"),cargo:d().trim().min(2).required().label("Cargo"),establecimiento_id:d().required().label("Establecimiento"),role_ids:V().of(d().required()).required().label("Roles")}),{handleSubmit:n,setErrors:u,resetForm:m}=w({validationSchema:c,initialValues:r.user}),l=j({limit:0}),{data:_}=W(l),h=$(()=>_.value?_.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{roles:y}=X(),C=$(()=>y.value?y.value.map(e=>({label:e.display_name,value:Number(e.id)})):[]),{isLoading:N,mutate:E,reset:x}=J(),k=n(async e=>{E({data:e,id:Number(r.user.id)},{onSuccess:()=>{i("submit")},onError:p=>{m(),x.value(),u(p.data.errors)}})},e=>{console.log(e)});return(e,p)=>(b(),g(T,{loading:o(N),onSubmit:o(k),onCancel:p[0]||(p[0]=ae=>e.$emit("cancel"))},{default:S(()=>[t(f,{name:"nombre_completo",label:"Nombre Completo",class:"col-12"}),t(f,{name:"name",label:"Usuario",class:"col-xs-12 col-sm-6"}),t(L,{options:h.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento",loading:!1,required:""},null,8,["options"]),t(f,{name:"cargo",label:"Cargo",class:"col-xs-12 col-sm-6"}),A("div",K,[t(M,{spaced:""}),O(" Roles: ")]),t(Z,{name:"role_ids",label:"Roles",options:C.value},null,8,["options"])]),_:1},8,["loading","onSubmit"]))}}),ee={class:"row"},ue=v({__name:"UserEditPage",props:{id:{type:Number,required:!0}},setup(a){const s=a,r=z(),{data:i,isSuccess:c,isFetching:n}=D(s.id,!0),u=()=>{I.success("Registro actualizado correctamente"),r.back()};return(m,l)=>(b(),G("div",ee,[o(n)?(b(),g(H,{key:0,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg"},{default:S(()=>[t(P,{class:"col-12",inputs:2})]),_:1})):q("",!0),o(c)&&!o(n)&&o(i)?(b(),g(Y,{key:1,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg",user:o(i),onSubmit:u,onCancel:l[0]||(l[0]=_=>m.$router.back())},null,8,["user"])):q("",!0)]))}});export{ue as default};
