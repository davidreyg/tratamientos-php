var ne=Object.defineProperty;var oe=(e,a,s)=>a in e?ne(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s;var A=(e,a,s)=>(oe(e,typeof a!="symbol"?a+"":a,s),s);import{W as O,b6 as Q,aE as J,aF as W,a as re,Y as j,a1 as P,ag as Z,o as r,e as h,w as g,ak as $,a_ as w,ad as D,aZ as q,a2 as _,aa as K,r as S,H as R,b7 as X,b8 as ee,$ as T,b9 as ae,aY as le,au as C,ba as te,aS as V,a5 as m,ae as ue,x as M,Q as U,a8 as I,f as G,a7 as H,aP as ce,aH as Y,aG as k,aI as de,bb as ie,bc as B,ac as se,am as L,al as me,aR as fe,k as pe,a0 as be,bd as ve,aU as ge,ab as _e,be as ye,aj as he,bf as $e,bg as z}from"./index.dc07db66.js";import{_ as Se}from"./SkeletonForm.b3aee6b9.js";import{_ as je}from"./BaseTable.b7c1a2f2.js";function xe(){return O(e=>Q.create(e))}function qe(){return O(e=>Q.delete(e))}function Te(e,a){const s=async()=>(await Q.findById(e)).data().data,{data:c,isLoading:l,isSuccess:n,isError:d,isFetching:t,refetch:u}=J([W.TRIAJE_ALL,e],s,{enabled:a});return{data:c,isLoading:l,isSuccess:n,isError:d,isFetching:t,refetch:u}}function we(){return O(({data:e,id:a})=>Q.update(e,a))}const N=class{static async fetchAll(a){return await N._api.get(N._endpoint,a)}};let E=N;A(E,"_api",re),A(E,"_endpoint","/signos");function Ce(e){const a=async()=>(await E.fetchAll(e==null?void 0:e.value)).data().data,{data:s,isLoading:c,isSuccess:l,isError:n,isFetching:d,refetch:t}=J([W.SIGNO_ALL],a);return{data:s,isLoading:c,isSuccess:l,isError:n,isFetching:d,refetch:t}}const Fe=j({__name:"FormDinamico",props:{fields:{type:Array,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0}},emits:["submit","cancel"],setup(e,{emit:a}){const s=a,c=e,{handleSubmit:l,setErrors:n,resetForm:d}=P({validationSchema:c.validationSchema,initialValues:c.initialValues}),{mutateAsync:t,reset:u,isLoading:v}=xe(),f=l(async p=>{await t(p,{onSuccess:()=>{Z.success(),s("submit")},onError:y=>{u.value(),n(y.data.errors)}})}),o=()=>{d(),s("cancel")};return(p,y)=>(r(),h(K,{loading:_(v),onSubmit:_(f),onCancel:o},{default:g(()=>[(r(!0),$(q,null,w(e.fields.filter(i=>i.type!=="array"),(i,b)=>(r(),h(D,{key:b,name:i.name,label:i.label,suffix:i.suffix,type:i.type,"stack-label":!0,class:"col-xs-12 col-sm-4"},null,8,["name","label","suffix","type"]))),128)),(r(!0),$(q,null,w(e.fields.filter(i=>i.type==="array"),(i,b)=>(r(),$("div",{key:b,class:"col-12 row q-col-gutter-md"},[(r(!0),$(q,null,w(i.fields,(x,F)=>(r(),h(D,{key:F,name:`pivot[${F}].valor`,label:x.label,suffix:x.suffix,"stack-label":!0,class:"col-xs-12 col-sm-4"},null,8,["name","label","suffix"]))),128))]))),128))]),_:1},8,["loading","onSubmit"]))}}),Ee=j({__name:"TriajeCreateForm",props:{pacienteId:{type:Number,required:!0}},emits:["submit","cancel"],setup(e){const a=e,s=S({search:"estado:1"}),{data:c}=Ce(s),l=S([]),n=S(),d=S();return R(()=>c.value,t=>{if(t){const u=t.map(p=>({label:p.nombre,name:p.nombre,type:"number",suffix:p.unidad}));l.value=[{name:"fecha_registro",label:"Fecha Registro",type:"date"},{name:"pivot",label:"Signos",type:"array",fields:u}];const v=X().of(ee(p=>{const y=t.find(b=>b.id==p.signo_id);let i={};return y&&(i={signo_id:te().when([],{is:()=>y.is_required,then:b=>b.required(),otherwise:b=>b.optional()}).label("Id del signo"),valor:V().positive().when([],{is:()=>y.is_required,then:b=>b.required(),otherwise:b=>b.optional()}).transform((b,x)=>x===""?void 0:b).typeError("Debe ingresar un numero").label(y.nombre)}),T().shape(i)})),f=T().shape({fecha_registro:ae().required().label("Fecha Registro")}).required();n.value=f.concat(T().shape({pivot:v}));const o=t.map(p=>({signo_id:p.id,valor:void 0}));d.value={fecha_registro:le.now().toISODate(),paciente_id:a.pacienteId,pivot:o}}},{immediate:!0}),(t,u)=>l.value.length>0&&n.value?(r(),h(Fe,{key:0,fields:l.value,"validation-schema":n.value,"initial-values":d.value,onCancel:u[0]||(u[0]=v=>t.$emit("cancel")),onSubmit:u[1]||(u[1]=v=>t.$emit("submit"))},null,8,["fields","validation-schema","initial-values"])):C("",!0)}}),ke=j({__name:"FormDinamicoEdit",props:{fields:{type:Array,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0},triajeId:{type:Number,required:!0}},emits:["submit","cancel"],setup(e,{emit:a}){const s=a,c=e,{handleSubmit:l,setErrors:n,resetForm:d}=P({validationSchema:c.validationSchema,initialValues:c.initialValues}),{mutateAsync:t,reset:u,isLoading:v}=we(),f=l(async p=>{await t({data:p,id:c.triajeId},{onSuccess:()=>{d(),Z.success(),s("submit")},onError:y=>{u.value(),n(y.data.errors)}})}),o=()=>{d(),s("cancel")};return(p,y)=>(r(),h(K,{loading:_(v),onSubmit:_(f),onCancel:o},{default:g(()=>[(r(!0),$(q,null,w(e.fields.filter(i=>i.type!=="array"),(i,b)=>(r(),h(D,{key:b,name:i.name,label:i.label,suffix:i.suffix,type:i.type,"stack-label":!0,class:"col-xs-12 col-sm-4"},null,8,["name","label","suffix","type"]))),128)),(r(!0),$(q,null,w(e.fields.filter(i=>i.type==="array"),(i,b)=>(r(),$("div",{key:b,class:"col-12 row q-col-gutter-md"},[(r(!0),$(q,null,w(i.fields,(x,F)=>(r(),h(D,{key:F,name:`pivot[${F}].valor`,label:x.label,suffix:x.suffix,"stack-label":!0,class:"col-xs-12 col-sm-4"},null,8,["name","label","suffix"]))),128))]))),128))]),_:1},8,["loading","onSubmit"]))}}),De={class:"row"},Ie=j({__name:"TriajeEditForm",props:{triajeId:{type:Number,required:!0}},emits:["submit","cancel"],setup(e){const a=e,{data:s,isFetching:c}=Te(a.triajeId,!0),l=S([]),n=S(),d=S();return R(()=>s.value,t=>{if(t){const u=t.signos.data.map(o=>({label:o.nombre,name:o.nombre,type:"number",suffix:o.unidad}));l.value=[{name:"fecha_registro",label:"Fecha Registro",type:"date"},{name:"pivot",label:"Signos",type:"array",fields:u}];const v=X().of(ee(o=>{const p=t.signos.data.find(i=>i.id==o.signo_id);let y={};return p&&(y={signo_id:te().when([],{is:()=>p.is_required,then:i=>i.required(),otherwise:i=>i.optional()}).label("Id del signo"),valor:V().positive().when([],{is:()=>p.is_required,then:i=>i.required(),otherwise:i=>i.optional()}).transform((i,b)=>b===""?void 0:i).typeError("Debe ingresar un numero").label(p.nombre)}),T().shape(y)})),f=T().shape({fecha_registro:ae().required().label("Fecha Registro")}).required();n.value=f.concat(T().shape({pivot:v})),d.value={fecha_registro:t.fecha_registro,paciente_id:t.paciente_id,pivot:t.pivot}}},{immediate:!0}),(t,u)=>(r(),$("div",De,[_(c)?(r(),h(ue,{key:0,class:"col-12 q-pa-lg"},{default:g(()=>[m(Se,{class:"col-12",inputs:5})]),_:1})):C("",!0),l.value.length>0&&n.value&&!_(c)?(r(),h(ke,{key:1,fields:l.value,"validation-schema":n.value,"initial-values":d.value,"triaje-id":e.triajeId,onCancel:u[0]||(u[0]=v=>t.$emit("cancel")),onSubmit:u[1]||(u[1]=v=>t.$emit("submit"))},null,8,["fields","validation-schema","initial-values","triaje-id"])):C("",!0)]))}}),Be=j({__name:"TriajesTableActions",props:{id:{type:String,required:!0}},emits:["destroy","edit"],setup(e){return(a,s)=>(r(),$(q,null,[M((r(),h(H,{clickable:"",onClick:s[0]||(s[0]=c=>a.$emit("edit",e.id))},{default:g(()=>[m(I,{avatar:""},{default:g(()=>[m(U,{name:"fas fa-pen-to-square",color:"warning"})]),_:1}),m(I,null,{default:g(()=>[G("Editar")]),_:1})]),_:1})),[[Y]]),m(ce),M((r(),h(H,{clickable:"",onClick:s[1]||(s[1]=c=>a.$emit("destroy",e.id))},{default:g(()=>[m(I,{avatar:""},{default:g(()=>[m(U,{name:"fas fa-trash-can",color:"negative"})]),_:1}),m(I,null,{default:g(()=>[G("Eliminar")]),_:1})]),_:1})),[[Y]])],64))}}),Ne=j({__name:"TriajesTable",props:{loading:{type:Boolean,required:!1,default:!1},data:{type:Array,required:!0},serverPagination:{type:Object,default:void 0}},emits:["destroyOne","edit"],setup(e,{emit:a}){const s=a,{formatDate:c}=de(),l=[{name:"fecha_registro",align:"left",label:"Fecha de Registro",field:"fecha_registro",format:t=>c(t),sortable:!0},{name:"actions",align:"right",label:"Acciones",field:"actions"}],{mutateAsync:n}=qe(),d=t=>{k.fire({title:"\xBFEst\xE1 seguro de eliminar este registro?",text:"No podra deshacer los cambios!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No",showLoaderOnConfirm:!0,preConfirm:async()=>{await n(t,{onSuccess:async()=>{s("destroyOne",t)},onError:()=>{k.hideLoading()}})},allowOutsideClick:()=>!k.isLoading()})};return(t,u)=>(r(),h(je,{columns:l,data:e.data,loading:e.loading,"row-key":"id","show-grid-toggle":!1},{actions:g(({key:v})=>[m(Be,{id:v,onEdit:f=>t.$emit("edit",v),onDestroy:f=>d(v)},null,8,["id","onEdit","onDestroy"])]),_:1},8,["data","loading"]))}}),Qe=j({__name:"TriajeTab",setup(e){const{paciente:a,triajesDelPaciente:s,isTriajesLoading:c}=ie(B()),{fetchTriajesDelPaciente:l}=B(),n=S("list"),d=S(),t=async()=>{a.value&&(await l(a.value.id),n.value="list")},u=async v=>{n.value="edit",d.value=Number(v)};return(v,f)=>_(a)?(r(),h(me,{key:0,modelValue:n.value,"onUpdate:modelValue":f[4]||(f[4]=o=>n.value=o),animated:"",class:""},{default:g(()=>[m(L,{name:"list"},{default:g(()=>[m(se,{color:"primary",icon:"add",outline:"",label:"Nuevo",class:"q-mb-md",onClick:f[0]||(f[0]=o=>n.value="new")}),m(Ne,{data:_(s),loading:_(c),onDestroyOne:f[1]||(f[1]=o=>_(l)(_(a).id)),onEdit:u},null,8,["data","loading"])]),_:1}),m(L,{name:"new"},{default:g(()=>[m(Ee,{"paciente-id":Number(_(a).id),onCancel:f[2]||(f[2]=o=>n.value="list"),onSubmit:t},null,8,["paciente-id"])]),_:1}),m(L,{name:"edit"},{default:g(()=>[d.value?(r(),h(Ie,{key:0,"triaje-id":d.value,onCancel:f[3]||(f[3]=o=>n.value="list"),onSubmit:t},null,8,["triaje-id"])):C("",!0)]),_:1})]),_:1},8,["modelValue"])):C("",!0)}}),Ae={class:"row q-col-gutter-md"},Le={class:"col-12"},Me=j({__name:"TriajeRegistroPage",setup(e){const{fetchPaciente:a,$reset:s,fetchTriajesDelPaciente:c}=B(),{paciente:l,isPacienteLoading:n}=ie(B()),{data:d}=fe(),t=pe(()=>d.value?d.value.map(o=>({label:o.nombre,value:o.id})):[]),u=T().shape({numero_documento:V().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:be().required().label("Tipo de Documento")}),{handleSubmit:v}=P({validationSchema:u}),f=v(async o=>{await a(o.numero_documento),l.value?k.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}):k.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})});return ve(()=>{s()}),R(()=>l.value,async o=>{o&&(console.log("hay paciente, debeiramos buscar su triaje"),await c(o.id))}),(o,p)=>(r(),$("div",Ae,[m(ye,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:_(f)},{default:g(()=>[m(ge,{options:t.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),m(D,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),m(_e,{class:"col-auto justify-center"},{default:g(()=>[m(se,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:_(n)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),he("div",Le,[m(z,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear"},{default:g(()=>[m($e,{paciente:_(l),onCancel:_(s),onSubmit:p[0]||(p[0]=y=>_(a)(y))},null,8,["paciente","onCancel"])]),_:1}),_(l)?(r(),h(z,{key:0,icon:"fas fa-stethoscope",label:"Triaje",caption:"Editar / Crear"},{default:g(()=>[m(Qe)]),_:1})):C("",!0)])]))}});export{Me as default};
