import{aG as fe,aH as he,U as ge,X as Z,j as x,r as B,Z as T,$ as S,aU as u,a_ as xe,b4 as L,a0 as ye,b5 as P,G as $e,o as r,aj as d,a4 as a,w as i,aW as y,ac as $,a1 as s,ai as q,b6 as I,ab as F,as as z,at as c,aP as D,a8 as G,e as X,aD as Y,aJ as H,d as w,a7 as J,v as qe,a6 as W,a9 as we,af as N,b7 as Ee,ax as ke,ad as Ue}from"./index.0b61b42a.js";import{_ as Ce}from"./SkeletonForm.a34e76f0.js";import{u as Se}from"./categoriaFetchAllQuery.8519a498.js";import{E as K}from"./ExamenApi.76925565.js";import{u as Fe,a as Qe}from"./unidadTiposFetchAllQuery.f81b07c2.js";import{u as Ne}from"./respuestaFetchAllQuery.01893b66.js";import{u as Ve}from"./operadoresFetchAllQuery.2318cb1a.js";import{u as Ae}from"./unidadFetchAllQuery.ff101a91.js";import{_ as Re}from"./BaseCheckBox.6b28d6ca.js";import"./CategoriaApi.d622634b.js";import"./UnidadApi.48fefe35.js";import"./RespuestaApi.777fe001.js";function Oe(n,m){const b=async()=>(await K.fetchOne(n)).data().data,{data:p,isLoading:_,isSuccess:f,isError:h,isFetching:E,refetch:v}=fe([he.EXAMEN_ALL,n],b,{enabled:m});return{data:p,isLoading:_,isSuccess:f,isError:h,isFetching:E,refetch:v}}function Me(){return ge(({data:n,id:m})=>K.update(n,m))}const je={class:"row"},Be={key:0,class:"col-xs-12 col-sm-12"},Te={class:"row"},Le={key:0,class:"text-red text-italic"},Pe={class:"row q-col-gutter-sm q-mb-sm"},Ie={class:"col-auto self-center"},ze={key:1,class:"col-xs-12 col-sm-12"},De={class:"row"},Ge={key:0,class:"text-red text-italic"},Xe={class:"row q-col-gutter-sm q-mb-sm"},Ye={class:"col-4 self-center"},He=Z({__name:"ExamenEditForm",props:{examen:{type:Object,required:!0}},emits:["submit","cancel"],setup(n,{emit:m}){const b=n,p=m,{data:_}=Se(),f=x(()=>_.value?_.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:h}=Fe(),E=x(()=>h.value?Object.values(h.value).map(e=>({label:e,value:e})):[]),{data:v}=Ae(),Q=x(()=>v.value?Object.values(v.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:V}=Ne(),A=x(()=>V.value?Object.values(V.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:R}=Qe(),ee=x(()=>R.value?Object.values(R.value).map(e=>({label:e,value:e})):[]),{data:O}=Ve(),ae=x(()=>O.value?Object.entries(O.value).map(([e,o])=>({label:`${o} (${e})`,value:e})):[]),k=B(),U=B(),se=T().shape({nombre:S().trim().min(2).required().label("Nombre"),codigo:u().typeError("Codigo debe ser un numero").positive().required().label("Codigo"),tipo:S().trim().min(2).required().label("Tipo"),categoria_id:u().required().label("Categoria"),is_active:xe().required().label("\xBFActivo?"),precio:u().typeError("Precio debe ser un numero").positive().required().label("Precio"),pivot:L().when(["tipo"],{is:e=>e==="unidad",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(T({unidad_id:u().typeError("Unidad debe ser un numero").positive().required().label("Unidad"),examen_id:u().typeError("Examen debe ser un numero").positive().label("Examen"),minimo:u().typeError("Minimo debe ser un numero").min(0).required().label("Minimo"),maximo:u().typeError("Maximo debe ser un numero").positive().when(["tipo"],{is:e=>e==="multivalor",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Maximo"),tipo:S().required().label("Tipo"),operador:S().when(["tipo"],{is:e=>e==="operador",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Operador")})).label("Unidades"),respuesta_ids:L().when(["tipo"],{is:e=>e==="respuesta",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(u().required()).label("Respuestas")}),{handleSubmit:oe,setErrors:te,values:g,errors:C,setFieldValue:re}=ye({validationSchema:se,initialValues:{...b.examen}}),{remove:le,push:ie,fields:M}=P("pivot"),{remove:ne,push:ue,fields:j}=P("respuesta_ids"),de=e=>{if(M.value.some(l=>l.value.unidad_id===e.value)){N.warn("Ya has agregado este item");return}ie({unidad_id:Number(e.value)}),k.value=void 0},ce=e=>{if(j.value.some(l=>l.value===e.value)){N.warn("Ya has agregado este item");return}ue(Number(e.value)),U.value=void 0},{isLoading:me,mutate:pe,reset:ve}=Me(),be=oe(async e=>{pe({data:e,id:b.examen.id},{onSuccess:()=>{p("submit")},onError:o=>{ve.value(),te(o.data.errors)}})},e=>{console.log(e)});return $e(()=>g.tipo,e=>{e&&re("pivot",[])}),(e,o)=>(r(),d("div",je,[a(we,{class:"col-xs-12 col-sm-10",loading:s(me),onSubmit:s(be),onCancel:o[4]||(o[4]=l=>e.$emit("cancel"))},{default:i(()=>[a(y,{options:f.value,name:"categoria_id",label:"Categoria",class:"col-xs-12 col-sm-6"},null,8,["options"]),a($,{name:"codigo",label:"Codigo",class:"col-xs-12 col-sm-6"}),a($,{name:"nombre",label:"Nombre",class:"col-xs-12 col-sm-9"}),a($,{name:"precio",label:"Precio",class:"col-xs-12 col-sm-3"}),a(Re,{name:"is_active",label:"\xBFActivo?",class:"col-xs-12 col-sm-6"}),a(y,{options:E.value,name:"tipo",label:"Tipo",class:"col-xs-12 col-sm-6"},null,8,["options"]),s(g).tipo==="unidad"?(r(),d("div",Be,[q("div",Te,[a(I,{modelValue:k.value,"onUpdate:modelValue":o[1]||(o[1]=l=>k.value=l),options:Q.value,borderless:"",dense:"",name:"unidadees1",label:"Unidades",class:"col-4 q-mb-md"},{after:i(()=>[a(F,{disable:!k.value,round:"",dense:"",icon:"add",color:"positive",onClick:o[0]||(o[0]=l=>de(k.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),s(C).pivot?(r(),d("div",Le,z(s(C).pivot),1)):c("",!0),a(D,{bordered:""},{default:i(()=>[a(G,{header:""},{default:i(()=>[X("Seleccionar Unidades")]),_:1}),(r(!0),d(Y,null,H(s(M),(l,t)=>(r(),w(W,{key:t},{default:i(()=>[a(J,null,{default:i(()=>[q("div",Pe,[qe(a($,{label:"examen",name:`pivot[${t}].examen_id`,class:"col-3",required:""},null,8,["name"]),[[Ee,!1]]),a(y,{label:"Unidades",name:`pivot[${t}].unidad_id`,options:Q.value,class:"col-2",required:""},null,8,["name","options"]),s(g).pivot[t].tipo==="operador"?(r(),w(y,{key:0,name:`pivot[${t}].operador`,options:ae.value,label:"Operador",class:"col-3"},null,8,["name","options"])):c("",!0),a($,{name:`pivot[${t}].minimo`,label:s(g).pivot[t].tipo==="multivalor"?"Minimo":"Valor",class:"col-3"},null,8,["name","label"]),s(g).pivot[t].tipo==="multivalor"?(r(),w($,{key:1,name:`pivot[${t}].maximo`,label:"Maximo",class:"col-3"},null,8,["name"])):c("",!0),a(y,{options:ee.value,name:`pivot[${t}].tipo`,label:"Tipo",class:"col-3"},null,8,["options","name"]),q("div",Ie,[a(F,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:_e=>s(le)(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):c("",!0),s(g).tipo==="respuesta"?(r(),d("div",ze,[q("div",De,[a(I,{modelValue:U.value,"onUpdate:modelValue":o[3]||(o[3]=l=>U.value=l),options:A.value,borderless:"",dense:"",name:"respuestas1",label:"Respuesta",class:"col-4 q-mb-md"},{after:i(()=>[a(F,{disable:!U.value,round:"",dense:"",icon:"add",color:"positive",onClick:o[2]||(o[2]=l=>ce(U.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),s(C).respuesta_ids?(r(),d("div",Ge,z(s(C).respuesta_ids),1)):c("",!0),a(D,{bordered:""},{default:i(()=>[a(G,{header:""},{default:i(()=>[X("Seleccionar Respuestas")]),_:1}),(r(!0),d(Y,null,H(s(j),(l,t)=>(r(),w(W,{key:t},{default:i(()=>[a(J,null,{default:i(()=>[q("div",Xe,[a(y,{label:"Respuesta",name:`respuesta_ids[${t}]`,options:A.value,class:"col-8",required:""},null,8,["name","options"]),q("div",Ye,[a(F,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:_e=>s(ne)(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):c("",!0)]),_:1},8,["loading","onSubmit"])]))}}),Je={class:"row"},ua=Z({__name:"ExamenEditPage",props:{id:{type:Number,required:!0}},setup(n){const m=n,b=ke(),{data:p,isSuccess:_,isFetching:f}=Oe(m.id,!0),h=()=>{N.success("Registro actualizado correctamente"),b.back()};return(E,v)=>(r(),d("div",Je,[s(f)?(r(),w(Ue,{key:0,class:"col-xs-12 col-sm-10 q-pa-lg"},{default:i(()=>[a(Ce,{class:"col-12",inputs:3})]),_:1})):c("",!0),s(_)&&!s(f)&&s(p)?(r(),w(He,{key:1,class:"col-xs-12 col-sm-10",examen:s(p),gol:s(p),onSubmit:h,onCancel:v[0]||(v[0]=Q=>E.$router.back())},null,8,["examen","gol"])):c("",!0)]))}});export{ua as default};
