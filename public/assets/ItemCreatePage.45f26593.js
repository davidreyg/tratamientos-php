import{W as pe,Y as P,k as v,r as y,$ as I,a0 as M,aV as i,b1 as A,a1 as ve,b2 as B,ag as k,o as r,ak as u,a5 as s,w as l,aX as b,ad as x,a2 as o,aj as c,b3 as j,ac as $,at as L,au as g,aQ as T,a9 as O,f as Y,aE as z,aK as D,e as C,a8 as J,a7 as K,aa as be}from"./index.4a4b5f86.js";import{u as _e}from"./examenFetchAllQuery.fc3a579b.js";import{u as fe,a as he,b as xe}from"./unidadFetchAllQuery.8dc243a9.js";import{I as $e}from"./ItemApi.4588d478.js";import{u as ge}from"./seccionFetchAllQuery.51083fca.js";import"./ExamenApi.d016762f.js";function qe(){return pe(q=>$e.create(q))}const ye={class:"row"},ke={key:0,class:"col-xs-12 col-sm-12"},Ce={class:"row"},Se={key:0,class:"text-red text-italic"},Ue={class:"row q-col-gutter-sm q-mb-sm"},we={class:"col-auto self-center"},Ne={key:1,class:"col-xs-12 col-sm-12"},Ee={class:"row"},Qe={key:0,class:"text-red text-italic"},Ve={class:"row q-col-gutter-sm q-mb-sm"},Re={class:"col-4 self-center"},Fe=P({__name:"ItemCreateForm",emits:["submit","cancel"],setup(q,{emit:_}){const d=_,{data:f}=ge(),W=v(()=>f.value?f.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),X=y({limit:0,search:"is_active:1",searchJoin:"and"}),{data:S}=_e(X),G=v(()=>S.value?S.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:U}=fe(),H=v(()=>U.value?Object.values(U.value).map(e=>({label:e,value:e})):[]),{data:w}=he(),N=v(()=>w.value?Object.values(w.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:E}=xe(),Q=v(()=>E.value?Object.values(E.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),Z=I().shape({nombre:M().trim().min(2).required().label("Nombre"),codigo:i().typeError("Codigo debe ser un numero").positive().required().label("Codigo"),tipo:M().trim().min(2).required().label("Tipo"),seccion_id:i().required().label("Seccion"),examen_id:i().required().label("Examen"),pivot:A().when(["tipo"],{is:e=>e==="unidad",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(I({unidad_id:i().typeError("Unidad debe ser un numero").positive().required().label("Unidad"),minimo:i().typeError("Minimo debe ser un numero").positive().required().label("Minimo"),maximo:i().typeError("Maximo debe ser un numero").positive().required().label("Maximo")})).label("Unidades"),respuesta_ids:A().when(["tipo"],{is:e=>e==="respuesta",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(i().required()).label("Respuestas")}),{handleSubmit:ee,setErrors:se,values:V,errors:h}=ve({validationSchema:Z}),m=y(),p=y(),{remove:ae,push:te,fields:R}=B("pivot"),{remove:oe,push:le,fields:F}=B("respuesta_ids"),re=e=>{if(R.value.some(t=>t.value.unidad_id===e.value)){k.warn("Ya has agregado este item");return}te({unidad_id:Number(e.value)}),m.value=void 0},ne=e=>{if(F.value.some(t=>t.value===e.value)){k.warn("Ya has agregado este item");return}le(Number(e.value)),p.value=void 0},{isLoading:ie,mutate:ue,reset:de}=qe(),ce=ee(async e=>{ue(e,{onSuccess:()=>{k.success(),d("submit")},onError:a=>{de.value(),se(a.data.errors)}})},e=>{console.log(e.errors)});return(e,a)=>(r(),u("div",ye,[s(be,{class:"col-xs-12 col-sm-10",loading:o(ie),onSubmit:o(ce),onCancel:a[4]||(a[4]=t=>e.$emit("cancel"))},{default:l(()=>[s(b,{options:G.value,name:"examen_id",label:"Examen",class:"col-12"},null,8,["options"]),s(b,{options:W.value,name:"seccion_id",label:"Seccion",class:"col-xs-12 col-sm-6"},null,8,["options"]),s(x,{name:"codigo",label:"Codigo",class:"col-xs-12 col-sm-6"}),s(x,{name:"nombre",label:"Nombre",class:"col-xs-12 col-sm-6"}),s(b,{options:H.value,name:"tipo",label:"Tipo",class:"col-xs-12 col-sm-6"},null,8,["options"]),o(V).tipo==="unidad"?(r(),u("div",ke,[c("div",Ce,[s(j,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=t=>m.value=t),options:N.value,borderless:"",dense:"",name:"unidadees1",label:"Unidades",class:"col-4 q-mb-md"},{after:l(()=>[s($,{disable:!m.value,round:"",dense:"",icon:"add",color:"positive",onClick:a[0]||(a[0]=t=>re(m.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),o(h).pivot?(r(),u("div",Se,L(o(h).pivot),1)):g("",!0),s(T,{bordered:""},{default:l(()=>[s(O,{header:""},{default:l(()=>[Y("Seleccionar Unidades")]),_:1}),(r(!0),u(z,null,D(o(R),(t,n)=>(r(),C(K,{key:n},{default:l(()=>[s(J,null,{default:l(()=>[c("div",Ue,[s(b,{label:"Unidades",name:`pivot[${n}].unidad_id`,options:N.value,class:"col-3",required:""},null,8,["name","options"]),s(x,{name:`pivot[${n}].minimo`,label:"Minimo",class:"col-4"},null,8,["name"]),s(x,{name:`pivot[${n}].maximo`,label:"Maximo",class:"col-4"},null,8,["name"]),c("div",we,[s($,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:me=>o(ae)(n)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):g("",!0),o(V).tipo==="respuesta"?(r(),u("div",Ne,[c("div",Ee,[s(j,{modelValue:p.value,"onUpdate:modelValue":a[3]||(a[3]=t=>p.value=t),options:Q.value,borderless:"",dense:"",name:"respuestas1",label:"Respuesta",class:"col-4 q-mb-md"},{after:l(()=>[s($,{disable:!p.value,round:"",dense:"",icon:"add",color:"positive",onClick:a[2]||(a[2]=t=>ne(p.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),o(h).respuesta_ids?(r(),u("div",Qe,L(o(h).respuesta_ids),1)):g("",!0),s(T,{bordered:""},{default:l(()=>[s(O,{header:""},{default:l(()=>[Y("Seleccionar Respuestas")]),_:1}),(r(!0),u(z,null,D(o(F),(t,n)=>(r(),C(K,{key:n},{default:l(()=>[s(J,null,{default:l(()=>[c("div",Ve,[s(b,{label:"Respuesta",name:`respuesta_ids[${n}]`,options:Q.value,class:"col-8",required:""},null,8,["name","options"]),c("div",Re,[s($,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:me=>o(oe)(n)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):g("",!0)]),_:1},8,["loading","onSubmit"])]))}}),Te=P({__name:"ItemCreatePage",setup(q){return(_,d)=>(r(),C(Fe,{onSubmit:d[0]||(d[0]=f=>_.$router.back()),onCancel:d[1]||(d[1]=f=>_.$router.back())}))}});export{Te as default};
