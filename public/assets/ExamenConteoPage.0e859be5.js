import{aZ as d,aG as N,aH as P,X as W,j as k,o as f,aj as E,aJ as F,a4 as n,w as u,a5 as M,ai as b,as as S,aP as U,aD as O,d as V,a7 as C,e as I,a6 as X,ad as Y,r as v,Z,$ as L,bk as Q,ae as J,a0 as K,G as A,ab as $,aa as ee,v as ae,aW as R,b6 as te,a1 as p,ac as B,a9 as se,at as oe,b7 as ne}from"./index.ddaffeba.js";import{u as ie}from"./establecimientoFetchAllQuery.4c2447b5.js";import{O as q}from"./OrdenApi.610e0468.js";import"./EstablecimientoApi.0ae636f8.js";const ce=[{label:"Hoy",value:"Hoy"},{label:"Esta semana",value:"Esta semana"},{label:"Este mes",value:"Este mes"},{label:"Este a\xF1o",value:"Este a\xF1o"},{label:"Personalizado",value:"Personalizado"}];function le(c){const e={fecha_inicio:"",fecha_fin:""},a=d.local().setLocale("es-PE");switch(c){case"Hoy":e.fecha_inicio=a.toISODate(),e.fecha_fin=a.toISODate();break;case"Esta semana":e.fecha_inicio=a.startOf("week",{useLocaleWeeks:!0}).toISODate(),e.fecha_fin=a.endOf("week",{useLocaleWeeks:!0}).toISODate();break;case"Este mes":e.fecha_inicio=a.startOf("month",{useLocaleWeeks:!0}).toISODate(),e.fecha_fin=a.endOf("month",{useLocaleWeeks:!0}).toISODate();break;case"Este a\xF1o":e.fecha_inicio=a.startOf("year",{useLocaleWeeks:!0}).toISODate(),e.fecha_fin=a.endOf("year",{useLocaleWeeks:!0}).toISODate();break;case"Personalizado":e.fecha_inicio=a.toISODate(),e.fecha_fin=a.toISODate();break}return e}function re(){const c=async()=>(await q.exportConteoExamens()).data(),{data:e,isLoading:a,isSuccess:m,isError:i,isFetching:s,refetch:l}=N([P.EXAMEN_ALL,"conteo"],c,{enabled:!1});return{data:e,isLoading:a,isSuccess:m,isError:i,isFetching:s,refetch:l}}function ue(c){const e=async()=>(await q.getConteoExamens(c.value)).data().data,{data:a,isLoading:m,isSuccess:i,isError:s,isFetching:l,refetch:r}=N([P.EXAMEN_ALL,"conteo",c==null?void 0:c.value],e);return{data:a,isLoading:m,isSuccess:i,isError:s,isFetching:l,refetch:r}}const de={class:"q-mb-sm text-overline"},me=W({__name:"ExamenConteoCard",props:{examens:{type:Array,required:!0}},setup(c){const e=c,a=k(()=>e.examens.map(s=>s.categoria.data).filter((s,l,r)=>r.findIndex(x=>x.id===s.id)===l).map(s=>({...s}))),m=i=>e.examens.filter(s=>s.categoria_id==i);return(i,s)=>(f(!0),E(O,null,F(a.value,l=>(f(),E("div",{key:l.id,class:"col-xs-12 col-sm-6"},[n(Y,null,{default:u(()=>[n(M,null,{default:u(()=>[b("div",de,S(l.nombre),1),n(U,{dense:""},{default:u(()=>[(f(!0),E(O,null,F(m(l.id),r=>(f(),V(X,{key:r.id,dense:""},{default:u(()=>[n(C,null,{default:u(()=>[I(S(r.nombre),1)]),_:2},1024),n(C,{side:"",class:"text-bold"},{default:u(()=>[I(S(r.ordens_count),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))}}),fe={class:"row q-col-gutter-md items-center justify-between"},_e=b("div",{class:"col-auto"},"Filtros:",-1),he={class:"col-12"},be={class:"col-12"},ye=W({__name:"ExamenConteoPage",setup(c){const e=v("Este mes"),a=v(!0),m=v({limit:0}),{data:i}=ie(m),s=k(()=>i.value?i.value.filter(t=>t.ris===y.ris).map(t=>({label:t.nombre,value:Number(t.id)})):[]),l=k(()=>{if(i.value){const t=[];return i.value.forEach(o=>{t.some(h=>h.value===o.ris)||t.push({label:o.ris,value:o.ris})}),t}return[]}),r=Z().shape({ris:L().required().label("RIS"),establecimiento_id:L().required().label("Establecimiento"),fecha_inicio:Q().required().label("Fecha Inicio"),fecha_fin:Q().required().min(J("fecha_inicio")).label("Fecha Fin")}),{handleSubmit:x,resetForm:j,values:y,setFieldValue:g}=K({validationSchema:r,initialValues:{fecha_inicio:d.local(d.now().year,d.now().month,1).toISODate(),fecha_fin:d.local(d.now().year,d.now().month,d.now().daysInMonth).toISODate()}}),_=v({...y}),{data:w}=ue(_),z=x(async t=>{console.log(t)}),{refetch:H,data:D}=re(),T=async()=>{if(await H.value(),D.value){const t=window.URL.createObjectURL(new Blob([D.value])),o=document.createElement("a");o.href=t,o.setAttribute("download","conteo_examenes.xlsx"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}},G=()=>{e.value="Este mes",j()};return A(()=>y,t=>{_.value.fecha_inicio=t.fecha_inicio,_.value.fecha_fin=t.fecha_fin,_.value.ris=t.ris,_.value.establecimiento_id=t.establecimiento_id},{immediate:!0,deep:!0}),A(()=>e.value,t=>{const{fecha_fin:o,fecha_inicio:h}=le(t);g("fecha_inicio",h),g("fecha_fin",o),e.value==="Personalizado"?a.value=!1:a.value=!0}),(t,o)=>(f(),E("div",fe,[_e,n(ee,{class:"col-auto",vertical:!1,align:"center"},{default:u(()=>[n($,{flat:"","no-caps":"",label:"Limpiar",color:"negative",icon:"fas fa-broom",onClick:G})]),_:1}),b("div",he,[n(se,{onSubmit:p(z)},{actions:u(()=>[ae(b("div",null,null,512),[[ne,!1]])]),default:u(()=>[n(R,{options:l.value,name:"ris",label:"RIS",class:"col-6"},null,8,["options"]),n(R,{options:s.value,name:"establecimiento_id",label:"Establecimiento",class:"col-6"},null,8,["options"]),n(te,{modelValue:e.value,"onUpdate:modelValue":o[0]||(o[0]=h=>e.value=h),options:p(ce),label:"Rango de Fechas",class:"col-4",outlined:"",dense:"","map-options":"","emit-value":""},null,8,["modelValue","options"]),n(B,{type:"date",label:"Fecha Inicio",name:"fecha_inicio",class:"col-4","min-date":new Date(new Date().getFullYear(),0,1),disable:a.value},null,8,["min-date","disable"]),n(B,{type:"date",label:"Fecha Fin",name:"fecha_fin",class:"col-4","min-date":new Date(new Date().getFullYear(),0,1),disable:a.value},null,8,["min-date","disable"])]),_:1},8,["onSubmit"])]),b("div",be,[n($,{color:"positive",icon:"fas fa-file-excel",label:"Exportar a excel","no-caps":"",onClick:T})]),p(w)?(f(),V(me,{key:0,examens:p(w)},null,8,["examens"])):oe("",!0)]))}});export{ye as default};
