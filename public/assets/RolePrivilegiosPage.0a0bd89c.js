var Ce=Object.defineProperty;var Fe=(r,l,d)=>l in r?Ce(r,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):r[l]=d;var V=(r,l,d)=>(Fe(r,typeof l!="symbol"?l+"":l,d),d);import{aD as oe,aE as se,S as Ke,g as Pe,M as Ie,N as Ee,r as z,a_ as Ae,k as K,G as J,m as b,q as Oe,P as Ne,A as pe,aq as Le,Q as X,a$ as Re,y as ie,b0 as Qe,x as je,b1 as ze,b2 as le,a as Be,b3 as ce,W as $e,o as R,ai as G,a0 as O,e as Me,w as Q,f as De,ac as Ue,as as H,a3 as j,aa as Ve,a9 as Ge,ah as W,ar as de,ae as He}from"./index.6499fb8a.js";import{R as ue}from"./RoleApi.b987bab2.js";class We{static async run(l){try{return(await ue.fetchRolePrivilegios(l)).data().data}catch(d){throw d}}}function Je(r,l){const d=async()=>await We.run(r),{data:C,isLoading:_,isSuccess:q,isError:f,isFetching:h,refetch:u}=oe([se.ROLES_ALL,r,"privilegios"],d,{enabled:l});return{data:C,isLoading:_,isSuccess:q,isError:f,isFetching:h,refetch:u}}function Xe(){return Ke(({data:r,id:l})=>ue.syncRolePrivilegios(l,r))}const Ye=["none","strict","leaf","leaf-filtered"];var Ze=Pe({name:"QTree",props:{...Ie,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:r=>Ye.includes(r)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:Number,noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(r,{slots:l,emit:d}){const{proxy:C}=Oe(),{$q:_}=C,q=Ee(r,_),f=z({}),h=z(r.ticked||[]),u=z(r.expanded||[]);let c={};Ae(()=>{c={}});const F=K(()=>`q-tree q-tree--${r.dense===!0?"dense":"standard"}`+(r.noConnectors===!0?" q-tree--no-connectors":"")+(q.value===!0?" q-tree--dark":"")+(r.color!==void 0?` text-${r.color}`:"")),y=K(()=>r.selected!==void 0),m=K(()=>r.icon||_.iconSet.tree.icon),w=K(()=>r.controlColor||r.color),P=K(()=>r.textColor!==void 0?` text-${r.textColor}`:""),S=K(()=>{const t=r.selectedColor||r.color;return t?` text-${t}`:""}),T=K(()=>r.filterMethod!==void 0?r.filterMethod:(t,a)=>{const e=a.toLowerCase();return t[r.labelKey]&&t[r.labelKey].toLowerCase().indexOf(e)>-1}),k=K(()=>{const t={},a=(e,i)=>{const n=e.tickStrategy||(i?i.tickStrategy:r.tickStrategy),s=e[r.nodeKey],v=e[r.childrenKey]&&Array.isArray(e[r.childrenKey])&&e[r.childrenKey].length!==0,E=e.disabled!==!0&&y.value===!0&&e.selectable!==!1,x=e.disabled!==!0&&e.expandable!==!1,Se=n!=="none",L=n==="strict",ae=n==="leaf-filtered",D=n==="leaf"||n==="leaf-filtered";let U=e.disabled!==!0&&e.tickable!==!1;D===!0&&U===!0&&i&&i.tickable!==!0&&(U=!1);let A=e.lazy;A===!0&&f.value[s]!==void 0&&Array.isArray(e[r.childrenKey])===!0&&(A=f.value[s]);const o={key:s,parent:i,isParent:v,lazy:A,disabled:e.disabled,link:e.disabled!==!0&&(E===!0||x===!0&&(v===!0||A===!0)),children:[],matchesFilter:r.filter?T.value(e,r.filter):!0,selected:s===r.selected&&E===!0,selectable:E,expanded:v===!0?u.value.includes(s):!1,expandable:x,noTick:e.noTick===!0||L!==!0&&A&&A!=="loaded",tickable:U,tickStrategy:n,hasTicking:Se,strictTicking:L,leafFilteredTicking:ae,leafTicking:D,ticked:L===!0?h.value.includes(s):v===!0?!1:h.value.includes(s)};if(t[s]=o,v===!0&&(o.children=e[r.childrenKey].map(g=>a(g,o)),r.filter&&(o.matchesFilter!==!0?o.matchesFilter=o.children.some(g=>g.matchesFilter):o.noTick!==!0&&o.disabled!==!0&&o.tickable===!0&&ae===!0&&o.children.every(g=>g.matchesFilter!==!0||g.noTick===!0||g.tickable!==!0)===!0&&(o.tickable=!1)),o.matchesFilter===!0&&(o.noTick!==!0&&L!==!0&&o.children.every(g=>g.noTick)===!0&&(o.noTick=!0),D))){if(o.ticked=!1,o.indeterminate=o.children.some(g=>g.indeterminate===!0),o.tickable=o.tickable===!0&&o.children.some(g=>g.tickable),o.indeterminate!==!0){const g=o.children.reduce((ne,qe)=>qe.ticked===!0?ne+1:ne,0);g===o.children.length?o.ticked=!0:g>0&&(o.indeterminate=!0)}o.indeterminate===!0&&(o.indeterminateNextState=o.children.every(g=>g.tickable!==!0||g.ticked!==!0))}return o};return r.nodes.forEach(e=>a(e,null)),t});J(()=>r.ticked,t=>{h.value=t}),J(()=>r.expanded,t=>{u.value=t});function I(t){const a=[].reduce,e=(i,n)=>{if(i||!n)return i;if(Array.isArray(n)===!0)return a.call(Object(n),e,i);if(n[r.nodeKey]===t)return n;if(n[r.childrenKey])return e(null,n[r.childrenKey])};return e(null,r.nodes)}function he(){return h.value.map(t=>I(t))}function ye(){return u.value.map(t=>I(t))}function ve(t){return t&&k.value[t]?k.value[t].expanded:!1}function ge(){r.expanded!==void 0?d("update:expanded",[]):u.value=[]}function Y(){const t=[],a=e=>{e[r.childrenKey]&&e[r.childrenKey].length!==0&&e.expandable!==!1&&e.disabled!==!0&&(t.push(e[r.nodeKey]),e[r.childrenKey].forEach(a))};r.nodes.forEach(a),r.expanded!==void 0?d("update:expanded",t):u.value=t}function $(t,a,e=I(t),i=k.value[t]){if(i.lazy&&i.lazy!=="loaded"){if(i.lazy==="loading")return;f.value[t]="loading",Array.isArray(e[r.childrenKey])!==!0&&(e[r.childrenKey]=[]),d("lazyLoad",{node:e,key:t,done:n=>{f.value[t]="loaded",e[r.childrenKey]=Array.isArray(n)===!0?n:[],Ne(()=>{const s=k.value[t];s&&s.isParent===!0&&Z(t,!0)})},fail:()=>{delete f.value[t],e[r.childrenKey].length===0&&delete e[r.childrenKey]}})}else i.isParent===!0&&i.expandable===!0&&Z(t,a)}function Z(t,a){let e=u.value;const i=r.expanded!==void 0;if(i===!0&&(e=e.slice()),a){if(r.accordion&&k.value[t]){const n=[];k.value[t].parent?k.value[t].parent.children.forEach(s=>{s.key!==t&&s.expandable===!0&&n.push(s.key)}):r.nodes.forEach(s=>{const v=s[r.nodeKey];v!==t&&n.push(v)}),n.length!==0&&(e=e.filter(s=>n.includes(s)===!1))}e=e.concat([t]).filter((n,s,v)=>v.indexOf(n)===s)}else e=e.filter(n=>n!==t);i===!0?d("update:expanded",e):u.value=e}function ke(t){return t&&k.value[t]?k.value[t].ticked:!1}function p(t,a){let e=h.value;const i=r.ticked!==void 0;i===!0&&(e=e.slice()),a?e=e.concat(t).filter((n,s,v)=>v.indexOf(n)===s):e=e.filter(n=>t.includes(n)===!1),i===!0&&d("update:ticked",e)}function be(t,a,e){const i={tree:C,node:t,key:e,color:r.color,dark:q.value};return le(i,"expanded",()=>a.expanded,n=>{n!==a.expanded&&$(e,n)}),le(i,"ticked",()=>a.ticked,n=>{n!==a.ticked&&p([e],n)}),i}function ee(t){return(r.filter?t.filter(a=>k.value[a[r.nodeKey]].matchesFilter):t).map(a=>me(a))}function _e(t){if(t.icon!==void 0)return b(X,{class:"q-tree__icon q-mr-sm",name:t.icon,color:t.iconColor});const a=t.img||t.avatar;if(a)return b("img",{class:`q-tree__${t.img?"img":"avatar"} q-mr-sm`,src:a})}function xe(){d("afterShow")}function Te(){d("afterHide")}function me(t){const a=t[r.nodeKey],e=k.value[a],i=t.header&&l[`header-${t.header}`]||l["default-header"],n=e.isParent===!0?ee(t[r.childrenKey]):[],s=n.length!==0||e.lazy&&e.lazy!=="loaded";let v=t.body&&l[`body-${t.body}`]||l["default-body"];const E=i!==void 0||v!==void 0?be(t,e,a):null;return v!==void 0&&(v=b("div",{class:"q-tree__node-body relative-position"},[b("div",{class:P.value},[v(E)])])),b("div",{key:a,class:`q-tree__node relative-position q-tree__node--${s===!0?"parent":"child"}`},[b("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(e.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(e.selected===!0?" q-tree__node--selected":"")+(e.disabled===!0?" q-tree__node--disabled":""),tabindex:e.link===!0?0:-1,ariaExpanded:n.length>0?e.expanded:null,role:"treeitem",onClick:x=>{re(t,e,x)},onKeypress(x){pe(x)!==!0&&(x.keyCode===13?re(t,e,x,!0):x.keyCode===32&&M(t,e,x,!0))}},[b("div",{class:"q-focus-helper",tabindex:-1,ref:x=>{c[e.key]=x}}),e.lazy==="loading"?b(Le,{class:"q-tree__spinner",color:w.value}):s===!0?b(X,{class:"q-tree__arrow"+(e.expanded===!0?" q-tree__arrow--rotate":""),name:m.value,onClick(x){M(t,e,x)}}):null,e.hasTicking===!0&&e.noTick!==!0?b(Re,{class:"q-tree__tickbox",modelValue:e.indeterminate===!0?null:e.ticked,color:w.value,dark:q.value,dense:!0,keepColor:!0,disable:e.tickable!==!0,onKeydown:ie,"onUpdate:modelValue":x=>{we(e,x)}}):null,b("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(e.selected===!0?S.value:P.value)},[i?i(E):[_e(t),b("div",t[r.labelKey])]])]),s===!0?r.noTransition===!0?e.expanded===!0?b("div",{class:"q-tree__node-collapsible"+P.value,key:`${a}__q`},[v,b("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},n)]):null:b(Qe,{duration:r.duration,onShow:xe,onHide:Te},()=>je(b("div",{class:"q-tree__node-collapsible"+P.value,key:`${a}__q`},[v,b("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},n)]),[[ze,e.expanded]])):v])}function te(t){const a=c[t];a&&a.focus()}function re(t,a,e,i){i!==!0&&a.selectable!==!1&&te(a.key),y.value&&a.selectable?r.noSelectionUnset===!1?d("update:selected",a.key!==r.selected?a.key:null):a.key!==r.selected&&d("update:selected",a.key===void 0?null:a.key):M(t,a,e,i),typeof t.handler=="function"&&t.handler(t)}function M(t,a,e,i){e!==void 0&&ie(e),i!==!0&&a.selectable!==!1&&te(a.key),$(a.key,!a.expanded,t,a)}function we(t,a){if(t.indeterminate===!0&&(a=t.indeterminateNextState),t.strictTicking)p([t.key],a);else if(t.leafTicking){const e=[],i=n=>{n.isParent?(a!==!0&&n.noTick!==!0&&n.tickable===!0&&e.push(n.key),n.leafTicking===!0&&n.children.forEach(i)):n.noTick!==!0&&n.tickable===!0&&(n.leafFilteredTicking!==!0||n.matchesFilter===!0)&&e.push(n.key)};i(t),p(e,a)}}return r.defaultExpandAll===!0&&Y(),Object.assign(C,{getNodeByKey:I,getTickedNodes:he,getExpandedNodes:ye,isExpanded:ve,collapseAll:ge,expandAll:Y,setExpanded:$,isTicked:ke,setTicked:p}),()=>{const t=ee(r.nodes);return b("div",{class:F.value,role:"tree"},t.length===0?r.filter?r.noResultsLabel||_.lang.tree.noResults:r.noNodesLabel||_.lang.tree.noNodes:t)}}});const B=class{static async fetchAll(l){return await B._api.get(B._endpoint,l)}};let N=B;V(N,"_api",Be),V(N,"_endpoint","/privilegios");class et{static async run(l){try{return(await N.fetchAll(l)).data().data}catch(d){throw d}}}function tt(){const r=async()=>await et.run(),{data:l,isLoading:d,isSuccess:C,isError:_,isFetching:q,refetch:f}=oe([se.PRIVILEGIO_ALL],r);return{data:l,isLoading:d,isSuccess:C,isError:_,isFetching:q,refetch:f}}var fe={};(function(r){var l=ce&&ce.__assign||function(){return(l=Object.assign||function(f){for(var h,u=1,c=arguments.length;u<c;u++)for(var F in h=arguments[u])Object.prototype.hasOwnProperty.call(h,F)&&(f[F]=h[F]);return f}).apply(this,arguments)},d=(Object.defineProperty(r,"__esModule",{value:!0}),{id:"id",parentId:"parentId",dataField:"data",childrenField:"children",throwIfOrphans:!1,rootParentIds:{"":!(r.countNodes=r.arrayToTree=void 0)},nestedIds:!0,assign:!1});function C(f,h){h===void 0&&(h={});for(var u,c=l(l({},d),h),F=[],y={},m=c.throwIfOrphans?new Set:null,w=0,P=f;w<P.length;w++){var S=P[w],T=c.nestedIds?q(S,c.id):S[c.id],k=c.nestedIds?q(S,c.parentId):S[c.parentId];if(c.rootParentIds[T])throw new Error("The item array contains a node whose parentId both exists in another node and is in "+'`rootParentIds` (`itemId`: "'.concat(T,'", `rootParentIds`: ').concat(Object.keys(c.rootParentIds).map(function(I){return'"'.concat(I,'"')}).join(", "),")."));Object.prototype.hasOwnProperty.call(y,T)||(y[T]=((u={})[c.childrenField]=[],u)),m&&m.delete(T),c.dataField?y[T][c.dataField]=S:c.assign?y[T]=Object.assign(S,((u={})[c.childrenField]=y[T][c.childrenField],u)):y[T]=l(l({},S),((S={})[c.childrenField]=y[T][c.childrenField],S)),S=y[T],k==null||c.rootParentIds[k]?F.push(S):(Object.prototype.hasOwnProperty.call(y,k)||(y[k]=((T={})[c.childrenField]=[],T),m&&m.add(k)),y[k][c.childrenField].push(S))}if(m!=null&&m.size)throw new Error("The items array contains orphans that point to the following parentIds: "+"[".concat(Array.from(m),"]. These parentIds do not exist in the items array. Hint: prevent orphans to result ")+"in an error by passing the following option: { throwIfOrphans: false }");if(c.throwIfOrphans&&_(F,c.childrenField)<Object.keys(y).length)throw new Error("The items array contains nodes with a circular parent/child relationship.");return F}function _(f,h){return f.reduce(function(u,c){return u+1+(c[h]&&_(c[h],h))},0)}function q(f,h){return h.split(".").reduce(function(u,c){return u&&u[c]},f)}r.arrayToTree=C,r.countNodes=_})(fe);const rt={class:"row"},at={key:1,class:"col-12 row q-col-gutter-sm"},nt={class:"row items-center q-ml-sm"},it={class:""},lt={key:0},ct={class:"text-weight-thin"},ut=$e({__name:"RolePrivilegiosPage",props:{id:{type:Number,required:!0}},setup(r){const l=r,{data:d,isSuccess:C,isFetching:_}=tt(),{data:q}=Je(l.id,!!_.value),f=z([]),h=K(()=>d.value?fe.arrayToTree(d.value,{parentId:"parent_id",dataField:null}):[]),{mutate:u,isLoading:c}=Xe(),F=()=>{u({data:f.value,id:l.id},{onSuccess:()=>{He.success("Privilegios otorgados correctamente")},onError:y=>{console.log(y)}})};return J(()=>q.value,y=>{y&&(f.value=y.map(m=>m.id.toString()))},{immediate:!0}),(y,m)=>(R(),G("div",rt,[O(_)?(R(),Me(Ue,{key:0,class:"col-12 q-pa-lg"},{default:Q(()=>[De(" loading... ")]),_:1})):H("",!0),O(C)&&!O(_)&&O(d)?(R(),G("div",at,[j(Ge,{align:"center"},{default:Q(()=>[j(Ve,{label:"Guardar",icon:"fas fa-floppy-disk",color:"primary","no-caps":"",loading:O(c),onClick:F},null,8,["loading"])]),_:1}),j(Ze,{ticked:f.value,"onUpdate:ticked":m[0]||(m[0]=w=>f.value=w),class:"col-12","tick-strategy":"strict",nodes:h.value,"node-key":"id","label-key":"nombre","default-expand-all":""},{"default-header":Q(w=>[W("div",nt,[j(X,{name:w.node.icono,class:"q-mr-sm"},null,8,["name"]),W("div",it,de(w.node.nombre),1)])]),"default-body":Q(w=>[w.node.parent_id!=null?(R(),G("div",lt,[W("span",ct,"Ruta: "+de(w.node.ruta),1)])):H("",!0)]),_:1},8,["ticked","nodes"])])):H("",!0)]))}});export{ut as default};
