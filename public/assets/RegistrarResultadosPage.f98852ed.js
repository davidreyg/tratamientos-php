import{aE as ne,aF as se,W as Z,Y as R,b7 as ie,b8 as re,o as p,e as h,w as n,f as O,at as P,a2 as o,a5 as e,b9 as ce,a3 as de,bc as ue,av as K,bb as me,k as j,a1 as G,ag as X,H as I,aj as D,ak as Q,a_ as be,aU as T,ad as $,au as k,aV as L,ac as F,ab as A,aZ as pe,bd as fe,b1 as ee,r as N,b4 as V,be as _e,$ as B,aY as ve,a6 as ge,ae as ye,bf as he,aS as S,a0 as x,bg as J,aa as qe,aO as Ce,aJ as Y,aN as $e,aI as xe,a$ as ae,Q as Ee,am as U,al as ke,aR as we,aG as W,b0 as Se,b2 as Fe,b3 as z}from"./index.8b2eeb1e.js";import{u as Ne}from"./ExamenCardList.ad6f0fef.js";import{O as H,u as M,_ as Re}from"./laboratorio.store.8fb8d8d6.js";import{u as Oe}from"./establecimientoFetchAllQuery.3a7537a1.js";import"./BaseCheckBoxGroup.35447f15.js";import"./paqueteFetchAllQuery.58725a73.js";import"./PaqueteApi.94040dff.js";function De(r){const f=async()=>(await H.fetchAll(r.value)).data(),{data:c,isLoading:i,isSuccess:q,isError:s,isFetching:u,refetch:a}=ne([se.ORDEN_ALL,r==null?void 0:r.value],f,{keepPreviousData:!0});return{data:c,isLoading:i,isSuccess:q,isError:s,isFetching:u,refetch:a}}function Qe(){return Z(({id:r,data:f})=>H.updateEstado(r,f))}function Ae(){return Z(({id:r,data:f})=>H.updateExamens(r,f))}const Pe=R({__name:"BaseCheckBox",props:{name:{type:String,required:!0},label:{type:String,required:!0}},setup(r){const c=ie(r,"name"),{value:i,handleChange:q,errorMessage:s}=re(c);return(u,a)=>(p(),h(me,{color:"black",borderless:"",error:!!o(s),"bottom-slots":"","hide-bottom-space":!o(s)},{error:n(()=>[O(P(o(s)),1)]),default:n(()=>[e(ue,ce(u.$attrs,{modelValue:o(i),"onUpdate:modelValue":[a[0]||(a[0]=b=>de(i)?i.value=b:null),a[1]||(a[1]=b=>o(q)(b))],label:r.label}),null,16,["modelValue","label"]),K(u.$slots,"default")]),_:3},8,["error","hide-bottom-space"]))}}),Ie={class:"row"},Te=R({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},examens:{type:Array,required:!0},ordenId:{type:Number,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0}},emits:["submit","cancel"],setup(r,{emit:f}){const c=f,i=r,q=j(()=>i.examens?i.examens.map(l=>({label:l.nombre,value:Number(l.id)})):[]),{handleSubmit:s,setFieldValue:u,values:a}=G({validationSchema:i.validationSchema,initialValues:i.initialValues}),{mutateAsync:b,reset:y,isLoading:w}=Ae(),_=s(async(l,{setErrors:d})=>{await b({id:i.ordenId,data:l},{onSuccess:()=>{X.success("Resultados actualizados correctamente"),c("submit"),y.value()},onError:v=>{y.value(),d(v.data.errors)}})},l=>console.log(l)),t=l=>{let d;return!!a.pivot[l].minimo&&!!a.pivot[l].minimo&&(d=`Min: ${a.pivot[l].minimo} - Max: ${a.pivot[l].maximo}`),d},g=l=>{let d;return!!a.pivot[l].minimo&&!!a.pivot[l].minimo&&(a.pivot[l].resultado>a.pivot[l].minimo&&a.pivot[l].resultado<a.pivot[l].maximo?d="green-2":d="red-2"),d},C=l=>{const d="pivot["+l+"].is_canceled",v=a.pivot[l].is_canceled;u(d,!v)};return i.fields.forEach((l,d)=>{I(()=>a.pivot[d].unidad_id,v=>{const m=i.examens.find(E=>E.id==a.pivot[d].examen_id);if(!!m&&!!v){const E=m.pivot.find(le=>le.unidad_id===v),oe="pivot["+d+"].minimo",te="pivot["+d+"].maximo";E&&(u(oe,E.minimo),u(te,E.maximo))}},{deep:!0,immediate:!0}),I(()=>a.pivot[d].is_canceled,v=>{const m="pivot["+d+"].minimo",E="pivot["+d+"].maximo";v&&(u(m,void 0),u(E,void 0))},{deep:!0,immediate:!0})}),(l,d)=>(p(),h(ee,{onSubmit:fe(o(_),["prevent"])},{default:n(()=>[D("pre",null,P(o(a)),1),(p(!0),Q(pe,null,be(r.fields,(v,m)=>(p(),Q("div",{key:m,class:"row q-col-gutter-sm q-mb-sm"},[e(T,{label:"Examen",name:`pivot[${m}].examen_id`,options:q.value,class:"col-3",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),o(a).pivot[m].is_canceled?(p(),h($,{key:0,name:`pivot[${m}].motivo`,label:"Motivo",class:"col-4",required:""},null,8,["name"])):k("",!0),o(a).pivot[m].is_canceled?k("",!0):(p(),h($,{key:1,name:`pivot[${m}].resultado`,"bg-color":g(m),label:"Resultado",class:"col-2",required:""},null,8,["name","bg-color"])),o(a).pivot[m].is_canceled?k("",!0):(p(),h(T,{key:2,label:"Unidad",name:`pivot[${m}].unidad_id`,options:o(a).pivot[m].unidads,hint:t(m),class:"col-2",required:""},null,8,["name","options","hint"])),e($,{label:"Fecha",type:"date",name:`pivot[${m}].fecha_resultado`,required:"",class:"col-2"},null,8,["name"]),e(A,{class:"col-3 self-center"},{default:n(()=>[e(Pe,{name:`pivot[${m}].is_enabled`,label:"",dense:""},{default:n(()=>[e(L,null,{default:n(()=>[O(P(o(a).pivot[m].is_enabled?"Deshabilitar.":"Habilitar."),1)]),_:2},1024)]),_:2},1032,["name"]),e(F,{icon:o(a).pivot[m].is_canceled?"fas fa-pen":"fas fa-ban",color:o(a).pivot[m].is_canceled?"warning":"negative",round:"",flat:"",size:"sm",onClick:E=>C(m)},{default:n(()=>[e(L,null,{default:n(()=>[O(P(o(a).pivot[m].is_canceled?"Registrar datos.":"Cancelar examen."),1)]),_:2},1024)]),_:2},1032,["icon","color","onClick"])]),_:2},1024)]))),128)),D("div",Ie,[e(A,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:n(()=>[e(F,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:d[0]||(d[0]=v=>l.$emit("cancel"))}),e(F,{label:"Guardar",type:"submit",icon:"fas fa-floppy-disk",color:"primary",loading:o(w),"no-caps":""},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))}}),Le=R({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0}},emits:["submit","cancel"],setup(r){const f=N({limit:0}),{data:c}=Ne(f),i=j(()=>c.value?c.value.map(b=>({label:b.nombre,value:Number(b.id)})):[]),q=r,s=N([]),u=N(),a=N();return I(()=>c.value,b=>{if(b){s.value=q.orden.pivot.map(_=>{let t=[];const g=b.find(C=>Number(C.id)==_.examen_id);return t=[{label:"Examen",name:"examen_id",type:"select",options:i.value},{label:"Resultado",name:"resultado",type:"string"},{label:"Unidad",name:"unidad_id",type:"select",options:g?g.unidads.data.map(C=>({label:C.nombre,value:Number(C.id)})):[]},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Acciones",name:"actions",type:"array"}],t});const y=V().of(_e(()=>{let _={};return _={examen_id:he().required().label("Examen"),resultado:S().positive().when(["is_enabled","is_canceled"],{is:(t,g)=>t&&!g,then:t=>t.required(),otherwise:t=>t.nullable()}).transform((t,g)=>g===""?void 0:t).typeError("Debe ingresar un numero").label("Resultado"),fecha_resultado:x().required().label("Fecha"),unidad_id:S().when(["is_enabled","is_canceled"],{is:(t,g)=>t&&!g,then:t=>t.required(),otherwise:t=>t.nullable()}).label("Unidad"),is_canceled:J().required().label("Cancelado?"),is_enabled:J().required().label("Hablitad?"),motivo:x().when(["is_enabled","is_canceled"],{is:!0,then:t=>t.required(),otherwise:t=>t.nullable()}).label("Motivo"),minimo:S(),maximo:S(),unidads:V()},B().shape(_)}));u.value=B().shape({pivot:y});const w=q.orden.pivot.map(_=>{var g;const t=b.find(C=>Number(C.id)==_.examen_id);return{examen_id:_.examen_id,resultado:_.resultado,fecha_resultado:(g=_.fecha_resultado)!=null?g:ve.now().toISODate(),unidad_id:_.unidad_id,is_canceled:_.is_canceled,is_enabled:!0,motivo:_.motivo,unidads:t?t.unidads.data.map(C=>({label:C.nombre,value:Number(C.id)})):[]}});a.value={pivot:w}}},{immediate:!0}),(b,y)=>(p(),h(ye,{class:"my-card"},{default:n(()=>[e(ge,null,{default:n(()=>[s.value.length>0&&u.value&&o(c)?(p(),h(Te,{key:0,fields:s.value,"validation-schema":u.value,"initial-values":a.value,"orden-id":Number(r.orden.id),examens:o(c),onCancel:y[0]||(y[0]=w=>b.$emit("cancel")),onSubmit:y[1]||(y[1]=w=>b.$emit("submit"))},null,8,["fields","validation-schema","initial-values","orden-id","examens"])):k("",!0)]),_:1})]),_:1}))}}),Ve=R({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},emits:["cancel"],setup(r){const f=r,{data:c}=Oe(),i=j(()=>c.value?c.value.map(s=>({label:s.nombre,value:Number(s.id)})):[]),q=B().shape({diagnostico:x().trim().min(2).required().label("Diagnostico"),CI10:x().trim().min(2).required().label("CI10"),CPN:x().trim().min(2).required().label("CPN"),EG:x().trim().min(2).required().label("EG"),codigo_atencion:x().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:x().trim().required().label("Fecha de Registro"),medico:x().trim().required().label("M\xE9dico"),examen_ids:V().of(S().required()).required().label("Examenes"),paquete_ids:V().of(S().required()).required().label("Paquetes"),establecimiento_id:S().label("Establecimiento Institucional"),establecimiento_otro:x().label("Otro Establecimiento")});return G({validationSchema:q,initialValues:f.orden}),(s,u)=>(p(),h(qe,null,{actions:n(()=>[e(A,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:n(()=>[e(F,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:u[0]||(u[0]=a=>s.$emit("cancel"))})]),_:1})]),default:n(()=>[e($,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1}),r.orden.establecimiento_id?(p(),h(T,{key:0,options:i.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:"",readonly:"",borderless:"",outlined:!1},null,8,["options"])):(p(),h($,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1})),e($,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e($,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e($,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e($,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e($,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e($,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1})]),_:1}))}}),Be=R({__name:"OrdenTable",props:{ordens:{type:Array,required:!0}},setup(r){const{formatDate:f}=xe(),c=[{name:"fecha_registro",align:"left",label:"Fecha Registro",field:"fecha_registro",format:i=>f(i)},{name:"medico",align:"center",label:"Medico",field:"medico"},{name:"codigo_atencion",align:"center",label:"Codigo Atenci\xF3n",field:"codigo_atencion"},{name:"estado",align:"center",label:"Estado",field:"estado"},{name:"actions",align:"right",label:"Acciones",field:"actions"}];return(i,q)=>(p(),h(o($e),{rows:r.ordens,columns:c,"row-key":"id"},{"body-cell-estado":n(s=>[e(Y,{props:s},{default:n(()=>[e(Ce,{color:s.row.estado_detalle.color,label:s.row.estado_detalle.label},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-actions":n(s=>[e(Y,{props:s,class:"text-right"},{default:n(()=>[e(A,{align:"right",class:"q-pa-none q-ma-none"},{default:n(()=>[K(i.$slots,"actions",{id:Number(s.key),estado:s.row.estado})]),_:2},1024)]),_:2},1032,["props"])]),_:3},8,["rows"]))}}),Me={key:0,class:"col-12 row justify-center"},je={class:"col-auto"},Ue=D("div",{class:"col-12 text-center text-h6"}," Lo sentimos. \xA1No se encontr\xF3 ninguna orden!. Porfavor registre uno para empezar. ",-1),ze={key:1},Ge=R({__name:"DatosOrdenTab",props:{paciente:{type:Object,required:!0}},setup(r){const f=r,{ordenSeleccionada:c,isOrdenLoading:i}=ae(M()),{fetchOrdenById:q}=M(),s=N({search:`paciente_id:${f.paciente.id};estado:0,1`,searchJoin:"and",limit:0}),{data:u,refetch:a}=De(s),b=N("list"),y=N(),w=async l=>{y.value=l,await q(l),c.value&&(b.value="view")},{mutateAsync:_,isLoading:t}=Qe(),g=async(l,d)=>{y.value=l,await _({id:l,data:{estado:d}},{onSuccess:()=>{X.success("La orden se REGISTRO correctamente."),a.value(),b.value="list"},onError:v=>{console.log(v)}})},C=()=>{c.value=void 0};return I(()=>c.value,l=>{l||(b.value="list")}),(l,d)=>r.paciente?(p(),h(ke,{key:0,modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=v=>b.value=v),animated:""},{default:n(()=>[e(U,{name:"list"},{default:n(()=>[o(u)&&o(u).data.length===0?(p(),Q("div",Me,[D("div",je,[e(Ee,{name:"fas fa-face-frown",size:"xl"})]),Ue,e(F,{class:"q-mt-lg",color:"primary",icon:"fas fa-plus","no-caps":"",label:"Registrar nueva orden",outline:"",to:"/laboratorio/registrar-orden"})])):o(u)?(p(),Q("div",ze,[e(Be,{ordens:o(u).data},{actions:n(({id:v,estado:m})=>[e(F,{color:"primary",icon:"fas fa-file-signature",round:"",flat:"",size:"sm",loading:o(i)&&y.value===v,onClick:E=>w(v)},{default:n(()=>[e(L,null,{default:n(()=>[O("Editar resultados.")]),_:1})]),_:2},1032,["loading","onClick"]),m===0?(p(),h(F,{key:0,color:"positive",icon:"fas fa-check-double",round:"",flat:"",size:"sm",loading:o(t)&&y.value===v,onClick:E=>g(v,1)},{default:n(()=>[e(L,null,{default:n(()=>[O("Confirmar registro.")]),_:1})]),_:2},1032,["loading","onClick"])):k("",!0)]),_:1},8,["ordens"])])):k("",!0)]),_:1}),e(U,{name:"new"},{default:n(()=>[e(Re,{"paciente-id":Number(r.paciente.id)},null,8,["paciente-id"])]),_:1}),e(U,{name:"view"},{default:n(()=>[o(c)?(p(),h(Ve,{key:0,orden:o(c),onCancel:C},null,8,["orden"])):k("",!0)]),_:1})]),_:1},8,["modelValue"])):k("",!0)}}),He={class:"row q-col-gutter-md"},Je={class:"col-12"},oa=R({__name:"RegistrarResultadosPage",setup(r){const{fetchPaciente:f,$reset:c}=M(),{paciente:i,isPacienteLoading:q,ordenSeleccionada:s}=ae(M()),{data:u}=we(),a=j(()=>u.value?u.value.map(t=>({label:t.nombre,value:t.id})):[]),b=B().shape({numero_documento:S().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:x().required().label("Tipo de Documento")}),{handleSubmit:y}=G({validationSchema:b}),w=y(async t=>{c(),await f(t.numero_documento),i.value?W.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}):W.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})}),_=()=>{s.value=void 0};return Se(()=>{if(window.confirm("Esta seguro de salir? Tiene cambios sin guardar!"))c();else return!1}),(t,g)=>(p(),Q("div",He,[e(ee,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:o(w)},{default:n(()=>[e(T,{options:a.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),e($,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),e(A,{class:"col-auto justify-center"},{default:n(()=>[e(F,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:o(q)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),D("div",Je,[e(z,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear",class:"bg-purple-2"},{default:n(()=>[e(Fe,{class:"bg-purple-1",paciente:o(i),onCancel:o(c),onSubmit:g[0]||(g[0]=C=>o(f)(C))},null,8,["paciente","onCancel"])]),_:1}),o(i)?(p(),h(z,{key:0,icon:"fas fa-vials",label:"Datos de la Orden de Lab.",caption:"Editar / Crear"},{default:n(()=>[e(Ge,{paciente:o(i),onCancel:o(c)},null,8,["paciente","onCancel"])]),_:1})):k("",!0),o(s)?(p(),h(z,{key:1,icon:"fas fa-file-signature",label:"Registrar resultados.",caption:"Editar / Crear"},{default:n(()=>[e(Le,{orden:o(s),onCancel:_,onSubmit:_},null,8,["orden"])]),_:1})):k("",!0)])]))}});export{oa as default};
