import{W as K,Y as G,r as S,k as Q,$ as L,a0 as r,b6 as I,aV as q,a1 as R,a$ as Z,ag as ee,H as ae,o as f,e as h,w as t,a5 as a,ad as c,aX as U,aY as A,f as O,ac as k,aj as $,aD as te,a2 as i,au as M,aa as oe,ba as ie,aU as se,aG as B,bb as ne,ak as le,ab as re,bg as ce,bh as ue,bi as V,a6 as me,ae as de}from"./index.95cf0a1c.js";import{u as be}from"./establecimientoFetchAllQuery.9aa8821e.js";import{u as pe}from"./examenFetchAllQuery.70164d9e.js";import{O as fe}from"./OrdenApi.c240bb7b.js";import{u as _e}from"./paqueteFetchAllQuery.31787a5c.js";import{_ as ge}from"./ExamenCardList.e87e54ef.js";import{_ as xe}from"./BaseCheckBoxGroup.5cc8f5ec.js";import{u as T}from"./laboratorio.store.096946da.js";import"./EstablecimientoApi.10fa5d30.js";import"./ExamenApi.9e8eeacd.js";import"./PaqueteApi.43b5412d.js";function ve(){return K(C=>fe.create(C))}const qe={class:"col-12"},he={class:"col-12"},Ce={class:"col-12 row q-col-gutter-sm"},Ee=G({__name:"OrdenCreateForm",props:{pacienteId:{type:Number,required:!0}},emits:["submit"],setup(C,{emit:E}){const y=C,b=E,w=S({limit:0,search:"is_active:1",searchJoin:"and"}),{data:d}=pe(w),{data:p}=_e(),F=Q(()=>p.value?p.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),D=S({limit:0}),{data:N}=be(D),_=Q(()=>N.value?N.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),u=L().shape({diagnostico:r().trim().min(2).required().label("Diagnostico"),CI10:r().trim().min(2).nullable().label("CI10"),CPN:r().trim().min(2).nullable().label("CPN"),EG:r().trim().min(2).nullable().label("EG"),codigo_atencion:r().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:r().trim().required().label("Fecha de Registro"),medico:r().trim().required().label("M\xE9dico"),examen_ids:I().of(q().required()).required().label("Examenes"),item_ids:I().of(q().required()).required().label("Items"),paquete_ids:I().of(q().required()).required().label("Paquetes"),establecimiento_id:q().when([],{is:()=>g.value,then:e=>e.required(),otherwise:e=>e.optional()}).label("Establecimiento Institucional"),establecimiento_otro:r().when([],{is:()=>!g.value,then:e=>e.required(),otherwise:e=>e.optional()}).label("Otro Establecimiento")}),{values:s,setFieldValue:m,handleSubmit:j}=R({validationSchema:u,initialValues:{examen_ids:[],paquete_ids:[],paciente_id:y.pacienteId,fecha_registro:Z.now().toISODate()}}),g=S(!0),{mutateAsync:Y,reset:z,isLoading:H}=ve(),J=j(async(e,{setErrors:o,resetForm:n})=>{await Y(e,{onSuccess:()=>{ee.success("Orden registrada correctamente."),n(),b("submit")},onError:l=>{z.value(),o(l.data.errors)}})});ae(()=>s.examen_ids,e=>{var o;if(e){const n=(o=p.value)==null?void 0:o.filter(x=>x.examen_ids.every(v=>e.includes(v)));m("paquete_ids",(n==null?void 0:n.map(x=>Number(x.id)))||[]);let l=[];d.value&&(l=[],e.forEach(x=>{const v=d.value.find(P=>Number(P.id)===x);if(v&&v.items.data.length>0){const P=v.items.data.map(X=>Number(X.id));l.push(...P)}}),m("item_ids",[...new Set(l)]),console.log(s.item_ids))}});const W=e=>{var o;if(e){const n=(o=p.value)==null?void 0:o.filter(l=>e.includes(Number(l.id))).map(l=>l.examen_ids).flat();m("examen_ids",[...new Set(n)])}};return(e,o)=>(f(),h(oe,{loading:i(H),onSubmit:i(J)},{default:t(()=>[a(c,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:""}),g.value?(f(),h(U,{key:0,options:_.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:""},{after:t(()=>[a(k,{round:"",flat:"",icon:"fas fa-building-circle-arrow-right",color:"primary",onClick:o[0]||(o[0]=n=>g.value=!1)},{default:t(()=>[a(A,null,{default:t(()=>[O(" Otro establecimiento ")]),_:1})]),_:1})]),_:1},8,["options"])):(f(),h(c,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:""},{after:t(()=>[a(k,{round:"",flat:"",icon:"fas fa-building-circle-xmark",color:"negative",onClick:o[1]||(o[1]=n=>g.value=!0)},{default:t(()=>[a(A,null,{default:t(()=>[O(" Establecimiento institucional")]),_:1})]),_:1})]),_:1})),a(c,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:""}),a(c,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4"}),a(c,{name:"CPN",label:"Codigo Pre Natal",class:"col-xs-12 col-sm-4"}),a(c,{name:"EG",label:"Edad Gestacional",class:"col-xs-12 col-sm-4"}),a(c,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:""}),a(c,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:""}),$("div",qe,[a(te,{spaced:""}),O(" Paquetes")]),$("div",he,[a(xe,{name:"paquete_ids",label:"Paquetes",options:F.value,onUpdate:W},null,8,["options"])]),$("div",Ce,[i(d)?(f(),h(ge,{key:0,examens:i(d)},null,8,["examens"])):M("",!0)])]),_:1},8,["loading","onSubmit"]))}}),ye={class:"row q-col-gutter-md"},Ne={class:"col-12"},Be=G({__name:"RegistrarOrdenPage",setup(C){const{fetchPaciente:E,$reset:y}=T(),{paciente:b,isPacienteLoading:w}=ie(T()),{data:d}=se(),p=Q(()=>d.value?d.value.map(u=>({label:u.nombre,value:u.id})):[]),F=L().shape({numero_documento:q().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:r().required().label("Tipo de Documento")}),{handleSubmit:D}=R({validationSchema:F}),N=D(async u=>{await E(u.numero_documento),b.value?(B.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}),_.value=!0):B.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})}),_=S(!1);return ne(()=>{y()}),(u,s)=>(f(),le("div",ye,[a(ce,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:i(N)},{default:t(()=>[a(U,{options:p.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),a(c,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),a(re,{class:"col-auto justify-center"},{default:t(()=>[a(k,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:i(w)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),$("div",Ne,[a(V,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear",class:"bg-purple-2"},{default:t(()=>[a(ue,{class:"bg-purple-1",paciente:i(b),onCancel:i(y),onSubmit:s[0]||(s[0]=m=>i(E)(m))},null,8,["paciente","onCancel"])]),_:1}),i(b)?(f(),h(V,{key:0,modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=m=>_.value=m),icon:"fas fa-vials",label:"Datos de la Orden de Lab.",caption:"Editar / Crear"},{default:t(()=>[a(de,null,{default:t(()=>[a(me,null,{default:t(()=>[a(Ee,{"paciente-id":Number(i(b).id),onSubmit:s[1]||(s[1]=m=>u.$router.push({name:"laboratorio.registrar"}))},null,8,["paciente-id"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):M("",!0)])]))}});export{Be as default};
