import{aE as ie,aF as ne,W as ee,Y as R,b7 as se,b8 as re,o as f,e as h,w as i,f as D,at as J,a2 as o,a5 as e,b9 as ce,a3 as de,bc as ue,av as ae,bb as me,k as B,a1 as Y,ag as oe,H as O,ak as Q,a_ as be,aU as P,ad as E,au as w,aV as I,ac as F,ab as A,aZ as pe,aj as M,bd as fe,b1 as te,r as N,b4 as T,be as _e,$ as L,aY as ve,a6 as ge,ae as ye,bf as he,aS as x,a0 as k,bg as Z,aa as qe,aO as Ce,aJ as K,aN as $e,aI as Ee,a$ as le,Q as ke,am as G,al as we,aR as Se,aG as X,b0 as xe,b2 as Fe,b3 as H}from"./index.fd90448d.js";import{u as Ne}from"./ExamenCardList.f693f175.js";import{O as W,u as V,_ as Re}from"./laboratorio.store.d9db7014.js";import{u as Oe}from"./establecimientoFetchAllQuery.6d4ecf46.js";import"./BaseCheckBoxGroup.53af3f5f.js";import"./paqueteFetchAllQuery.0839479f.js";import"./PaqueteApi.e999dde6.js";function De(u){const _=async()=>(await W.fetchAll(u.value)).data(),{data:m,isLoading:d,isSuccess:q,isError:r,isFetching:c,refetch:a}=ie([ne.ORDEN_ALL,u==null?void 0:u.value],_,{keepPreviousData:!0});return{data:m,isLoading:d,isSuccess:q,isError:r,isFetching:c,refetch:a}}function Qe(){return ee(({id:u,data:_})=>W.updateEstado(u,_))}function Ae(){return ee(({id:u,data:_})=>W.updateExamens(u,_))}const Pe=R({__name:"BaseCheckBox",props:{name:{type:String,required:!0},label:{type:String,required:!0}},setup(u){const m=se(u,"name"),{value:d,handleChange:q,errorMessage:r}=re(m);return(c,a)=>(f(),h(me,{color:"black",borderless:"",error:!!o(r),"bottom-slots":"","hide-bottom-space":!o(r)},{error:i(()=>[D(J(o(r)),1)]),default:i(()=>[e(ue,ce(c.$attrs,{modelValue:o(d),"onUpdate:modelValue":[a[0]||(a[0]=b=>de(d)?d.value=b:null),a[1]||(a[1]=b=>o(q)(b))],label:u.label}),null,16,["modelValue","label"]),ae(c.$slots,"default")]),_:3},8,["error","hide-bottom-space"]))}}),Ie={class:"row"},Te=R({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},examens:{type:Array,required:!0},ordenId:{type:Number,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0}},emits:["submit","cancel"],setup(u,{emit:_}){const m=_,d=u,q=B(()=>d.examens?d.examens.map(l=>({label:l.nombre,value:Number(l.id)})):[]),{handleSubmit:r,setFieldValue:c,values:a}=Y({validationSchema:d.validationSchema,initialValues:d.initialValues}),{mutateAsync:b,reset:y,isLoading:S}=Ae(),v=r(async(l,{setErrors:n})=>{await b({id:d.ordenId,data:l},{onSuccess:()=>{oe.success("Resultados actualizados correctamente"),m("submit"),y.value()},onError:p=>{y.value(),n(p.data.errors)}})},l=>console.log(l)),t=l=>{let n;return!!a.pivot[l].minimo&&!!a.pivot[l].minimo&&(n=`Min: ${a.pivot[l].minimo} - Max: ${a.pivot[l].maximo}`),n},g=l=>{let n;return!!a.pivot[l].minimo&&!!a.pivot[l].minimo&&(a.pivot[l].resultado>a.pivot[l].minimo&&a.pivot[l].resultado<a.pivot[l].maximo?n="green-2":n="red-2"),n},C=l=>{const n="pivot["+l+"].is_canceled",p=a.pivot[l].is_canceled;c(n,!p)};return d.fields.forEach((l,n)=>{O(()=>a.pivot[n].unidad_id,p=>{if(p){const s=d.examens.find($=>$.id==a.pivot[n].examen_id);if(!!s&&!!p){const $=s.pivot.find(z=>z.unidad_id===p),j="pivot["+n+"].minimo",U="pivot["+n+"].maximo";$&&(c(j,$.minimo),c(U,$.maximo))}}},{deep:!0,immediate:!0}),O(()=>a.pivot[n].is_canceled,p=>{const s="pivot["+n+"].minimo",$="pivot["+n+"].maximo";p&&(c(s,void 0),c($,void 0))},{deep:!0,immediate:!0}),O(()=>a.pivot[n].is_enabled,p=>{const s="pivot["+n+"].minimo",$="pivot["+n+"].maximo",j="pivot["+n+"].resultado",U="pivot["+n+"].unidad_id",z="pivot["+n+"].motivo";p||(c(s,void 0),c($,void 0),c(j,null),c(U,null),c(z,null))},{deep:!0,immediate:!0})}),(l,n)=>(f(),h(te,{onSubmit:fe(o(v),["prevent"])},{default:i(()=>[(f(!0),Q(pe,null,be(u.fields,(p,s)=>(f(),Q("div",{key:s,class:"row q-col-gutter-sm q-mb-sm"},[e(P,{label:"Examen",name:`pivot[${s}].examen_id`,options:q.value,class:"col-3",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),o(a).pivot[s].is_canceled?(f(),h(E,{key:0,name:`pivot[${s}].motivo`,label:"Motivo",class:"col-4",required:"",disable:!o(a).pivot[s].is_enabled},null,8,["name","disable"])):w("",!0),o(a).pivot[s].is_canceled?w("",!0):(f(),h(E,{key:1,name:`pivot[${s}].resultado`,"bg-color":g(s),label:"Resultado",class:"col-2",required:"",disable:!o(a).pivot[s].is_enabled},null,8,["name","bg-color","disable"])),o(a).pivot[s].is_canceled?w("",!0):(f(),h(P,{key:2,label:"Unidad",name:`pivot[${s}].unidad_id`,options:o(a).pivot[s].unidads,hint:t(s),class:"col-2",required:"",disable:!o(a).pivot[s].is_enabled},null,8,["name","options","hint","disable"])),e(E,{label:"Fecha",type:"date",name:`pivot[${s}].fecha_resultado`,required:"",class:"col-2",disable:!o(a).pivot[s].is_enabled},null,8,["name","disable"]),e(A,{class:"col-3 self-center"},{default:i(()=>[e(Pe,{name:`pivot[${s}].is_enabled`,label:"",dense:""},{default:i(()=>[e(I,null,{default:i(()=>[D(J(o(a).pivot[s].is_enabled?"Deshabilitar.":"Habilitar."),1)]),_:2},1024)]),_:2},1032,["name"]),e(F,{icon:o(a).pivot[s].is_canceled?"fas fa-pen":"fas fa-ban",color:o(a).pivot[s].is_canceled?"warning":"negative",disable:!o(a).pivot[s].is_enabled,round:"",flat:"",size:"sm",onClick:$=>C(s)},{default:i(()=>[e(I,null,{default:i(()=>[D(J(o(a).pivot[s].is_canceled?"Registrar datos.":"Cancelar examen."),1)]),_:2},1024)]),_:2},1032,["icon","color","disable","onClick"])]),_:2},1024)]))),128)),M("div",Ie,[e(A,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:i(()=>[e(F,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:n[0]||(n[0]=p=>l.$emit("cancel"))}),e(F,{label:"Guardar",type:"submit",icon:"fas fa-floppy-disk",color:"primary",loading:o(S),"no-caps":""},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))}}),Le=R({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0}},emits:["submit","cancel"],setup(u){const _=N({limit:0}),{data:m}=Ne(_),d=B(()=>m.value?m.value.map(b=>({label:b.nombre,value:Number(b.id)})):[]),q=u,r=N([]),c=N(),a=N();return O(()=>m.value,b=>{if(b){r.value=q.orden.pivot.map(v=>{let t=[];const g=b.find(C=>Number(C.id)==v.examen_id);return t=[{label:"Examen",name:"examen_id",type:"select",options:d.value},{label:"Resultado",name:"resultado",type:"string"},{label:"Unidad",name:"unidad_id",type:"select",options:g?g.unidads.data.map(C=>({label:C.nombre,value:Number(C.id)})):[]},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Acciones",name:"actions",type:"array"}],t});const y=T().of(_e(()=>{let v={};return v={examen_id:he().required().label("Examen"),resultado:x().positive().when(["is_enabled","is_canceled"],{is:(t,g)=>t&&!g,then:t=>t.required(),otherwise:t=>t.nullable()}).transform((t,g)=>g===""?void 0:t).typeError("Debe ingresar un numero").label("Resultado"),fecha_resultado:k().required().label("Fecha"),unidad_id:x().when(["is_enabled","is_canceled"],{is:(t,g)=>t&&!g,then:t=>t.required(),otherwise:t=>t.nullable()}).label("Unidad"),is_canceled:Z().required().label("Cancelado?"),is_enabled:Z().required().label("Hablitad?"),motivo:k().when(["is_enabled","is_canceled"],{is:!0,then:t=>t.required(),otherwise:t=>t.nullable()}).label("Motivo"),minimo:x(),maximo:x(),unidads:T()},L().shape(v)}));c.value=L().shape({pivot:y});const S=q.orden.pivot.map(v=>{var g;const t=b.find(C=>Number(C.id)==v.examen_id);return{examen_id:v.examen_id,resultado:v.resultado,fecha_resultado:(g=v.fecha_resultado)!=null?g:ve.now().toISODate(),unidad_id:v.unidad_id,is_canceled:v.is_canceled,is_enabled:!0,motivo:v.motivo,unidads:t?t.unidads.data.map(C=>({label:C.nombre,value:Number(C.id)})):[]}});a.value={pivot:S}}},{immediate:!0}),(b,y)=>(f(),h(ye,{class:"my-card"},{default:i(()=>[e(ge,null,{default:i(()=>[r.value.length>0&&c.value&&o(m)?(f(),h(Te,{key:0,fields:r.value,"validation-schema":c.value,"initial-values":a.value,"orden-id":Number(u.orden.id),examens:o(m),onCancel:y[0]||(y[0]=S=>b.$emit("cancel")),onSubmit:y[1]||(y[1]=S=>b.$emit("submit"))},null,8,["fields","validation-schema","initial-values","orden-id","examens"])):w("",!0)]),_:1})]),_:1}))}}),Ve=R({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},emits:["cancel"],setup(u){const _=u,{data:m}=Oe(),d=B(()=>m.value?m.value.map(r=>({label:r.nombre,value:Number(r.id)})):[]),q=L().shape({diagnostico:k().trim().min(2).required().label("Diagnostico"),CI10:k().trim().min(2).required().label("CI10"),CPN:k().trim().min(2).required().label("CPN"),EG:k().trim().min(2).required().label("EG"),codigo_atencion:k().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:k().trim().required().label("Fecha de Registro"),medico:k().trim().required().label("M\xE9dico"),examen_ids:T().of(x().required()).required().label("Examenes"),paquete_ids:T().of(x().required()).required().label("Paquetes"),establecimiento_id:x().label("Establecimiento Institucional"),establecimiento_otro:k().label("Otro Establecimiento")});return Y({validationSchema:q,initialValues:_.orden}),(r,c)=>(f(),h(qe,null,{actions:i(()=>[e(A,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:i(()=>[e(F,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:c[0]||(c[0]=a=>r.$emit("cancel"))})]),_:1})]),default:i(()=>[e(E,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1}),u.orden.establecimiento_id?(f(),h(P,{key:0,options:d.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:"",readonly:"",borderless:"",outlined:!1},null,8,["options"])):(f(),h(E,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1})),e(E,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(E,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(E,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(E,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(E,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(E,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1})]),_:1}))}}),Be=R({__name:"OrdenTable",props:{ordens:{type:Array,required:!0}},setup(u){const{formatDate:_}=Ee(),m=[{name:"fecha_registro",align:"left",label:"Fecha Registro",field:"fecha_registro",format:d=>_(d)},{name:"medico",align:"center",label:"Medico",field:"medico"},{name:"codigo_atencion",align:"center",label:"Codigo Atenci\xF3n",field:"codigo_atencion"},{name:"estado",align:"center",label:"Estado",field:"estado"},{name:"actions",align:"right",label:"Acciones",field:"actions"}];return(d,q)=>(f(),h(o($e),{rows:u.ordens,columns:m,"row-key":"id"},{"body-cell-estado":i(r=>[e(K,{props:r},{default:i(()=>[e(Ce,{color:r.row.estado_detalle.color,label:r.row.estado_detalle.label},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-actions":i(r=>[e(K,{props:r,class:"text-right"},{default:i(()=>[e(A,{align:"right",class:"q-pa-none q-ma-none"},{default:i(()=>[ae(d.$slots,"actions",{id:Number(r.key),estado:r.row.estado})]),_:2},1024)]),_:2},1032,["props"])]),_:3},8,["rows"]))}}),Me={key:0,class:"col-12 row justify-center"},je={class:"col-auto"},Ue=M("div",{class:"col-12 text-center text-h6"}," Lo sentimos. \xA1No se encontr\xF3 ninguna orden!. Porfavor registre uno para empezar. ",-1),ze={key:1},Ge=R({__name:"DatosOrdenTab",props:{paciente:{type:Object,required:!0}},setup(u){const _=u,{ordenSeleccionada:m,isOrdenLoading:d}=le(V()),{fetchOrdenById:q}=V(),r=N({search:`paciente_id:${_.paciente.id};estado:0,1`,searchJoin:"and",limit:0}),{data:c,refetch:a}=De(r),b=N("list"),y=N(),S=async l=>{y.value=l,await q(l),m.value&&(b.value="view")},{mutateAsync:v,isLoading:t}=Qe(),g=async(l,n)=>{y.value=l,await v({id:l,data:{estado:n}},{onSuccess:()=>{oe.success("La orden se REGISTRO correctamente."),a.value(),b.value="list"},onError:p=>{console.log(p)}})},C=()=>{m.value=void 0};return O(()=>m.value,l=>{l||(b.value="list")}),(l,n)=>u.paciente?(f(),h(we,{key:0,modelValue:b.value,"onUpdate:modelValue":n[0]||(n[0]=p=>b.value=p),animated:""},{default:i(()=>[e(G,{name:"list"},{default:i(()=>[o(c)&&o(c).data.length===0?(f(),Q("div",Me,[M("div",je,[e(ke,{name:"fas fa-face-frown",size:"xl"})]),Ue,e(F,{class:"q-mt-lg",color:"primary",icon:"fas fa-plus","no-caps":"",label:"Registrar nueva orden",outline:"",to:"/laboratorio/registrar-orden"})])):o(c)?(f(),Q("div",ze,[e(Be,{ordens:o(c).data},{actions:i(({id:p,estado:s})=>[e(F,{color:"primary",icon:"fas fa-file-signature",round:"",flat:"",size:"sm",loading:o(d)&&y.value===p,onClick:$=>S(p)},{default:i(()=>[e(I,null,{default:i(()=>[D("Editar resultados.")]),_:1})]),_:2},1032,["loading","onClick"]),s===0?(f(),h(F,{key:0,color:"positive",icon:"fas fa-check-double",round:"",flat:"",size:"sm",loading:o(t)&&y.value===p,onClick:$=>g(p,1)},{default:i(()=>[e(I,null,{default:i(()=>[D("Confirmar registro.")]),_:1})]),_:2},1032,["loading","onClick"])):w("",!0)]),_:1},8,["ordens"])])):w("",!0)]),_:1}),e(G,{name:"new"},{default:i(()=>[e(Re,{"paciente-id":Number(u.paciente.id)},null,8,["paciente-id"])]),_:1}),e(G,{name:"view"},{default:i(()=>[o(m)?(f(),h(Ve,{key:0,orden:o(m),onCancel:C},null,8,["orden"])):w("",!0)]),_:1})]),_:1},8,["modelValue"])):w("",!0)}}),He={class:"row q-col-gutter-md"},Je={class:"col-12"},oa=R({__name:"RegistrarResultadosPage",setup(u){const{fetchPaciente:_,$reset:m}=V(),{paciente:d,isPacienteLoading:q,ordenSeleccionada:r}=le(V()),{data:c}=Se(),a=B(()=>c.value?c.value.map(t=>({label:t.nombre,value:t.id})):[]),b=L().shape({numero_documento:x().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:k().required().label("Tipo de Documento")}),{handleSubmit:y}=Y({validationSchema:b}),S=y(async t=>{m(),await _(t.numero_documento),d.value?X.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}):X.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})}),v=()=>{r.value=void 0};return xe(()=>{if(window.confirm("Esta seguro de salir? Tiene cambios sin guardar!"))m();else return!1}),(t,g)=>(f(),Q("div",He,[e(te,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:o(S)},{default:i(()=>[e(P,{options:a.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),e(E,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),e(A,{class:"col-auto justify-center"},{default:i(()=>[e(F,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:o(q)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),M("div",Je,[e(H,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear",class:"bg-purple-2"},{default:i(()=>[e(Fe,{class:"bg-purple-1",paciente:o(d),onCancel:o(m),onSubmit:g[0]||(g[0]=C=>o(_)(C))},null,8,["paciente","onCancel"])]),_:1}),o(d)?(f(),h(H,{key:0,icon:"fas fa-vials",label:"Datos de la Orden de Lab.",caption:"Editar / Crear"},{default:i(()=>[e(Ge,{paciente:o(d),onCancel:o(m)},null,8,["paciente","onCancel"])]),_:1})):w("",!0),o(r)?(f(),h(H,{key:1,icon:"fas fa-file-signature",label:"Registrar resultados.",caption:"Editar / Crear"},{default:i(()=>[e(Le,{orden:o(r),onCancel:v,onSubmit:v},null,8,["orden"])]),_:1})):w("",!0)])]))}});export{oa as default};
