import{U as K,X as U,r as S,j as Q,Z as G,$ as c,aU as f,b4 as P,a0 as L,aZ as Y,af as ee,G as ae,o as _,d as h,w as t,a4 as e,ac as s,aW as R,aX as k,e as I,ab as A,ai as $,aC as te,a1 as i,at as j,a9 as oe,b8 as ie,aT as se,aF as B,b9 as ne,aj as re,aa as le,be as ce,bf as ue,bg as T,a5 as me,ad as de}from"./index.ddaffeba.js";import{u as be}from"./establecimientoFetchAllQuery.4c2447b5.js";import{u as pe}from"./examenFetchAllQuery.20d85fdf.js";import{O as fe}from"./OrdenApi.610e0468.js";import{u as _e}from"./paqueteFetchAllQuery.ecaf4de4.js";import{_ as ge}from"./ExamenCardList.f0810d8a.js";import{_ as xe}from"./BaseCheckBoxGroup.e838326f.js";import{u as V}from"./laboratorio.store.4ce676c2.js";import"./EstablecimientoApi.0ae636f8.js";import"./ExamenApi.fd374c57.js";import"./PaqueteApi.c4643ddc.js";function qe(){return K(C=>fe.create(C))}const ve={class:"col-12"},he={class:"col-12"},Ce={class:"col-12 row q-col-gutter-sm"},Ee=U({__name:"OrdenCreateForm",props:{pacienteId:{type:Number,required:!0}},emits:["submit"],setup(C,{emit:E}){const y=C,b=E,F=S({limit:0,search:"is_active:1",searchJoin:"and"}),{data:d}=pe(F),{data:p}=_e(),w=Q(()=>p.value?p.value.map(a=>({label:a.nombre,value:Number(a.id)})):[]),O=S({limit:0}),{data:N}=be(O),g=Q(()=>N.value?N.value.map(a=>({label:a.nombre,value:Number(a.id)})):[]),u=G().shape({diagnostico:c().trim().min(2).required().label("Diagnostico"),CI10:c().trim().min(2).nullable().label("CI10"),CPN:c().trim().min(2).nullable().label("CPN"),EG:c().trim().min(2).nullable().label("EG"),codigo_atencion:c().trim().min(2).required().label("Codigo de Atencion"),numero_orden:f().required().typeError("Debe ingresar un numero").positive().integer().label("Numero de Orden"),fecha_registro:c().trim().required().label("Fecha de Registro"),medico:c().trim().required().label("M\xE9dico"),examen_ids:P().of(f().required()).required().label("Examenes"),item_ids:P().of(f().required()).required().label("Items"),paquete_ids:P().of(f().required()).required().label("Paquetes"),establecimiento_id:f().when([],{is:()=>x.value,then:a=>a.required(),otherwise:a=>a.optional()}).label("Establecimiento Institucional"),establecimiento_otro:c().when([],{is:()=>!x.value,then:a=>a.required(),otherwise:a=>a.optional()}).label("Otro Establecimiento")}),{values:n,setFieldValue:m,handleSubmit:M}=L({validationSchema:u,initialValues:{examen_ids:[],paquete_ids:[],paciente_id:y.pacienteId,fecha_registro:Y.now().toISODate()}}),x=S(!0),{mutateAsync:X,reset:Z,isLoading:z}=qe(),J=M(async(a,{setErrors:o,resetForm:r})=>{await X(a,{onSuccess:()=>{ee.success("Orden registrada correctamente."),r(),b("submit")},onError:l=>{Z.value(),o(l.data.errors)}})});ae(()=>n.examen_ids,a=>{var o;if(a){const r=(o=p.value)==null?void 0:o.filter(q=>q.examen_ids.every(v=>a.includes(v)));m("paquete_ids",(r==null?void 0:r.map(q=>Number(q.id)))||[]);let l=[];d.value&&(l=[],a.forEach(q=>{const v=d.value.find(D=>Number(D.id)===q);if(v&&v.items.data.length>0){const D=v.items.data.map(H=>Number(H.id));l.push(...D)}}),m("item_ids",[...new Set(l)]),console.log(n.item_ids))}});const W=a=>{var o;if(a){const r=(o=p.value)==null?void 0:o.filter(l=>a.includes(Number(l.id))).map(l=>l.examen_ids).flat();m("examen_ids",[...new Set(r)])}};return(a,o)=>(_(),h(oe,{loading:i(z),onSubmit:i(J)},{default:t(()=>[e(s,{name:"numero_orden",label:"Numero de Orden",class:"col-xs-12 col-sm-6",required:""}),e(s,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:""}),x.value?(_(),h(R,{key:0,options:g.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:""},{after:t(()=>[e(A,{round:"",flat:"",icon:"fas fa-building-circle-arrow-right",color:"primary",onClick:o[0]||(o[0]=r=>x.value=!1)},{default:t(()=>[e(k,null,{default:t(()=>[I(" Otro establecimiento ")]),_:1})]),_:1})]),_:1},8,["options"])):(_(),h(s,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:""},{after:t(()=>[e(A,{round:"",flat:"",icon:"fas fa-building-circle-xmark",color:"negative",onClick:o[1]||(o[1]=r=>x.value=!0)},{default:t(()=>[e(k,null,{default:t(()=>[I(" Establecimiento institucional")]),_:1})]),_:1})]),_:1})),e(s,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-6",required:""}),e(s,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4"}),e(s,{name:"CPN",label:"Codigo Pre Natal",class:"col-xs-12 col-sm-4"}),e(s,{name:"EG",label:"Edad Gestacional",class:"col-xs-12 col-sm-4"}),e(s,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:""}),e(s,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:""}),$("div",ve,[e(te,{spaced:""}),I(" Paquetes")]),$("div",he,[e(xe,{name:"paquete_ids",label:"Paquetes",options:w.value,onUpdate:W},null,8,["options"])]),$("div",Ce,[i(d)?(_(),h(ge,{key:0,examens:i(d)},null,8,["examens"])):j("",!0)])]),_:1},8,["loading","onSubmit"]))}}),ye={class:"row q-col-gutter-md"},Ne={class:"col-12"},Be=U({__name:"RegistrarOrdenPage",setup(C){const{fetchPaciente:E,$reset:y}=V(),{paciente:b,isPacienteLoading:F}=ie(V()),{data:d}=se(),p=Q(()=>d.value?d.value.map(u=>({label:u.nombre,value:u.id})):[]),w=G().shape({numero_documento:f().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:c().required().label("Tipo de Documento")}),{handleSubmit:O}=L({validationSchema:w}),N=O(async u=>{await E(u.numero_documento),b.value?(B.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}),g.value=!0):B.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})}),g=S(!1);return ne(()=>{y()}),(u,n)=>(_(),re("div",ye,[e(ce,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:i(N)},{default:t(()=>[e(R,{options:p.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),e(s,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),e(le,{class:"col-auto justify-center"},{default:t(()=>[e(A,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:i(F)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),$("div",Ne,[e(T,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear",class:"bg-purple-2"},{default:t(()=>[e(ue,{class:"bg-purple-1",paciente:i(b),onCancel:i(y),onSubmit:n[0]||(n[0]=m=>i(E)(m))},null,8,["paciente","onCancel"])]),_:1}),i(b)?(_(),h(T,{key:0,modelValue:g.value,"onUpdate:modelValue":n[2]||(n[2]=m=>g.value=m),icon:"fas fa-vials",label:"Datos de la Orden de Lab.",caption:"Editar / Crear"},{default:t(()=>[e(de,null,{default:t(()=>[e(me,null,{default:t(()=>[e(Ee,{"paciente-id":Number(i(b).id),onSubmit:n[1]||(n[1]=m=>u.$router.push({name:"laboratorio.registrar"}))},null,8,["paciente-id"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):j("",!0)])]))}});export{Be as default};
