import{W as K,Y as G,r as S,k as Q,$ as L,a0 as c,aV as _,b6 as P,a1 as R,a$ as Z,ag as ee,H as ae,o as f,e as h,w as t,a5 as e,ad as s,aX as U,aY as A,f as I,ac as k,aj as $,aD as te,a2 as i,au as M,aa as oe,ba as ie,aU as se,aG as B,bb as ne,ak as re,ab as le,bg as ce,bh as ue,bi as V,a6 as me,ae as de}from"./index.747a1a42.js";import{u as be}from"./establecimientoFetchAllQuery.0f455efc.js";import{u as pe}from"./examenFetchAllQuery.a8190778.js";import{O as _e}from"./OrdenApi.7b7ed575.js";import{u as fe}from"./paqueteFetchAllQuery.db0cf8d7.js";import{_ as ge}from"./ExamenCardList.f4cd1169.js";import{_ as xe}from"./BaseCheckBoxGroup.27455b89.js";import{u as T}from"./laboratorio.store.9e34b982.js";import"./EstablecimientoApi.a44a843e.js";import"./ExamenApi.90f33f4e.js";import"./PaqueteApi.e900bc56.js";function qe(){return K(E=>_e.create(E))}const ve={class:"col-12"},he={class:"col-12"},Ee={class:"col-12 row q-col-gutter-sm"},ye=G({__name:"OrdenCreateForm",props:{pacienteId:{type:Number,required:!0}},emits:["submit"],setup(E,{emit:y}){const C=E,b=y,w=S({limit:0,search:"is_active:1",searchJoin:"and"}),{data:d}=pe(w),{data:p}=fe(),F=Q(()=>p.value?p.value.map(a=>({label:a.nombre,value:Number(a.id)})):[]),D=S({limit:0}),{data:N}=be(D),g=Q(()=>N.value?N.value.map(a=>({label:a.nombre,value:Number(a.id)})):[]),u=L().shape({diagnostico:c().trim().min(2).required().label("Diagnostico"),CI10:c().trim().min(2).nullable().label("CI10"),CPN:c().trim().min(2).nullable().label("CPN"),EG:c().trim().min(2).nullable().label("EG"),codigo_atencion:c().trim().min(2).required().label("Codigo de Atencion"),numero_orden:_().required().typeError("Debe ingresar un numero").positive().integer().label("Numero de Orden"),fecha_registro:c().trim().required().label("Fecha de Registro"),medico:c().trim().required().label("M\xE9dico"),examen_ids:P().of(_().required()).required().label("Examenes"),item_ids:P().of(_().required()).required().label("Items"),paquete_ids:P().of(_().required()).required().label("Paquetes"),establecimiento_id:_().when([],{is:()=>x.value,then:a=>a.required(),otherwise:a=>a.optional()}).label("Establecimiento Institucional"),establecimiento_otro:c().when([],{is:()=>!x.value,then:a=>a.required(),otherwise:a=>a.optional()}).label("Otro Establecimiento")}),{values:n,setFieldValue:m,handleSubmit:j}=R({validationSchema:u,initialValues:{examen_ids:[],paquete_ids:[],paciente_id:C.pacienteId,fecha_registro:Z.now().toISODate()}}),x=S(!0),{mutateAsync:Y,reset:z,isLoading:H}=qe(),J=j(async(a,{setErrors:o,resetForm:r})=>{await Y(a,{onSuccess:()=>{ee.success("Orden registrada correctamente."),r(),b("submit")},onError:l=>{z.value(),o(l.data.errors)}})});ae(()=>n.examen_ids,a=>{var o;if(a){const r=(o=p.value)==null?void 0:o.filter(q=>q.examen_ids.every(v=>a.includes(v)));m("paquete_ids",(r==null?void 0:r.map(q=>Number(q.id)))||[]);let l=[];d.value&&(l=[],a.forEach(q=>{const v=d.value.find(O=>Number(O.id)===q);if(v&&v.items.data.length>0){const O=v.items.data.map(X=>Number(X.id));l.push(...O)}}),m("item_ids",[...new Set(l)]),console.log(n.item_ids))}});const W=a=>{var o;if(a){const r=(o=p.value)==null?void 0:o.filter(l=>a.includes(Number(l.id))).map(l=>l.examen_ids).flat();m("examen_ids",[...new Set(r)])}};return(a,o)=>(f(),h(oe,{loading:i(H),onSubmit:i(J)},{default:t(()=>[e(s,{name:"numero_orden",label:"Numero de Orden",class:"col-xs-12 col-sm-6",required:""}),e(s,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:""}),x.value?(f(),h(U,{key:0,options:g.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:""},{after:t(()=>[e(k,{round:"",flat:"",icon:"fas fa-building-circle-arrow-right",color:"primary",onClick:o[0]||(o[0]=r=>x.value=!1)},{default:t(()=>[e(A,null,{default:t(()=>[I(" Otro establecimiento ")]),_:1})]),_:1})]),_:1},8,["options"])):(f(),h(s,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:""},{after:t(()=>[e(k,{round:"",flat:"",icon:"fas fa-building-circle-xmark",color:"negative",onClick:o[1]||(o[1]=r=>x.value=!0)},{default:t(()=>[e(A,null,{default:t(()=>[I(" Establecimiento institucional")]),_:1})]),_:1})]),_:1})),e(s,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-6",required:""}),e(s,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4"}),e(s,{name:"CPN",label:"Codigo Pre Natal",class:"col-xs-12 col-sm-4"}),e(s,{name:"EG",label:"Edad Gestacional",class:"col-xs-12 col-sm-4"}),e(s,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:""}),e(s,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:""}),$("div",ve,[e(te,{spaced:""}),I(" Paquetes")]),$("div",he,[e(xe,{name:"paquete_ids",label:"Paquetes",options:F.value,onUpdate:W},null,8,["options"])]),$("div",Ee,[i(d)?(f(),h(ge,{key:0,examens:i(d)},null,8,["examens"])):M("",!0)])]),_:1},8,["loading","onSubmit"]))}}),Ce={class:"row q-col-gutter-md"},Ne={class:"col-12"},Be=G({__name:"RegistrarOrdenPage",setup(E){const{fetchPaciente:y,$reset:C}=T(),{paciente:b,isPacienteLoading:w}=ie(T()),{data:d}=se(),p=Q(()=>d.value?d.value.map(u=>({label:u.nombre,value:u.id})):[]),F=L().shape({numero_documento:_().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:c().required().label("Tipo de Documento")}),{handleSubmit:D}=R({validationSchema:F}),N=D(async u=>{await y(u.numero_documento),b.value?(B.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}),g.value=!0):B.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})}),g=S(!1);return ne(()=>{C()}),(u,n)=>(f(),re("div",Ce,[e(ce,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:i(N)},{default:t(()=>[e(U,{options:p.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),e(s,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),e(le,{class:"col-auto justify-center"},{default:t(()=>[e(k,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:i(w)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),$("div",Ne,[e(V,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear",class:"bg-purple-2"},{default:t(()=>[e(ue,{class:"bg-purple-1",paciente:i(b),onCancel:i(C),onSubmit:n[0]||(n[0]=m=>i(y)(m))},null,8,["paciente","onCancel"])]),_:1}),i(b)?(f(),h(V,{key:0,modelValue:g.value,"onUpdate:modelValue":n[2]||(n[2]=m=>g.value=m),icon:"fas fa-vials",label:"Datos de la Orden de Lab.",caption:"Editar / Crear"},{default:t(()=>[e(de,null,{default:t(()=>[e(me,null,{default:t(()=>[e(ye,{"paciente-id":Number(i(b).id),onSubmit:n[1]||(n[1]=m=>u.$router.push({name:"laboratorio.registrar"}))},null,8,["paciente-id"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):M("",!0)])]))}});export{Be as default};
