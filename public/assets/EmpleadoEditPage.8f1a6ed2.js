import{a_ as P,au as R,d as $,c as g,w as O,h as _,j as E,v as x,B as h,x as a,aC as j,u as l,K as z,y as U,aX as K,z as X,aD as G,aE as H}from"./index.80fb9679.js";import{_ as J}from"./SkeletonForm.5f1f3023.js";import{u as W,a as y,Q as Y,_ as Z,b as ee}from"./personaReniecQuery.c4423399.js";import{D as ae,u as oe}from"./useLuxonFormat.a1b67595.js";import{u as re,a as se}from"./establecimientoFetchAllQuery.9d800f6d.js";import{E as S}from"./EmpleadoApi.b1521251.js";import{u as le}from"./tipoDocumentoFetchAllQuery.b2559a5f.js";import{u as te,a as m,_ as ne}from"./BaseInput.36ff5cc4.js";import{c as ie,a as d,e as N}from"./index.esm.1f0c9726.js";import{Q as ce}from"./QueryTypes.707bd378.js";import"./index.d0197c56.js";import"./QSelect.6ee785ba.js";import"./rtl.b51694b1.js";import"./TipoDocumentoApi.aa3c7475.js";function ue(r,t){const f=async()=>(await S.fetchById(r)).data().data,{data:n,isLoading:p,isSuccess:s,isError:b,isFetching:v,refetch:i}=P([ce.EMPLEADOS_ALL,r],f,{enabled:t});return{data:n,isLoading:p,isSuccess:s,isError:b,isFetching:v,refetch:i}}function me(){return R(({data:r,id:t})=>S.update(r,t))}const de={class:"col-xs-12 col-sm-4"},pe=$({__name:"EmpleadoEditForm",props:{empleado:{type:Object,required:!0}},emits:["submit","cancel"],setup(r,{emit:t}){const f=t,n=r,{data:p}=le(),s=g(()=>p.value?p.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:b}=re(),v=g(()=>b.value?b.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:i}=se(),F=g(()=>i.value?i.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),D=g(()=>{const e=s.value.find(o=>o.value==Number(q.tipo_documento_id));return e?e.label==="DNI":!1}),A=ie().shape({nombres:d().trim().required().label("Nombres"),apellido_paterno:d().trim().required().label("Apellido Paterno"),apellido_materno:d().trim().required().label("Apellido Materno"),tipo_documento_id:d().required().label("Tipo de Documento"),direccion:d().trim().required().label("Direccion"),numero_documento:N().typeError("Debe ingresar un n\xFAmero").required().label("N\xFAmero de Documento"),fecha_nacimiento:d().trim().required().label("Fecha de Nacimiento"),telefono:N().typeError("Tel\xE9fono debe ser un numero").integer().positive().required().label("Tel\xE9fono"),edad:N().typeError("Edad debe ser un numero").integer().positive().required().label("Edad"),sexo:d().required().label("Sexo")}),{handleSubmit:Q,setErrors:C,values:q,setFieldValue:c,resetForm:k}=te({validationSchema:A,initialValues:n.empleado}),{isLoading:B,mutate:T}=me(),L=Q(async e=>{T({data:e,id:n.empleado.id},{onSuccess:()=>{f("submit")},onError:o=>{C(o.data.errors)}})},e=>console.log(e)),{fetch:M,reniec:u,isLoading:V}=W(),w=async()=>{if(await M(q.numero_documento),u.value){c("nombres",u.value.nombres),c("apellido_paterno",u.value.apellido_paterno),c("apellido_materno",u.value.apellido_materno),c("direccion",u.value.direccion),c("sexo",u.value.sexo==="1"?"Masculino":"Femenino");var e=u.value.fecha_nacimiento.split("/");const o=ae.local(Number(e[2]),Number(e[1]),Number(e[0]));o.isValid&&c("fecha_nacimiento",o.toISODate())}else k()},{calcularEdad:I}=oe();return O(()=>q.fecha_nacimiento,e=>{e&&c("edad",I(e))}),(e,o)=>(_(),E(ne,{loading:l(B),onSubmit:l(L),onCancel:o[0]||(o[0]=_e=>e.$emit("cancel"))},{default:x(()=>[s.value.length>0?(_(),E(y,{key:0,options:s.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"])):h("",!0),a(m,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""},{after:x(()=>[D.value?(_(),E(j,{key:0,round:"",dense:"",icon:"search",color:"primary",loading:l(V),onClick:w},{default:x(()=>[a(Y,null,{default:x(()=>[z(" Buscar en RENIEC ")]),_:1})]),_:1},8,["loading"])):h("",!0)]),_:1}),a(y,{options:v.value,name:"establecimiento_id",class:"col-xs-12 col-sm-4",label:"Establecimiento",loading:!1,required:""},null,8,["options"]),a(y,{options:F.value,name:"cargo_id",class:"col-xs-12 col-sm-4",label:"Cargo",loading:!1,required:""},null,8,["options"]),a(m,{name:"nombres",label:"Nombres",class:"col-xs-12 col-sm-4",required:""}),a(m,{name:"apellido_paterno",label:"Apellido Paterno",class:"col-xs-12 col-sm-4",required:""}),a(m,{name:"apellido_materno",label:"Apellido Materno",class:"col-xs-12 col-sm-4",required:""}),U("div",de,[a(Z,{required:"",name:"fecha_nacimiento",label:"Fecha Nacimiento"})]),a(m,{name:"direccion",label:"Direcci\xF3n",class:"col-xs-12 col-sm-4",required:""}),a(m,{name:"telefono",label:"Tel\xE9fono",class:"col-xs-12 col-sm-4",required:""}),a(m,{name:"edad",label:"Edad",class:"col-xs-12 col-sm-4",required:""}),a(ee,{required:"",options:[{label:"Masculino",value:"Masculino"},{label:"Femenino",value:"Femenino"}],name:"sexo",label:"Sexo",class:"col-xs-12 col-sm-8"})]),_:1},8,["loading","onSubmit"]))}}),be={class:"row"},Qe=$({__name:"EmpleadoEditPage",props:{id:{type:Number,required:!0}},setup(r){const t=r,f=K(),{data:n,isSuccess:p,isFetching:s}=ue(t.id,!0),b=()=>{H.success("Registro actualizado correctamente"),f.back()};return(v,i)=>(_(),X("div",be,[l(s)?(_(),E(G,{key:0,class:"col-12 q-pa-lg"},{default:x(()=>[a(J,{class:"col-12",inputs:2})]),_:1})):h("",!0),l(p)&&!l(s)&&l(n)?(_(),E(pe,{key:1,empleado:l(n),onSubmit:b,onCancel:i[0]||(i[0]=F=>v.$router.back())},null,8,["empleado"])):h("",!0)]))}});export{Qe as default};
