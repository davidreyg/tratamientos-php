import{aE as oe,aF as te,W as Y,Y as O,k as T,a1 as U,ag as W,H as z,o as f,e as h,w as l,ak as R,a_ as ne,a5 as e,aU as D,a2 as n,ad as x,au as E,ac as F,aV as M,f as B,at as le,ab as A,aZ as ie,aj as L,bc as se,b1 as Z,r as N,b4 as Q,bd as re,$ as I,aY as ce,a6 as de,ae as ue,be as me,aS as S,a0 as $,bf as fe,aa as pe,aO as be,aJ as H,av as _e,aN as ve,aI as ge,a$ as K,Q as ye,am as V,al as he,aR as qe,aG as J,b0 as Ce,b2 as xe,b3 as j}from"./index.f6335575.js";import{u as $e}from"./ExamenCardList.16584f46.js";import{O as G,u as P,_ as Ee}from"./laboratorio.store.d9dfc1bb.js";import{u as we}from"./establecimientoFetchAllQuery.a8f000e4.js";import"./BaseCheckBoxGroup.06666695.js";import"./paqueteFetchAllQuery.67cc79d0.js";import"./PaqueteApi.12b8e14d.js";function ke(r){const _=async()=>(await G.fetchAll(r.value)).data(),{data:s,isLoading:c,isSuccess:C,isError:i,isFetching:m,refetch:o}=oe([te.ORDEN_ALL,r==null?void 0:r.value],_,{keepPreviousData:!0});return{data:s,isLoading:c,isSuccess:C,isError:i,isFetching:m,refetch:o}}function Se(){return Y(({id:r,data:_})=>G.updateEstado(r,_))}function Fe(){return Y(({id:r,data:_})=>G.updateExamens(r,_))}const Ne={class:"row"},Oe=O({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},examens:{type:Array,required:!0},ordenId:{type:Number,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0}},emits:["submit","cancel"],setup(r,{emit:_}){const s=_,c=r,C=T(()=>c.examens?c.examens.map(a=>({label:a.nombre,value:Number(a.id)})):[]),{handleSubmit:i,setFieldValue:m,values:o}=U({validationSchema:c.validationSchema,initialValues:c.initialValues}),{mutateAsync:p,reset:g,isLoading:w}=Fe(),b=i(async(a,{setErrors:d})=>{await p({id:c.ordenId,data:a},{onSuccess:()=>{W.success("Resultados actualizados correctamente"),s("submit"),g.value()},onError:v=>{g.value(),d(v.data.errors)}})}),t=a=>{let d;return!!o.pivot[a].minimo&&!!o.pivot[a].minimo&&(d=`Min: ${o.pivot[a].minimo} - Max: ${o.pivot[a].maximo}`),d},q=a=>{let d;return!!o.pivot[a].minimo&&!!o.pivot[a].minimo&&(o.pivot[a].resultado>o.pivot[a].minimo&&o.pivot[a].resultado<o.pivot[a].maximo?d="green-2":d="red-2"),d},y=a=>{const d="pivot["+a+"].is_canceled",v=o.pivot[a].is_canceled;m(d,!v)};return c.fields.forEach((a,d)=>{z(()=>o.pivot[d].unidad_id,v=>{const u=c.examens.find(k=>k.id==o.pivot[d].examen_id);if(!!u&&!!v){const k=u.pivot.find(ae=>ae.unidad_id===v),X="pivot["+d+"].minimo",ee="pivot["+d+"].maximo";k&&(m(X,k.minimo),m(ee,k.maximo))}},{deep:!0,immediate:!0})}),(a,d)=>(f(),h(Z,{onSubmit:se(n(b),["prevent"])},{default:l(()=>[(f(!0),R(ie,null,ne(r.fields,(v,u)=>(f(),R("div",{key:u,class:"row q-col-gutter-sm q-mb-sm"},[e(D,{label:"Examen",name:`pivot[${u}].examen_id`,options:C.value,class:"col-3",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),n(o).pivot[u].is_canceled?(f(),h(x,{key:0,name:`pivot[${u}].motivo`,label:"Motivo",class:"col-4",required:""},null,8,["name"])):E("",!0),n(o).pivot[u].is_canceled?E("",!0):(f(),h(x,{key:1,name:`pivot[${u}].resultado`,"bg-color":q(u),label:"Resultado",class:"col-2",required:""},null,8,["name","bg-color"])),n(o).pivot[u].is_canceled?E("",!0):(f(),h(D,{key:2,label:"Unidad",name:`pivot[${u}].unidad_id`,options:n(o).pivot[u].unidads,hint:t(u),class:"col-2",required:""},null,8,["name","options","hint"])),e(x,{label:"Fecha",type:"date",name:`pivot[${u}].fecha_resultado`,required:"",class:"col-2"},null,8,["name"]),e(A,{class:"col-3 self-center"},{default:l(()=>[e(F,{icon:n(o).pivot[u].is_canceled?"fas fa-pen":"fas fa-ban",color:n(o).pivot[u].is_canceled?"warning":"negative",round:"",flat:"",size:"sm",onClick:k=>y(u)},{default:l(()=>[e(M,null,{default:l(()=>[B(le(n(o).pivot[u].is_canceled?"Registrar datos.":"Cancelar examen."),1)]),_:2},1024)]),_:2},1032,["icon","color","onClick"])]),_:2},1024)]))),128)),L("div",Ne,[e(A,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:l(()=>[e(F,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:d[0]||(d[0]=v=>a.$emit("cancel"))}),e(F,{label:"Guardar",type:"submit",icon:"fas fa-floppy-disk",color:"primary",loading:n(w),"no-caps":""},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))}}),Re=O({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0}},emits:["submit","cancel"],setup(r){const _=N({limit:0}),{data:s}=$e(_),c=T(()=>s.value?s.value.map(p=>({label:p.nombre,value:Number(p.id)})):[]),C=r,i=N([]),m=N(),o=N();return z(()=>s.value,p=>{if(p){i.value=C.orden.pivot.map(b=>{let t=[];const q=p.find(y=>Number(y.id)==b.examen_id);return t=[{label:"Examen",name:"examen_id",type:"select",options:c.value},{label:"Resultado",name:"resultado",type:"string"},{label:"Unidad",name:"unidad_id",type:"select",options:q?q.unidads.data.map(y=>({label:y.nombre,value:Number(y.id)})):[]},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Acciones",name:"actions",type:"array"}],t});const g=Q().of(re(()=>{let b={};return b={examen_id:me().required().label("Examen"),resultado:S().positive().when("is_canceled",{is:!1,then:t=>t.nullable(),otherwise:t=>t.nullable()}).transform((t,q)=>q===""?void 0:t).typeError("Debe ingresar un numero").label("Resultado"),fecha_resultado:$().required().label("Fecha"),unidad_id:S().when("is_canceled",{is:!1,then:t=>t.nullable(),otherwise:t=>t.nullable()}).label("Unidad"),is_canceled:fe().required().label("Cancelado?"),motivo:$().when("is_canceled",{is:!0,then:t=>t.required(),otherwise:t=>t.nullable()}).label("Motivo"),minimo:S(),maximo:S(),unidads:Q()},I().shape(b)}));m.value=I().shape({pivot:g});const w=C.orden.pivot.map(b=>{var q;const t=p.find(y=>Number(y.id)==b.examen_id);return{examen_id:b.examen_id,resultado:b.resultado,fecha_resultado:(q=b.fecha_resultado)!=null?q:ce.now().toISODate(),unidad_id:b.unidad_id,is_canceled:b.is_canceled,motivo:b.motivo,unidads:t?t.unidads.data.map(y=>({label:y.nombre,value:Number(y.id)})):[]}});o.value={pivot:w}}},{immediate:!0}),(p,g)=>(f(),h(ue,{class:"my-card"},{default:l(()=>[e(de,null,{default:l(()=>[i.value.length>0&&m.value&&n(s)?(f(),h(Oe,{key:0,fields:i.value,"validation-schema":m.value,"initial-values":o.value,"orden-id":Number(r.orden.id),examens:n(s),onCancel:g[0]||(g[0]=w=>p.$emit("cancel")),onSubmit:g[1]||(g[1]=w=>p.$emit("submit"))},null,8,["fields","validation-schema","initial-values","orden-id","examens"])):E("",!0)]),_:1})]),_:1}))}}),Ae=O({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},emits:["cancel"],setup(r){const _=r,{data:s}=we(),c=T(()=>s.value?s.value.map(i=>({label:i.nombre,value:Number(i.id)})):[]),C=I().shape({diagnostico:$().trim().min(2).required().label("Diagnostico"),CI10:$().trim().min(2).required().label("CI10"),CPN:$().trim().min(2).required().label("CPN"),EG:$().trim().min(2).required().label("EG"),codigo_atencion:$().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:$().trim().required().label("Fecha de Registro"),medico:$().trim().required().label("M\xE9dico"),examen_ids:Q().of(S().required()).required().label("Examenes"),paquete_ids:Q().of(S().required()).required().label("Paquetes"),establecimiento_id:S().label("Establecimiento Institucional"),establecimiento_otro:$().label("Otro Establecimiento")});return U({validationSchema:C,initialValues:_.orden}),(i,m)=>(f(),h(pe,null,{actions:l(()=>[e(A,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:l(()=>[e(F,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:m[0]||(m[0]=o=>i.$emit("cancel"))})]),_:1})]),default:l(()=>[e(x,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1}),r.orden.establecimiento_id?(f(),h(D,{key:0,options:c.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:"",readonly:"",borderless:"",outlined:!1},null,8,["options"])):(f(),h(x,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1})),e(x,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(x,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(x,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(x,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(x,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(x,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1})]),_:1}))}}),De=O({__name:"OrdenTable",props:{ordens:{type:Array,required:!0}},setup(r){const{formatDate:_}=ge(),s=[{name:"fecha_registro",align:"left",label:"Fecha Registro",field:"fecha_registro",format:c=>_(c)},{name:"medico",align:"center",label:"Medico",field:"medico"},{name:"codigo_atencion",align:"center",label:"Codigo Atenci\xF3n",field:"codigo_atencion"},{name:"estado",align:"center",label:"Estado",field:"estado"},{name:"actions",align:"right",label:"Acciones",field:"actions"}];return(c,C)=>(f(),h(n(ve),{rows:r.ordens,columns:s,"row-key":"id"},{"body-cell-estado":l(i=>[e(H,{props:i},{default:l(()=>[e(be,{color:i.row.estado_detalle.color,label:i.row.estado_detalle.label},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-actions":l(i=>[e(H,{props:i,class:"text-right"},{default:l(()=>[e(A,{align:"right",class:"q-pa-none q-ma-none"},{default:l(()=>[_e(c.$slots,"actions",{id:Number(i.key),estado:i.row.estado})]),_:2},1024)]),_:2},1032,["props"])]),_:3},8,["rows"]))}}),Qe={key:0,class:"col-12 row justify-center"},Ie={class:"col-auto"},Pe=L("div",{class:"col-12 text-center text-h6"}," Lo sentimos. \xA1No se encontr\xF3 ninguna orden!. Porfavor registre uno para empezar. ",-1),Te={key:1},Le=O({__name:"DatosOrdenTab",props:{paciente:{type:Object,required:!0}},setup(r){const _=r,{ordenSeleccionada:s,isOrdenLoading:c}=K(P()),{fetchOrdenById:C}=P(),i=N({search:`paciente_id:${_.paciente.id};estado:0,1`,searchJoin:"and",limit:0}),{data:m,refetch:o}=ke(i),p=N("list"),g=N(),w=async a=>{g.value=a,await C(a),s.value&&(p.value="view")},{mutateAsync:b,isLoading:t}=Se(),q=async(a,d)=>{g.value=a,await b({id:a,data:{estado:d}},{onSuccess:()=>{W.success("La orden se REGISTRO correctamente."),o.value(),p.value="list"},onError:v=>{console.log(v)}})},y=()=>{s.value=void 0};return z(()=>s.value,a=>{a||(p.value="list")}),(a,d)=>r.paciente?(f(),h(he,{key:0,modelValue:p.value,"onUpdate:modelValue":d[0]||(d[0]=v=>p.value=v),animated:""},{default:l(()=>[e(V,{name:"list"},{default:l(()=>[n(m)&&n(m).data.length===0?(f(),R("div",Qe,[L("div",Ie,[e(ye,{name:"fas fa-face-frown",size:"xl"})]),Pe,e(F,{class:"q-mt-lg",color:"primary",icon:"fas fa-plus","no-caps":"",label:"Registrar nueva orden",outline:"",to:"/laboratorio/registrar-orden"})])):n(m)?(f(),R("div",Te,[e(De,{ordens:n(m).data},{actions:l(({id:v,estado:u})=>[e(F,{color:"primary",icon:"fas fa-file-signature",round:"",flat:"",size:"sm",loading:n(c)&&g.value===v,onClick:k=>w(v)},{default:l(()=>[e(M,null,{default:l(()=>[B("Registrar resultados.")]),_:1})]),_:2},1032,["loading","onClick"]),u===0?(f(),h(F,{key:0,color:"positive",icon:"fas fa-check-double",round:"",flat:"",size:"sm",loading:n(t)&&g.value===v,onClick:k=>q(v,1)},{default:l(()=>[e(M,null,{default:l(()=>[B("Confirmar registro.")]),_:1})]),_:2},1032,["loading","onClick"])):E("",!0)]),_:1},8,["ordens"])])):E("",!0)]),_:1}),e(V,{name:"new"},{default:l(()=>[e(Ee,{"paciente-id":Number(r.paciente.id)},null,8,["paciente-id"])]),_:1}),e(V,{name:"view"},{default:l(()=>[n(s)?(f(),h(Ae,{key:0,orden:n(s),onCancel:y},null,8,["orden"])):E("",!0)]),_:1})]),_:1},8,["modelValue"])):E("",!0)}}),Ve={class:"row q-col-gutter-md"},je={class:"col-12"},Ye=O({__name:"RegistrarResultadosPage",setup(r){const{fetchPaciente:_,$reset:s}=P(),{paciente:c,isPacienteLoading:C,ordenSeleccionada:i}=K(P()),{data:m}=qe(),o=T(()=>m.value?m.value.map(t=>({label:t.nombre,value:t.id})):[]),p=I().shape({numero_documento:S().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:$().required().label("Tipo de Documento")}),{handleSubmit:g}=U({validationSchema:p}),w=g(async t=>{s(),await _(t.numero_documento),c.value?J.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}):J.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})}),b=()=>{i.value=void 0};return Ce(()=>{if(window.confirm("Esta seguro de salir? Tiene cambios sin guardar!"))s();else return!1}),(t,q)=>(f(),R("div",Ve,[e(Z,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:n(w)},{default:l(()=>[e(D,{options:o.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),e(x,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),e(A,{class:"col-auto justify-center"},{default:l(()=>[e(F,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:n(C)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),L("div",je,[e(j,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear",class:"bg-purple-2"},{default:l(()=>[e(xe,{class:"bg-purple-1",paciente:n(c),onCancel:n(s),onSubmit:q[0]||(q[0]=y=>n(_)(y))},null,8,["paciente","onCancel"])]),_:1}),n(c)?(f(),h(j,{key:0,icon:"fas fa-vials",label:"Datos de la Orden de Lab.",caption:"Editar / Crear"},{default:l(()=>[e(Le,{paciente:n(c),onCancel:n(s)},null,8,["paciente","onCancel"])]),_:1})):E("",!0),n(i)?(f(),h(j,{key:1,icon:"fas fa-file-signature",label:"Registrar resultados.",caption:"Editar / Crear"},{default:l(()=>[e(Re,{orden:n(i),onCancel:b,onSubmit:b},null,8,["orden"])]),_:1})):E("",!0)])]))}});export{Ye as default};
