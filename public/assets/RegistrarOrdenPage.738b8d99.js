import{W as Y,Y as G,r as I,k,$ as L,a0 as r,b0 as P,aU as g,a1 as R,ag as K,H as Z,o as _,e as v,w as t,a5 as a,ad as l,aW as M,aX as D,f as Q,ac as A,aj as N,aS as ee,a2 as i,au as U,aa as ae,b1 as te,aT as oe,aG as O,b2 as ie,ak as se,ab as ne,bc as re,bd as le,b3 as B,a6 as ce,ae as ue}from"./index.d6593c0d.js";import{u as me}from"./establecimientoFetchAllQuery.48b0f705.js";import{u as de,_ as be}from"./ExamenCardList.51cdd6f1.js";import{O as pe}from"./OrdenApi.583ffc6a.js";import{u as _e}from"./paqueteFetchAllQuery.7b666994.js";import{_ as fe}from"./BaseCheckBoxGroup.ee0eec32.js";import{u as T}from"./laboratorio.store.4fa33e35.js";import"./PaqueteApi.8eb6661c.js";function qe(){return Y(h=>pe.create(h))}const xe={class:"col-12"},ge={class:"col-12"},ve={class:"col-12 row q-col-gutter-sm"},he=G({__name:"OrdenCreateForm",props:{pacienteId:{type:Number,required:!0}},emits:["submit"],setup(h,{emit:C}){const y=h,d=C,S=I({limit:0,search:"is_active:1",searchJoin:"and"}),{data:u}=de(S),{data:b}=_e(),$=k(()=>b.value?b.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:E}=me(),F=k(()=>E.value?E.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),c=L().shape({diagnostico:r().trim().min(2).required().label("Diagnostico"),CI10:r().trim().min(2).required().label("CI10"),CPN:r().trim().min(2).required().label("CPN"),EG:r().trim().min(2).required().label("EG"),codigo_atencion:r().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:r().trim().required().label("Fecha de Registro"),medico:r().trim().required().label("M\xE9dico"),examen_ids:P().of(g().required()).required().label("Examenes"),item_ids:P().of(g().required()).required().label("Items"),paquete_ids:P().of(g().required()).required().label("Paquetes"),establecimiento_id:g().when([],{is:()=>f.value,then:e=>e.required(),otherwise:e=>e.optional()}).label("Establecimiento Institucional"),establecimiento_otro:r().when([],{is:()=>!f.value,then:e=>e.required(),otherwise:e=>e.optional()}).label("Otro Establecimiento")}),{values:m,setFieldValue:p,handleSubmit:V}=R({validationSchema:c,initialValues:{examen_ids:[],paquete_ids:[],paciente_id:y.pacienteId}}),f=I(!0),{mutateAsync:j,reset:W,isLoading:z}=qe(),H=V(async(e,{setErrors:o,resetForm:s})=>{await j(e,{onSuccess:()=>{K.success("Orden registrada correctamente."),s(),d("submit")},onError:n=>{W.value(),o(n.data.errors)}})});Z(()=>m.examen_ids,e=>{var o;if(e){const s=(o=b.value)==null?void 0:o.filter(q=>q.examen_ids.every(x=>e.includes(x)));p("paquete_ids",(s==null?void 0:s.map(q=>Number(q.id)))||[]);let n=[];u.value&&(n=[],e.forEach(q=>{const x=u.value.find(w=>Number(w.id)===q);if(x&&x.items.data.length>0){const w=x.items.data.map(X=>Number(X.id));n.push(...w)}}),p("item_ids",[...new Set(n)]),console.log(m.item_ids))}});const J=e=>{var o;if(e){const s=(o=b.value)==null?void 0:o.filter(n=>e.includes(Number(n.id))).map(n=>n.examen_ids).flat();p("examen_ids",[...new Set(s)])}};return(e,o)=>(_(),v(ae,{loading:i(z),onSubmit:i(H)},{default:t(()=>[a(l,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:""}),f.value?(_(),v(M,{key:0,options:F.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:""},{after:t(()=>[a(A,{round:"",flat:"",icon:"fas fa-building-circle-arrow-right",color:"primary",onClick:o[0]||(o[0]=s=>f.value=!1)},{default:t(()=>[a(D,null,{default:t(()=>[Q(" Otro establecimiento ")]),_:1})]),_:1})]),_:1},8,["options"])):(_(),v(l,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:""},{after:t(()=>[a(A,{round:"",flat:"",icon:"fas fa-building-circle-xmark",color:"negative",onClick:o[1]||(o[1]=s=>f.value=!0)},{default:t(()=>[a(D,null,{default:t(()=>[Q(" Establecimiento institucional")]),_:1})]),_:1})]),_:1})),a(l,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:""}),a(l,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:""}),a(l,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:""}),a(l,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:""}),a(l,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:""}),a(l,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:""}),N("div",xe,[a(ee,{spaced:""}),Q(" Paquetes")]),N("div",ge,[a(fe,{name:"paquete_ids",label:"Paquetes",options:$.value,onUpdate:J},null,8,["options"])]),N("div",ve,[i(u)?(_(),v(be,{key:0,examens:i(u)},null,8,["examens"])):U("",!0)])]),_:1},8,["loading","onSubmit"]))}}),Ce={class:"row q-col-gutter-md"},ye={class:"col-12"},ke=G({__name:"RegistrarOrdenPage",setup(h){const{fetchPaciente:C,$reset:y}=T(),{paciente:d,isPacienteLoading:S}=te(T()),{data:u}=oe(),b=k(()=>u.value?u.value.map(c=>({label:c.nombre,value:c.id})):[]),$=L().shape({numero_documento:g().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:r().required().label("Tipo de Documento")}),{handleSubmit:E}=R({validationSchema:$}),F=E(async c=>{await C(c.numero_documento),d.value?O.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}):O.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})});return ie(()=>{y()}),(c,m)=>(_(),se("div",Ce,[a(re,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:i(F)},{default:t(()=>[a(M,{options:b.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),a(l,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),a(ne,{class:"col-auto justify-center"},{default:t(()=>[a(A,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:i(S)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),N("div",ye,[a(B,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear",class:"bg-purple-2"},{default:t(()=>[a(le,{class:"bg-purple-1",paciente:i(d),onCancel:i(y),onSubmit:m[0]||(m[0]=p=>i(C)(p))},null,8,["paciente","onCancel"])]),_:1}),i(d)?(_(),v(B,{key:0,icon:"fas fa-vials",label:"Datos de la Orden de Lab.",caption:"Editar / Crear"},{default:t(()=>[a(ue,null,{default:t(()=>[a(ce,null,{default:t(()=>[a(he,{"paciente-id":Number(i(d).id),onSubmit:m[1]||(m[1]=p=>c.$router.push({name:"laboratorio.registrar"}))},null,8,["paciente-id"])]),_:1})]),_:1})]),_:1})):U("",!0)])]))}});export{ke as default};
