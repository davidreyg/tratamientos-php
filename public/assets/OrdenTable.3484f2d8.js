import{Y as w,o as y,e as $,w as p,a5 as s,ad as v,b3 as L,aj as C,aE as K,aF as X,W as Y,b4 as Z,b5 as ee,f as A,at as B,a2 as d,b6 as ae,a3 as oe,b7 as le,av as M,b8 as te,k as G,a1 as ie,ag as se,H as O,ak as D,aK as ne,aW as Q,au as x,aX as V,ac as R,ab as P,a$ as re,b9 as de,r as S,ba as j,bb as ce,$ as U,a_ as ue,bc as me,aU as N,a0 as I,bd as T,be,aM as ve,aI as pe}from"./index.8455c660.js";import{O as H}from"./laboratorio.store.67274c5f.js";import{_ as fe}from"./BaseTable.bb893000.js";const _e=C("div",{class:"col-12 text-bold text-italic"},"Datos Generales:",-1),ge=C("div",{class:"col-12 text-bold text-italic"}," Datos del Establecimiento de Origen: ",-1),he=C("div",{class:"col-12 text-bold text-italic"},"Datos del Medico:",-1),ye=C("div",{class:"col-12 text-bold text-italic"},"Datos del paciente:",-1),Fe=w({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},setup(a){return(g,u)=>(y(),$(L,{class:"row"},{default:p(()=>[_e,s(v,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.diagnostico},null,8,["value"]),s(v,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.CI10},null,8,["value"]),s(v,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.CPN},null,8,["value"]),s(v,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.EG},null,8,["value"]),s(v,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.codigo_atencion},null,8,["value"]),s(v,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.fecha_registro},null,8,["value"]),ge,s(v,{name:"establecimiento_tipo",class:"col-xs-12 col-sm-4",label:"Tipo de Establecimiento",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.establecimiento?"Jurisdiccion":"Externo"},null,8,["value"]),s(v,{name:"establecimiento_id",class:"col-xs-12 col-sm-8",label:"Establecimiento Origen",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.establecimiento?a.orden.establecimiento.data.nombre:a.orden.establecimiento_otro},null,8,["value"]),he,s(v,{name:"medico",label:"Nombre",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.medico},null,8,["value"]),ye,s(v,{name:"paciente",label:"Nombre",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.paciente.data.nombre_completo},null,8,["value"]),s(v,{name:"documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:a.orden.paciente.data.numero_documento},null,8,["value"])]),_:1}))}});function Oe(a){const g=async()=>(await H.fetchAll(a.value)).data(),{data:u,isLoading:t,isSuccess:_,isError:c,isFetching:m,refetch:e}=K([X.ORDEN_ALL,a==null?void 0:a.value],g,{keepPreviousData:!0});return{data:u,isLoading:t,isSuccess:_,isError:c,isFetching:m,refetch:e}}function qe(){return Y(({id:a,data:g})=>H.updateExamens(a,g))}const $e=w({__name:"BaseCheckBox",props:{name:{type:String,required:!0},label:{type:String,required:!0}},setup(a){const u=Z(a,"name"),{value:t,handleChange:_,errorMessage:c}=ee(u);return(m,e)=>(y(),$(te,{color:"black",borderless:"",error:!!d(c),"bottom-slots":"","hide-bottom-space":!d(c)},{error:p(()=>[A(B(d(c)),1)]),default:p(()=>[s(le,ae(m.$attrs,{modelValue:d(t),"onUpdate:modelValue":[e[0]||(e[0]=n=>oe(t)?t.value=n:null),e[1]||(e[1]=n=>d(_)(n))],label:a.label}),null,16,["modelValue","label"]),M(m.$slots,"default")]),_:3},8,["error","hide-bottom-space"]))}}),xe={key:0,class:"row q-mt-md"},we={class:"row"},Ce=w({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},examens:{type:Array,required:!0},ordenId:{type:Number,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!0}},emits:["submit","cancel"],setup(a,{emit:g}){const u=g,t=a,_=G(()=>t.examens?t.examens.map(r=>({label:r.nombre,value:Number(r.id)})):[]),{handleSubmit:c,setFieldValue:m,values:e}=ie({validationSchema:t.validationSchema,initialValues:t.initialValues}),{mutateAsync:n,reset:o,isLoading:b}=qe(),h=c(async(r,{setErrors:i})=>{await n({id:t.ordenId,data:r},{onSuccess:()=>{se.success("Resultados actualizados correctamente"),u("submit"),o.value()},onError:f=>{o.value(),i(f.data.errors)}})},r=>console.log(r)),z=r=>{let i;return!!e.pivot[r].minimo&&!!e.pivot[r].minimo&&(i=`Min: ${e.pivot[r].minimo} - Max: ${e.pivot[r].maximo}`),i},W=r=>{let i;return!!e.pivot[r].minimo&&!!e.pivot[r].minimo&&(e.pivot[r].resultado>e.pivot[r].minimo&&e.pivot[r].resultado<e.pivot[r].maximo?i="green-2":i="red-2"),i},J=r=>{const i="pivot["+r+"].is_canceled",f=e.pivot[r].is_canceled;m(i,!f)};return t.fields.forEach((r,i)=>{O(()=>e.pivot[i].unidad_id,f=>{if(f){const l=t.examens.find(q=>q.id==e.pivot[i].examen_id);if(!!l&&!!f){const q=l.pivot.find(F=>F.unidad_id===f),k="pivot["+i+"].minimo",E="pivot["+i+"].maximo";q&&(m(k,q.minimo),m(E,q.maximo))}}},{deep:!0,immediate:!0}),O(()=>e.pivot[i].is_canceled,f=>{const l="pivot["+i+"].minimo",q="pivot["+i+"].maximo";f&&(m(l,void 0),m(q,void 0))},{deep:!0,immediate:!0}),O(()=>e.pivot[i].is_enabled,f=>{const l="pivot["+i+"].minimo",q="pivot["+i+"].maximo",k="pivot["+i+"].resultado",E="pivot["+i+"].unidad_id",F="pivot["+i+"].motivo";f||(m(l,void 0),m(q,void 0),m(k,null),m(E,null),m(F,null))},{deep:!0,immediate:!0})}),(r,i)=>(y(),$(L,{onSubmit:de(d(h),["prevent"])},{default:p(()=>[(y(!0),D(re,null,ne(a.fields,(f,l)=>(y(),D("div",{key:l,class:"row q-col-gutter-sm q-mb-sm"},[s(Q,{label:"Examen",name:`pivot[${l}].examen_id`,options:_.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),d(e).pivot[l].is_canceled?(y(),$(v,{key:0,name:`pivot[${l}].motivo`,label:"Motivo",class:"col-4",required:"",disable:!d(e).pivot[l].is_enabled},null,8,["name","disable"])):x("",!0),d(e).pivot[l].is_canceled?x("",!0):(y(),$(v,{key:1,name:`pivot[${l}].resultado`,"bg-color":W(l),label:"Resultado",class:"col-2",required:"",disable:!d(e).pivot[l].is_enabled},null,8,["name","bg-color","disable"])),d(e).pivot[l].is_canceled?x("",!0):(y(),$(Q,{key:2,label:"Unidad",name:`pivot[${l}].unidad_id`,options:d(e).pivot[l].unidads,hint:z(l),class:"col-2",required:"",disable:!d(e).pivot[l].is_enabled},null,8,["name","options","hint","disable"])),s(v,{label:"Fecha",type:"date",name:`pivot[${l}].fecha_resultado`,required:"",class:"col-2",disable:!d(e).pivot[l].is_enabled},null,8,["name","disable"]),s(P,{class:"col-2 self-center justify-center"},{default:p(()=>[s($e,{name:`pivot[${l}].is_enabled`,label:"",dense:""},{default:p(()=>[s(V,null,{default:p(()=>[A(B(d(e).pivot[l].is_enabled?"Deshabilitar.":"Habilitar."),1)]),_:2},1024)]),_:2},1032,["name"]),s(R,{icon:d(e).pivot[l].is_canceled?"fas fa-pen":"fas fa-ban",color:d(e).pivot[l].is_canceled?"warning":"negative",disable:!d(e).pivot[l].is_enabled,round:"",flat:"",size:"sm",onClick:q=>J(l)},{default:p(()=>[s(V,null,{default:p(()=>[A(B(d(e).pivot[l].is_canceled?"Registrar datos.":"Cancelar examen."),1)]),_:2},1024)]),_:2},1032,["icon","color","disable","onClick"])]),_:2},1024)]))),128)),a.withObservaciones?(y(),D("div",xe,[s(v,{label:"Observaciones",type:"textarea",name:"observaciones",class:"col-12"})])):x("",!0),C("div",we,[s(P,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:p(()=>[s(R,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:i[0]||(i[0]=f=>r.$emit("cancel"))}),s(R,{label:"Guardar",type:"submit",icon:"fas fa-floppy-disk",color:"primary",loading:d(b),"no-caps":""},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))}}),De=w({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!1,default:!1}},emits:["submit","cancel"],setup(a){const g=G(()=>u.orden.examens.data?u.orden.examens.data.map(n=>({label:n.nombre,value:Number(n.id)})):[]),u=a,t=S([]),_=S(),c=S();t.value=u.orden.pivot.map(n=>{let o=[];const b=u.orden.examens.data.find(h=>Number(h.id)==n.examen_id);return o=[{label:"Examen",name:"examen_id",type:"select",options:g.value},{label:"Resultado",name:"resultado",type:"string"},{label:"Unidad",name:"unidad_id",type:"select",options:b?b.unidads.data.map(h=>({label:h.nombre,value:Number(h.id)})):[]},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Acciones",name:"actions",type:"array"}],o});const m=j().of(ce(()=>{let n={};return n={examen_id:me().required().label("Examen"),resultado:N().positive().when(["is_enabled","is_canceled"],{is:(o,b)=>o&&!b,then:o=>o.required(),otherwise:o=>o.nullable()}).transform((o,b)=>b===""?void 0:o).typeError("Debe ingresar un numero").label("Resultado"),fecha_resultado:I().required().label("Fecha"),unidad_id:N().when(["is_enabled","is_canceled"],{is:(o,b)=>o&&!b,then:o=>o.required(),otherwise:o=>o.nullable()}).label("Unidad"),is_canceled:T().required().label("Cancelado?"),is_enabled:T().required().label("Hablitad?"),motivo:I().when(["is_enabled","is_canceled"],{is:!0,then:o=>o.required(),otherwise:o=>o.nullable()}).label("Motivo"),minimo:N(),maximo:N(),unidads:j()},U().shape(n)}));_.value=U().shape({pivot:m});const e=u.orden.pivot.map(n=>{var b;const o=u.orden.examens.data.find(h=>Number(h.id)==n.examen_id);return{examen_id:n.examen_id,resultado:n.resultado,fecha_resultado:(b=n.fecha_resultado)!=null?b:ue.now().toISODate(),unidad_id:n.unidad_id,is_canceled:n.is_canceled,is_enabled:!0,motivo:n.motivo,unidads:o?o.unidads.data.map(h=>({label:h.nombre,value:Number(h.id)})):[]}});return c.value={pivot:e,observaciones:u.orden.observaciones},(n,o)=>t.value.length>0&&_.value?(y(),$(Ce,{key:0,fields:t.value,"validation-schema":_.value,"initial-values":c.value,"orden-id":Number(a.orden.id),examens:u.orden.examens.data,"with-observaciones":a.withObservaciones,onCancel:o[0]||(o[0]=b=>n.$emit("cancel")),onSubmit:o[1]||(o[1]=b=>n.$emit("submit"))},null,8,["fields","validation-schema","initial-values","orden-id","examens","with-observaciones"])):x("",!0)}}),Re=w({__name:"OrdenTable",props:{ordens:{type:Array,required:!0},loading:{type:Boolean,required:!1,default:!1},serverPagination:{type:Object,default:void 0}},emits:["request"],setup(a){const{formatDate:g}=pe(),u=[{name:"index",label:"#",field:"index"},{name:"fecha_registro",align:"left",label:"Fecha Registro",field:"fecha_registro",format:t=>g(t)},{name:"medico",align:"center",label:"Medico",field:"medico"},{name:"diagnostico",align:"center",label:"Diagnostico",field:"diagnostico"},{name:"nombre_completo",align:"center",label:"Paciente",field:t=>t.paciente.data.nombre_completo},{name:"documento",align:"center",label:"N\xB0 Documento",field:t=>t.paciente.data.numero_documento},{name:"codigo_atencion",align:"center",label:"Codigo Atenci\xF3n",field:"codigo_atencion"},{name:"estado",align:"center",label:"Estado",field:"estado",sortable:!0},{name:"actions",align:"right",label:"Acciones",field:"actions"}];return(t,_)=>(y(),$(fe,{data:a.ordens,columns:u,loading:a.loading,"row-key":"id","server-pagination":a.serverPagination,onRequest:_[0]||(_[0]=c=>t.$emit("request",c))},{top:p(()=>[M(t.$slots,"top")]),"body-cell-estado":p(({props:c})=>[s(ve,{props:c},{default:p(()=>[s(be,{color:c.row.estado_detalle.color,label:c.row.estado_detalle.label},null,8,["color","label"])]),_:2},1032,["props"])]),customActions:p(({props:c})=>[M(t.$slots,"custom-actions",{props:c})]),_:3},8,["data","loading","server-pagination"]))}});export{Re as _,Fe as a,De as b,Oe as u};
