import{aE as x,aF as F,W as Q,Y as S,$ as R,a0 as d,b4 as B,a1 as V,k as $,o as b,e as f,w as U,a5 as o,ad as _,aU as w,aj as L,aP as j,f as A,a2 as r,aa as M,ay as O,ak as P,ae as T,au as v,ag as z}from"./index.4de37196.js";import{_ as I}from"./SkeletonForm.c0047c05.js";import{u as W}from"./establecimientoFetchAllQuery.5a0b8b02.js";import{u as Y}from"./roleListQuery.7bb7fbb9.js";import{U as h}from"./UserApi.5f5d0dc4.js";import{_ as D}from"./BaseCheckBoxGroup.0eabbe9b.js";import"./RoleApi.ed30d6ee.js";function G(a,s){const n=async()=>(await h.fetchOne(a)).data().data,{data:i,isLoading:c,isSuccess:l,isError:u,isFetching:m,refetch:t}=x([F.USERS,a],n,{enabled:s});return{data:i,isLoading:c,isSuccess:l,isError:u,isFetching:m,refetch:t}}function H(){return Q(({data:a,id:s})=>h.update(a,s))}const J={class:"col-12"},K=S({__name:"UserEditForm",props:{user:{type:Object,required:!0}},emits:["submit","cancel"],setup(a,{emit:s}){const n=a,i=s,c=R().shape({name:d().trim().min(2).required().label("Usuario"),nombre_completo:d().trim().min(2).required().label("Nombre Completo"),cargo:d().trim().min(2).required().label("Cargo"),establecimiento_id:d().required().label("Establecimiento"),role_ids:B().of(d().required()).required().label("Roles")}),{handleSubmit:l,setErrors:u,resetForm:m}=V({validationSchema:c,initialValues:n.user}),{data:t}=W(),g=$(()=>t.value?t.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{roles:y}=Y(),q=$(()=>y.value?y.value.map(e=>({label:e.display_name,value:Number(e.id)})):[]),{isLoading:E,mutate:N,reset:C}=H(),k=l(async e=>{N({data:e,id:Number(n.user.id)},{onSuccess:()=>{i("submit")},onError:p=>{m(),C.value(),u(p.data.errors)}})},e=>{console.log(e)});return(e,p)=>(b(),f(M,{loading:r(E),onSubmit:r(k),onCancel:p[0]||(p[0]=Z=>e.$emit("cancel"))},{default:U(()=>[o(_,{name:"nombre_completo",label:"Nombre Completo",class:"col-12"}),o(_,{name:"name",label:"Usuario",class:"col-xs-12 col-sm-6"}),o(w,{options:g.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento",loading:!1,required:""},null,8,["options"]),o(_,{name:"cargo",label:"Cargo",class:"col-xs-12 col-sm-6"}),L("div",J,[o(j,{spaced:""}),A(" Roles: ")]),o(D,{name:"role_ids",label:"Roles",options:q.value},null,8,["options"])]),_:1},8,["loading","onSubmit"]))}}),X={class:"row"},ie=S({__name:"UserEditPage",props:{id:{type:Number,required:!0}},setup(a){const s=a,n=O(),{data:i,isSuccess:c,isFetching:l}=G(s.id,!0),u=()=>{z.success("Registro actualizado correctamente"),n.back()};return(m,t)=>(b(),P("div",X,[r(l)?(b(),f(T,{key:0,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg"},{default:U(()=>[o(I,{class:"col-12",inputs:2})]),_:1})):v("",!0),r(c)&&!r(l)&&r(i)?(b(),f(K,{key:1,class:"col-sm-8 col-xs-12 col-md-6 q-pa-lg",user:r(i),onSubmit:u,onCancel:t[0]||(t[0]=g=>m.$router.back())},null,8,["user"])):v("",!0)]))}});export{ie as default};
