import{Y as k,o as g,e as x,w as v,a5 as i,ad as f,b3 as ae,aj as N,aE as se,aF as ne,W as re,b4 as de,b5 as ce,f as j,at as T,a2 as d,b6 as me,a3 as ue,b7 as be,av as L,b8 as ve,k as G,a1 as _e,ag as pe,H as B,ak as I,aK as H,a7 as z,a8 as W,aW as O,au as D,ab as J,aX as K,ac as M,x as fe,b9 as he,aQ as X,a$ as Y,ba as ge,r as V,bb as F,bc as Z,$ as P,a_ as ye,bd as U,aU as w,a0 as ee,be as C,bf as qe,aM as xe,aI as $e}from"./index.56bc56d2.js";import{O as te}from"./laboratorio.store.6c89e3bf.js";import{_ as we}from"./BaseTable.fed7cd80.js";const Ee=N("div",{class:"col-12 text-bold text-italic"},"Datos Generales:",-1),Ne=N("div",{class:"col-12 text-bold text-italic"}," Datos del Establecimiento de Origen: ",-1),Ce=N("div",{class:"col-12 text-bold text-italic"},"Datos del Medico:",-1),De=N("div",{class:"col-12 text-bold text-italic"},"Datos del paciente:",-1),Pe=k({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},setup(l){return(q,u)=>(g(),x(ae,{class:"row"},{default:v(()=>[Ee,i(f,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.diagnostico},null,8,["value"]),i(f,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.CI10},null,8,["value"]),i(f,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.CPN},null,8,["value"]),i(f,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.EG},null,8,["value"]),i(f,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.codigo_atencion},null,8,["value"]),i(f,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.fecha_registro},null,8,["value"]),Ne,i(f,{name:"establecimiento_tipo",class:"col-xs-12 col-sm-4",label:"Tipo de Establecimiento",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.establecimiento?"Jurisdiccion":"Externo"},null,8,["value"]),i(f,{name:"establecimiento_id",class:"col-xs-12 col-sm-8",label:"Establecimiento Origen",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.establecimiento?l.orden.establecimiento.data.nombre:l.orden.establecimiento_otro},null,8,["value"]),Ce,i(f,{name:"medico",label:"Nombre",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.medico},null,8,["value"]),De,i(f,{name:"paciente",label:"Nombre",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.paciente.data.nombre_completo},null,8,["value"]),i(f,{name:"documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:l.orden.paciente.data.numero_documento},null,8,["value"])]),_:1}))}});function Ue(l){const q=async()=>(await te.fetchAll(l.value)).data(),{data:u,isLoading:n,isSuccess:y,isError:_,isFetching:$,refetch:b}=se([ne.ORDEN_ALL,l==null?void 0:l.value],q,{keepPreviousData:!0});return{data:u,isLoading:n,isSuccess:y,isError:_,isFetching:$,refetch:b}}function ke(){return re(({id:l,data:q})=>te.updateExamens(l,q))}const Oe=k({__name:"BaseCheckBox",props:{name:{type:String,required:!0},label:{type:String,required:!0}},setup(l){const u=de(l,"name"),{value:n,handleChange:y,errorMessage:_}=ce(u);return($,b)=>(g(),x(ve,{color:"black",borderless:"",error:!!d(_),"bottom-slots":"","hide-bottom-space":!d(_)},{error:v(()=>[j(T(d(_)),1)]),default:v(()=>[i(be,me($.$attrs,{modelValue:d(n),"onUpdate:modelValue":[b[0]||(b[0]=a=>ue(n)?n.value=a:null),b[1]||(b[1]=a=>d(y)(a))],label:l.label}),null,16,["modelValue","label"]),L($.$slots,"default")]),_:3},8,["error","hide-bottom-space"]))}}),Fe={class:"row q-col-gutter-sm q-mb-sm"},Se={class:"row q-col-gutter-sm q-mb-sm"},Re={key:0,class:"row q-mt-md"},Ae={class:"row"},Qe=k({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},examens:{type:Array,required:!0},items:{type:Array,required:!0},ordenId:{type:Number,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!0}},emits:["submit","cancel"],setup(l,{emit:q}){const u=q,n=l,y=G(()=>n.examens?n.examens.map(s=>({label:s.nombre,value:Number(s.id)})):[]),_=G(()=>n.items.map(s=>({label:s.nombre,value:Number(s.id)}))),{handleSubmit:$,setFieldValue:b,values:a}=_e({validationSchema:n.validationSchema,initialValues:n.initialValues}),{mutateAsync:S,reset:o,isLoading:e}=ke(),m=$(async(s,{setErrors:r})=>{await S({id:n.ordenId,data:s},{onSuccess:()=>{pe.success("Resultados actualizados correctamente"),u("submit"),o.value()},onError:h=>{o.value(),r(h.data.errors)}})},s=>console.log(s)),c=s=>{let r;return!!a.pivot[s].minimo&&!!a.pivot[s].minimo&&(r=`Min: ${a.pivot[s].minimo} - Max: ${a.pivot[s].maximo}`),r},R=s=>{let r;return!!a.pivot[s].minimo&&!!a.pivot[s].minimo&&(a.pivot[s].resultado>a.pivot[s].minimo&&a.pivot[s].resultado<a.pivot[s].maximo?r="green-2":r="red-2"),r},le=s=>{const r="pivot["+s+"].is_canceled",h=a.pivot[s].is_canceled;a.pivot[s].has_items&&a.pivot[s].items.forEach(p=>{const E="item_orden["+p.pivot_index+"].is_canceled";b(E,!h)}),b(r,!h)};return n.fields.forEach((s,r)=>{B(()=>a.pivot[r].unidad_id,h=>{if(h){const t=n.examens.find(p=>p.id==a.pivot[r].examen_id);if(!!t&&!!h){const p=t.pivot.find(Q=>Q.unidad_id===h),E="pivot["+r+"].minimo",A="pivot["+r+"].maximo";p&&(b(E,p.minimo),b(A,p.maximo))}}},{deep:!0,immediate:!0}),B(()=>a.pivot[r].is_canceled,h=>{const t="pivot["+r+"].minimo",p="pivot["+r+"].maximo";h&&(b(t,void 0),b(p,void 0))},{deep:!0,immediate:!0}),B(()=>a.pivot[r].is_enabled,h=>{const t="pivot["+r+"].minimo",p="pivot["+r+"].maximo",E="pivot["+r+"].resultado",A="pivot["+r+"].unidad_id",Q="pivot["+r+"].motivo";h||(b(t,void 0),b(p,void 0),b(E,null),b(A,null),b(Q,null),a.pivot[r].items.forEach(ie=>{const oe="item_orden["+ie.pivot_index+"].is_enabled";b(oe,h)}))},{deep:!0,immediate:!0})}),(s,r)=>(g(),x(ae,{onSubmit:ge(d(m),["prevent"])},{default:v(()=>[i(X,{bordered:""},{default:v(()=>[(g(!0),I(Y,null,H(l.examens,(h,t)=>(g(),x(z,{key:t},{default:v(()=>[i(W,null,{default:v(()=>[N("div",Fe,[i(O,{label:"Examen",name:`pivot[${t}].examen_id`,options:y.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),d(a).pivot[t].is_canceled?(g(),x(f,{key:0,name:`pivot[${t}].motivo`,label:"Motivo",class:"col-4",required:"",disable:!d(a).pivot[t].is_enabled},null,8,["name","disable"])):D("",!0),!d(a).pivot[t].is_canceled&&!d(a).pivot[t].has_items?(g(),x(f,{key:1,name:`pivot[${t}].resultado`,"bg-color":R(t),label:"Resultado",class:"col-2",required:"",disable:!d(a).pivot[t].is_enabled},null,8,["name","bg-color","disable"])):D("",!0),!d(a).pivot[t].is_canceled&&!d(a).pivot[t].has_items?(g(),x(O,{key:2,label:"Unidad",name:`pivot[${t}].unidad_id`,options:d(a).pivot[t].unidads,hint:c(t),class:"col-2",required:"",disable:!d(a).pivot[t].is_enabled},null,8,["name","options","hint","disable"])):D("",!0),i(f,{label:"Fecha",type:"date",name:`pivot[${t}].fecha_resultado`,required:"",class:"col-2",disable:!d(a).pivot[t].is_enabled},null,8,["name","disable"]),i(J,{class:"col-2 self-center justify-center"},{default:v(()=>[i(Oe,{name:`pivot[${t}].is_enabled`,label:"",dense:""},{default:v(()=>[i(K,null,{default:v(()=>[j(T(d(a).pivot[t].is_enabled?"Deshabilitar.":"Habilitar."),1)]),_:2},1024)]),_:2},1032,["name"]),i(M,{icon:d(a).pivot[t].is_canceled?"fas fa-pen":"fas fa-ban",color:d(a).pivot[t].is_canceled?"warning":"negative",disable:!d(a).pivot[t].is_enabled,round:"",flat:"",size:"sm",onClick:p=>le(t)},{default:v(()=>[i(K,null,{default:v(()=>[j(T(d(a).pivot[t].is_canceled?"Registrar datos.":"Cancelar examen."),1)]),_:2},1024)]),_:2},1032,["icon","color","disable","onClick"])]),_:2},1024)]),fe(i(X,{bordered:""},{default:v(()=>[(g(!0),I(Y,null,H(d(a).pivot[t].items,(p,E)=>(g(),x(z,{key:E},{default:v(()=>[i(W,null,{default:v(()=>[N("div",Se,[i(O,{label:"Item",name:`item_orden[${p.pivot_index}].item_id`,options:_.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),i(f,{name:`item_orden[${p.pivot_index}].resultado`,label:"Resultado",class:"col-2",required:"",disable:!d(a).pivot[t].is_enabled},null,8,["name","disable"]),i(O,{label:"Unidad",name:`item_orden[${p.pivot_index}].unidad_id`,options:d(a).item_orden[p.pivot_index].unidads,class:"col-2",required:"",disable:!d(a).pivot[t].is_enabled},null,8,["name","options","disable"])])]),_:2},1024)]),_:2},1024))),128))]),_:2},1536),[[he,d(a).pivot[t].is_enabled&&!d(a).pivot[t].is_canceled]])]),_:2},1024)]),_:2},1024))),128))]),_:1}),l.withObservaciones?(g(),I("div",Re,[i(f,{label:"Observaciones",type:"textarea",name:"observaciones",class:"col-12"})])):D("",!0),N("div",Ae,[i(J,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:v(()=>[i(M,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:r[0]||(r[0]=h=>s.$emit("cancel"))}),i(M,{label:"Guardar",type:"submit",icon:"fas fa-floppy-disk",color:"primary",loading:d(e),"no-caps":""},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))}}),je=k({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!1,default:!1}},emits:["submit","cancel"],setup(l){const q=G(()=>u.orden.examens.data?u.orden.examens.data.map(o=>({label:o.nombre,value:Number(o.id)})):[]),u=l,n=V([]),y=V(),_=V();n.value=u.orden.pivot.map(o=>{let e=[];const m=u.orden.examens.data.find(c=>Number(c.id)==o.examen_id);return e=[{label:"Examen",name:"examen_id",type:"select",options:q.value},{label:"Resultado",name:"resultado",type:"string"},{label:"Unidad",name:"unidad_id",type:"select",options:m?m.unidads.data.map(c=>({label:c.nombre,value:Number(c.id)})):[]},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Acciones",name:"actions",type:"array"}],e});const $=F().of(Z(()=>{let o={};return o={examen_id:U().required().label("Examen"),resultado:w().positive().when(["is_enabled","is_canceled","has_items"],{is:(e,m,c)=>e&&!m&&!c,then:e=>e.required(),otherwise:e=>e.nullable()}).transform((e,m)=>m===""?void 0:e).typeError("Debe ingresar un numero").label("Resultado"),fecha_resultado:ee().required().label("Fecha"),unidad_id:w().when(["is_enabled","is_canceled","has_items"],{is:(e,m,c)=>e&&!m&&!c,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Unidad"),is_canceled:C().required().label("Cancelado?"),is_enabled:C().required().label("Hablitad?"),has_items:C().required().label("Tiene items?"),motivo:ee().when(["is_enabled","is_canceled"],{is:!0,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Motivo"),minimo:w(),maximo:w(),unidads:F(),items:F()},P().shape(o)})),b=F().of(Z(()=>{let o={};return o={item_id:U().required().label("Item"),examen_id:U().required().label("Examen"),resultado:w().positive().when(["is_enabled","is_canceled"],{is:(e,m)=>e&&!m,then:e=>e.required(),otherwise:e=>e.nullable()}).transform((e,m)=>m===""?void 0:e).typeError("Debe ingresar un numero").label("Resultado"),unidad_id:w().when(["is_enabled","is_canceled"],{is:(e,m)=>e&&!m,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Unidad"),minimo:w(),maximo:w(),is_canceled:C().required().label("Cancelado?"),is_enabled:C().required().label("Habilitado?")},P().shape(o)}));y.value=P().shape({pivot:$,item_orden:b});const a=u.orden.pivot.map(o=>{var m;const e=u.orden.examens.data.find(c=>Number(c.id)==o.examen_id);return{examen_id:o.examen_id,resultado:o.resultado,fecha_resultado:(m=o.fecha_resultado)!=null?m:ye.now().toISODate(),unidad_id:o.unidad_id,is_canceled:o.is_canceled,is_enabled:!0,has_items:e?e.items.data.length>0:!1,motivo:o.motivo,unidads:e?e.unidads.data.map(c=>({label:c.nombre,value:Number(c.id)})):[],items:u.orden.items.data.map((c,R)=>({pivot_index:R,examen_id:c.examen_id})).filter(c=>c.examen_id===Number(e==null?void 0:e.id))}}),S=u.orden.item_orden.map(o=>{const e=u.orden.items.data.find(c=>Number(c.id)==o.item_id),m=u.orden.pivot.find(c=>Number(c.examen_id)==(e==null?void 0:e.examen_id));return{item_id:o.item_id,examen_id:e==null?void 0:e.examen_id,resultado:o.resultado,unidad_id:o.unidad_id,is_canceled:m?m.is_canceled:!1,is_enabled:!0,unidads:e?e.unidads.data.map(c=>({label:c.nombre,value:Number(c.id)})):[]}});return _.value={pivot:a,item_orden:S,observaciones:u.orden.observaciones},(o,e)=>n.value.length>0&&y.value?(g(),x(Qe,{key:0,fields:n.value,"validation-schema":y.value,"initial-values":_.value,"orden-id":Number(l.orden.id),examens:u.orden.examens.data,items:u.orden.items.data,"with-observaciones":l.withObservaciones,onCancel:e[0]||(e[0]=m=>o.$emit("cancel")),onSubmit:e[1]||(e[1]=m=>o.$emit("submit"))},null,8,["fields","validation-schema","initial-values","orden-id","examens","items","with-observaciones"])):D("",!0)}}),Te=k({__name:"OrdenTable",props:{ordens:{type:Array,required:!0},loading:{type:Boolean,required:!1,default:!1},serverPagination:{type:Object,default:void 0}},emits:["request"],setup(l){const{formatDate:q}=$e(),u=[{name:"index",label:"#",field:"index"},{name:"fecha_registro",align:"left",label:"Fecha Registro",field:"fecha_registro",format:n=>q(n)},{name:"medico",align:"center",label:"Medico",field:"medico"},{name:"diagnostico",align:"center",label:"Diagnostico",field:"diagnostico"},{name:"nombre_completo",align:"center",label:"Paciente",field:n=>n.paciente.data.nombre_completo},{name:"documento",align:"center",label:"N\xB0 Documento",field:n=>n.paciente.data.numero_documento},{name:"codigo_atencion",align:"center",label:"Codigo Atenci\xF3n",field:"codigo_atencion"},{name:"estado",align:"center",label:"Estado",field:"estado",sortable:!0},{name:"actions",align:"right",label:"Acciones",field:"actions"}];return(n,y)=>(g(),x(we,{data:l.ordens,columns:u,loading:l.loading,"row-key":"id","server-pagination":l.serverPagination,onRequest:y[0]||(y[0]=_=>n.$emit("request",_))},{top:v(()=>[L(n.$slots,"top")]),"body-cell-estado":v(({props:_})=>[i(xe,{props:_},{default:v(()=>[i(qe,{color:_.row.estado_detalle.color,label:_.row.estado_detalle.label},null,8,["color","label"])]),_:2},1032,["props"])]),customActions:v(({props:_})=>[L(n.$slots,"custom-actions",{props:_})]),_:3},8,["data","loading","server-pagination"]))}});export{Te as _,Pe as a,je as b,Ue as u};
