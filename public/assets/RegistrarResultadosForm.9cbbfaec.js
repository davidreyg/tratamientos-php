import{W as re,Y,o as _,e as f,w as h,a5 as m,ad as v,bg as oe,aj as w,k as z,a1 as ne,ag as de,H as B,ak as D,aK as J,a7 as K,a8 as W,aX as O,a2 as s,au as y,ab as X,aY as Z,f as x,at as H,ac as V,x as me,b9 as ue,aQ as ee,aE as ae,aL as ce,bj as pe,r as G,b6 as S,bk as ie,$ as P,a$ as be,bl as j,aV as k,a0 as q,b0 as A}from"./index.95cf0a1c.js";import{u as _e}from"./operadoresFetchAllQuery.bc8d5d35.js";import{O as ve}from"./OrdenApi.c240bb7b.js";import{_ as fe}from"./BaseCheckBox.b54519b5.js";function he(){return re(({id:p,data:C})=>ve.updateExamens(p,C))}const ye=w("div",{class:"col-12 text-bold text-italic"},"Datos Generales:",-1),qe=w("div",{class:"col-12 text-bold text-italic"}," Datos del Establecimiento de Origen: ",-1),ge=w("div",{class:"col-12 text-bold text-italic"},"Datos del Medico:",-1),ke=w("div",{class:"col-12 text-bold text-italic"},"Datos del paciente:",-1),je=Y({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},setup(p){return(C,F)=>(_(),f(oe,{class:"row"},{default:h(()=>[ye,m(v,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:p.orden.diagnostico},null,8,["value"]),m(v,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:p.orden.CI10},null,8,["value"]),m(v,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:p.orden.CPN},null,8,["value"]),m(v,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:p.orden.EG},null,8,["value"]),m(v,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:p.orden.codigo_atencion},null,8,["value"]),m(v,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1,value:p.orden.fecha_registro},null,8,["value"]),qe,m(v,{name:"establecimiento_tipo",class:"col-xs-12 col-sm-4",label:"Tipo de Establecimiento",required:"",readonly:"",borderless:"",outlined:!1,value:p.orden.establecimiento?"Jurisdiccion":"Externo"},null,8,["value"]),m(v,{name:"establecimiento_id",class:"col-xs-12 col-sm-8",label:"Establecimiento Origen",required:"",readonly:"",borderless:"",outlined:!1,value:p.orden.establecimiento?p.orden.establecimiento.data.nombre:p.orden.establecimiento_otro},null,8,["value"]),ge,m(v,{name:"medico",label:"Nombre",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1,value:p.orden.medico},null,8,["value"]),ke,m(v,{name:"paciente",label:"Nombre",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:p.orden.paciente.data.nombre_completo},null,8,["value"]),m(v,{name:"documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:p.orden.paciente.data.numero_documento},null,8,["value"])]),_:1}))}}),we={class:"row q-col-gutter-sm q-mb-sm"},$e={key:0,class:"col-4 row q-col-gutter-sm"},Ee={key:1,class:"col-4 row q-col-gutter-sm"},Ce={key:2,class:"col-4 row q-col-gutter-sm"},Ne={class:"row q-col-gutter-sm q-mb-sm"},Re={class:"col-auto text-center self-center text-caption"},De={key:0,class:"row q-mt-md"},Oe={class:"row"},Se=Y({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},examens:{type:Array,required:!0},items:{type:Array,required:!0},ordenId:{type:Number,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!0},operadores:{type:Object,required:!0}},emits:["submit","cancel"],setup(p,{emit:C}){const F=C,u=p,I=z(()=>u.examens?u.examens.map(i=>({label:i.nombre,value:Number(i.id)})):[]),M=z(()=>u.items.map(i=>({label:i.nombre,value:Number(i.id)}))),{handleSubmit:Q,setFieldValue:b,values:e}=ne({validationSchema:u.validationSchema,initialValues:u.initialValues}),{mutateAsync:T,reset:U,isLoading:n}=he(),a=Q(async(i,{setErrors:o})=>{await T({id:u.ordenId,data:i},{onSuccess:()=>{de.success("Resultados actualizados correctamente"),F("submit"),U.value()},onError:c=>{U.value(),o(c.data.errors)}})},i=>console.log(i)),r=i=>{let o;switch(e.pivot[i].tipo_unidad,e.pivot[i].tipo_unidad){case"multivalor":!!e.pivot[i].minimo&&!!e.pivot[i].maximo&&(o=`Min: ${e.pivot[i].minimo} - Max: ${e.pivot[i].maximo}`);break;case"operador":!!e.pivot[i].minimo&&!!e.pivot[i].operador_unidad&&(o=`${e.pivot[i].operador_unidad} ${e.pivot[i].minimo}`);break;case"unico":e.pivot[i].minimo;break;default:o=void 0;break}return o},d=i=>{let o;switch(e.pivot[i].tipo_unidad){case"multivalor":!!e.pivot[i].minimo&&!!e.pivot[i].maximo&&(e.pivot[i].resultado>e.pivot[i].minimo&&e.pivot[i].resultado<e.pivot[i].maximo?o="green-2":o="red-2");break;case"operador":if(!!e.pivot[i].minimo&&!!e.pivot[i].operador_unidad)switch(e.pivot[i].operador_unidad){case">":e.pivot[i].resultado>e.pivot[i].minimo?o="green-2":o="red-2";break;case">=":e.pivot[i].resultado>=e.pivot[i].minimo?o="green-2":o="red-2";break;case"<":e.pivot[i].resultado<e.pivot[i].minimo?o="green-2":o="red-2";break;case"<=":e.pivot[i].resultado<=e.pivot[i].minimo?o="green-2":o="red-2";break}break;case"unico":break;default:o=void 0;break}return o},L=i=>{let o;switch(e.item_orden[i].tipo_unidad,e.item_orden[i].tipo_unidad){case"multivalor":!!e.item_orden[i].minimo&&!!e.item_orden[i].maximo&&(o=`Min: ${e.item_orden[i].minimo} - Max: ${e.item_orden[i].maximo}`);break;case"operador":!!e.item_orden[i].minimo&&!!e.item_orden[i].operador_unidad&&(o=`${u.operadores[e.item_orden[i].operador_unidad]} ${e.item_orden[i].minimo}`);break;case"unico":e.item_orden[i].minimo;break;default:o=void 0;break}return o},te=i=>{let o;switch(e.item_orden[i].tipo_unidad){case"multivalor":!!e.item_orden[i].minimo&&!!e.item_orden[i].maximo&&(e.item_orden[i].resultado>e.item_orden[i].minimo&&e.item_orden[i].resultado<e.item_orden[i].maximo?o="green-2":o="red-2");break;case"operador":if(!!e.item_orden[i].minimo&&!!e.item_orden[i].operador_unidad)switch(e.item_orden[i].operador_unidad){case">":e.item_orden[i].resultado>e.item_orden[i].minimo?o="green-2":o="red-2";break;case">=":e.item_orden[i].resultado>=e.item_orden[i].minimo?o="green-2":o="red-2";break;case"<":e.item_orden[i].resultado<e.item_orden[i].minimo?o="green-2":o="red-2";break;case"<=":e.item_orden[i].resultado<=e.item_orden[i].minimo?o="green-2":o="red-2";break}break;case"unico":break;default:o=void 0;break}return o},se=i=>{const o="pivot["+i+"].is_canceled",c=e.pivot[i].is_canceled;e.pivot[i].has_items&&e.pivot[i].items.forEach(l=>{const g="item_orden["+l.pivot_index+"].is_canceled";b(g,!c)}),b(o,!c)};return u.fields.forEach((i,o)=>{B(()=>e.pivot[o].unidad_id,c=>{if(c){const t=u.examens.find(l=>l.id==e.pivot[o].examen_id);if(!!t&&!!c){const l=t.pivot.find(E=>E.unidad_id===c),g="pivot["+o+"].minimo",$="pivot["+o+"].maximo",N="pivot["+o+"].tipo_unidad",R="pivot["+o+"].operador_unidad";l&&(b(g,l.minimo),b($,l.maximo),b(N,l.tipo),b(R,l.operador))}}},{deep:!0,immediate:!0}),B(()=>e.pivot[o].is_canceled,c=>{const t="pivot["+o+"].minimo",l="pivot["+o+"].maximo",g="pivot["+o+"].tipo_unidad",$="pivot["+o+"].operador_unidad";c&&(b(t,void 0),b(l,void 0),b(g,void 0),b($,void 0)),e.pivot[o].items.forEach(R=>{const E="item_orden["+R.pivot_index+"].is_canceled";b(E,c)})},{deep:!0,immediate:!0}),B(()=>e.pivot[o].is_enabled,c=>{const t="pivot["+o+"].minimo",l="pivot["+o+"].maximo",g="pivot["+o+"].resultado",$="pivot["+o+"].unidad_id",N="pivot["+o+"].motivo";c||(b(t,void 0),b(l,void 0),b(g,null),b($,null),b(N,null),e.pivot[o].items.forEach(E=>{const le="item_orden["+E.pivot_index+"].is_enabled";b(le,c)}))},{deep:!0,immediate:!0})}),u.items.forEach((i,o)=>{B(()=>e.item_orden[o].unidad_id,c=>{if(c){const t=u.items.find(l=>l.id==e.item_orden[o].item_id);if(!!t&&!!c){const l=t.pivot.find(E=>E.unidad_id===c),g="item_orden["+o+"].minimo",$="item_orden["+o+"].maximo",N="item_orden["+o+"].tipo_unidad",R="item_orden["+o+"].operador_unidad";l&&(b(g,l.minimo),b($,l.maximo),b(N,l.tipo),b(R,l.operador))}}},{deep:!0,immediate:!0})}),(i,o)=>(_(),f(oe,{onSubmit:pe(s(a),["prevent"])},{default:h(()=>[m(ee,{dense:""},{default:h(()=>[(_(!0),D(ae,null,J(p.examens,(c,t)=>(_(),f(K,{key:t,dense:""},{default:h(()=>[m(W,null,{default:h(()=>[w("div",we,[m(O,{label:"Examen",name:`pivot[${t}].examen_id`,options:I.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),c.tipo.toLowerCase()==="string"?(_(),D("div",$e,[s(e).pivot[t].is_canceled?y("",!0):(_(),f(v,{key:0,name:`pivot[${t}].resultado`,"bg-color":d(t),label:"Resultado",class:"col-12",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","bg-color","disable"])),s(e).pivot[t].is_canceled?(_(),f(v,{key:1,name:`pivot[${t}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","disable"])):y("",!0)])):c.tipo.toLowerCase()==="unidad"?(_(),D("div",Ee,[s(e).pivot[t].is_canceled?y("",!0):(_(),f(v,{key:0,name:`pivot[${t}].resultado`,"bg-color":d(t),label:"Resultado",class:"col-6",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","bg-color","disable"])),!s(e).pivot[t].is_canceled&&!s(e).pivot[t].has_items?(_(),f(O,{key:1,label:"Unidad",name:`pivot[${t}].unidad_id`,options:s(e).pivot[t].unidads,hint:r(t),class:"col-6",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","options","hint","disable"])):y("",!0),s(e).pivot[t].is_canceled?(_(),f(v,{key:2,name:`pivot[${t}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","disable"])):y("",!0)])):c.tipo.toLowerCase()==="respuesta"?(_(),D("div",Ce,[s(e).pivot[t].is_canceled?y("",!0):(_(),f(O,{key:0,label:"Respuesta",name:`pivot[${t}].respuesta_id`,options:s(e).pivot[t].respuestas,class:"col-12",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","options","disable"])),s(e).pivot[t].is_canceled?(_(),f(v,{key:1,name:`pivot[${t}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","disable"])):y("",!0)])):y("",!0),m(v,{label:"Fecha",type:"date",name:`pivot[${t}].fecha_resultado`,required:"",class:"col-2",disable:!s(e).pivot[t].is_enabled},null,8,["name","disable"]),m(X,{class:"col-2 self-center justify-center"},{default:h(()=>[m(fe,{name:`pivot[${t}].is_enabled`,label:"",dense:""},{default:h(()=>[m(Z,null,{default:h(()=>[x(H(s(e).pivot[t].is_enabled?"Deshabilitar.":"Habilitar."),1)]),_:2},1024)]),_:2},1032,["name"]),m(V,{icon:s(e).pivot[t].is_canceled?"fas fa-pen":"fas fa-ban",color:s(e).pivot[t].is_canceled?"warning":"negative",disable:!s(e).pivot[t].is_enabled,round:"",flat:"",size:"sm",onClick:l=>se(t)},{default:h(()=>[m(Z,null,{default:h(()=>[x(H(s(e).pivot[t].is_canceled?"Registrar datos.":"Cancelar examen."),1)]),_:2},1024)]),_:2},1032,["icon","color","disable","onClick"])]),_:2},1024)]),me(m(ee,{dense:""},{default:h(()=>[(_(!0),D(ae,null,J(s(e).pivot[t].items,(l,g)=>(_(),f(K,{key:g,dense:""},{default:h(()=>[m(W,null,{default:h(()=>[w("div",Ne,[m(O,{label:"Item",name:`item_orden[${l.pivot_index}].item_id`,options:M.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),s(e).item_orden[l.pivot_index].tipo!=="respuesta"?(_(),f(v,{key:0,name:`item_orden[${l.pivot_index}].resultado`,label:"Resultado",class:ce(s(e).item_orden[l.pivot_index].tipo==="unidad"?"col-2":"col-4"),required:"",disable:!s(e).pivot[t].is_enabled,"bg-color":te(l.pivot_index)},null,8,["name","class","disable","bg-color"])):y("",!0),s(e).item_orden[l.pivot_index].tipo==="unidad"?(_(),f(O,{key:1,label:"Unidad",name:`item_orden[${l.pivot_index}].unidad_id`,options:s(e).item_orden[l.pivot_index].unidads,class:"col-2",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","options","disable"])):y("",!0),s(e).item_orden[l.pivot_index].tipo==="respuesta"?(_(),f(O,{key:2,label:"Respuesta",name:`item_orden[${l.pivot_index}].respuesta_id`,options:s(e).item_orden[l.pivot_index].respuestas,class:"col-4",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","options","disable"])):y("",!0),w("span",Re,H(L(l.pivot_index)),1)])]),_:2},1024)]),_:2},1024))),128))]),_:2},1536),[[ue,s(e).pivot[t].is_enabled&&!s(e).pivot[t].is_canceled]])]),_:2},1024)]),_:2},1024))),128))]),_:1}),p.withObservaciones?(_(),D("div",De,[m(v,{label:"Observaciones",type:"textarea",name:"observaciones",class:"col-12"})])):y("",!0),w("div",Oe,[m(X,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:h(()=>[m(V,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:o[0]||(o[0]=c=>i.$emit("cancel"))}),m(V,{label:"Guardar",type:"submit",icon:"fas fa-floppy-disk",color:"primary",loading:s(n),"no-caps":""},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))}}),Ae=Y({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!1,default:!1}},emits:["submit","cancel"],setup(p){const C=z(()=>u.orden.examens.data?u.orden.examens.data.map(n=>({label:n.nombre,value:Number(n.id)})):[]),{data:F}=_e(),u=p,I=G([]),M=G(),Q=G();I.value=u.orden.pivot.map(n=>{let a=[];const r=u.orden.examens.data.find(d=>Number(d.id)==n.examen_id);return a=[{label:"Examen",name:"examen_id",type:"select",options:C.value},{label:"Resultado",name:"resultado",type:"string"},{label:"Unidad",name:"unidad_id",type:"select",options:r?r.unidads.data.map(d=>({label:d.nombre,value:Number(d.id)})):[]},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Acciones",name:"actions",type:"array"}],a});const b=S().of(ie(()=>{let n={};return n={examen_id:j().required().label("Examen"),resultado:j().when(["tipo"],{is:a=>a=="unidad",then:()=>k().positive().typeError("Debe ingresar un numero").label("Resultado")}).when(["tipo"],{is:a=>a==="string",then:()=>q().trim().label("Resultado")}).when(["tipo"],{is:a=>a==="respuesta",then:()=>q().trim().label("Resultado")}).when(["is_enabled","is_canceled","tipo"],{is:(a,r,d)=>a&&!r&&d.toLowerCase()!=="respuesta",then:a=>a.required(),otherwise:a=>a.nullable()}).transform((a,r)=>r===""?void 0:a),fecha_resultado:q().required().label("Fecha"),unidad_id:k().when(["is_enabled","is_canceled","has_items","tipo"],{is:(a,r,d,L)=>a&&!r&&!d&&L==="unidad",then:a=>a.required(),otherwise:a=>a.nullable()}).label("Unidad"),is_canceled:A().required().label("Cancelado?"),is_enabled:A().required().label("Hablitad?"),has_items:A().required().label("Tiene items?"),motivo:q().when(["is_enabled","is_canceled"],{is:!0,then:a=>a.required(),otherwise:a=>a.nullable()}).label("Motivo"),minimo:k(),maximo:k().nullable(),tipo_unidad:q(),operador_unidad:q().nullable(),unidads:S(),items:S(),respuestas:S(),tipo:q().required().label("Tipo"),respuesta_id:k().when(["is_enabled","is_canceled","tipo"],{is:(a,r,d)=>a&&!r&&d==="respuesta",then:a=>a.required(),otherwise:a=>a.nullable()}).label("Respuesta")},P().shape(n)})),e=S().of(ie(()=>{let n={};return n={item_id:j().required().label("Item"),examen_id:j().required().label("Examen"),resultado:j().when(["tipo"],{is:a=>a=="unidad",then:()=>k().positive().typeError("Debe ingresar un numero").label("Resultado")}).when(["tipo"],{is:a=>a==="string",then:()=>q().trim().label("Resultado")}).when(["tipo"],{is:a=>a==="respuesta",then:()=>q().trim().label("Resultado")}).when(["is_enabled","is_canceled","tipo"],{is:(a,r,d)=>a&&!r&&d.toLowerCase()!=="respuesta",then:a=>a.required(),otherwise:a=>a.nullable()}).transform((a,r)=>r===""?void 0:a),unidad_id:k().when(["is_enabled","is_canceled","tipo"],{is:(a,r,d)=>a&&!r&&d==="unidad",then:a=>a.required(),otherwise:a=>a.nullable()}).label("Unidad"),respuesta_id:k().when(["is_enabled","is_canceled","tipo"],{is:(a,r,d)=>a&&!r&&d==="respuesta",then:a=>a.required(),otherwise:a=>a.nullable()}).label("Respuesta"),minimo:k(),maximo:k().nullable(),tipo_unidad:q(),operador_unidad:q().nullable(),is_canceled:A().required().label("Cancelado?"),is_enabled:A().required().label("Habilitado?"),respuestas:S(),tipo:q().required().label("Tipo")},P().shape(n)}));M.value=P().shape({pivot:b,item_orden:e});const T=u.orden.pivot.map(n=>{var r;const a=u.orden.examens.data.find(d=>Number(d.id)==n.examen_id);return{examen_id:n.examen_id,resultado:n.resultado,fecha_resultado:(r=n.fecha_resultado)!=null?r:be.now().toISODate(),unidad_id:n.unidad_id,respuesta_id:n.respuesta_id,is_canceled:n.is_canceled,is_enabled:!0,has_items:a?a.items.data.length>0:!1,tipo:a&&a.tipo.toLowerCase(),motivo:n.motivo,unidads:a?a.unidads.data.map(d=>({label:d.nombre,value:Number(d.id)})):[],respuestas:a?a.respuestas.data.map(d=>({label:d.nombre,value:Number(d.id)})):[],items:u.orden.items.data.map((d,L)=>({pivot_index:L,examen_id:d.examen_id})).filter(d=>d.examen_id===Number(a==null?void 0:a.id))}}),U=u.orden.item_orden.map(n=>{const a=u.orden.items.data.find(r=>Number(r.id)==n.item_id);return{item_id:n.item_id,examen_id:a==null?void 0:a.examen_id,resultado:n.resultado,unidad_id:n.unidad_id,respuesta_id:n.respuesta_id,is_canceled:n.is_canceled,is_enabled:!0,tipo:a&&a.tipo.toLowerCase(),unidads:a?a.unidads.data.map(r=>({label:r.nombre,value:Number(r.id)})):[],respuestas:a?a.respuestas.data.map(r=>({label:r.nombre,value:Number(r.id)})):[]}});return Q.value={pivot:T,item_orden:U,observaciones:u.orden.observaciones},(n,a)=>I.value.length>0&&M.value&&s(F)?(_(),f(Se,{key:0,fields:I.value,"validation-schema":M.value,"initial-values":Q.value,"orden-id":Number(p.orden.id),examens:u.orden.examens.data,items:u.orden.items.data,operadores:s(F),"with-observaciones":p.withObservaciones,onCancel:a[0]||(a[0]=r=>n.$emit("cancel")),onSubmit:a[1]||(a[1]=r=>n.$emit("submit"))},null,8,["fields","validation-schema","initial-values","orden-id","examens","items","operadores","with-observaciones"])):y("",!0)}});export{je as _,Ae as a};
