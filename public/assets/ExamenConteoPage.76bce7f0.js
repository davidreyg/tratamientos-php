import{aZ as t,aG as N,aH as P,X as V,j as S,o as f,aj as w,aJ as F,a4 as o,w as d,a5 as M,ai as p,as as y,aP as U,aD as I,d as q,a7 as C,e as k,a6 as X,ad as Y,r as v,Z,$ as Q,bk as L,ae as J,a0 as W,G as A,ab as $,a1 as b,aa as K,v as ee,aW as R,b6 as ae,ac as B,a9 as te,at as ne,b7 as se}from"./index.0b61b42a.js";import{u as oe}from"./establecimientoFetchAllQuery.87bb6dd9.js";import{O as j}from"./OrdenApi.505fed1e.js";import"./EstablecimientoApi.f30e0dee.js";const ie=[{label:"Hoy",value:"Hoy"},{label:"Esta semana",value:"Esta semana"},{label:"Este mes",value:"Este mes"},{label:"Este a\xF1o",value:"Este a\xF1o"},{label:"Personalizado",value:"Personalizado"}];function le(l){const e={fecha_inicio:"",fecha_fin:""};switch(l){case"Hoy":e.fecha_inicio=t.now().toISODate(),e.fecha_fin=t.now().toISODate();break;case"Esta semana":e.fecha_inicio=t.now().startOf("week").toISODate(),e.fecha_fin=t.now().endOf("week").toISODate();break;case"Este mes":e.fecha_inicio=t.now().startOf("month").toISODate(),e.fecha_fin=t.now().endOf("month").toISODate();break;case"Este a\xF1o":e.fecha_inicio=t.now().startOf("year").toISODate(),e.fecha_fin=t.now().endOf("year").toISODate();break;case"Personalizado":e.fecha_inicio=t.now().toISODate(),e.fecha_fin=t.now().toISODate();break}return e}function ce(){const l=async()=>(await j.exportConteoExamens()).data(),{data:e,isLoading:r,isSuccess:m,isError:i,isFetching:s,refetch:c}=N([P.EXAMEN_ALL,"conteo"],l,{enabled:!1});return{data:e,isLoading:r,isSuccess:m,isError:i,isFetching:s,refetch:c}}function re(l){const e=async()=>(await j.getConteoExamens(l.value)).data().data,{data:r,isLoading:m,isSuccess:i,isError:s,isFetching:c,refetch:u}=N([P.EXAMEN_ALL,"conteo",l==null?void 0:l.value],e);return{data:r,isLoading:m,isSuccess:i,isError:s,isFetching:c,refetch:u}}const ue={class:"q-mb-sm text-overline"},de=V({__name:"ExamenConteoCard",props:{examens:{type:Array,required:!0}},setup(l){const e=l,r=S(()=>e.examens.map(s=>s.categoria.data).filter((s,c,u)=>u.findIndex(x=>x.id===s.id)===c).map(s=>({...s}))),m=i=>e.examens.filter(s=>s.categoria_id==i);return(i,s)=>(f(!0),w(I,null,F(r.value,c=>(f(),w("div",{key:c.id,class:"col-xs-12 col-sm-6"},[o(Y,null,{default:d(()=>[o(M,null,{default:d(()=>[p("div",ue,y(c.nombre),1),o(U,{dense:""},{default:d(()=>[(f(!0),w(I,null,F(m(c.id),u=>(f(),q(X,{key:u.id,dense:""},{default:d(()=>[o(C,null,{default:d(()=>[k(y(u.nombre),1)]),_:2},1024),o(C,{side:"",class:"text-bold"},{default:d(()=>[k(y(u.ordens_count),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))}}),me={class:"row q-col-gutter-md items-center justify-between"},fe=p("div",{class:"col-auto"},"Filtros:",-1),_e={class:"col-12"},he={class:"col-12"},xe=V({__name:"ExamenConteoPage",setup(l){const e=v("Este mes"),r=v(!0),m=v({limit:0}),{data:i}=oe(m),s=S(()=>i.value?i.value.filter(a=>a.ris===E.ris).map(a=>({label:a.nombre,value:Number(a.id)})):[]),c=S(()=>{if(i.value){const a=[];return i.value.forEach(n=>{a.some(h=>h.value===n.ris)||a.push({label:n.ris,value:n.ris})}),a}return[]}),u=Z().shape({ris:Q().required().label("RIS"),establecimiento_id:Q().required().label("Establecimiento"),fecha_inicio:L().required().label("Fecha Inicio"),fecha_fin:L().required().min(J("fecha_inicio")).label("Fecha Fin")}),{handleSubmit:x,resetForm:z,values:E,setFieldValue:g}=W({validationSchema:u,initialValues:{fecha_inicio:t.local(t.now().year,t.now().month,1).toISODate(),fecha_fin:t.local(t.now().year,t.now().month,t.now().daysInMonth).toISODate()}}),_=v({...E}),{data:D}=re(_),H=x(async a=>{console.log(a)}),{refetch:T,data:O}=ce(),G=async()=>{if(await T.value(),O.value){const a=window.URL.createObjectURL(new Blob([O.value])),n=document.createElement("a");n.href=a,n.setAttribute("download","conteo_examenes.xlsx"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}};return A(()=>E,a=>{_.value.fecha_inicio=a.fecha_inicio,_.value.fecha_fin=a.fecha_fin,_.value.ris=a.ris,_.value.establecimiento_id=a.establecimiento_id},{immediate:!0,deep:!0}),A(()=>e.value,a=>{const{fecha_fin:n,fecha_inicio:h}=le(a);g("fecha_inicio",h),g("fecha_fin",n),e.value==="Personalizado"?r.value=!1:r.value=!0}),(a,n)=>(f(),w("div",me,[fe,o(K,{class:"col-auto",vertical:!1,align:"center"},{default:d(()=>[o($,{flat:"","no-caps":"",label:"Limpiar",color:"negative",icon:"fas fa-broom",onClick:n[0]||(n[0]=()=>b(z)())})]),_:1}),p("div",_e,[o(te,{onSubmit:b(H)},{actions:d(()=>[ee(p("div",null,null,512),[[se,!1]])]),default:d(()=>[o(R,{options:c.value,name:"ris",label:"RIS",class:"col-6"},null,8,["options"]),o(R,{options:s.value,name:"establecimiento_id",label:"Establecimiento",class:"col-6"},null,8,["options"]),o(ae,{modelValue:e.value,"onUpdate:modelValue":n[1]||(n[1]=h=>e.value=h),options:b(ie),label:"Rango de Fechas",class:"col-4",outlined:"",dense:"","map-options":"","emit-value":""},null,8,["modelValue","options"]),o(B,{type:"date",label:"Fecha Inicio",name:"fecha_inicio",class:"col-4","min-date":new Date(new Date().getFullYear(),0,1),disable:r.value},null,8,["min-date","disable"]),o(B,{type:"date",label:"Fecha Fin",name:"fecha_fin",class:"col-4","min-date":new Date(new Date().getFullYear(),0,1),disable:r.value},null,8,["min-date","disable"])]),_:1},8,["onSubmit"])]),p("div",he,[o($,{color:"positive",icon:"fas fa-file-excel",label:"Exportar a excel","no-caps":"",onClick:G})]),b(D)?(f(),q(de,{key:0,examens:b(D)},null,8,["examens"])):ne("",!0)]))}});export{xe as default};
