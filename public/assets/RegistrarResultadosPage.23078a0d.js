import{aE as M,aF as J,Y as k,a1 as P,o as n,e as m,w as t,a5 as e,aj as h,ak as C,a_ as V,bc as Y,aZ as L,aJ as R,ad as v,aU as S,au as x,bd as H,a2 as i,aa as G,r as q,k as T,H as Z,b4 as A,be as K,$ as O,aY as W,bf as X,aS as E,a0 as y,ac as F,ab as I,aO as ee,av as ae,aN as te,aI as oe,a$ as U,Q as le,aV as j,f as B,am as Q,al as ne,aR as se,aG as z,b0 as re,b1 as ie,b2 as ce,b3 as N}from"./index.4038eb98.js";import{u as de}from"./ExamenCardList.51cd1e07.js";import{O as ue,u as D,_ as me}from"./laboratorio.store.acbddd3c.js";import{u as be}from"./establecimientoFetchAllQuery.0f91c8ff.js";import"./BaseCheckBoxGroup.15db148c.js";import"./paqueteFetchAllQuery.deb0a7eb.js";import"./PaqueteApi.8de3acd7.js";function fe(r){const b=async()=>(await ue.fetchAll(r.value)).data(),{data:l,isLoading:c,isSuccess:f,isError:o,isFetching:d,refetch:u}=M([J.ORDEN_ALL,r==null?void 0:r.value],b,{keepPreviousData:!0});return{data:l,isLoading:c,isSuccess:f,isError:o,isFetching:d,refetch:u}}const pe=h("thead",null,[h("tr",null,[h("th",{class:"text-center"},"Examen"),h("th",{class:"text-center"},"Fecha"),h("th",{class:"text-center"},"Resultado"),h("th",{class:"text-center"},"Unidad")])],-1),_e=k({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0}},setup(r){const b=r,{handleSubmit:l}=P({validationSchema:b.validationSchema,initialValues:b.initialValues}),c=l(async f=>{console.log(f)});return(f,o)=>(n(),m(G,{onSubmit:i(c)},{default:t(()=>[e(H,{class:"col-12"},{default:t(()=>[pe,h("tbody",null,[(n(!0),C(L,null,V(r.fields,(d,u)=>(n(),m(Y,{key:u},{default:t(()=>[(n(!0),C(L,null,V(d,(a,g)=>(n(),m(R,{key:g,class:"text-center","auto-width":""},{default:t(()=>[a.type!=="select"?(n(),m(v,{key:0,label:a.label,type:a.type,name:`pivot[${u}].${a.name}`,style:{"min-width":"120px"},required:""},null,8,["label","type","name"])):a.type==="select"&&a.name==="examen_id"?(n(),m(S,{key:1,label:a.label,name:`pivot[${u}].${a.name}`,options:a.options||[],style:{"min-width":"150px"},required:"",borderless:"",readonly:"",outlined:!1},null,8,["label","name","options"])):a.type==="select"&&a.name==="unidad"?(n(),m(S,{key:2,label:a.label,name:`pivot[${u}].${a.name}`,options:a.options||[],style:{"min-width":"150px"},required:""},null,8,["label","name","options"])):x("",!0)]),_:2},1024))),128))]),_:2},1024))),128))])]),_:1})]),_:1},8,["onSubmit"]))}}),ye=k({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0}},setup(r){const b=q({limit:0}),{data:l}=de(b),c=T(()=>l.value?l.value.map(a=>({label:a.nombre,value:Number(a.id)})):[]),f=r,o=q([]),d=q(),u=q();return Z(()=>l.value,a=>{if(a){o.value=f.orden.pivot.map(s=>{let p=[];const _=a.find($=>Number($.id)==s.examen_id);return p=[{label:"Examen",name:"examen_id",type:"select",options:c.value},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Resultado",name:"resultado",type:"number"},{label:"Unidad",name:"unidad",type:"select",options:_?_.unidades.map($=>({label:$,value:$})):[]}],p});const g=A().of(K(()=>{let s={};return s={examen_id:X().required().label("Examen"),resultado:E().positive().required().transform((p,_)=>_===""?void 0:p).typeError("Debe ingresar un numero").label("Resultado"),fecha_resultado:y().required().label("Fecha"),unidad:y().required().label("Unidad")},O().shape(s)}));d.value=O().shape({pivot:g});const w=f.orden.pivot.map(s=>{var p;return{examen_id:s.examen_id,resultado:s.resultado,fecha_resultado:(p=s.fecha_resultado)!=null?p:W.now().toISODate(),unidad:s.unidad}});u.value={pivot:w}}},{immediate:!0}),(a,g)=>(n(),C("div",null,[o.value.length>0&&d.value?(n(),m(_e,{key:0,fields:o.value,"validation-schema":d.value,"initial-values":u.value},null,8,["fields","validation-schema","initial-values"])):x("",!0)]))}}),ve=k({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},emits:["cancel"],setup(r){const b=r,{data:l}=be(),c=T(()=>l.value?l.value.map(o=>({label:o.nombre,value:Number(o.id)})):[]),f=O().shape({diagnostico:y().trim().min(2).required().label("Diagnostico"),CI10:y().trim().min(2).required().label("CI10"),CPN:y().trim().min(2).required().label("CPN"),EG:y().trim().min(2).required().label("EG"),codigo_atencion:y().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:y().trim().required().label("Fecha de Registro"),medico:y().trim().required().label("M\xE9dico"),examen_ids:A().of(E().required()).required().label("Examenes"),paquete_ids:A().of(E().required()).required().label("Paquetes"),establecimiento_id:E().label("Establecimiento Institucional"),establecimiento_otro:y().label("Otro Establecimiento")});return P({validationSchema:f,initialValues:b.orden}),(o,d)=>(n(),m(G,null,{actions:t(()=>[e(I,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:t(()=>[e(F,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:d[0]||(d[0]=u=>o.$emit("cancel"))})]),_:1})]),default:t(()=>[e(v,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1}),r.orden.establecimiento_id?(n(),m(S,{key:0,options:c.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:"",readonly:"",borderless:"",outlined:!1},null,8,["options"])):(n(),m(v,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1})),e(v,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(v,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(v,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(v,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(v,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1}),e(v,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1})]),_:1}))}}),he=k({__name:"OrdenTable",props:{ordens:{type:Array,required:!0}},setup(r){const{formatDate:b}=oe(),l=[{name:"fecha_registro",align:"left",label:"Fecha Registro",field:"fecha_registro",format:c=>b(c)},{name:"medico",align:"center",label:"Medico",field:"medico"},{name:"codigo_atencion",align:"center",label:"Codigo Atenci\xF3n",field:"codigo_atencion"},{name:"estado",align:"center",label:"Estado",field:"estado"},{name:"actions",align:"right",label:"Acciones",field:"actions"}];return(c,f)=>(n(),m(i(te),{rows:r.ordens,columns:l,"row-key":"id"},{"body-cell-estado":t(o=>[e(R,{props:o},{default:t(()=>[e(ee,{color:o.row.estado_detalle.color,label:o.row.estado_detalle.label},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-actions":t(o=>[e(R,{props:o,class:"text-right"},{default:t(()=>[e(I,{align:"right",class:"q-pa-none q-ma-none"},{default:t(()=>[ae(c.$slots,"actions",{id:Number(o.key),estado:o.row.estado})]),_:2},1024)]),_:2},1032,["props"])]),_:3},8,["rows"]))}}),ge={key:0,class:"col-12 row justify-center"},xe={class:"col-auto"},qe=h("div",{class:"col-12 text-center text-h6"}," Lo sentimos. \xA1No se encontr\xF3 ninguna orden!. Porfavor registre uno para empezar. ",-1),$e={key:1},Ce=k({__name:"DatosOrdenTab",props:{paciente:{type:Object,required:!0}},setup(r){const b=r,{ordenSeleccionada:l,isOrdenLoading:c}=U(D()),{fetchOrdenById:f}=D(),o=q({search:`paciente_id:${b.paciente.id};estado:0,1`,searchJoin:"and",limit:0}),{data:d}=fe(o),u=q("list"),a=q(),g=async s=>{a.value=s,await f(s),l.value&&(u.value="view")},w=()=>{l.value=void 0,u.value="list"};return(s,p)=>r.paciente?(n(),m(ne,{key:0,modelValue:u.value,"onUpdate:modelValue":p[0]||(p[0]=_=>u.value=_),animated:""},{default:t(()=>[e(Q,{name:"list"},{default:t(()=>[i(d)&&i(d).data.length===0?(n(),C("div",ge,[h("div",xe,[e(le,{name:"fas fa-face-frown",size:"xl"})]),qe,e(F,{class:"q-mt-lg",color:"primary",icon:"fas fa-plus","no-caps":"",label:"Registrar nueva orden",outline:"",to:"/laboratorio/registrar-orden"})])):i(d)?(n(),C("div",$e,[e(he,{ordens:i(d).data},{actions:t(({id:_,estado:$})=>[e(F,{color:"primary",icon:"fas fa-file-signature",round:"",flat:"",size:"sm",loading:i(c)&&a.value===_,onClick:Ee=>g(_)},{default:t(()=>[e(j,null,{default:t(()=>[B("Registrar resultados.")]),_:1})]),_:2},1032,["loading","onClick"]),$===0?(n(),m(F,{key:0,color:"positive",icon:"fas fa-check-double",round:"",flat:"",size:"sm"},{default:t(()=>[e(j,null,{default:t(()=>[B("Confirmar registro.")]),_:1})]),_:1})):x("",!0)]),_:1},8,["ordens"])])):x("",!0)]),_:1}),e(Q,{name:"new"},{default:t(()=>[e(me,{"paciente-id":Number(r.paciente.id)},null,8,["paciente-id"])]),_:1}),e(Q,{name:"view"},{default:t(()=>[i(l)?(n(),m(ve,{key:0,orden:i(l),onCancel:w},null,8,["orden"])):x("",!0)]),_:1})]),_:1},8,["modelValue"])):x("",!0)}}),ke={class:"row q-col-gutter-md"},we={class:"col-12"},Ae=k({__name:"RegistrarResultadosPage",setup(r){const{fetchPaciente:b,$reset:l}=D(),{paciente:c,isPacienteLoading:f,ordenSeleccionada:o}=U(D()),{data:d}=se(),u=T(()=>d.value?d.value.map(s=>({label:s.nombre,value:s.id})):[]),a=O().shape({numero_documento:E().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:y().required().label("Tipo de Documento")}),{handleSubmit:g}=P({validationSchema:a}),w=g(async s=>{l(),await b(s.numero_documento),c.value?z.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}):z.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})});return re(()=>{if(window.confirm("Esta seguro de salir? Tiene cambios sin guardar!"))l();else return!1}),(s,p)=>(n(),C("div",ke,[e(ie,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:i(w)},{default:t(()=>[e(S,{options:u.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),e(v,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),e(I,{class:"col-auto justify-center"},{default:t(()=>[e(F,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:i(f)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),h("div",we,[e(N,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear",class:"bg-purple-2"},{default:t(()=>[e(ce,{class:"bg-purple-1",paciente:i(c),onCancel:i(l),onSubmit:p[0]||(p[0]=_=>i(b)(_))},null,8,["paciente","onCancel"])]),_:1}),i(c)?(n(),m(N,{key:0,icon:"fas fa-vials",label:"Datos de la Orden de Lab.",caption:"Editar / Crear"},{default:t(()=>[e(Ce,{paciente:i(c),onCancel:i(l)},null,8,["paciente","onCancel"])]),_:1})):x("",!0),i(o)?(n(),m(N,{key:1,icon:"fas fa-file-signature",label:"Registrar resultados.",caption:"Editar / Crear"},{default:t(()=>[e(ye,{orden:i(o)},null,8,["orden"])]),_:1})):x("",!0)])]))}});export{Ae as default};
