import{W as J,aH as W,aI as X,Y as G,r as h,k as j,$ as le,a0 as q,b6 as z,aV as D,a1 as ne,ag as T,H as Z,o as f,e as p,w as l,a5 as t,ad as x,aX as ie,aY as C,f as E,ac as F,aj as Q,aD as oe,a2 as d,au as k,aa as se,Z as re,a6 as K,ak as ee,ae,a3 as ue,a4 as ce,ba as de,bb as me,am as H,al as fe,aG as ve}from"./index.95cf0a1c.js";import{u as _e}from"./establecimientoFetchAllQuery.9aa8821e.js";import{u as pe}from"./examenFetchAllQuery.70164d9e.js";import{O as B}from"./OrdenApi.c240bb7b.js";import{u as be}from"./paqueteFetchAllQuery.31787a5c.js";import{_ as ge}from"./ExamenCardList.e87e54ef.js";import{_ as ye}from"./BaseCheckBoxGroup.5cc8f5ec.js";import{u as he,_ as qe}from"./OrdenTable.f2b50502.js";import{u as Y}from"./laboratorio.store.096946da.js";import"./EstablecimientoApi.10fa5d30.js";import"./ExamenApi.9e8eeacd.js";import"./PaqueteApi.43b5412d.js";import"./BaseTable.a8024ea7.js";function xe(){return J(c=>B.destroy(c))}function ke(c,_){const s=async()=>(await B.fetchById(c.value)).data().data,{data:m,isLoading:n,isSuccess:r,isError:u,isFetching:y,refetch:w}=W([X.ORDEN_ALL,c.value],s,{enabled:_});return{data:m,isLoading:n,isSuccess:r,isError:u,isFetching:y,refetch:w}}function we(c,_){const s=async()=>(await B.fetchPDF(c.value)).data(),{data:m,isLoading:n,isSuccess:r,isError:u,isFetching:y,refetch:w}=W([X.ORDEN_ALL,c.value,"pdf"],s,{enabled:_});return{data:m,isLoading:n,isSuccess:r,isError:u,isFetching:y,refetch:w}}function Ee(){return J(({id:c,data:_})=>B.update(c,_))}const Oe={class:"col-12"},Ce={class:"col-12"},Fe={class:"col-12 row q-col-gutter-sm"},Ne=G({__name:"OrdenEditForm",props:{orden:{type:Object,required:!0}},emits:["submit","cancel"],setup(c,{emit:_}){const s=c,m=_,n=h({limit:0,search:"is_active:1",searchJoin:"and"}),{data:r}=pe(n),{data:u}=be(),y=j(()=>u.value?u.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),w=h({limit:0}),{data:N}=_e(w),S=j(()=>N.value?N.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),A=le().shape({diagnostico:q().trim().min(2).required().label("Diagnostico"),CI10:q().trim().min(2).nullable().label("CI10"),CPN:q().trim().min(2).nullable().label("CPN"),EG:q().trim().min(2).nullable().label("EG"),codigo_atencion:q().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:q().trim().required().label("Fecha de Registro"),medico:q().trim().required().label("M\xE9dico"),examen_ids:z().of(D().required()).required().label("Examenes"),item_ids:z().of(D().required()).required().label("Items"),paquete_ids:z().of(D().required()).required().label("Paquetes"),establecimiento_id:D().when([],{is:()=>b.value===!0,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Establecimiento Institucional"),establecimiento_otro:q().when([],{is:()=>b.value===!1,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Otro Establecimiento")}),{values:$,setFieldValue:P,handleSubmit:L}=ne({validationSchema:A,initialValues:{...s.orden,paquete_ids:[]}}),b=h(!!s.orden.establecimiento_id),{mutateAsync:U,reset:V,isLoading:I}=Ee(),R=L(async(e,{setErrors:o,resetForm:v})=>{await U({id:s.orden.id,data:e},{onSuccess:()=>{T.success("Orden Actualizada correctamente."),v(),m("submit")},onError:a=>{V.value(),o(a.data.errors)}})},e=>{console.log(e)});Z(()=>$.examen_ids,e=>{var o;if(e){const v=(o=u.value)==null?void 0:o.filter(g=>g.examen_ids.every(i=>e.includes(i)));P("paquete_ids",(v==null?void 0:v.map(g=>Number(g.id)))||[]);let a=[];r.value&&(a=[],e.forEach(g=>{const i=r.value.find(O=>Number(O.id)===g);if(i&&i.items.data.length>0){const O=i.items.data.map(te=>Number(te.id));a.push(...O)}}),P("item_ids",[...new Set(a)]),console.log($.item_ids))}});const M=e=>{var o;if(e){const v=(o=u.value)==null?void 0:o.filter(a=>e.includes(Number(a.id))).map(a=>a.examen_ids).flat();P("examen_ids",[...new Set(v)])}};return(e,o)=>(f(),p(se,{loading:d(I),onSubmit:d(R),onCancel:o[2]||(o[2]=v=>e.$emit("cancel"))},{default:l(()=>[t(x,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:""}),b.value?(f(),p(ie,{key:0,options:S.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:""},{after:l(()=>[t(F,{round:"",flat:"",icon:"fas fa-building-circle-arrow-right",color:"primary",onClick:o[0]||(o[0]=v=>b.value=!1)},{default:l(()=>[t(C,null,{default:l(()=>[E(" Otro establecimiento ")]),_:1})]),_:1})]),_:1},8,["options"])):(f(),p(x,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:""},{after:l(()=>[t(F,{round:"",flat:"",icon:"fas fa-building-circle-xmark",color:"negative",onClick:o[1]||(o[1]=v=>b.value=!0)},{default:l(()=>[t(C,null,{default:l(()=>[E(" Establecimiento institucional")]),_:1})]),_:1})]),_:1})),t(x,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:""}),t(x,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4"}),t(x,{name:"CPN",label:"Codigo Pre Natal",class:"col-xs-12 col-sm-4"}),t(x,{name:"EG",label:"Edad Gestacional",class:"col-xs-12 col-sm-4"}),t(x,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:""}),t(x,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:""}),Q("div",Oe,[t(oe,{spaced:""}),E(" Paquetes")]),Q("div",Ce,[t(ye,{name:"paquete_ids",label:"Paquetes",options:y.value,onUpdate:M},null,8,["options"])]),Q("div",Fe,[d(r)?(f(),p(ge,{key:0,examens:d(r)},null,8,["examens"])):k("",!0)])]),_:1},8,["loading","onSubmit"]))}}),$e=["src"],Pe=G({__name:"OrdenPDFModal",props:{modelValue:{type:Boolean},pdfUrl:{}},emits:["update:modelValue"],setup(c,{emit:_}){const n=re(c,"modelValue",_);return(r,u)=>(f(),p(ce,{modelValue:d(n),"onUpdate:modelValue":u[0]||(u[0]=y=>ue(n)?n.value=y:null)},{default:l(()=>[t(ae,{style:{width:"1000px","max-width":"90vw"}},{default:l(()=>[t(K,null,{default:l(()=>[r.pdfUrl?(f(),ee("iframe",{key:0,src:r.pdfUrl,width:"100%",height:"500px"},null,8,$e)):k("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ve={class:"row q-col-gutter-md"},Se={class:"col-12"},He=G({__name:"OrdenListPage",setup(c){const{$reset:_}=Y(),{ordenSeleccionada:s}=de(Y()),m=h({}),n=h(0),r=h(""),{data:u,isFetching:y,refetch:w}=he(m),{data:N,isFetching:S,refetch:A}=ke(n,!!n.value),{data:$,isFetching:P,refetch:L}=we(n,!!n.value),b=h("list"),U=a=>{m.value.page=a.pagination.page,m.value.limit=a.pagination.rowsPerPage,m.value.search=a.filter,m.value.orderBy=a.pagination.sortBy,m.value.sortedBy=a.pagination.descending?"desc":"asc"},V=async()=>{s.value=void 0,await w.value()},I=async a=>{s.value=void 0,n.value=a,r.value="edit",await A.value(),N.value&&(s.value=N.value,b.value="edit-orden")},{mutateAsync:R}=xe(),M=async a=>{s.value=void 0,n.value=a,T.confirmDialog(a,{title:"\xBFEsta seguro de eliminar esta ORDEN?",preConfirm:async()=>{await R(a,{onSuccess:async()=>{T.success("Orden eliminada correctamente."),V()},onError:()=>{ve.hideLoading()}})}})},e=h(""),o=h(!1),v=async a=>{s.value=void 0,n.value=a,r.value="pdf",await L.value(),$.value&&(e.value=URL.createObjectURL(new Blob([$.value],{type:"application/pdf"})),o.value=!0)};return me(()=>{_()}),Z(()=>s.value,a=>{a||(b.value="list")}),(a,g)=>(f(),ee("div",Ve,[Q("div",Se,[t(fe,{modelValue:b.value,"onUpdate:modelValue":g[0]||(g[0]=i=>b.value=i),animated:""},{default:l(()=>[t(H,{name:"list"},{default:l(()=>[d(u)?(f(),p(qe,{key:0,ordens:d(u).data,"server-pagination":d(u).meta.pagination,loading:d(y),onRequest:U},{"custom-actions":l(({props:i})=>[i.row.estado===0?(f(),p(F,{key:0,color:"warning",icon:"fas fa-edit",round:"",flat:"",size:"sm",loading:r.value==="edit"&&d(S)&&n.value===Number(i.key),onClick:O=>I(Number(i.key))},{default:l(()=>[t(C,null,{default:l(()=>[E("Editar Orden.")]),_:1})]),_:2},1032,["loading","onClick"])):k("",!0),t(F,{color:"primary",icon:"fas fa-eye",round:"",flat:"",size:"sm",loading:r.value==="view"&&d(S)&&n.value===Number(i.key)},{default:l(()=>[t(C,null,{default:l(()=>[E("Visualizar Orden.")]),_:1})]),_:2},1032,["loading"]),i.row.estado===2?(f(),p(F,{key:1,color:"info",icon:"fas fa-print",round:"",flat:"",loading:r.value==="pdf"&&d(P)&&n.value===Number(i.key),size:"sm",onClick:O=>v(Number(i.key))},{default:l(()=>[t(C,null,{default:l(()=>[E("Imprimir.")]),_:1})]),_:2},1032,["loading","onClick"])):k("",!0),i.row.estado!==2?(f(),p(F,{key:2,color:"negative",icon:"fas fa-trash-can",round:"",flat:"",size:"sm",onClick:O=>M(Number(i.key))},{default:l(()=>[t(C,null,{default:l(()=>[E("Eliminar orden.")]),_:1})]),_:2},1032,["onClick"])):k("",!0)]),_:1},8,["ordens","server-pagination","loading"])):k("",!0)]),_:1}),t(H,{name:"edit-orden"},{default:l(()=>[t(ae,{class:"my-card"},{default:l(()=>[t(K,null,{default:l(()=>[d(s)?(f(),p(Ne,{key:0,orden:d(s),onSubmit:V,onCancel:V},null,8,["orden"])):k("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e.value?(f(),p(Pe,{key:0,modelValue:o.value,"onUpdate:modelValue":g[1]||(g[1]=i=>o.value=i),"pdf-url":e.value},null,8,["modelValue","pdf-url"])):k("",!0)]))}});export{He as default};
