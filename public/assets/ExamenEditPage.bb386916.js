import{aH as fe,aI as he,W as ge,Y as J,k as y,r as T,$ as j,a0 as S,aV as u,b0 as ye,b6 as L,a1 as xe,b7 as I,H as $e,o as r,ak as d,a5 as a,w as i,aX as x,ad as $,a2 as s,aj as q,b8 as P,ac as U,at as z,au as c,aQ as Y,a9 as D,f as H,aE as X,aK as K,e as E,a8 as W,x as qe,a7 as G,aa as Ee,ag as N,b9 as ke,ay as we,ae as Ce}from"./index.822d49dc.js";import{_ as Qe}from"./SkeletonForm.bf08108b.js";import{u as Se}from"./categoriaFetchAllQuery.cac212b3.js";import{E as Z}from"./ExamenApi.ab8fee7c.js";import{u as Ue,a as Fe,b as Ne}from"./unidadTiposFetchAllQuery.697dc3c7.js";import{u as Ve}from"./operadoresFetchAllQuery.73970322.js";import{u as Ae}from"./unidadFetchAllQuery.98309231.js";import{_ as Re}from"./BaseCheckBox.8dbddfe1.js";import"./CategoriaApi.eadd07d2.js";import"./UnidadApi.7d2c2a45.js";function Oe(n,m){const b=async()=>(await Z.fetchOne(n)).data().data,{data:p,isLoading:_,isSuccess:f,isError:h,isFetching:k,refetch:v}=fe([he.EXAMEN_ALL,n],b,{enabled:m});return{data:p,isLoading:_,isSuccess:f,isError:h,isFetching:k,refetch:v}}function Me(){return ge(({data:n,id:m})=>Z.update(n,m))}const Be={class:"row"},Te={key:0,class:"col-xs-12 col-sm-12"},je={class:"row"},Le={key:0,class:"text-red text-italic"},Ie={class:"row q-col-gutter-sm q-mb-sm"},Pe={class:"col-auto self-center"},ze={key:1,class:"col-xs-12 col-sm-12"},Ye={class:"row"},De={key:0,class:"text-red text-italic"},He={class:"row q-col-gutter-sm q-mb-sm"},Xe={class:"col-4 self-center"},Ke=J({__name:"ExamenEditForm",props:{examen:{type:Object,required:!0}},emits:["submit","cancel"],setup(n,{emit:m}){const b=n,p=m,{data:_}=Se(),f=y(()=>_.value?_.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:h}=Ue(),k=y(()=>h.value?Object.values(h.value).map(e=>({label:e,value:e})):[]),{data:v}=Ae(),F=y(()=>v.value?Object.values(v.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:V}=Fe(),A=y(()=>V.value?Object.values(V.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:R}=Ne(),ee=y(()=>R.value?Object.values(R.value).map(e=>({label:e,value:e})):[]),{data:O}=Ve(),ae=y(()=>O.value?Object.entries(O.value).map(([e,o])=>({label:`${o} (${e})`,value:e})):[]),w=T(),C=T(),se=j().shape({nombre:S().trim().min(2).required().label("Nombre"),codigo:u().typeError("Codigo debe ser un numero").positive().required().label("Codigo"),tipo:S().trim().min(2).required().label("Tipo"),categoria_id:u().required().label("Categoria"),is_active:ye().required().label("\xBFActivo?"),precio:u().typeError("Precio debe ser un numero").positive().required().label("Precio"),pivot:L().when(["tipo"],{is:e=>e==="unidad",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(j({unidad_id:u().typeError("Unidad debe ser un numero").positive().required().label("Unidad"),examen_id:u().typeError("Examen debe ser un numero").positive().label("Examen"),minimo:u().typeError("Minimo debe ser un numero").min(0).required().label("Minimo"),maximo:u().typeError("Maximo debe ser un numero").positive().when(["tipo"],{is:e=>e==="multivalor",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Maximo"),tipo:S().required().label("Tipo"),operador:S().when(["tipo"],{is:e=>e==="operador",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Operador")})).label("Unidades"),respuesta_ids:L().when(["tipo"],{is:e=>e==="respuesta",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(u().required()).label("Respuestas")}),{handleSubmit:oe,setErrors:te,values:g,errors:Q,setFieldValue:re}=xe({validationSchema:se,initialValues:{...b.examen}}),{remove:le,push:ie,fields:M}=I("pivot"),{remove:ne,push:ue,fields:B}=I("respuesta_ids"),de=e=>{if(M.value.some(l=>l.value.unidad_id===e.value)){N.warn("Ya has agregado este item");return}ie({unidad_id:Number(e.value)}),w.value=void 0},ce=e=>{if(B.value.some(l=>l.value===e.value)){N.warn("Ya has agregado este item");return}ue(Number(e.value)),C.value=void 0},{isLoading:me,mutate:pe,reset:ve}=Me(),be=oe(async e=>{pe({data:e,id:b.examen.id},{onSuccess:()=>{p("submit")},onError:o=>{ve.value(),te(o.data.errors)}})},e=>{console.log(e)});return $e(()=>g.tipo,e=>{e&&re("pivot",[])}),(e,o)=>(r(),d("div",Be,[a(Ee,{class:"col-xs-12 col-sm-10",loading:s(me),onSubmit:s(be),onCancel:o[4]||(o[4]=l=>e.$emit("cancel"))},{default:i(()=>[a(x,{options:f.value,name:"categoria_id",label:"Categoria",class:"col-xs-12 col-sm-6"},null,8,["options"]),a($,{name:"codigo",label:"Codigo",class:"col-xs-12 col-sm-6"}),a($,{name:"nombre",label:"Nombre",class:"col-xs-12 col-sm-9"}),a($,{name:"precio",label:"Precio",class:"col-xs-12 col-sm-3"}),a(Re,{name:"is_active",label:"\xBFActivo?",class:"col-xs-12 col-sm-6"}),a(x,{options:k.value,name:"tipo",label:"Tipo",class:"col-xs-12 col-sm-6"},null,8,["options"]),s(g).tipo==="unidad"?(r(),d("div",Te,[q("div",je,[a(P,{modelValue:w.value,"onUpdate:modelValue":o[1]||(o[1]=l=>w.value=l),options:F.value,borderless:"",dense:"",name:"unidadees1",label:"Unidades",class:"col-4 q-mb-md"},{after:i(()=>[a(U,{disable:!w.value,round:"",dense:"",icon:"add",color:"positive",onClick:o[0]||(o[0]=l=>de(w.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),s(Q).pivot?(r(),d("div",Le,z(s(Q).pivot),1)):c("",!0),a(Y,{bordered:""},{default:i(()=>[a(D,{header:""},{default:i(()=>[H("Seleccionar Unidades")]),_:1}),(r(!0),d(X,null,K(s(M),(l,t)=>(r(),E(G,{key:t},{default:i(()=>[a(W,null,{default:i(()=>[q("div",Ie,[qe(a($,{label:"examen",name:`pivot[${t}].examen_id`,class:"col-3",required:""},null,8,["name"]),[[ke,!1]]),a(x,{label:"Unidades",name:`pivot[${t}].unidad_id`,options:F.value,class:"col-2",required:""},null,8,["name","options"]),s(g).pivot[t].tipo==="operador"?(r(),E(x,{key:0,name:`pivot[${t}].operador`,options:ae.value,label:"Operador",class:"col-3"},null,8,["name","options"])):c("",!0),a($,{name:`pivot[${t}].minimo`,label:s(g).pivot[t].tipo==="multivalor"?"Minimo":"Valor",class:"col-3"},null,8,["name","label"]),s(g).pivot[t].tipo==="multivalor"?(r(),E($,{key:1,name:`pivot[${t}].maximo`,label:"Maximo",class:"col-3"},null,8,["name"])):c("",!0),a(x,{options:ee.value,name:`pivot[${t}].tipo`,label:"Tipo",class:"col-3"},null,8,["options","name"]),q("div",Pe,[a(U,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:_e=>s(le)(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):c("",!0),s(g).tipo==="respuesta"?(r(),d("div",ze,[q("div",Ye,[a(P,{modelValue:C.value,"onUpdate:modelValue":o[3]||(o[3]=l=>C.value=l),options:A.value,borderless:"",dense:"",name:"respuestas1",label:"Respuesta",class:"col-4 q-mb-md"},{after:i(()=>[a(U,{disable:!C.value,round:"",dense:"",icon:"add",color:"positive",onClick:o[2]||(o[2]=l=>ce(C.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),s(Q).respuesta_ids?(r(),d("div",De,z(s(Q).respuesta_ids),1)):c("",!0),a(Y,{bordered:""},{default:i(()=>[a(D,{header:""},{default:i(()=>[H("Seleccionar Respuestas")]),_:1}),(r(!0),d(X,null,K(s(B),(l,t)=>(r(),E(G,{key:t},{default:i(()=>[a(W,null,{default:i(()=>[q("div",He,[a(x,{label:"Respuesta",name:`respuesta_ids[${t}]`,options:A.value,class:"col-8",required:""},null,8,["name","options"]),q("div",Xe,[a(U,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:_e=>s(ne)(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):c("",!0)]),_:1},8,["loading","onSubmit"])]))}}),We={class:"row"},ia=J({__name:"ExamenEditPage",props:{id:{type:Number,required:!0}},setup(n){const m=n,b=we(),{data:p,isSuccess:_,isFetching:f}=Oe(m.id,!0),h=()=>{N.success("Registro actualizado correctamente"),b.back()};return(k,v)=>(r(),d("div",We,[s(f)?(r(),E(Ce,{key:0,class:"col-xs-12 col-sm-10 q-pa-lg"},{default:i(()=>[a(Qe,{class:"col-12",inputs:3})]),_:1})):c("",!0),s(_)&&!s(f)&&s(p)?(r(),E(Ke,{key:1,class:"col-xs-12 col-sm-10",examen:s(p),gol:s(p),onSubmit:h,onCancel:v[0]||(v[0]=F=>k.$router.back())},null,8,["examen","gol"])):c("",!0)]))}});export{ia as default};
