var U=Object.defineProperty;var A=(t,a,s)=>a in t?U(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s;var $=(t,a,s)=>(A(t,typeof a!="symbol"?a+"":a,s),s);import{a as T,W as R,Y as j,k as I,$ as H,a0 as u,b4 as F,aS as w,a1 as W,r as _,ag as Y,H as z,o as N,e as P,w as f,a5 as i,ad as d,aU as J,aV as k,f as E,ac as B,aj as S,aP as K,a2 as O,aa as X,b5 as Z,b6 as ee}from"./index.4de37196.js";import{u as ae}from"./establecimientoFetchAllQuery.5a0b8b02.js";import{u as te}from"./paqueteFetchAllQuery.bca6b3bc.js";import{_ as ie}from"./ExamenCardList.cd77e745.js";import{_ as se}from"./BaseCheckBoxGroup.0eabbe9b.js";const m=class{static fetchAll(a){return m._api.get(`${m._endpoint}`,a)}static fetchById(a){return m._api.get(`${m._endpoint}/${a}`)}static async create(a){await m._api.post(m._endpoint,a)}};let p=m;$(p,"_api",T),$(p,"_endpoint","/ordens");function oe(){return R(t=>p.create(t))}const ne={class:"col-12"},re={class:"col-12"},le={class:"col-12 row q-col-gutter-sm"},_e=j({__name:"OrdenCreateForm",props:{pacienteId:{type:Number,required:!0}},emits:["submit"],setup(t,{emit:a}){const s=t,b=a,{data:r}=te(),g=I(()=>r.value?r.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:h}=ae(),x=I(()=>h.value?h.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),y=H().shape({diagnostico:u().trim().min(2).required().label("Diagnostico"),CI10:u().trim().min(2).required().label("CI10"),CPN:u().trim().min(2).required().label("CPN"),EG:u().trim().min(2).required().label("EG"),codigo_atencion:u().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:u().trim().required().label("Fecha de Registro"),medico:u().trim().required().label("M\xE9dico"),examen_ids:F().of(w().required()).required().label("Examenes"),paquete_ids:F().of(w().required()).required().label("Paquetes"),establecimiento_id:w().when([],{is:()=>q.value,then:e=>e.required(),otherwise:e=>e.optional()}).label("Establecimiento Institucional"),establecimiento_otro:u().when([],{is:()=>!q.value,then:e=>e.required(),otherwise:e=>e.optional()}).label("Otro Establecimiento")}),{values:C,setFieldValue:n,handleSubmit:v}=W({validationSchema:y,initialValues:{examen_ids:[],paquete_ids:[],paciente_id:s.pacienteId}}),q=_(!0),{mutateAsync:Q,reset:V,isLoading:D}=oe(),G=v(async(e,{setErrors:o,resetForm:l})=>{await Q(e,{onSuccess:()=>{Y.success("Orden registrada correctamente."),l(),b("submit")},onError:c=>{V.value(),o(c.data.errors)}})});z(()=>C.examen_ids,e=>{var o;if(e){const l=(o=r.value)==null?void 0:o.filter(c=>c.examen_ids.every(M=>e.includes(M)));n("paquete_ids",(l==null?void 0:l.map(c=>Number(c.id)))||[])}});const L=e=>{var o;if(e){const l=(o=r.value)==null?void 0:o.filter(c=>e.includes(Number(c.id))).map(c=>c.examen_ids).flat();n("examen_ids",[...new Set(l)])}};return(e,o)=>(N(),P(X,{loading:O(D),onSubmit:O(G)},{default:f(()=>[i(d,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:""}),q.value?(N(),P(J,{key:0,options:x.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:""},{after:f(()=>[i(B,{round:"",flat:"",icon:"fas fa-building-circle-arrow-right",color:"primary",onClick:o[0]||(o[0]=l=>q.value=!1)},{default:f(()=>[i(k,null,{default:f(()=>[E(" Otro establecimiento ")]),_:1})]),_:1})]),_:1},8,["options"])):(N(),P(d,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:""},{after:f(()=>[i(B,{round:"",flat:"",icon:"fas fa-building-circle-xmark",color:"negative",onClick:o[1]||(o[1]=l=>q.value=!0)},{default:f(()=>[i(k,null,{default:f(()=>[E(" Establecimiento institucional")]),_:1})]),_:1})]),_:1})),i(d,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:""}),i(d,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:""}),i(d,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:""}),i(d,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:""}),i(d,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:""}),i(d,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:""}),S("div",ne,[i(K,{spaced:""}),E(" Paquetes")]),S("div",re,[i(se,{name:"paquete_ids",label:"Paquetes",options:g.value,onUpdate:L},null,8,["options"])]),S("div",le,[i(ie)])]),_:1},8,["loading","onSubmit"]))}}),pe=Z("laboratorio-form",()=>{const t=_(),a=_(),s=_(),b=_(!1),r=_(!1);function g(){t.value=void 0,a.value=void 0,s.value=void 0}function h(n){t.value=n}function x(n){a.value=n}async function y(n){b.value=!0;try{t.value=void 0,t.value=await ee.run(n),b.value=!1}catch(v){throw b.value=!1,v}}async function C(n){r.value=!0;try{s.value=void 0,s.value=(await p.fetchById(n)).data().data,r.value=!1}catch(v){throw r.value=!1,v}}return{paciente:t,isPacienteLoading:b,isOrdenLoading:r,ordenesSeleccionada:a,ordenSeleccionada:s,$reset:g,setPaciente:h,fetchOrdenById:C,setOrdenesDelPaciente:x,fetchPaciente:y}});export{p as O,_e as _,pe as u};
