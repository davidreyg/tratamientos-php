import{U as ve,X,j as c,Z as M,$ as C,aU as n,a_ as be,b4 as O,a0 as _e,r as j,b5 as B,af as U,o as l,aj as u,a4 as a,w as i,aW as m,ac as h,a1 as o,ai as p,b6 as T,ab as x,as as P,at as v,aP as L,a8 as I,e as z,aD as D,aJ as Y,d as $,a7 as J,a6 as W,a9 as fe}from"./index.0b61b42a.js";import{u as he}from"./categoriaFetchAllQuery.8519a498.js";import{E as $e}from"./ExamenApi.76925565.js";import{u as ge,a as qe}from"./unidadTiposFetchAllQuery.f81b07c2.js";import{u as ye}from"./respuestaFetchAllQuery.01893b66.js";import{u as Ce}from"./operadoresFetchAllQuery.2318cb1a.js";import{u as xe}from"./unidadFetchAllQuery.ff101a91.js";import{_ as ke}from"./BaseCheckBox.6b28d6ca.js";import"./CategoriaApi.d622634b.js";import"./UnidadApi.48fefe35.js";import"./RespuestaApi.777fe001.js";function Ue(){return ve(k=>$e.create(k))}const we={class:"row"},Se={key:0,class:"col-xs-12 col-sm-12"},Ee={class:"row"},Fe={key:0,class:"text-red text-italic"},Ne={class:"row q-col-gutter-sm q-mb-sm"},Qe={class:"col-auto self-center"},Ve={key:1,class:"col-xs-12 col-sm-12"},Ae={class:"row"},Re={key:0,class:"text-red text-italic"},Me={class:"row q-col-gutter-sm q-mb-sm"},Oe={class:"col-4 self-center"},je=X({__name:"ExamenCreateForm",emits:["submit","cancel"],setup(k,{emit:g}){const d=g,{data:q}=he(),Z=c(()=>q.value?q.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:w}=ge(),G=c(()=>w.value?Object.values(w.value).map(e=>({label:e,value:e})):[]),{data:S}=xe(),E=c(()=>S.value?Object.values(S.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:F}=ye(),N=c(()=>F.value?Object.values(F.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:Q}=qe(),H=c(()=>Q.value?Object.values(Q.value).map(e=>({label:e,value:e})):[]),{data:V}=Ce(),K=c(()=>V.value?Object.entries(V.value).map(([e,s])=>({label:`${s} (${e})`,value:e})):[]),ee=M().shape({nombre:C().trim().min(2).required().label("Nombre"),codigo:n().typeError("Codigo debe ser un numero").positive().required().label("Codigo"),tipo:C().trim().min(2).required().label("Tipo"),categoria_id:n().required().label("Categoria"),is_active:be().required().label("\xBFActivo?"),precio:n().typeError("Precio debe ser un numero").positive().required().label("Precio"),pivot:O().when(["tipo"],{is:e=>e==="unidad",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(M({unidad_id:n().typeError("Unidad debe ser un numero").positive().required().label("Unidad"),minimo:n().typeError("Minimo debe ser un numero").min(0).required().label("Minimo"),maximo:n().typeError("Maximo debe ser un numero").positive().when(["tipo"],{is:e=>e==="multivalor",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Maximo"),tipo:C().required().label("Tipo"),operador:C().when(["tipo"],{is:e=>e==="operador",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Operador")})).label("Unidades"),respuesta_ids:O().when(["tipo"],{is:e=>e==="respuesta",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(n().required()).label("Respuestas")}),{handleSubmit:ae,setErrors:se,values:b,errors:y}=_e({validationSchema:ee}),_=j(),f=j(),{remove:oe,push:te,fields:A}=B("pivot"),{remove:re,push:le,fields:R}=B("respuesta_ids"),ie=e=>{if(A.value.some(r=>r.value.unidad_id===e.value)){U.warn("Ya has agregado este item");return}te({unidad_id:Number(e.value)}),_.value=void 0},ne=e=>{if(R.value.some(r=>r.value===e.value)){U.warn("Ya has agregado este item");return}le(Number(e.value)),f.value=void 0},{isLoading:ue,mutate:de,reset:ce}=Ue(),me=ae(async e=>{de(e,{onSuccess:()=>{U.success(),d("submit")},onError:s=>{ce.value(),se(s.data.errors)}})},e=>{console.log(e.errors)});return(e,s)=>(l(),u("div",we,[a(fe,{class:"col-xs-12 col-sm-10",loading:o(ue),onSubmit:o(me),onCancel:s[4]||(s[4]=r=>e.$emit("cancel"))},{default:i(()=>[a(m,{options:Z.value,name:"categoria_id",label:"Categoria",class:"col-xs-12 col-sm-6"},null,8,["options"]),a(h,{name:"codigo",label:"Codigo",class:"col-xs-12 col-sm-6"}),a(h,{name:"nombre",label:"Nombre",class:"col-xs-12 col-sm-9"}),a(h,{name:"precio",label:"Precio",class:"col-xs-12 col-sm-3"}),a(ke,{name:"is_active",label:"\xBFActivo?",class:"col-xs-12 col-sm-6"}),a(m,{options:G.value,name:"tipo",label:"Tipo",class:"col-xs-12 col-sm-6"},null,8,["options"]),o(b).tipo==="unidad"?(l(),u("div",Se,[p("div",Ee,[a(T,{modelValue:_.value,"onUpdate:modelValue":s[1]||(s[1]=r=>_.value=r),options:E.value,borderless:"",dense:"",label:"Unidades",class:"col-4 q-mb-md"},{after:i(()=>[a(x,{disable:!_.value,round:"",dense:"",icon:"add",color:"positive",onClick:s[0]||(s[0]=r=>ie(_.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),o(y).pivot?(l(),u("div",Fe,P(o(y).pivot),1)):v("",!0),a(L,{bordered:""},{default:i(()=>[a(I,{header:""},{default:i(()=>[z("Seleccionar Unidades")]),_:1}),(l(!0),u(D,null,Y(o(A),(r,t)=>(l(),$(W,{key:t},{default:i(()=>[a(J,null,{default:i(()=>[p("div",Ne,[a(m,{label:"Unidades",name:`pivot[${t}].unidad_id`,options:E.value,class:"col-2",required:""},null,8,["name","options"]),o(b).pivot[t].tipo==="operador"?(l(),$(m,{key:0,name:`pivot[${t}].operador`,options:K.value,label:"Operador",class:"col-3"},null,8,["name","options"])):v("",!0),a(h,{name:`pivot[${t}].minimo`,label:o(b).pivot[t].tipo==="multivalor"?"Minimo":"Valor",class:"col-3"},null,8,["name","label"]),o(b).pivot[t].tipo==="multivalor"?(l(),$(h,{key:1,name:`pivot[${t}].maximo`,label:"Maximo",class:"col-3"},null,8,["name"])):v("",!0),a(m,{options:H.value,name:`pivot[${t}].tipo`,label:"Tipo",class:"col-3"},null,8,["options","name"]),p("div",Qe,[a(x,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:pe=>o(oe)(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):v("",!0),o(b).tipo==="respuesta"?(l(),u("div",Ve,[p("div",Ae,[a(T,{modelValue:f.value,"onUpdate:modelValue":s[3]||(s[3]=r=>f.value=r),options:N.value,borderless:"",dense:"",label:"Respuesta",class:"col-4 q-mb-md"},{after:i(()=>[a(x,{disable:!f.value,round:"",dense:"",icon:"add",color:"positive",onClick:s[2]||(s[2]=r=>ne(f.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),o(y).respuesta_ids?(l(),u("div",Re,P(o(y).respuesta_ids),1)):v("",!0),a(L,{bordered:""},{default:i(()=>[a(I,{header:""},{default:i(()=>[z("Seleccionar Respuestas")]),_:1}),(l(!0),u(D,null,Y(o(R),(r,t)=>(l(),$(W,{key:t},{default:i(()=>[a(J,null,{default:i(()=>[p("div",Me,[a(m,{label:"Respuesta",name:`respuesta_ids[${t}]`,options:N.value,class:"col-8",required:""},null,8,["name","options"]),p("div",Oe,[a(x,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:pe=>o(re)(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):v("",!0)]),_:1},8,["loading","onSubmit"])]))}}),Ze=X({__name:"ExamenCreatePage",setup(k){return(g,d)=>(l(),$(je,{onSubmit:d[0]||(d[0]=q=>g.$router.back()),onCancel:d[1]||(d[1]=q=>g.$router.back())}))}});export{Ze as default};
