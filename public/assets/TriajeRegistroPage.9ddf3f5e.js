import{U,bq as B,aG as H,aH as W,X as $,a0 as V,af as X,o as c,d as _,w as d,aj as h,aJ as D,ac as k,aD as C,a1 as p,a9 as Z,r as T,G as M,b4 as K,bi as Y,Z as w,bk as ee,a4 as a,ad as ae,at as x,bj as te,aU as G,v as N,Q as A,a7 as q,e as L,a6 as P,aC as ie,aE as O,aF as S,aR as ne,b8 as J,br as E,ab as z,al as F,bs as se,ak as oe,aT as re,j as le,$ as ce,b9 as ue,aW as de,aa as me,be as fe,ai as pe,bf as be,bg as R}from"./index.0b61b42a.js";import{_ as ve}from"./SkeletonForm.a34e76f0.js";import{_ as _e}from"./BaseTable.15a0ffee.js";function ge(){return U(n=>B.delete(n))}function ye(n,s){const r=async()=>(await B.findById(n)).data().data,{data:m,isLoading:u,isSuccess:o,isError:f,isFetching:e,refetch:b}=H([W.TRIAJE_ALL,n],r,{enabled:s});return{data:m,isLoading:u,isSuccess:o,isError:f,isFetching:e,refetch:b}}function he(){return U(({data:n,id:s})=>B.update(n,s))}const $e=$({__name:"FormDinamicoEdit",props:{fields:{type:Array,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0},triajeId:{type:Number,required:!0}},emits:["submit","cancel"],setup(n,{emit:s}){const r=s,m=n,{handleSubmit:u,setErrors:o,resetForm:f}=V({validationSchema:m.validationSchema,initialValues:m.initialValues}),{mutateAsync:e,reset:b,isLoading:v}=he(),l=u(async g=>{await e({data:g,id:m.triajeId},{onSuccess:()=>{f(),X.success(),r("submit")},onError:y=>{b.value(),o(y.data.errors)}})}),t=()=>{f(),r("cancel")};return(g,y)=>(c(),_(Z,{loading:p(v),onSubmit:p(l),onCancel:t},{default:d(()=>[(c(!0),h(C,null,D(n.fields.filter(i=>i.type!=="array"),(i,j)=>(c(),_(k,{key:j,name:i.name,label:i.label,suffix:i.suffix,type:i.type,"stack-label":!0,class:"col-xs-12 col-sm-4"},null,8,["name","label","suffix","type"]))),128)),(c(!0),h(C,null,D(n.fields.filter(i=>i.type==="array"),(i,j)=>(c(),h("div",{key:j,class:"col-12 row q-col-gutter-md"},[(c(!0),h(C,null,D(i.fields,(Q,I)=>(c(),_(k,{key:I,name:`pivot[${I}].valor`,label:Q.label,suffix:Q.suffix,"stack-label":!0,class:"col-xs-12 col-sm-4"},null,8,["name","label","suffix"]))),128))]))),128))]),_:1},8,["loading","onSubmit"]))}}),je={class:"row"},Te=$({__name:"TriajeEditForm",props:{triajeId:{type:Number,required:!0}},emits:["submit","cancel"],setup(n){const s=n,{data:r,isFetching:m}=ye(s.triajeId,!0),u=T([]),o=T(),f=T();return M(()=>r.value,e=>{if(e){const b=e.signos.data.map(t=>({label:t.nombre,name:t.nombre,type:"number",suffix:t.unidad}));u.value=[{name:"fecha_registro",label:"Fecha Registro",type:"date"},{name:"pivot",label:"Signos",type:"array",fields:b}];const v=K().of(Y(t=>{const g=e.signos.data.find(i=>i.id==t.signo_id);let y={};return g&&(y={signo_id:te().when([],{is:()=>g.is_required,then:i=>i.required(),otherwise:i=>i.optional()}).label("Id del signo"),valor:G().positive().when([],{is:()=>g.is_required,then:i=>i.required(),otherwise:i=>i.optional()}).transform((i,j)=>j===""?void 0:i).typeError("Debe ingresar un numero").label(g.nombre)}),w().shape(y)})),l=w().shape({fecha_registro:ee().required().label("Fecha Registro")}).required();o.value=l.concat(w().shape({pivot:v})),f.value={fecha_registro:e.fecha_registro,paciente_id:e.paciente_id,pivot:e.pivot}}},{immediate:!0}),(e,b)=>(c(),h("div",je,[p(m)?(c(),_(ae,{key:0,class:"col-12 q-pa-lg"},{default:d(()=>[a(ve,{class:"col-12",inputs:5})]),_:1})):x("",!0),u.value.length>0&&o.value&&!p(m)?(c(),_($e,{key:1,fields:u.value,"validation-schema":o.value,"initial-values":f.value,"triaje-id":n.triajeId,onCancel:b[0]||(b[0]=v=>e.$emit("cancel")),onSubmit:b[1]||(b[1]=v=>e.$emit("submit"))},null,8,["fields","validation-schema","initial-values","triaje-id"])):x("",!0)]))}}),Se=$({__name:"TriajesTableActions",props:{id:{type:String,required:!0}},emits:["destroy","edit"],setup(n){return(s,r)=>(c(),h(C,null,[N((c(),_(P,{clickable:"",onClick:r[0]||(r[0]=m=>s.$emit("edit",n.id))},{default:d(()=>[a(q,{avatar:""},{default:d(()=>[a(A,{name:"fas fa-pen-to-square",color:"warning"})]),_:1}),a(q,null,{default:d(()=>[L("Editar")]),_:1})]),_:1})),[[O]]),a(ie),N((c(),_(P,{clickable:"",onClick:r[1]||(r[1]=m=>s.$emit("destroy",n.id))},{default:d(()=>[a(q,{avatar:""},{default:d(()=>[a(A,{name:"fas fa-trash-can",color:"negative"})]),_:1}),a(q,null,{default:d(()=>[L("Eliminar")]),_:1})]),_:1})),[[O]])],64))}}),xe=$({__name:"TriajesTable",props:{loading:{type:Boolean,required:!1,default:!1},data:{type:Array,required:!0},serverPagination:{type:Object,default:void 0}},emits:["destroyOne","edit"],setup(n,{emit:s}){const r=s,{formatDate:m}=ne(),u=[{name:"fecha_registro",align:"left",label:"Fecha de Registro",field:"fecha_registro",format:e=>m(e),sortable:!0},{name:"actions",align:"right",label:"Acciones",field:"actions"}],{mutateAsync:o}=ge(),f=e=>{S.fire({title:"\xBFEst\xE1 seguro de eliminar este registro?",text:"No podra deshacer los cambios!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No",showLoaderOnConfirm:!0,preConfirm:async()=>{await o(e,{onSuccess:async()=>{r("destroyOne",e)},onError:()=>{S.hideLoading()}})},allowOutsideClick:()=>!S.isLoading()})};return(e,b)=>(c(),_(_e,{columns:u,data:n.data,loading:n.loading,"row-key":"id","show-grid-toggle":!1},{actions:d(({key:v})=>[a(Se,{id:v,onEdit:l=>e.$emit("edit",v),onDestroy:l=>f(v)},null,8,["id","onEdit","onDestroy"])]),_:1},8,["data","loading"]))}}),qe=$({__name:"TriajeTab",setup(n){const{paciente:s,triajesDelPaciente:r,isTriajesLoading:m}=J(E()),{fetchTriajesDelPaciente:u}=E(),o=T("list"),f=T(),e=async()=>{s.value&&(await u(s.value.id),o.value="list")},b=async v=>{o.value="edit",f.value=Number(v)};return(v,l)=>p(s)?(c(),_(oe,{key:0,modelValue:o.value,"onUpdate:modelValue":l[4]||(l[4]=t=>o.value=t),animated:"",class:""},{default:d(()=>[a(F,{name:"list"},{default:d(()=>[a(z,{color:"primary",icon:"add",outline:"",label:"Nuevo",class:"q-mb-md",onClick:l[0]||(l[0]=t=>o.value="new")}),a(xe,{data:p(r),loading:p(m),onDestroyOne:l[1]||(l[1]=t=>p(u)(p(s).id)),onEdit:b},null,8,["data","loading"])]),_:1}),a(F,{name:"new"},{default:d(()=>[a(se,{"paciente-id":Number(p(s).id),onCancel:l[2]||(l[2]=t=>o.value="list"),onSubmit:e},null,8,["paciente-id"])]),_:1}),a(F,{name:"edit"},{default:d(()=>[f.value?(c(),_(Te,{key:0,"triaje-id":f.value,onCancel:l[3]||(l[3]=t=>o.value="list"),onSubmit:e},null,8,["triaje-id"])):x("",!0)]),_:1})]),_:1},8,["modelValue"])):x("",!0)}}),Ce={class:"row q-col-gutter-md"},we={class:"col-12"},ke=$({__name:"TriajeRegistroPage",setup(n){const{fetchPaciente:s,$reset:r,fetchTriajesDelPaciente:m}=E(),{paciente:u,isPacienteLoading:o}=J(E()),{data:f}=re(),e=le(()=>f.value?f.value.map(t=>({label:t.nombre,value:t.id})):[]),b=w().shape({numero_documento:G().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:ce().required().label("Tipo de Documento")}),{handleSubmit:v}=V({validationSchema:b}),l=v(async t=>{await s(t.numero_documento),u.value?S.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}):S.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})});return ue(()=>{r()}),M(()=>u.value,async t=>{t&&(console.log("hay paciente, debeiramos buscar su triaje"),await m(t.id))}),(t,g)=>(c(),h("div",Ce,[a(fe,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:p(l)},{default:d(()=>[a(de,{options:e.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),a(k,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),a(me,{class:"col-auto justify-center"},{default:d(()=>[a(z,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:p(o)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),pe("div",we,[a(R,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear"},{default:d(()=>[a(be,{paciente:p(u),onCancel:p(r),onSubmit:g[0]||(g[0]=y=>p(s)(y))},null,8,["paciente","onCancel"])]),_:1}),p(u)?(c(),_(R,{key:0,icon:"fas fa-stethoscope",label:"Triaje",caption:"Editar / Crear"},{default:d(()=>[a(qe)]),_:1})):x("",!0)])]))}});export{ke as default};
