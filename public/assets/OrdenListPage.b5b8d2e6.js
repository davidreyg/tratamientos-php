import{aH as W,aI as X,W as K,Y as M,r as x,k as z,$ as Z,a0 as b,b1 as D,aV as B,a1 as ee,ag as ae,H as j,o as _,e as p,w as t,a5 as a,ad as v,aX as te,aY as Q,f as E,ac as S,aj as V,aD as ie,a2 as n,au as F,aa as se,ba as oe,bb as ne,ak as le,am as U,ae as re,a6 as ce,bc as ue,al as de}from"./index.4a4b5f86.js";import{u as me}from"./establecimientoFetchAllQuery.5ff4a9f4.js";import{u as fe}from"./examenFetchAllQuery.fc3a579b.js";import{O as H}from"./OrdenApi.ec4e43af.js";import{u as _e}from"./paqueteFetchAllQuery.5714154c.js";import{_ as be}from"./ExamenCardList.b8f78ab8.js";import{_ as ve}from"./BaseCheckBoxGroup.440122b5.js";import{u as pe,_ as ge}from"./OrdenTable.afbb30ca.js";import{u as G}from"./laboratorio.store.bf529a63.js";import"./ExamenApi.d016762f.js";import"./PaqueteApi.69797540.js";import"./BaseTable.27f6cbd6.js";function ye(g,y){const s=async()=>(await H.fetchById(g.value)).data().data,{data:l,isLoading:d,isSuccess:r,isError:c,isFetching:C,refetch:$}=W([X.ORDEN_ALL,g.value],s,{enabled:y});return{data:l,isLoading:d,isSuccess:r,isError:c,isFetching:C,refetch:$}}function qe(){return K(({id:g,data:y})=>H.update(g,y))}const he={class:"col-12"},xe={class:"col-12"},Ee={class:"col-12 row q-col-gutter-sm"},Ce=M({__name:"OrdenEditForm",props:{orden:{type:Object,required:!0}},emits:["submit","cancel"],setup(g,{emit:y}){const s=g,l=y,d=x({limit:0,search:"is_active:1",searchJoin:"and"}),{data:r}=fe(d),{data:c}=_e(),C=z(()=>c.value?c.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),$=x({limit:0}),{data:k}=me($),I=z(()=>k.value?k.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),L=Z().shape({diagnostico:b().trim().min(2).required().label("Diagnostico"),CI10:b().trim().min(2).required().label("CI10"),CPN:b().trim().min(2).required().label("CPN"),EG:b().trim().min(2).required().label("EG"),codigo_atencion:b().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:b().trim().required().label("Fecha de Registro"),medico:b().trim().required().label("M\xE9dico"),examen_ids:D().of(B().required()).required().label("Examenes"),item_ids:D().of(B().required()).required().label("Items"),paquete_ids:D().of(B().required()).required().label("Paquetes"),establecimiento_id:B().when([],{is:()=>h.value===!0,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Establecimiento Institucional"),establecimiento_otro:b().when([],{is:()=>h.value===!1,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Otro Establecimiento")}),{values:q,setFieldValue:w,handleSubmit:P}=ee({validationSchema:L,initialValues:{...s.orden,paquete_ids:[]}}),h=x(!!s.orden.establecimiento_id),{mutateAsync:o,reset:A,isLoading:m}=qe(),T=P(async(e,{setErrors:i,resetForm:u})=>{await o({id:s.orden.id,data:e},{onSuccess:()=>{ae.success("Orden Actualizada correctamente."),u(),l("submit")},onError:f=>{A.value(),i(f.data.errors)}})},e=>{console.log(e)});j(()=>q.examen_ids,e=>{var i;if(e){const u=(i=c.value)==null?void 0:i.filter(N=>N.examen_ids.every(O=>e.includes(O)));w("paquete_ids",(u==null?void 0:u.map(N=>Number(N.id)))||[]);let f=[];r.value&&(f=[],e.forEach(N=>{const O=r.value.find(R=>Number(R.id)===N);if(O&&O.items.data.length>0){const R=O.items.data.map(J=>Number(J.id));f.push(...R)}}),w("item_ids",[...new Set(f)]),console.log(q.item_ids))}});const Y=e=>{var i;if(e){const u=(i=c.value)==null?void 0:i.filter(f=>e.includes(Number(f.id))).map(f=>f.examen_ids).flat();w("examen_ids",[...new Set(u)])}};return(e,i)=>(_(),p(se,{loading:n(m),onSubmit:n(T),onCancel:i[2]||(i[2]=u=>e.$emit("cancel"))},{default:t(()=>[a(v,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:""}),h.value?(_(),p(te,{key:0,options:I.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:""},{after:t(()=>[a(S,{round:"",flat:"",icon:"fas fa-building-circle-arrow-right",color:"primary",onClick:i[0]||(i[0]=u=>h.value=!1)},{default:t(()=>[a(Q,null,{default:t(()=>[E(" Otro establecimiento ")]),_:1})]),_:1})]),_:1},8,["options"])):(_(),p(v,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:""},{after:t(()=>[a(S,{round:"",flat:"",icon:"fas fa-building-circle-xmark",color:"negative",onClick:i[1]||(i[1]=u=>h.value=!0)},{default:t(()=>[a(Q,null,{default:t(()=>[E(" Establecimiento institucional")]),_:1})]),_:1})]),_:1})),a(v,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:""}),a(v,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:""}),a(v,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:""}),a(v,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:""}),a(v,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:""}),a(v,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:""}),V("div",he,[a(ie,{spaced:""}),E(" Paquetes")]),V("div",xe,[a(ve,{name:"paquete_ids",label:"Paquetes",options:C.value,onUpdate:Y},null,8,["options"])]),V("div",Ee,[n(r)?(_(),p(be,{key:0,examens:n(r)},null,8,["examens"])):F("",!0)])]),_:1},8,["loading","onSubmit"]))}}),$e={class:"row q-col-gutter-md"},ke={class:"col-12"},Re=M({__name:"OrdenListPage",setup(g){const{$reset:y}=G(),{ordenSeleccionada:s}=oe(G()),l=x({}),d=x(0),r=x(""),{data:c,isFetching:C,refetch:$}=pe(l),{data:k,isFetching:I,refetch:L}=ye(d,!!d.value),q=x("list"),w=o=>{l.value.page=o.pagination.page,l.value.limit=o.pagination.rowsPerPage,l.value.search=o.filter,l.value.orderBy=o.pagination.sortBy,l.value.sortedBy=o.pagination.descending?"desc":"asc"},P=async()=>{s.value=void 0,await $.value()},h=async o=>{s.value=void 0,d.value=o,r.value="edit",await L.value(),k.value&&(s.value=k.value,q.value="edit-orden")};return ne(()=>{y()}),j(()=>s.value,o=>{o||(q.value="list")}),(o,A)=>(_(),le("div",$e,[V("div",ke,[a(de,{modelValue:q.value,"onUpdate:modelValue":A[0]||(A[0]=m=>q.value=m),animated:""},{default:t(()=>[a(U,{name:"list"},{default:t(()=>[n(c)?(_(),p(ge,{key:0,ordens:n(c).data,"server-pagination":n(c).meta.pagination,loading:n(C),onRequest:w},{"custom-actions":t(({props:m})=>[m.row.estado===0?(_(),p(S,{key:0,color:"warning",icon:"fas fa-edit",round:"",flat:"",size:"sm",loading:r.value==="edit"&&n(I)&&d.value===Number(m.key),onClick:T=>h(Number(m.key))},{default:t(()=>[a(Q,null,{default:t(()=>[E("Editar Orden.")]),_:1})]),_:2},1032,["loading","onClick"])):F("",!0),a(S,{color:"primary",icon:"fas fa-eye",round:"",flat:"",size:"sm",loading:r.value==="view"&&n(I)&&d.value===Number(m.key)},{default:t(()=>[a(Q,null,{default:t(()=>[E("Visualizar Orden.")]),_:1})]),_:2},1032,["loading"]),m.row.estado===2?(_(),p(S,{key:1,color:"info",icon:"fas fa-print",round:"",flat:"",size:"sm"},{default:t(()=>[a(Q,null,{default:t(()=>[E("Imprimir.")]),_:1})]),_:1})):F("",!0)]),_:1},8,["ordens","server-pagination","loading"])):F("",!0)]),_:1}),a(U,{name:"edit-orden"},{default:t(()=>[n(s)?(_(),p(ue,{key:0,icon:"fas fa-file-signature",label:"Datos de la orden."},{default:t(()=>[a(re,{class:"my-card"},{default:t(()=>[a(ce,null,{default:t(()=>[a(Ce,{orden:n(s),onSubmit:P,onCancel:P},null,8,["orden"])]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1})]),_:1},8,["modelValue"])])]))}});export{Re as default};
