var Ce=Object.defineProperty;var Fe=(r,l,d)=>l in r?Ce(r,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):r[l]=d;var V=(r,l,d)=>(Fe(r,typeof l!="symbol"?l+"":l,d),d);import{aG as oe,aH as se,U as Ke,f as Ie,M as Pe,N as Ee,r as Q,bl as Ae,j as K,G as J,k as b,n as Oe,S as Ne,z as pe,ar as Le,Q as W,b2 as Re,x as ie,bm as je,v as ze,b7 as Qe,bn as le,a as Be,bo as ce,X as $e,o as R,aj as G,a1 as O,d as Me,w as j,e as Ue,ad as De,at as H,a4 as z,ab as Ve,aa as Ge,ai as X,as as de,af as He}from"./index.0b61b42a.js";import{R as ue}from"./RoleApi.b85f5dd5.js";class Xe{static async run(l){try{return(await ue.fetchRolePrivilegios(l)).data().data}catch(d){throw d}}}function Je(r,l){const d=async()=>await Xe.run(r),{data:C,isLoading:_,isSuccess:q,isError:f,isFetching:h,refetch:u}=oe([se.ROLES_ALL,r,"privilegios"],d,{enabled:l});return{data:C,isLoading:_,isSuccess:q,isError:f,isFetching:h,refetch:u}}function We(){return Ke(({data:r,id:l})=>ue.syncRolePrivilegios(l,r))}const Ye=["none","strict","leaf","leaf-filtered"];var Ze=Ie({name:"QTree",props:{...Pe,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:r=>Ye.includes(r)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:Number,noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(r,{slots:l,emit:d}){const{proxy:C}=Oe(),{$q:_}=C,q=Ee(r,_),f=Q({}),h=Q(r.ticked||[]),u=Q(r.expanded||[]);let c={};Ae(()=>{c={}});const F=K(()=>`q-tree q-tree--${r.dense===!0?"dense":"standard"}`+(r.noConnectors===!0?" q-tree--no-connectors":"")+(q.value===!0?" q-tree--dark":"")+(r.color!==void 0?` text-${r.color}`:"")),y=K(()=>r.selected!==void 0),m=K(()=>r.icon||_.iconSet.tree.icon),w=K(()=>r.controlColor||r.color),I=K(()=>r.textColor!==void 0?` text-${r.textColor}`:""),S=K(()=>{const t=r.selectedColor||r.color;return t?` text-${t}`:""}),T=K(()=>r.filterMethod!==void 0?r.filterMethod:(t,n)=>{const e=n.toLowerCase();return t[r.labelKey]&&t[r.labelKey].toLowerCase().indexOf(e)>-1}),k=K(()=>{const t={},n=(e,i)=>{const a=e.tickStrategy||(i?i.tickStrategy:r.tickStrategy),s=e[r.nodeKey],v=e[r.childrenKey]&&Array.isArray(e[r.childrenKey])&&e[r.childrenKey].length!==0,E=e.disabled!==!0&&y.value===!0&&e.selectable!==!1,x=e.disabled!==!0&&e.expandable!==!1,Se=a!=="none",L=a==="strict",ne=a==="leaf-filtered",U=a==="leaf"||a==="leaf-filtered";let D=e.disabled!==!0&&e.tickable!==!1;U===!0&&D===!0&&i&&i.tickable!==!0&&(D=!1);let A=e.lazy;A===!0&&f.value[s]!==void 0&&Array.isArray(e[r.childrenKey])===!0&&(A=f.value[s]);const o={key:s,parent:i,isParent:v,lazy:A,disabled:e.disabled,link:e.disabled!==!0&&(E===!0||x===!0&&(v===!0||A===!0)),children:[],matchesFilter:r.filter?T.value(e,r.filter):!0,selected:s===r.selected&&E===!0,selectable:E,expanded:v===!0?u.value.includes(s):!1,expandable:x,noTick:e.noTick===!0||L!==!0&&A&&A!=="loaded",tickable:D,tickStrategy:a,hasTicking:Se,strictTicking:L,leafFilteredTicking:ne,leafTicking:U,ticked:L===!0?h.value.includes(s):v===!0?!1:h.value.includes(s)};if(t[s]=o,v===!0&&(o.children=e[r.childrenKey].map(g=>n(g,o)),r.filter&&(o.matchesFilter!==!0?o.matchesFilter=o.children.some(g=>g.matchesFilter):o.noTick!==!0&&o.disabled!==!0&&o.tickable===!0&&ne===!0&&o.children.every(g=>g.matchesFilter!==!0||g.noTick===!0||g.tickable!==!0)===!0&&(o.tickable=!1)),o.matchesFilter===!0&&(o.noTick!==!0&&L!==!0&&o.children.every(g=>g.noTick)===!0&&(o.noTick=!0),U))){if(o.ticked=!1,o.indeterminate=o.children.some(g=>g.indeterminate===!0),o.tickable=o.tickable===!0&&o.children.some(g=>g.tickable),o.indeterminate!==!0){const g=o.children.reduce((ae,qe)=>qe.ticked===!0?ae+1:ae,0);g===o.children.length?o.ticked=!0:g>0&&(o.indeterminate=!0)}o.indeterminate===!0&&(o.indeterminateNextState=o.children.every(g=>g.tickable!==!0||g.ticked!==!0))}return o};return r.nodes.forEach(e=>n(e,null)),t});J(()=>r.ticked,t=>{h.value=t}),J(()=>r.expanded,t=>{u.value=t});function P(t){const n=[].reduce,e=(i,a)=>{if(i||!a)return i;if(Array.isArray(a)===!0)return n.call(Object(a),e,i);if(a[r.nodeKey]===t)return a;if(a[r.childrenKey])return e(null,a[r.childrenKey])};return e(null,r.nodes)}function he(){return h.value.map(t=>P(t))}function ye(){return u.value.map(t=>P(t))}function ve(t){return t&&k.value[t]?k.value[t].expanded:!1}function ge(){r.expanded!==void 0?d("update:expanded",[]):u.value=[]}function Y(){const t=[],n=e=>{e[r.childrenKey]&&e[r.childrenKey].length!==0&&e.expandable!==!1&&e.disabled!==!0&&(t.push(e[r.nodeKey]),e[r.childrenKey].forEach(n))};r.nodes.forEach(n),r.expanded!==void 0?d("update:expanded",t):u.value=t}function $(t,n,e=P(t),i=k.value[t]){if(i.lazy&&i.lazy!=="loaded"){if(i.lazy==="loading")return;f.value[t]="loading",Array.isArray(e[r.childrenKey])!==!0&&(e[r.childrenKey]=[]),d("lazyLoad",{node:e,key:t,done:a=>{f.value[t]="loaded",e[r.childrenKey]=Array.isArray(a)===!0?a:[],Ne(()=>{const s=k.value[t];s&&s.isParent===!0&&Z(t,!0)})},fail:()=>{delete f.value[t],e[r.childrenKey].length===0&&delete e[r.childrenKey]}})}else i.isParent===!0&&i.expandable===!0&&Z(t,n)}function Z(t,n){let e=u.value;const i=r.expanded!==void 0;if(i===!0&&(e=e.slice()),n){if(r.accordion&&k.value[t]){const a=[];k.value[t].parent?k.value[t].parent.children.forEach(s=>{s.key!==t&&s.expandable===!0&&a.push(s.key)}):r.nodes.forEach(s=>{const v=s[r.nodeKey];v!==t&&a.push(v)}),a.length!==0&&(e=e.filter(s=>a.includes(s)===!1))}e=e.concat([t]).filter((a,s,v)=>v.indexOf(a)===s)}else e=e.filter(a=>a!==t);i===!0?d("update:expanded",e):u.value=e}function ke(t){return t&&k.value[t]?k.value[t].ticked:!1}function p(t,n){let e=h.value;const i=r.ticked!==void 0;i===!0&&(e=e.slice()),n?e=e.concat(t).filter((a,s,v)=>v.indexOf(a)===s):e=e.filter(a=>t.includes(a)===!1),i===!0&&d("update:ticked",e)}function be(t,n,e){const i={tree:C,node:t,key:e,color:r.color,dark:q.value};return le(i,"expanded",()=>n.expanded,a=>{a!==n.expanded&&$(e,a)}),le(i,"ticked",()=>n.ticked,a=>{a!==n.ticked&&p([e],a)}),i}function ee(t){return(r.filter?t.filter(n=>k.value[n[r.nodeKey]].matchesFilter):t).map(n=>me(n))}function _e(t){if(t.icon!==void 0)return b(W,{class:"q-tree__icon q-mr-sm",name:t.icon,color:t.iconColor});const n=t.img||t.avatar;if(n)return b("img",{class:`q-tree__${t.img?"img":"avatar"} q-mr-sm`,src:n})}function xe(){d("afterShow")}function Te(){d("afterHide")}function me(t){const n=t[r.nodeKey],e=k.value[n],i=t.header&&l[`header-${t.header}`]||l["default-header"],a=e.isParent===!0?ee(t[r.childrenKey]):[],s=a.length!==0||e.lazy&&e.lazy!=="loaded";let v=t.body&&l[`body-${t.body}`]||l["default-body"];const E=i!==void 0||v!==void 0?be(t,e,n):null;return v!==void 0&&(v=b("div",{class:"q-tree__node-body relative-position"},[b("div",{class:I.value},[v(E)])])),b("div",{key:n,class:`q-tree__node relative-position q-tree__node--${s===!0?"parent":"child"}`},[b("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(e.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(e.selected===!0?" q-tree__node--selected":"")+(e.disabled===!0?" q-tree__node--disabled":""),tabindex:e.link===!0?0:-1,ariaExpanded:a.length>0?e.expanded:null,role:"treeitem",onClick:x=>{re(t,e,x)},onKeypress(x){pe(x)!==!0&&(x.keyCode===13?re(t,e,x,!0):x.keyCode===32&&M(t,e,x,!0))}},[b("div",{class:"q-focus-helper",tabindex:-1,ref:x=>{c[e.key]=x}}),e.lazy==="loading"?b(Le,{class:"q-tree__spinner",color:w.value}):s===!0?b(W,{class:"q-tree__arrow"+(e.expanded===!0?" q-tree__arrow--rotate":""),name:m.value,onClick(x){M(t,e,x)}}):null,e.hasTicking===!0&&e.noTick!==!0?b(Re,{class:"q-tree__tickbox",modelValue:e.indeterminate===!0?null:e.ticked,color:w.value,dark:q.value,dense:!0,keepColor:!0,disable:e.tickable!==!0,onKeydown:ie,"onUpdate:modelValue":x=>{we(e,x)}}):null,b("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(e.selected===!0?S.value:I.value)},[i?i(E):[_e(t),b("div",t[r.labelKey])]])]),s===!0?r.noTransition===!0?e.expanded===!0?b("div",{class:"q-tree__node-collapsible"+I.value,key:`${n}__q`},[v,b("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},a)]):null:b(je,{duration:r.duration,onShow:xe,onHide:Te},()=>ze(b("div",{class:"q-tree__node-collapsible"+I.value,key:`${n}__q`},[v,b("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},a)]),[[Qe,e.expanded]])):v])}function te(t){const n=c[t];n&&n.focus()}function re(t,n,e,i){i!==!0&&n.selectable!==!1&&te(n.key),y.value&&n.selectable?r.noSelectionUnset===!1?d("update:selected",n.key!==r.selected?n.key:null):n.key!==r.selected&&d("update:selected",n.key===void 0?null:n.key):M(t,n,e,i),typeof t.handler=="function"&&t.handler(t)}function M(t,n,e,i){e!==void 0&&ie(e),i!==!0&&n.selectable!==!1&&te(n.key),$(n.key,!n.expanded,t,n)}function we(t,n){if(t.indeterminate===!0&&(n=t.indeterminateNextState),t.strictTicking)p([t.key],n);else if(t.leafTicking){const e=[],i=a=>{a.isParent?(n!==!0&&a.noTick!==!0&&a.tickable===!0&&e.push(a.key),a.leafTicking===!0&&a.children.forEach(i)):a.noTick!==!0&&a.tickable===!0&&(a.leafFilteredTicking!==!0||a.matchesFilter===!0)&&e.push(a.key)};i(t),p(e,n)}}return r.defaultExpandAll===!0&&Y(),Object.assign(C,{getNodeByKey:P,getTickedNodes:he,getExpandedNodes:ye,isExpanded:ve,collapseAll:ge,expandAll:Y,setExpanded:$,isTicked:ke,setTicked:p}),()=>{const t=ee(r.nodes);return b("div",{class:F.value,role:"tree"},t.length===0?r.filter?r.noResultsLabel||_.lang.tree.noResults:r.noNodesLabel||_.lang.tree.noNodes:t)}}});const B=class{static async fetchAll(l){return await B._api.get(B._endpoint,l)}};let N=B;V(N,"_api",Be),V(N,"_endpoint","/privilegios");class et{static async run(l){try{return(await N.fetchAll(l)).data().data}catch(d){throw d}}}function tt(){const r=async()=>await et.run(),{data:l,isLoading:d,isSuccess:C,isError:_,isFetching:q,refetch:f}=oe([se.PRIVILEGIO_ALL],r);return{data:l,isLoading:d,isSuccess:C,isError:_,isFetching:q,refetch:f}}var fe={};(function(r){var l=ce&&ce.__assign||function(){return(l=Object.assign||function(f){for(var h,u=1,c=arguments.length;u<c;u++)for(var F in h=arguments[u])Object.prototype.hasOwnProperty.call(h,F)&&(f[F]=h[F]);return f}).apply(this,arguments)},d=(Object.defineProperty(r,"__esModule",{value:!0}),{id:"id",parentId:"parentId",dataField:"data",childrenField:"children",throwIfOrphans:!1,rootParentIds:{"":!(r.countNodes=r.arrayToTree=void 0)},nestedIds:!0,assign:!1});function C(f,h){h===void 0&&(h={});for(var u,c=l(l({},d),h),F=[],y={},m=c.throwIfOrphans?new Set:null,w=0,I=f;w<I.length;w++){var S=I[w],T=c.nestedIds?q(S,c.id):S[c.id],k=c.nestedIds?q(S,c.parentId):S[c.parentId];if(c.rootParentIds[T])throw new Error("The item array contains a node whose parentId both exists in another node and is in "+'`rootParentIds` (`itemId`: "'.concat(T,'", `rootParentIds`: ').concat(Object.keys(c.rootParentIds).map(function(P){return'"'.concat(P,'"')}).join(", "),")."));Object.prototype.hasOwnProperty.call(y,T)||(y[T]=((u={})[c.childrenField]=[],u)),m&&m.delete(T),c.dataField?y[T][c.dataField]=S:c.assign?y[T]=Object.assign(S,((u={})[c.childrenField]=y[T][c.childrenField],u)):y[T]=l(l({},S),((S={})[c.childrenField]=y[T][c.childrenField],S)),S=y[T],k==null||c.rootParentIds[k]?F.push(S):(Object.prototype.hasOwnProperty.call(y,k)||(y[k]=((T={})[c.childrenField]=[],T),m&&m.add(k)),y[k][c.childrenField].push(S))}if(m!=null&&m.size)throw new Error("The items array contains orphans that point to the following parentIds: "+"[".concat(Array.from(m),"]. These parentIds do not exist in the items array. Hint: prevent orphans to result ")+"in an error by passing the following option: { throwIfOrphans: false }");if(c.throwIfOrphans&&_(F,c.childrenField)<Object.keys(y).length)throw new Error("The items array contains nodes with a circular parent/child relationship.");return F}function _(f,h){return f.reduce(function(u,c){return u+1+(c[h]&&_(c[h],h))},0)}function q(f,h){return h.split(".").reduce(function(u,c){return u&&u[c]},f)}r.arrayToTree=C,r.countNodes=_})(fe);const rt={class:"row"},nt={key:1,class:"col-12 row q-col-gutter-sm"},at={class:"row items-center q-ml-sm"},it={class:""},lt={key:0},ct={class:"text-weight-thin"},ut=$e({__name:"RolePrivilegiosPage",props:{id:{type:Number,required:!0}},setup(r){const l=r,{data:d,isSuccess:C,isFetching:_}=tt(),{data:q}=Je(l.id,!!_.value),f=Q([]),h=K(()=>d.value?fe.arrayToTree(d.value,{parentId:"parent_id",dataField:null}):[]),{mutate:u,isLoading:c}=We(),F=()=>{u({data:f.value,id:l.id},{onSuccess:()=>{He.success("Privilegios otorgados correctamente")},onError:y=>{console.log(y)}})};return J(()=>q.value,y=>{y&&(f.value=y.map(m=>m.id.toString()))},{immediate:!0}),(y,m)=>(R(),G("div",rt,[O(_)?(R(),Me(De,{key:0,class:"col-12 q-pa-lg"},{default:j(()=>[Ue(" loading... ")]),_:1})):H("",!0),O(C)&&!O(_)&&O(d)?(R(),G("div",nt,[z(Ge,{align:"center"},{default:j(()=>[z(Ve,{label:"Guardar",icon:"fas fa-floppy-disk",color:"primary","no-caps":"",loading:O(c),onClick:F},null,8,["loading"])]),_:1}),z(Ze,{ticked:f.value,"onUpdate:ticked":m[0]||(m[0]=w=>f.value=w),class:"col-12","tick-strategy":"strict",nodes:h.value,"node-key":"id","label-key":"nombre","default-expand-all":""},{"default-header":j(w=>[X("div",at,[z(W,{name:w.node.icono,class:"q-mr-sm"},null,8,["name"]),X("div",it,de(w.node.nombre),1)])]),"default-body":j(w=>[w.node.parent_id!=null?(R(),G("div",lt,[X("span",ct,"Ruta: "+de(w.node.ruta),1)])):H("",!0)]),_:1},8,["ticked","nodes"])])):H("",!0)]))}});export{ut as default};
