import{aE as R,aF as P,aR as $,W as O,Y as S,aT as U,k as g,$ as j,a0 as d,aU as h,a1 as W,aV as Y,H as z,o as _,e as E,w as x,aW as N,au as q,a5 as a,ac as H,a2 as r,aX as X,f as Z,ad as m,aj as G,aY as J,aZ as K,aa as ee,a_ as ae,aI as oe,ay as se,ak as le,ae as re,ag as ne}from"./index.d215a0e8.js";import{_ as te}from"./SkeletonForm.caf6823c.js";import{u as ie}from"./cargoFetchAllQuery.dd372d3c.js";import{u as ce}from"./establecimientoFetchAllQuery.e7744208.js";function ue(s,n){const f=async()=>(await $.fetchById(s)).data().data,{data:t,isLoading:p,isSuccess:l,isError:b,isFetching:v,refetch:i}=R([P.EMPLEADOS_ALL,s],f,{enabled:n});return{data:t,isLoading:p,isSuccess:l,isError:b,isFetching:v,refetch:i}}function de(){return O(({data:s,id:n})=>$.update(s,n))}const me={class:"col-xs-12 col-sm-4"},pe=S({__name:"EmpleadoEditForm",props:{empleado:{type:Object,required:!0}},emits:["submit","cancel"],setup(s,{emit:n}){const f=n,t=s,{data:p}=U(),l=g(()=>p.value?p.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:b}=ce(),v=g(()=>b.value?b.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:i}=ie(),F=g(()=>i.value?i.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),k=g(()=>{const e=l.value.find(o=>o.value==Number(y.tipo_documento_id));return e?e.label==="DNI":!1}),A=j().shape({nombres:d().trim().required().label("Nombres"),apellido_paterno:d().trim().required().label("Apellido Paterno"),apellido_materno:d().trim().required().label("Apellido Materno"),tipo_documento_id:d().required().label("Tipo de Documento"),direccion:d().trim().required().label("Direccion"),numero_documento:h().typeError("Debe ingresar un n\xFAmero").required().label("N\xFAmero de Documento"),fecha_nacimiento:d().trim().required().label("Fecha de Nacimiento"),telefono:h().typeError("Tel\xE9fono debe ser un numero").integer().positive().required().label("Tel\xE9fono"),edad:h().typeError("Edad debe ser un numero").integer().positive().required().label("Edad"),sexo:d().required().label("Sexo")}),{handleSubmit:D,setErrors:T,values:y,setFieldValue:c,resetForm:C}=W({validationSchema:A,initialValues:t.empleado}),{isLoading:Q,mutate:B}=de(),L=D(async e=>{B({data:e,id:t.empleado.id},{onSuccess:()=>{f("submit")},onError:o=>{T(o.data.errors)}})},e=>console.log(e)),{fetch:M,reniec:u,isLoading:V}=Y(),w=async()=>{if(await M(y.numero_documento),u.value){c("nombres",u.value.nombres),c("apellido_paterno",u.value.apellido_paterno),c("apellido_materno",u.value.apellido_materno),c("direccion",u.value.direccion),c("sexo",u.value.sexo==="1"?"Masculino":"Femenino");var e=u.value.fecha_nacimiento.split("/");const o=ae.local(Number(e[2]),Number(e[1]),Number(e[0]));o.isValid&&c("fecha_nacimiento",o.toISODate())}else C()},{calcularEdad:I}=oe();return z(()=>y.fecha_nacimiento,e=>{e&&c("edad",I(e))}),(e,o)=>(_(),E(ee,{loading:r(Q),onSubmit:r(L),onCancel:o[0]||(o[0]=_e=>e.$emit("cancel"))},{default:x(()=>[l.value.length>0?(_(),E(N,{key:0,options:l.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"])):q("",!0),a(m,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""},{after:x(()=>[k.value?(_(),E(H,{key:0,round:"",dense:"",icon:"search",color:"primary",loading:r(V),onClick:w},{default:x(()=>[a(X,null,{default:x(()=>[Z(" Buscar en RENIEC ")]),_:1})]),_:1},8,["loading"])):q("",!0)]),_:1}),a(N,{options:v.value,name:"establecimiento_id",class:"col-xs-12 col-sm-4",label:"Establecimiento",loading:!1,required:""},null,8,["options"]),a(N,{options:F.value,name:"cargo_id",class:"col-xs-12 col-sm-4",label:"Cargo",loading:!1,required:""},null,8,["options"]),a(m,{name:"nombres",label:"Nombres",class:"col-xs-12 col-sm-4",required:""}),a(m,{name:"apellido_paterno",label:"Apellido Paterno",class:"col-xs-12 col-sm-4",required:""}),a(m,{name:"apellido_materno",label:"Apellido Materno",class:"col-xs-12 col-sm-4",required:""}),G("div",me,[a(J,{required:"",name:"fecha_nacimiento",label:"Fecha Nacimiento"})]),a(m,{name:"direccion",label:"Direcci\xF3n",class:"col-xs-12 col-sm-4",required:""}),a(m,{name:"telefono",label:"Tel\xE9fono",class:"col-xs-12 col-sm-4",required:""}),a(m,{name:"edad",label:"Edad",class:"col-xs-12 col-sm-4",required:""}),a(K,{required:"",options:[{label:"Masculino",value:"Masculino"},{label:"Femenino",value:"Femenino"}],name:"sexo",label:"Sexo",class:"col-xs-12 col-sm-8"})]),_:1},8,["loading","onSubmit"]))}}),be={class:"row"},ge=S({__name:"EmpleadoEditPage",props:{id:{type:Number,required:!0}},setup(s){const n=s,f=se(),{data:t,isSuccess:p,isFetching:l}=ue(n.id,!0),b=()=>{ne.success("Registro actualizado correctamente"),f.back()};return(v,i)=>(_(),le("div",be,[r(l)?(_(),E(re,{key:0,class:"col-12 q-pa-lg"},{default:x(()=>[a(te,{class:"col-12",inputs:2})]),_:1})):q("",!0),r(p)&&!r(l)&&r(t)?(_(),E(pe,{key:1,empleado:r(t),onSubmit:b,onCancel:i[0]||(i[0]=F=>v.$router.back())},null,8,["empleado"])):q("",!0)]))}});export{ge as default};
