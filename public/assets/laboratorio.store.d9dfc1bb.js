var U=Object.defineProperty;var A=(i,e,t)=>e in i?U(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var w=(i,e,t)=>(A(i,typeof e!="symbol"?e+"":e,t),t);import{a as T,W as R,Y as j,k as I,$ as H,a0 as d,b4 as F,aS as C,a1 as W,r as b,ag as Y,H as z,o as E,e as N,w as f,a5 as s,ad as m,aU as J,aV as k,f as P,ac as B,aj as S,aP as K,a2 as O,aa as X,b5 as Z,b6 as ee}from"./index.f6335575.js";import{u as ae}from"./establecimientoFetchAllQuery.a8f000e4.js";import{u as te}from"./paqueteFetchAllQuery.67cc79d0.js";import{_ as ie}from"./ExamenCardList.16584f46.js";import{_ as se}from"./BaseCheckBoxGroup.06666695.js";const n=class{static fetchAll(e){return n._api.get(`${n._endpoint}`,e)}static fetchById(e){return n._api.get(`${n._endpoint}/${e}`)}static async create(e){await n._api.post(n._endpoint,e)}static async updateExamens(e,t){await n._api.patch(`${n._endpoint}/${e}/examens`,t)}static async updateEstado(e,t){await n._api.patch(`${n._endpoint}/${e}/status`,t)}};let _=n;w(_,"_api",T),w(_,"_endpoint","/ordens");function oe(){return R(i=>_.create(i))}const ne={class:"col-12"},re={class:"col-12"},le={class:"col-12 row q-col-gutter-sm"},be=j({__name:"OrdenCreateForm",props:{pacienteId:{type:Number,required:!0}},emits:["submit"],setup(i,{emit:e}){const t=i,p=e,{data:l}=te(),g=I(()=>l.value?l.value.map(a=>({label:a.nombre,value:Number(a.id)})):[]),{data:h}=ae(),x=I(()=>h.value?h.value.map(a=>({label:a.nombre,value:Number(a.id)})):[]),y=H().shape({diagnostico:d().trim().min(2).required().label("Diagnostico"),CI10:d().trim().min(2).required().label("CI10"),CPN:d().trim().min(2).required().label("CPN"),EG:d().trim().min(2).required().label("EG"),codigo_atencion:d().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:d().trim().required().label("Fecha de Registro"),medico:d().trim().required().label("M\xE9dico"),examen_ids:F().of(C().required()).required().label("Examenes"),paquete_ids:F().of(C().required()).required().label("Paquetes"),establecimiento_id:C().when([],{is:()=>q.value,then:a=>a.required(),otherwise:a=>a.optional()}).label("Establecimiento Institucional"),establecimiento_otro:d().when([],{is:()=>!q.value,then:a=>a.required(),otherwise:a=>a.optional()}).label("Otro Establecimiento")}),{values:$,setFieldValue:r,handleSubmit:v}=W({validationSchema:y,initialValues:{examen_ids:[],paquete_ids:[],paciente_id:t.pacienteId}}),q=b(!0),{mutateAsync:Q,reset:V,isLoading:D}=oe(),G=v(async(a,{setErrors:o,resetForm:c})=>{await Q(a,{onSuccess:()=>{Y.success("Orden registrada correctamente."),c(),p("submit")},onError:u=>{V.value(),o(u.data.errors)}})});z(()=>$.examen_ids,a=>{var o;if(a){const c=(o=l.value)==null?void 0:o.filter(u=>u.examen_ids.every(M=>a.includes(M)));r("paquete_ids",(c==null?void 0:c.map(u=>Number(u.id)))||[])}});const L=a=>{var o;if(a){const c=(o=l.value)==null?void 0:o.filter(u=>a.includes(Number(u.id))).map(u=>u.examen_ids).flat();r("examen_ids",[...new Set(c)])}};return(a,o)=>(E(),N(X,{loading:O(D),onSubmit:O(G)},{default:f(()=>[s(m,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:""}),q.value?(E(),N(J,{key:0,options:x.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:""},{after:f(()=>[s(B,{round:"",flat:"",icon:"fas fa-building-circle-arrow-right",color:"primary",onClick:o[0]||(o[0]=c=>q.value=!1)},{default:f(()=>[s(k,null,{default:f(()=>[P(" Otro establecimiento ")]),_:1})]),_:1})]),_:1},8,["options"])):(E(),N(m,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:""},{after:f(()=>[s(B,{round:"",flat:"",icon:"fas fa-building-circle-xmark",color:"negative",onClick:o[1]||(o[1]=c=>q.value=!0)},{default:f(()=>[s(k,null,{default:f(()=>[P(" Establecimiento institucional")]),_:1})]),_:1})]),_:1})),s(m,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:""}),s(m,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:""}),s(m,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:""}),s(m,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:""}),s(m,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:""}),s(m,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:""}),S("div",ne,[s(K,{spaced:""}),P(" Paquetes")]),S("div",re,[s(se,{name:"paquete_ids",label:"Paquetes",options:g.value,onUpdate:L},null,8,["options"])]),S("div",le,[s(ie)])]),_:1},8,["loading","onSubmit"]))}}),_e=Z("laboratorio-form",()=>{const i=b(),e=b(),t=b(),p=b(!1),l=b(!1);function g(){i.value=void 0,e.value=void 0,t.value=void 0}function h(r){i.value=r}function x(r){e.value=r}async function y(r){p.value=!0;try{i.value=void 0,i.value=await ee.run(r),p.value=!1}catch(v){throw p.value=!1,v}}async function $(r){l.value=!0;try{t.value=void 0,t.value=(await _.fetchById(r)).data().data,l.value=!1}catch(v){throw l.value=!1,v}}return{paciente:i,isPacienteLoading:p,isOrdenLoading:l,ordenesSeleccionada:e,ordenSeleccionada:t,$reset:g,setPaciente:h,fetchOrdenById:$,setOrdenesDelPaciente:x,fetchPaciente:y}});export{_ as O,be as _,_e as u};
