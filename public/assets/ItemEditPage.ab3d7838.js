import{aH as be,aI as _e,W as fe,Y as G,k as $,r as C,$ as B,a0 as T,aV as u,b6 as j,a1 as he,b7 as O,o as r,ak as d,a5 as s,w as l,aX as k,ad as S,a2 as a,aj as h,b8 as z,ac as E,at as Y,au as y,aQ as D,a9 as H,f as J,aE as K,aK as P,e as Q,a8 as W,x as ye,a7 as X,aa as xe,ag as I,b9 as ge,ay as qe,ae as $e}from"./index.e07e8f59.js";import{_ as ke}from"./SkeletonForm.69637e03.js";import{u as Se}from"./examenFetchAllQuery.2bab0b52.js";import{u as we,a as Ee}from"./respuestaFetchAllQuery.323d8c6b.js";import{I as Z}from"./ItemApi.396ec2a0.js";import{u as Qe}from"./seccionFetchAllQuery.9a9a77d3.js";import{u as Ue}from"./unidadFetchAllQuery.96a617b3.js";import"./ExamenApi.1d5c16f4.js";import"./SeccionApi.5f2e53bd.js";import"./UnidadApi.14d5f2c4.js";function Ce(n,c){const p=async()=>(await Z.fetchOne(n)).data().data,{data:m,isLoading:v,isSuccess:b,isError:x,isFetching:_,refetch:f}=be([_e.ITEM_ALL,n],p,{enabled:c});return{data:m,isLoading:v,isSuccess:b,isError:x,isFetching:_,refetch:f}}function Ie(){return fe(({data:n,id:c})=>Z.update(n,c))}const Ne={class:"row"},Fe={key:0,class:"col-xs-12 col-sm-12"},Re={class:"row"},Ve={key:0,class:"text-red text-italic"},Me={class:"row q-col-gutter-sm q-mb-sm"},Ae={class:"col-auto self-center"},Le={key:1,class:"col-xs-12 col-sm-12"},Be={class:"row"},Te={key:0,class:"text-red text-italic"},je={class:"row q-col-gutter-sm q-mb-sm"},Oe={class:"col-4 self-center"},ze=G({__name:"ItemEditForm",props:{item:{type:Object,required:!0}},emits:["submit","cancel"],setup(n,{emit:c}){const p=n,m=c,{data:v}=Qe(),b=$(()=>v.value?v.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),x=C({limit:0,search:"is_active:1",searchJoin:"and"}),{data:_}=Se(x),f=$(()=>_.value?_.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:U}=we(),ee=$(()=>U.value?Object.values(U.value).map(e=>({label:e,value:e})):[]),{data:N}=Ue(),F=$(()=>N.value?Object.values(N.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:R}=Ee(),V=$(()=>R.value?Object.values(R.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),g=C(),q=C(),se=B().shape({nombre:T().trim().min(2).required().label("Nombre"),codigo:u().typeError("Codigo debe ser un numero").positive().required().label("Codigo"),tipo:T().trim().min(2).required().label("Tipo"),seccion_id:u().required().label("Seccion"),examen_id:u().required().label("Examen"),pivot:j().when(["tipo"],{is:e=>e==="unidad",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(B().shape({unidad_id:u().typeError("Unidad debe ser un numero").positive().required().label("Unidad"),item_id:u().typeError("Item debe ser un numero").positive().label("Item"),minimo:u().typeError("Minimo debe ser un numero").positive().required().label("Minimo"),maximo:u().typeError("Maximo debe ser un numero").positive().required().label("Maximo")})).label("Unidades"),respuesta_ids:j().when(["tipo"],{is:e=>e==="respuesta",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(u().required()).label("Respuestas")}),{handleSubmit:ae,setErrors:te,values:M,errors:w}=he({validationSchema:se,initialValues:{...p.item}}),{remove:oe,push:le,fields:A}=O("pivot"),{remove:re,push:ie,fields:L}=O("respuesta_ids"),ne=e=>{if(A.value.some(o=>o.value.unidad_id===e.value)){I.warn("Ya has agregado este item");return}le({unidad_id:Number(e.value)}),g.value=void 0},ue=e=>{if(L.value.some(o=>o.value===e.value)){I.warn("Ya has agregado este item");return}ie(Number(e.value)),q.value=void 0},{isLoading:de,mutate:ce,reset:me}=Ie(),pe=ae(async e=>{ce({data:e,id:p.item.id},{onSuccess:()=>{m("submit")},onError:t=>{me.value(),te(t.data.errors)}})},e=>{console.log(e.errors)});return(e,t)=>(r(),d("div",Ne,[s(xe,{class:"col-xs-12 col-sm-10",loading:a(de),onSubmit:a(pe),onCancel:t[4]||(t[4]=o=>e.$emit("cancel"))},{default:l(()=>[s(k,{options:f.value,name:"examen_id",label:"Examen",class:"col-12"},null,8,["options"]),s(k,{options:b.value,name:"seccion_id",label:"Seccion",class:"col-xs-12 col-sm-6"},null,8,["options"]),s(S,{name:"codigo",label:"Codigo",class:"col-xs-12 col-sm-6"}),s(S,{name:"nombre",label:"Nombre",class:"col-xs-12 col-sm-6"}),s(k,{options:ee.value,name:"tipo",label:"Tipo",class:"col-xs-12 col-sm-6"},null,8,["options"]),a(M).tipo==="unidad"?(r(),d("div",Fe,[h("div",Re,[s(z,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=o=>g.value=o),options:F.value,borderless:"",dense:"",name:"unidadees1",label:"Unidades",class:"col-4 q-mb-md"},{after:l(()=>[s(E,{disable:!g.value,round:"",dense:"",icon:"add",color:"positive",onClick:t[0]||(t[0]=o=>ne(g.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),a(w).pivot?(r(),d("div",Ve,Y(a(w).pivot),1)):y("",!0),s(D,{bordered:""},{default:l(()=>[s(H,{header:""},{default:l(()=>[J("Seleccionar Unidades")]),_:1}),(r(!0),d(K,null,P(a(A),(o,i)=>(r(),Q(X,{key:i},{default:l(()=>[s(W,null,{default:l(()=>[h("div",Me,[ye(s(S,{label:"examen",name:`pivot[${i}].examen_id`,class:"col-3",required:""},null,8,["name"]),[[ge,!1]]),s(k,{label:"Unidades",name:`pivot[${i}].unidad_id`,options:F.value,class:"col-3",required:""},null,8,["name","options"]),s(S,{name:`pivot[${i}].minimo`,label:"Minimo",class:"col-4"},null,8,["name"]),s(S,{name:`pivot[${i}].maximo`,label:"Maximo",class:"col-4"},null,8,["name"]),h("div",Ae,[s(E,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:ve=>a(oe)(i)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):y("",!0),a(M).tipo==="respuesta"?(r(),d("div",Le,[h("div",Be,[s(z,{modelValue:q.value,"onUpdate:modelValue":t[3]||(t[3]=o=>q.value=o),options:V.value,borderless:"",dense:"",name:"respuestas1",label:"Respuesta",class:"col-4 q-mb-md"},{after:l(()=>[s(E,{disable:!q.value,round:"",dense:"",icon:"add",color:"positive",onClick:t[2]||(t[2]=o=>ue(q.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),a(w).respuesta_ids?(r(),d("div",Te,Y(a(w).respuesta_ids),1)):y("",!0),s(D,{bordered:""},{default:l(()=>[s(H,{header:""},{default:l(()=>[J("Seleccionar Respuestas")]),_:1}),(r(!0),d(K,null,P(a(L),(o,i)=>(r(),Q(X,{key:i},{default:l(()=>[s(W,null,{default:l(()=>[h("div",je,[s(k,{label:"Respuesta",name:`respuesta_ids[${i}]`,options:V.value,class:"col-8",required:""},null,8,["name","options"]),h("div",Oe,[s(E,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:ve=>a(re)(i)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):y("",!0)]),_:1},8,["loading","onSubmit"])]))}}),Ye={class:"row"},ss=G({__name:"ItemEditPage",props:{id:{type:Number,required:!0}},setup(n){const c=n,p=qe(),{data:m,isSuccess:v,isFetching:b}=Ce(c.id,!0),x=()=>{I.success("Registro actualizado correctamente"),p.back()};return(_,f)=>(r(),d("div",Ye,[a(b)?(r(),Q($e,{key:0,class:"col-xs-12 col-sm-10 q-pa-lg"},{default:l(()=>[s(ke,{class:"col-12",inputs:3})]),_:1})):y("",!0),a(v)&&!a(b)&&a(m)?(r(),Q(ze,{key:1,class:"col-xs-12 col-sm-10",item:a(m),gol:a(m),onSubmit:x,onCancel:f[0]||(f[0]=U=>_.$router.back())},null,8,["item","gol"])):y("",!0)]))}});export{ss as default};
