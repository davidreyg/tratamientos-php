import{W as re,Y as P,o as b,e as f,w as y,a5 as m,ad as _,bh as ie,aj as C,k as G,a1 as ne,ag as de,H as A,ak as S,aK as z,a7 as Y,a8 as J,aX as I,a2 as s,au as q,ab as K,aY as W,f as X,at as Z,ac as T,x as me,b9 as ue,aQ as x,aE as ee,aL as ce,bj as pe,r as H,b6 as F,bk as ae,$ as V,a$ as be,bl as L,aV as w,a0 as g,b0 as U}from"./index.92b645b8.js";import{O as _e}from"./OrdenApi.71c6207c.js";import{_ as ve}from"./BaseCheckBox.7ac5c785.js";function fe(){return re(({id:u,data:N})=>_e.updateExamens(u,N))}const he=C("div",{class:"col-12 text-bold text-italic"},"Datos Generales:",-1),ye=C("div",{class:"col-12 text-bold text-italic"}," Datos del Establecimiento de Origen: ",-1),qe=C("div",{class:"col-12 text-bold text-italic"},"Datos del Medico:",-1),ge=C("div",{class:"col-12 text-bold text-italic"},"Datos del paciente:",-1),Fe=P({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},setup(u){return(N,v)=>(b(),f(ie,{class:"row"},{default:y(()=>[he,m(_,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:u.orden.diagnostico},null,8,["value"]),m(_,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:u.orden.CI10},null,8,["value"]),m(_,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:u.orden.CPN},null,8,["value"]),m(_,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:u.orden.EG},null,8,["value"]),m(_,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:u.orden.codigo_atencion},null,8,["value"]),m(_,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1,value:u.orden.fecha_registro},null,8,["value"]),ye,m(_,{name:"establecimiento_tipo",class:"col-xs-12 col-sm-4",label:"Tipo de Establecimiento",required:"",readonly:"",borderless:"",outlined:!1,value:u.orden.establecimiento?"Jurisdiccion":"Externo"},null,8,["value"]),m(_,{name:"establecimiento_id",class:"col-xs-12 col-sm-8",label:"Establecimiento Origen",required:"",readonly:"",borderless:"",outlined:!1,value:u.orden.establecimiento?u.orden.establecimiento.data.nombre:u.orden.establecimiento_otro},null,8,["value"]),qe,m(_,{name:"medico",label:"Nombre",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1,value:u.orden.medico},null,8,["value"]),ge,m(_,{name:"paciente",label:"Nombre",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:u.orden.paciente.data.nombre_completo},null,8,["value"]),m(_,{name:"documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:u.orden.paciente.data.numero_documento},null,8,["value"])]),_:1}))}}),ke={class:"row q-col-gutter-sm q-mb-sm"},we={key:0,class:"col-4 row q-col-gutter-sm"},$e={key:1,class:"col-4 row q-col-gutter-sm"},Ee={key:2,class:"col-4 row q-col-gutter-sm"},Ce={class:"row q-col-gutter-sm q-mb-sm"},Ne={key:0,class:"row q-mt-md"},Re={class:"row"},De=P({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},examens:{type:Array,required:!0},items:{type:Array,required:!0},ordenId:{type:Number,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!0}},emits:["submit","cancel"],setup(u,{emit:N}){const v=N,h=u,M=G(()=>h.examens?h.examens.map(i=>({label:i.nombre,value:Number(i.id)})):[]),j=G(()=>h.items.map(i=>({label:i.nombre,value:Number(i.id)}))),{handleSubmit:B,setFieldValue:c,values:e}=ne({validationSchema:h.validationSchema,initialValues:h.initialValues}),{mutateAsync:Q,reset:n,isLoading:a}=fe(),r=B(async(i,{setErrors:o})=>{await Q({id:h.ordenId,data:i},{onSuccess:()=>{de.success("Resultados actualizados correctamente"),v("submit"),n.value()},onError:p=>{n.value(),o(p.data.errors)}})},i=>console.log(i)),d=i=>{let o;switch(e.pivot[i].tipo_unidad,e.pivot[i].tipo_unidad){case"multivalor":!!e.pivot[i].minimo&&!!e.pivot[i].maximo&&(o=`Min: ${e.pivot[i].minimo} - Max: ${e.pivot[i].maximo}`);break;case"operador":!!e.pivot[i].minimo&&!!e.pivot[i].operador_unidad&&(o=`${e.pivot[i].operador_unidad} ${e.pivot[i].minimo}`);break;case"unico":e.pivot[i].minimo&&(o="Es unico");break;default:o=void 0;break}return o},R=i=>{let o;switch(e.pivot[i].tipo_unidad){case"multivalor":!!e.pivot[i].minimo&&!!e.pivot[i].maximo&&(e.pivot[i].resultado>e.pivot[i].minimo&&e.pivot[i].resultado<e.pivot[i].maximo?o="green-2":o="red-2");break;case"operador":if(!!e.pivot[i].minimo&&!!e.pivot[i].operador_unidad)switch(e.pivot[i].operador_unidad){case">":e.pivot[i].resultado>e.pivot[i].minimo?o="green-2":o="red-2";break;case">=":e.pivot[i].resultado>=e.pivot[i].minimo?o="green-2":o="red-2";break;case"<":e.pivot[i].resultado<e.pivot[i].minimo?o="green-2":o="red-2";break;case"<=":e.pivot[i].resultado<=e.pivot[i].minimo?o="green-2":o="red-2";break}break;case"unico":break;default:o=void 0;break}return o},oe=i=>{let o;switch(e.item_orden[i].tipo_unidad,e.item_orden[i].tipo_unidad){case"multivalor":!!e.item_orden[i].minimo&&!!e.item_orden[i].maximo&&(o=`Min: ${e.item_orden[i].minimo} - Max: ${e.item_orden[i].maximo}`);break;case"operador":!!e.item_orden[i].minimo&&!!e.item_orden[i].operador_unidad&&(o=`${e.item_orden[i].operador_unidad} ${e.item_orden[i].minimo}`);break;case"unico":e.item_orden[i].minimo&&(o="Es unico");break;default:o=void 0;break}return o},te=i=>{let o;switch(e.item_orden[i].tipo_unidad){case"multivalor":!!e.item_orden[i].minimo&&!!e.item_orden[i].maximo&&(e.item_orden[i].resultado>e.item_orden[i].minimo&&e.item_orden[i].resultado<e.item_orden[i].maximo?o="green-2":o="red-2");break;case"operador":if(!!e.item_orden[i].minimo&&!!e.item_orden[i].operador_unidad)switch(e.item_orden[i].operador_unidad){case">":e.item_orden[i].resultado>e.item_orden[i].minimo?o="green-2":o="red-2";break;case">=":e.item_orden[i].resultado>=e.item_orden[i].minimo?o="green-2":o="red-2";break;case"<":e.item_orden[i].resultado<e.item_orden[i].minimo?o="green-2":o="red-2";break;case"<=":e.item_orden[i].resultado<=e.item_orden[i].minimo?o="green-2":o="red-2";break}break;case"unico":break;default:o=void 0;break}return o},se=i=>{const o="pivot["+i+"].is_canceled",p=e.pivot[i].is_canceled;e.pivot[i].has_items&&e.pivot[i].items.forEach(l=>{const k="item_orden["+l.pivot_index+"].is_canceled";c(k,!p)}),c(o,!p)};return h.fields.forEach((i,o)=>{A(()=>e.pivot[o].unidad_id,p=>{if(p){const t=h.examens.find(l=>l.id==e.pivot[o].examen_id);if(!!t&&!!p){const l=t.pivot.find(E=>E.unidad_id===p),k="pivot["+o+"].minimo",$="pivot["+o+"].maximo",D="pivot["+o+"].tipo_unidad",O="pivot["+o+"].operador_unidad";l&&(c(k,l.minimo),c($,l.maximo),c(D,l.tipo),c(O,l.operador))}}},{deep:!0,immediate:!0}),A(()=>e.pivot[o].is_canceled,p=>{const t="pivot["+o+"].minimo",l="pivot["+o+"].maximo",k="pivot["+o+"].tipo_unidad",$="pivot["+o+"].operador_unidad";p&&(c(t,void 0),c(l,void 0),c(k,void 0),c($,void 0)),e.pivot[o].items.forEach(O=>{const E="item_orden["+O.pivot_index+"].is_canceled";c(E,p)})},{deep:!0,immediate:!0}),A(()=>e.pivot[o].is_enabled,p=>{const t="pivot["+o+"].minimo",l="pivot["+o+"].maximo",k="pivot["+o+"].resultado",$="pivot["+o+"].unidad_id",D="pivot["+o+"].motivo";p||(c(t,void 0),c(l,void 0),c(k,null),c($,null),c(D,null),e.pivot[o].items.forEach(E=>{const le="item_orden["+E.pivot_index+"].is_enabled";c(le,p)}))},{deep:!0,immediate:!0})}),h.items.forEach((i,o)=>{A(()=>e.item_orden[o].unidad_id,p=>{if(p){const t=h.items.find(l=>l.id==e.item_orden[o].item_id);if(!!t&&!!p){const l=t.pivot.find(E=>E.unidad_id===p),k="item_orden["+o+"].minimo",$="item_orden["+o+"].maximo",D="item_orden["+o+"].tipo_unidad",O="item_orden["+o+"].operador_unidad";l&&(c(k,l.minimo),c($,l.maximo),c(D,l.tipo),c(O,l.operador))}}},{deep:!0,immediate:!0})}),(i,o)=>(b(),f(ie,{onSubmit:pe(s(r),["prevent"])},{default:y(()=>[m(x,{bordered:""},{default:y(()=>[(b(!0),S(ee,null,z(u.examens,(p,t)=>(b(),f(Y,{key:t},{default:y(()=>[m(J,null,{default:y(()=>[C("div",ke,[m(I,{label:"Examen",name:`pivot[${t}].examen_id`,options:M.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),p.tipo.toLowerCase()==="string"?(b(),S("div",we,[s(e).pivot[t].is_canceled?q("",!0):(b(),f(_,{key:0,name:`pivot[${t}].resultado`,"bg-color":R(t),label:"Resultado",class:"col-12",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","bg-color","disable"])),s(e).pivot[t].is_canceled?(b(),f(_,{key:1,name:`pivot[${t}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","disable"])):q("",!0)])):p.tipo.toLowerCase()==="unidad"?(b(),S("div",$e,[s(e).pivot[t].is_canceled?q("",!0):(b(),f(_,{key:0,name:`pivot[${t}].resultado`,"bg-color":R(t),label:"Resultado",class:"col-6",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","bg-color","disable"])),!s(e).pivot[t].is_canceled&&!s(e).pivot[t].has_items?(b(),f(I,{key:1,label:"Unidad",name:`pivot[${t}].unidad_id`,options:s(e).pivot[t].unidads,hint:d(t),class:"col-6",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","options","hint","disable"])):q("",!0),s(e).pivot[t].is_canceled?(b(),f(_,{key:2,name:`pivot[${t}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","disable"])):q("",!0)])):p.tipo.toLowerCase()==="respuesta"?(b(),S("div",Ee,[s(e).pivot[t].is_canceled?q("",!0):(b(),f(I,{key:0,label:"Respuesta",name:`pivot[${t}].respuesta_id`,options:s(e).pivot[t].respuestas,class:"col-12",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","options","disable"])),s(e).pivot[t].is_canceled?(b(),f(_,{key:1,name:`pivot[${t}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","disable"])):q("",!0)])):q("",!0),m(_,{label:"Fecha",type:"date",name:`pivot[${t}].fecha_resultado`,required:"",class:"col-2",disable:!s(e).pivot[t].is_enabled},null,8,["name","disable"]),m(K,{class:"col-2 self-center justify-center"},{default:y(()=>[m(ve,{name:`pivot[${t}].is_enabled`,label:"",dense:""},{default:y(()=>[m(W,null,{default:y(()=>[X(Z(s(e).pivot[t].is_enabled?"Deshabilitar.":"Habilitar."),1)]),_:2},1024)]),_:2},1032,["name"]),m(T,{icon:s(e).pivot[t].is_canceled?"fas fa-pen":"fas fa-ban",color:s(e).pivot[t].is_canceled?"warning":"negative",disable:!s(e).pivot[t].is_enabled,round:"",flat:"",size:"sm",onClick:l=>se(t)},{default:y(()=>[m(W,null,{default:y(()=>[X(Z(s(e).pivot[t].is_canceled?"Registrar datos.":"Cancelar examen."),1)]),_:2},1024)]),_:2},1032,["icon","color","disable","onClick"])]),_:2},1024)]),me(m(x,{bordered:""},{default:y(()=>[(b(!0),S(ee,null,z(s(e).pivot[t].items,(l,k)=>(b(),f(Y,{key:k},{default:y(()=>[m(J,null,{default:y(()=>[C("div",Ce,[m(I,{label:"Item",name:`item_orden[${l.pivot_index}].item_id`,options:j.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),s(e).item_orden[l.pivot_index].tipo!=="respuesta"?(b(),f(_,{key:0,name:`item_orden[${l.pivot_index}].resultado`,label:"Resultado",class:ce(s(e).item_orden[l.pivot_index].tipo==="unidad"?"col-2":"col-4"),required:"",disable:!s(e).pivot[t].is_enabled,"bg-color":te(l.pivot_index)},null,8,["name","class","disable","bg-color"])):q("",!0),s(e).item_orden[l.pivot_index].tipo==="unidad"?(b(),f(I,{key:1,label:"Unidad",name:`item_orden[${l.pivot_index}].unidad_id`,options:s(e).item_orden[l.pivot_index].unidads,class:"col-2",required:"",disable:!s(e).pivot[t].is_enabled,hint:oe(l.pivot_index)},null,8,["name","options","disable","hint"])):q("",!0),s(e).item_orden[l.pivot_index].tipo==="respuesta"?(b(),f(I,{key:2,label:"Respuesta",name:`item_orden[${l.pivot_index}].respuesta_id`,options:s(e).item_orden[l.pivot_index].respuestas,class:"col-4",required:"",disable:!s(e).pivot[t].is_enabled},null,8,["name","options","disable"])):q("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:2},1536),[[ue,s(e).pivot[t].is_enabled&&!s(e).pivot[t].is_canceled]])]),_:2},1024)]),_:2},1024))),128))]),_:1}),u.withObservaciones?(b(),S("div",Ne,[m(_,{label:"Observaciones",type:"textarea",name:"observaciones",class:"col-12"})])):q("",!0),C("div",Re,[m(K,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:y(()=>[m(T,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:o[0]||(o[0]=p=>i.$emit("cancel"))}),m(T,{label:"Guardar",type:"submit",icon:"fas fa-floppy-disk",color:"primary",loading:s(a),"no-caps":""},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))}}),Me=P({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!1,default:!1}},emits:["submit","cancel"],setup(u){const N=G(()=>v.orden.examens.data?v.orden.examens.data.map(n=>({label:n.nombre,value:Number(n.id)})):[]),v=u,h=H([]),M=H(),j=H();h.value=v.orden.pivot.map(n=>{let a=[];const r=v.orden.examens.data.find(d=>Number(d.id)==n.examen_id);return a=[{label:"Examen",name:"examen_id",type:"select",options:N.value},{label:"Resultado",name:"resultado",type:"string"},{label:"Unidad",name:"unidad_id",type:"select",options:r?r.unidads.data.map(d=>({label:d.nombre,value:Number(d.id)})):[]},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Acciones",name:"actions",type:"array"}],a});const B=F().of(ae(()=>{let n={};return n={examen_id:L().required().label("Examen"),resultado:L().when(["tipo"],{is:a=>a=="unidad",then:()=>w().positive().typeError("Debe ingresar un numero").label("Resultado")}).when(["tipo"],{is:a=>a==="string",then:()=>g().trim().label("Resultado")}).when(["tipo"],{is:a=>a==="respuesta",then:()=>g().trim().label("Resultado")}).when(["is_enabled","is_canceled","tipo"],{is:(a,r,d)=>a&&!r&&d.toLowerCase()!=="respuesta",then:a=>a.required(),otherwise:a=>a.nullable()}).transform((a,r)=>r===""?void 0:a),fecha_resultado:g().required().label("Fecha"),unidad_id:w().when(["is_enabled","is_canceled","has_items","tipo"],{is:(a,r,d,R)=>a&&!r&&!d&&R==="unidad",then:a=>a.required(),otherwise:a=>a.nullable()}).label("Unidad"),is_canceled:U().required().label("Cancelado?"),is_enabled:U().required().label("Hablitad?"),has_items:U().required().label("Tiene items?"),motivo:g().when(["is_enabled","is_canceled"],{is:!0,then:a=>a.required(),otherwise:a=>a.nullable()}).label("Motivo"),minimo:w(),maximo:w().nullable(),tipo_unidad:g(),operador_unidad:g().nullable(),unidads:F(),items:F(),respuestas:F(),tipo:g().required().label("Tipo"),respuesta_id:w().when(["is_enabled","is_canceled","tipo"],{is:(a,r,d)=>a&&!r&&d==="respuesta",then:a=>a.required(),otherwise:a=>a.nullable()}).label("Respuesta")},V().shape(n)})),c=F().of(ae(()=>{let n={};return n={item_id:L().required().label("Item"),examen_id:L().required().label("Examen"),resultado:L().when(["tipo"],{is:a=>a=="unidad",then:()=>w().positive().typeError("Debe ingresar un numero").label("Resultado")}).when(["tipo"],{is:a=>a==="string",then:()=>g().trim().label("Resultado")}).when(["tipo"],{is:a=>a==="respuesta",then:()=>g().trim().label("Resultado")}).when(["is_enabled","is_canceled","tipo"],{is:(a,r,d)=>a&&!r&&d.toLowerCase()!=="respuesta",then:a=>a.required(),otherwise:a=>a.nullable()}).transform((a,r)=>r===""?void 0:a),unidad_id:w().when(["is_enabled","is_canceled","tipo"],{is:(a,r,d)=>a&&!r&&d==="unidad",then:a=>a.required(),otherwise:a=>a.nullable()}).label("Unidad"),respuesta_id:w().when(["is_enabled","is_canceled","tipo"],{is:(a,r,d)=>a&&!r&&d==="respuesta",then:a=>a.required(),otherwise:a=>a.nullable()}).label("Respuesta"),minimo:w(),maximo:w().nullable(),tipo_unidad:g(),operador_unidad:g().nullable(),is_canceled:U().required().label("Cancelado?"),is_enabled:U().required().label("Habilitado?"),respuestas:F(),tipo:g().required().label("Tipo")},V().shape(n)}));M.value=V().shape({pivot:B,item_orden:c});const e=v.orden.pivot.map(n=>{var r;const a=v.orden.examens.data.find(d=>Number(d.id)==n.examen_id);return{examen_id:n.examen_id,resultado:n.resultado,fecha_resultado:(r=n.fecha_resultado)!=null?r:be.now().toISODate(),unidad_id:n.unidad_id,respuesta_id:n.respuesta_id,is_canceled:n.is_canceled,is_enabled:!0,has_items:a?a.items.data.length>0:!1,tipo:a&&a.tipo.toLowerCase(),motivo:n.motivo,unidads:a?a.unidads.data.map(d=>({label:d.nombre,value:Number(d.id)})):[],respuestas:a?a.respuestas.data.map(d=>({label:d.nombre,value:Number(d.id)})):[],items:v.orden.items.data.map((d,R)=>({pivot_index:R,examen_id:d.examen_id})).filter(d=>d.examen_id===Number(a==null?void 0:a.id))}}),Q=v.orden.item_orden.map(n=>{const a=v.orden.items.data.find(r=>Number(r.id)==n.item_id);return{item_id:n.item_id,examen_id:a==null?void 0:a.examen_id,resultado:n.resultado,unidad_id:n.unidad_id,respuesta_id:n.respuesta_id,is_canceled:n.is_canceled,is_enabled:!0,tipo:a&&a.tipo.toLowerCase(),unidads:a?a.unidads.data.map(r=>({label:r.nombre,value:Number(r.id)})):[],respuestas:a?a.respuestas.data.map(r=>({label:r.nombre,value:Number(r.id)})):[]}});return j.value={pivot:e,item_orden:Q,observaciones:v.orden.observaciones},(n,a)=>h.value.length>0&&M.value?(b(),f(De,{key:0,fields:h.value,"validation-schema":M.value,"initial-values":j.value,"orden-id":Number(u.orden.id),examens:v.orden.examens.data,items:v.orden.items.data,"with-observaciones":u.withObservaciones,onCancel:a[0]||(a[0]=r=>n.$emit("cancel")),onSubmit:a[1]||(a[1]=r=>n.$emit("submit"))},null,8,["fields","validation-schema","initial-values","orden-id","examens","items","with-observaciones"])):q("",!0)}});export{Fe as _,Me as a};
