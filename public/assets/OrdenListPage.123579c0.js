import{U as ae,aG as J,aH as W,X as Y,r as w,j as Z,Z as se,$ as q,aU as V,b4 as X,a0 as ie,af as H,G as te,o as v,d as b,w as l,a4 as a,ac as h,aW as re,aX as C,e as x,ab as N,ai as A,aC as ue,a1 as f,at as O,a9 as de,Y as ce,a5 as le,aj as ne,ad as oe,a2 as me,a3 as fe,b8 as ve,b9 as _e,al as K,ak as pe,aF as be}from"./index.ddaffeba.js";import{u as ge}from"./establecimientoFetchAllQuery.4c2447b5.js";import{u as ye}from"./examenFetchAllQuery.20d85fdf.js";import{O as Q}from"./OrdenApi.610e0468.js";import{u as he}from"./paqueteFetchAllQuery.ecaf4de4.js";import{_ as Oe}from"./ExamenCardList.f0810d8a.js";import{_ as we}from"./BaseCheckBoxGroup.e838326f.js";import{u as Fe,_ as ke}from"./OrdenTable.aea8de03.js";import{u as ee}from"./laboratorio.store.4ce676c2.js";import"./EstablecimientoApi.0ae636f8.js";import"./ExamenApi.fd374c57.js";import"./PaqueteApi.c4643ddc.js";import"./BaseTable.fcb0392f.js";function qe(){return ae(i=>Q.destroy(i))}function xe(i,_){const o=async()=>(await Q.fetchById(i.value)).data().data,{data:m,isLoading:t,isSuccess:n,isError:r,isFetching:g,refetch:y}=J([W.ORDEN_ALL,i.value],o,{enabled:_});return{data:m,isLoading:t,isSuccess:n,isError:r,isFetching:g,refetch:y}}function Ee(i,_){const o=async()=>(await Q.fetchOrdenPDF(i.value)).data(),{data:m,isLoading:t,isSuccess:n,isError:r,isFetching:g,refetch:y}=J([W.ORDEN_ALL,i.value,"orden-pdf"],o,{enabled:_});return{data:m,isLoading:t,isSuccess:n,isError:r,isFetching:g,refetch:y}}function Ce(i,_){const o=async()=>(await Q.fetchResultadosPDF(i.value)).data(),{data:m,isLoading:t,isSuccess:n,isError:r,isFetching:g,refetch:y}=J([W.ORDEN_ALL,i.value,"resultados-pdf"],o,{enabled:_});return{data:m,isLoading:t,isSuccess:n,isError:r,isFetching:g,refetch:y}}function Ne(){return ae(({id:i,data:_})=>Q.update(i,_))}const Pe={class:"col-12"},$e={class:"col-12"},De={class:"col-12 row q-col-gutter-sm"},Re=Y({__name:"OrdenEditForm",props:{orden:{type:Object,required:!0}},emits:["submit","cancel"],setup(i,{emit:_}){const o=i,m=_,t=w({limit:0,search:"is_active:1",searchJoin:"and"}),{data:n}=ye(t),{data:r}=he(),g=Z(()=>r.value?r.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),y=w({limit:0}),{data:$}=ge(y),U=Z(()=>$.value?$.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),I=se().shape({diagnostico:q().trim().min(2).required().label("Diagnostico"),CI10:q().trim().min(2).nullable().label("CI10"),CPN:q().trim().min(2).nullable().label("CPN"),EG:q().trim().min(2).nullable().label("EG"),codigo_atencion:q().trim().min(2).required().label("Codigo de Atencion"),numero_orden:V().required().typeError("Debe ingresar un numero").positive().integer().label("Numero de Orden"),fecha_registro:q().trim().required().label("Fecha de Registro"),medico:q().trim().required().label("M\xE9dico"),examen_ids:X().of(V().required()).required().label("Examenes"),item_ids:X().of(V().required()).required().label("Items"),paquete_ids:X().of(V().required()).required().label("Paquetes"),establecimiento_id:V().when([],{is:()=>F.value===!0,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Establecimiento Institucional"),establecimiento_otro:q().when([],{is:()=>F.value===!1,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Otro Establecimiento")}),{values:D,setFieldValue:R,handleSubmit:M}=ie({validationSchema:I,initialValues:{...o.orden,paquete_ids:[]}}),F=w(!!o.orden.establecimiento_id),{mutateAsync:z,reset:G,isLoading:P}=Ne(),T=M(async(e,{setErrors:u,resetForm:p})=>{await z({id:o.orden.id,data:e},{onSuccess:()=>{H.success("Orden Actualizada correctamente."),p(),m("submit")},onError:d=>{G.value(),u(d.data.errors)}})},e=>{console.log(e)});te(()=>D.examen_ids,e=>{var u;if(e){const p=(u=r.value)==null?void 0:u.filter(k=>k.examen_ids.every(E=>e.includes(E)));R("paquete_ids",(p==null?void 0:p.map(k=>Number(k.id)))||[]);let d=[];n.value&&(d=[],e.forEach(k=>{const E=n.value.find(S=>Number(S.id)===k);if(E&&E.items.data.length>0){const S=E.items.data.map(s=>Number(s.id));d.push(...S)}}),R("item_ids",[...new Set(d)]),console.log(D.item_ids))}});const L=e=>{var u;if(e){const p=(u=r.value)==null?void 0:u.filter(d=>e.includes(Number(d.id))).map(d=>d.examen_ids).flat();R("examen_ids",[...new Set(p)])}};return(e,u)=>(v(),b(de,{loading:f(P),onSubmit:f(T),onCancel:u[2]||(u[2]=p=>e.$emit("cancel"))},{default:l(()=>[a(h,{name:"numero_orden",label:"Numero de Orden",class:"col-xs-12 col-sm-6",required:""}),a(h,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:""}),F.value?(v(),b(re,{key:0,options:U.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:""},{after:l(()=>[a(N,{round:"",flat:"",icon:"fas fa-building-circle-arrow-right",color:"primary",onClick:u[0]||(u[0]=p=>F.value=!1)},{default:l(()=>[a(C,null,{default:l(()=>[x(" Otro establecimiento ")]),_:1})]),_:1})]),_:1},8,["options"])):(v(),b(h,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:""},{after:l(()=>[a(N,{round:"",flat:"",icon:"fas fa-building-circle-xmark",color:"negative",onClick:u[1]||(u[1]=p=>F.value=!0)},{default:l(()=>[a(C,null,{default:l(()=>[x(" Establecimiento institucional")]),_:1})]),_:1})]),_:1})),a(h,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-6",required:""}),a(h,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4"}),a(h,{name:"CPN",label:"Codigo Pre Natal",class:"col-xs-12 col-sm-4"}),a(h,{name:"EG",label:"Edad Gestacional",class:"col-xs-12 col-sm-4"}),a(h,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:""}),a(h,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:""}),A("div",Pe,[a(ue,{spaced:""}),x(" Paquetes")]),A("div",$e,[a(we,{name:"paquete_ids",label:"Paquetes",options:g.value,onUpdate:L},null,8,["options"])]),A("div",De,[f(n)?(v(),b(Oe,{key:0,examens:f(n)},null,8,["examens"])):O("",!0)])]),_:1},8,["loading","onSubmit"]))}}),Le=["src"],Se=Y({__name:"OrdenPDFModal",props:{modelValue:{type:Boolean},pdfUrl:{}},emits:["update:modelValue"],setup(i,{emit:_}){const t=ce(i,"modelValue",_);return(n,r)=>(v(),b(fe,{modelValue:f(t),"onUpdate:modelValue":r[0]||(r[0]=g=>me(t)?t.value=g:null)},{default:l(()=>[a(oe,{style:{width:"1000px","max-width":"90vw"}},{default:l(()=>[a(le,null,{default:l(()=>[n.pdfUrl?(v(),ne("iframe",{key:0,src:n.pdfUrl,width:"100%",height:"500px"},null,8,Le)):O("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ve={class:"row q-col-gutter-md"},Qe={class:"col-12"},Ye=Y({__name:"OrdenListPage",setup(i){const{$reset:_}=ee(),{ordenSeleccionada:o}=ve(ee()),m=w({}),t=w(0),n=w(""),{data:r,isFetching:g,refetch:y}=Fe(m),{data:$,isFetching:U,refetch:I}=xe(t,!!t.value),{data:D,isFetching:R,refetch:M}=Ce(t,!!t.value),{data:F,isFetching:z,refetch:G}=Ee(t,!!t.value),P=w("list"),T=s=>{m.value.page=s.pagination.page,m.value.limit=s.pagination.rowsPerPage,m.value.search=s.filter,m.value.orderBy=s.pagination.sortBy,m.value.sortedBy=s.pagination.descending?"desc":"asc"},L=async()=>{o.value=void 0,await y.value()},e=async s=>{o.value=void 0,t.value=s,n.value="edit",await I.value(),$.value&&(o.value=$.value,P.value="edit-orden")},{mutateAsync:u}=qe(),p=async s=>{o.value=void 0,t.value=s,H.confirmDialog(s,{title:"\xBFEsta seguro de eliminar esta ORDEN?",preConfirm:async()=>{await u(s,{onSuccess:async()=>{H.success("Orden eliminada correctamente."),L()},onError:()=>{be.hideLoading()}})}})},d=w(""),k=w(!1),E=async s=>{o.value=void 0,t.value=s,n.value="pdf",await M.value(),D.value&&(d.value=URL.createObjectURL(new Blob([D.value],{type:"application/pdf"})),window.open(d.value,"_blank"))},S=async s=>{o.value=void 0,t.value=s,n.value="pdf",await G.value(),F.value&&(d.value=URL.createObjectURL(new Blob([F.value],{type:"application/pdf"})),window.open(d.value,"_blank"))};return _e(()=>{_()}),te(()=>o.value,s=>{s||(P.value="list")}),(s,B)=>(v(),ne("div",Ve,[A("div",Qe,[a(pe,{modelValue:P.value,"onUpdate:modelValue":B[0]||(B[0]=c=>P.value=c),animated:""},{default:l(()=>[a(K,{name:"list"},{default:l(()=>[f(r)?(v(),b(ke,{key:0,ordens:f(r).data,"server-pagination":f(r).meta.pagination,loading:f(g),onRequest:T},{"custom-actions":l(({props:c})=>[c.row.estado===0?(v(),b(N,{key:0,color:"warning",icon:"fas fa-edit",round:"",flat:"",size:"sm",loading:n.value==="edit"&&f(U)&&t.value===Number(c.key),onClick:j=>e(Number(c.key))},{default:l(()=>[a(C,null,{default:l(()=>[x("Editar Orden.")]),_:1})]),_:2},1032,["loading","onClick"])):O("",!0),a(N,{color:"primary",icon:"fas fa-eye",round:"",flat:"",size:"sm",loading:n.value==="view"&&f(U)&&t.value===Number(c.key)},{default:l(()=>[a(C,null,{default:l(()=>[x("Visualizar Orden.")]),_:1})]),_:2},1032,["loading"]),c.row.estado===2?(v(),b(N,{key:1,color:"info",icon:"fas fa-print",round:"",flat:"",loading:n.value==="pdf"&&f(R)&&t.value===Number(c.key),size:"sm",onClick:j=>E(Number(c.key))},{default:l(()=>[a(C,null,{default:l(()=>[x("Imprimir Resultados.")]),_:1})]),_:2},1032,["loading","onClick"])):O("",!0),c.row.estado===2?(v(),b(N,{key:2,color:"info",icon:"fas fa-print",round:"",flat:"",loading:n.value==="pdf"&&f(z)&&t.value===Number(c.key),size:"sm",onClick:j=>S(Number(c.key))},{default:l(()=>[a(C,null,{default:l(()=>[x("Imprimir Orden.")]),_:1})]),_:2},1032,["loading","onClick"])):O("",!0),c.row.estado!==2?(v(),b(N,{key:3,color:"negative",icon:"fas fa-trash-can",round:"",flat:"",size:"sm",onClick:j=>p(Number(c.key))},{default:l(()=>[a(C,null,{default:l(()=>[x("Eliminar orden.")]),_:1})]),_:2},1032,["onClick"])):O("",!0)]),_:1},8,["ordens","server-pagination","loading"])):O("",!0)]),_:1}),a(K,{name:"edit-orden"},{default:l(()=>[a(oe,{class:"my-card"},{default:l(()=>[a(le,null,{default:l(()=>[f(o)?(v(),b(Re,{key:0,orden:f(o),onSubmit:L,onCancel:L},null,8,["orden"])):O("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),d.value?(v(),b(Se,{key:0,modelValue:k.value,"onUpdate:modelValue":B[1]||(B[1]=c=>k.value=c),"pdf-url":d.value},null,8,["modelValue","pdf-url"])):O("",!0)]))}});export{Ye as default};
