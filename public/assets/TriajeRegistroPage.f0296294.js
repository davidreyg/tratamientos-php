import{W as V,bp as B,aE as G,aF as J,Y as $,a1 as U,ag as K,o as c,e as v,w as d,ak as h,aK as D,ad as k,a$ as C,a2 as p,aa as Y,r as S,H as M,b0 as X,bh as Z,$ as w,bq as ee,a5 as a,ae,au as x,bi as te,aU as H,x as N,Q as A,a8 as q,f as L,a7 as P,aS as ie,aH as O,aG as T,aI as ne,b1 as W,br as E,ac as z,am as F,bs as se,al as oe,aT as re,k as le,a0 as ce,b2 as ue,aW as de,ab as me,bc as fe,aj as pe,bd as be,b3 as R}from"./index.1470aaf9.js";import{_ as _e}from"./SkeletonForm.bab038e8.js";import{_ as ve}from"./BaseTable.1600205b.js";function ge(){return V(n=>B.delete(n))}function ye(n,s){const r=async()=>(await B.findById(n)).data().data,{data:m,isLoading:u,isSuccess:o,isError:f,isFetching:e,refetch:b}=G([J.TRIAJE_ALL,n],r,{enabled:s});return{data:m,isLoading:u,isSuccess:o,isError:f,isFetching:e,refetch:b}}function he(){return V(({data:n,id:s})=>B.update(n,s))}const $e=$({__name:"FormDinamicoEdit",props:{fields:{type:Array,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0},triajeId:{type:Number,required:!0}},emits:["submit","cancel"],setup(n,{emit:s}){const r=s,m=n,{handleSubmit:u,setErrors:o,resetForm:f}=U({validationSchema:m.validationSchema,initialValues:m.initialValues}),{mutateAsync:e,reset:b,isLoading:_}=he(),l=u(async g=>{await e({data:g,id:m.triajeId},{onSuccess:()=>{f(),K.success(),r("submit")},onError:y=>{b.value(),o(y.data.errors)}})}),t=()=>{f(),r("cancel")};return(g,y)=>(c(),v(Y,{loading:p(_),onSubmit:p(l),onCancel:t},{default:d(()=>[(c(!0),h(C,null,D(n.fields.filter(i=>i.type!=="array"),(i,j)=>(c(),v(k,{key:j,name:i.name,label:i.label,suffix:i.suffix,type:i.type,"stack-label":!0,class:"col-xs-12 col-sm-4"},null,8,["name","label","suffix","type"]))),128)),(c(!0),h(C,null,D(n.fields.filter(i=>i.type==="array"),(i,j)=>(c(),h("div",{key:j,class:"col-12 row q-col-gutter-md"},[(c(!0),h(C,null,D(i.fields,(I,Q)=>(c(),v(k,{key:Q,name:`pivot[${Q}].valor`,label:I.label,suffix:I.suffix,"stack-label":!0,class:"col-xs-12 col-sm-4"},null,8,["name","label","suffix"]))),128))]))),128))]),_:1},8,["loading","onSubmit"]))}}),je={class:"row"},Se=$({__name:"TriajeEditForm",props:{triajeId:{type:Number,required:!0}},emits:["submit","cancel"],setup(n){const s=n,{data:r,isFetching:m}=ye(s.triajeId,!0),u=S([]),o=S(),f=S();return M(()=>r.value,e=>{if(e){const b=e.signos.data.map(t=>({label:t.nombre,name:t.nombre,type:"number",suffix:t.unidad}));u.value=[{name:"fecha_registro",label:"Fecha Registro",type:"date"},{name:"pivot",label:"Signos",type:"array",fields:b}];const _=X().of(Z(t=>{const g=e.signos.data.find(i=>i.id==t.signo_id);let y={};return g&&(y={signo_id:te().when([],{is:()=>g.is_required,then:i=>i.required(),otherwise:i=>i.optional()}).label("Id del signo"),valor:H().positive().when([],{is:()=>g.is_required,then:i=>i.required(),otherwise:i=>i.optional()}).transform((i,j)=>j===""?void 0:i).typeError("Debe ingresar un numero").label(g.nombre)}),w().shape(y)})),l=w().shape({fecha_registro:ee().required().label("Fecha Registro")}).required();o.value=l.concat(w().shape({pivot:_})),f.value={fecha_registro:e.fecha_registro,paciente_id:e.paciente_id,pivot:e.pivot}}},{immediate:!0}),(e,b)=>(c(),h("div",je,[p(m)?(c(),v(ae,{key:0,class:"col-12 q-pa-lg"},{default:d(()=>[a(_e,{class:"col-12",inputs:5})]),_:1})):x("",!0),u.value.length>0&&o.value&&!p(m)?(c(),v($e,{key:1,fields:u.value,"validation-schema":o.value,"initial-values":f.value,"triaje-id":n.triajeId,onCancel:b[0]||(b[0]=_=>e.$emit("cancel")),onSubmit:b[1]||(b[1]=_=>e.$emit("submit"))},null,8,["fields","validation-schema","initial-values","triaje-id"])):x("",!0)]))}}),Te=$({__name:"TriajesTableActions",props:{id:{type:String,required:!0}},emits:["destroy","edit"],setup(n){return(s,r)=>(c(),h(C,null,[N((c(),v(P,{clickable:"",onClick:r[0]||(r[0]=m=>s.$emit("edit",n.id))},{default:d(()=>[a(q,{avatar:""},{default:d(()=>[a(A,{name:"fas fa-pen-to-square",color:"warning"})]),_:1}),a(q,null,{default:d(()=>[L("Editar")]),_:1})]),_:1})),[[O]]),a(ie),N((c(),v(P,{clickable:"",onClick:r[1]||(r[1]=m=>s.$emit("destroy",n.id))},{default:d(()=>[a(q,{avatar:""},{default:d(()=>[a(A,{name:"fas fa-trash-can",color:"negative"})]),_:1}),a(q,null,{default:d(()=>[L("Eliminar")]),_:1})]),_:1})),[[O]])],64))}}),xe=$({__name:"TriajesTable",props:{loading:{type:Boolean,required:!1,default:!1},data:{type:Array,required:!0},serverPagination:{type:Object,default:void 0}},emits:["destroyOne","edit"],setup(n,{emit:s}){const r=s,{formatDate:m}=ne(),u=[{name:"fecha_registro",align:"left",label:"Fecha de Registro",field:"fecha_registro",format:e=>m(e),sortable:!0},{name:"actions",align:"right",label:"Acciones",field:"actions"}],{mutateAsync:o}=ge(),f=e=>{T.fire({title:"\xBFEst\xE1 seguro de eliminar este registro?",text:"No podra deshacer los cambios!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No",showLoaderOnConfirm:!0,preConfirm:async()=>{await o(e,{onSuccess:async()=>{r("destroyOne",e)},onError:()=>{T.hideLoading()}})},allowOutsideClick:()=>!T.isLoading()})};return(e,b)=>(c(),v(ve,{columns:u,data:n.data,loading:n.loading,"row-key":"id","show-grid-toggle":!1},{actions:d(({key:_})=>[a(Te,{id:_,onEdit:l=>e.$emit("edit",_),onDestroy:l=>f(_)},null,8,["id","onEdit","onDestroy"])]),_:1},8,["data","loading"]))}}),qe=$({__name:"TriajeTab",setup(n){const{paciente:s,triajesDelPaciente:r,isTriajesLoading:m}=W(E()),{fetchTriajesDelPaciente:u}=E(),o=S("list"),f=S(),e=async()=>{s.value&&(await u(s.value.id),o.value="list")},b=async _=>{o.value="edit",f.value=Number(_)};return(_,l)=>p(s)?(c(),v(oe,{key:0,modelValue:o.value,"onUpdate:modelValue":l[4]||(l[4]=t=>o.value=t),animated:"",class:""},{default:d(()=>[a(F,{name:"list"},{default:d(()=>[a(z,{color:"primary",icon:"add",outline:"",label:"Nuevo",class:"q-mb-md",onClick:l[0]||(l[0]=t=>o.value="new")}),a(xe,{data:p(r),loading:p(m),onDestroyOne:l[1]||(l[1]=t=>p(u)(p(s).id)),onEdit:b},null,8,["data","loading"])]),_:1}),a(F,{name:"new"},{default:d(()=>[a(se,{"paciente-id":Number(p(s).id),onCancel:l[2]||(l[2]=t=>o.value="list"),onSubmit:e},null,8,["paciente-id"])]),_:1}),a(F,{name:"edit"},{default:d(()=>[f.value?(c(),v(Se,{key:0,"triaje-id":f.value,onCancel:l[3]||(l[3]=t=>o.value="list"),onSubmit:e},null,8,["triaje-id"])):x("",!0)]),_:1})]),_:1},8,["modelValue"])):x("",!0)}}),Ce={class:"row q-col-gutter-md"},we={class:"col-12"},ke=$({__name:"TriajeRegistroPage",setup(n){const{fetchPaciente:s,$reset:r,fetchTriajesDelPaciente:m}=E(),{paciente:u,isPacienteLoading:o}=W(E()),{data:f}=re(),e=le(()=>f.value?f.value.map(t=>({label:t.nombre,value:t.id})):[]),b=w().shape({numero_documento:H().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:ce().required().label("Tipo de Documento")}),{handleSubmit:_}=U({validationSchema:b}),l=_(async t=>{await s(t.numero_documento),u.value?T.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}):T.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})});return ue(()=>{r()}),M(()=>u.value,async t=>{t&&(console.log("hay paciente, debeiramos buscar su triaje"),await m(t.id))}),(t,g)=>(c(),h("div",Ce,[a(fe,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:p(l)},{default:d(()=>[a(de,{options:e.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),a(k,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),a(me,{class:"col-auto justify-center"},{default:d(()=>[a(z,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:p(o)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),pe("div",we,[a(R,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear"},{default:d(()=>[a(be,{paciente:p(u),onCancel:p(r),onSubmit:g[0]||(g[0]=y=>p(s)(y))},null,8,["paciente","onCancel"])]),_:1}),p(u)?(c(),v(R,{key:0,icon:"fas fa-stethoscope",label:"Triaje",caption:"Editar / Crear"},{default:d(()=>[a(qe)]),_:1})):x("",!0)])]))}});export{ke as default};
