import{by as L,U as R,$ as ne,W as g,T as oe,j as G,f as x,a5 as N,K as ie,a1 as le,g as O,c as ce,V as U,bz as Z,aL as ue,X as M,ae as de,af as pe,p as me,a6 as fe,ag as ve,h as P,M as _e,m as y,q as k,u as f,i as ee,bA as he,ar as ge,d as be,D as w,C as _,B as n,A as v,ao as D,ap as Q,b7 as te,_ as ye,H as V,G as j,am as C,al as B,F as H,O as I,E as A,bB as xe,bC as Y,at as Se,y as qe,bD as Ce}from"./index.7154a952.js";import{u as we,d as ke,a as Fe,b as $e,c as Ie}from"./use-panel.7434bc9b.js";import{L as Pe}from"./SaveTokenInLSTask.54b8b942.js";import{b as Ee,u as Te,_ as F,a as Ae}from"./BaseInput.2176ddc5.js";import{_ as Qe}from"./BaseSelect.fb102cb1.js";import{c as Le,a as $,e as X}from"./index.esm.4940542b.js";import{a as z,u as ae}from"./index.171e870f.js";import{Q as W}from"./QueryTypes.b72dec59.js";import{Q as K}from"./QSkeleton.7bd5440c.js";import{_ as Ne}from"./PeriodCreateForm.db08c658.js";import"./QSelect.ac7e71a8.js";import"./QField.527885b8.js";import"./rtl.b51694b1.js";import"./datetime.b26a663f.js";import"./BaseCheckBox.8195ac8c.js";import"./BaseDatePicker.d5214fd0.js";import"./index.a9fd2e02.js";import"./PeriodApi.9ff7ce1b.js";class Be{static async run(){try{return(await L.checkFolderPermissions()).data().data}catch(t){throw t}}}class Re{static async run(){try{return(await L.checkPhpRequirements()).data().data}catch(t){throw t}}}class De{static async run(){try{return(await L.getFaculties()).data().data}catch(t){throw t}}}class Ve{static async run(t){try{return(await L.createCapellanAndUser(t)).data().data}catch(r){throw r}}}class je{static async run(t){try{await L.setStep(t)}catch(r){throw r}}}var Ue=R({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(e,{slots:t,emit:r}){let i=!1,a,l,o=null,c=null,m,h;function S(){a&&a(),a=null,i=!1,o!==null&&(clearTimeout(o),o=null),c!==null&&(clearTimeout(c),c=null),l!==void 0&&l.removeEventListener("transitionend",m),m=null}function d(u,s,p){s!==void 0&&(u.style.height=`${s}px`),u.style.transition=`height ${e.duration}ms cubic-bezier(.25, .8, .50, 1)`,i=!0,a=p}function b(u,s){u.style.overflowY=null,u.style.height=null,u.style.transition=null,S(),s!==h&&r(s)}function E(u,s){let p=0;l=u,i===!0?(S(),p=u.offsetHeight===u.scrollHeight?0:void 0):(h="hide",u.style.overflowY="hidden"),d(u,p,s),o=setTimeout(()=>{o=null,u.style.height=`${u.scrollHeight}px`,m=q=>{c=null,(Object(q)!==q||q.target===u)&&b(u,"show")},u.addEventListener("transitionend",m),c=setTimeout(m,e.duration*1.1)},100)}function T(u,s){let p;l=u,i===!0?S():(h="show",u.style.overflowY="hidden",p=u.scrollHeight),d(u,p,s),o=setTimeout(()=>{o=null,u.style.height=0,m=q=>{c=null,(Object(q)!==q||q.target===u)&&b(u,"hide")},u.addEventListener("transitionend",m),c=setTimeout(m,e.duration*1.1)},100)}return ne(()=>{i===!0&&S()}),()=>g(oe,{css:!1,appear:e.appear,onEnter:E,onLeave:T},t.default)}}),re=R({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:t}){const{proxy:{$q:r}}=O(),i=G(null),a=x(()=>e.stepper.modelValue===e.step.name),l=x(()=>{const s=e.step.disable;return s===!0||s===""}),o=x(()=>{const s=e.step.error;return s===!0||s===""}),c=x(()=>{const s=e.step.done;return l.value===!1&&(s===!0||s==="")}),m=x(()=>{const s=e.step.headerNav,p=s===!0||s===""||s===void 0;return l.value===!1&&e.stepper.headerNav&&p}),h=x(()=>e.step.prefix&&(a.value===!1||e.stepper.activeIcon==="none")&&(o.value===!1||e.stepper.errorIcon==="none")&&(c.value===!1||e.stepper.doneIcon==="none")),S=x(()=>{const s=e.step.icon||e.stepper.inactiveIcon;if(a.value===!0){const p=e.step.activeIcon||e.stepper.activeIcon;return p==="none"?s:p||r.iconSet.stepper.active}if(o.value===!0){const p=e.step.errorIcon||e.stepper.errorIcon;return p==="none"?s:p||r.iconSet.stepper.error}if(l.value===!1&&c.value===!0){const p=e.step.doneIcon||e.stepper.doneIcon;return p==="none"?s:p||r.iconSet.stepper.done}return s}),d=x(()=>{const s=o.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(a.value===!0){const p=e.step.activeColor||e.stepper.activeColor||e.step.color;return p!==void 0?p:s}return s!==void 0?s:l.value===!1&&c.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),b=x(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(d.value!==void 0?` text-${d.value}`:"")+(o.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(h.value===!0?"prefix":"icon"):"")+(a.value===!0?" q-stepper__tab--active":"")+(c.value===!0?" q-stepper__tab--done":"")+(m.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(l.value===!0?" q-stepper__tab--disabled":"")),E=x(()=>e.stepper.headerNav!==!0?!1:m.value);function T(){i.value!==null&&i.value.focus(),a.value===!1&&e.goToPanel(e.step.name)}function u(s){s.keyCode===13&&a.value===!1&&e.goToPanel(e.step.name)}return()=>{const s={class:b.value};m.value===!0&&(s.onClick=T,s.onKeyup=u,Object.assign(s,l.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:t.tabindex||0}));const p=[g("div",{class:"q-focus-helper",tabindex:-1,ref:i}),g("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[g("span",{class:"row flex-center"},[h.value===!0?e.step.prefix:g(N,{name:S.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const q=[g("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&q.push(g("div",{class:"q-stepper__caption"},e.step.caption)),p.push(g("div",{class:"q-stepper__label q-stepper__line relative-position"},q))}return ie(g("div",s,p),[[le,E.value]])}}});function se(e){return g("div",{class:"q-stepper__step-content"},[g("div",{class:"q-stepper__step-inner"},M(e.default))])}const J={setup(e,{slots:t}){return()=>se(t)}};var Ke=R({name:"QStep",props:{...we,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:t,emit:r}){const{proxy:{$q:i}}=O(),a=ce(Z,U);if(a===U)return console.error("QStep needs to be a child of QStepper"),U;const{getCacheWithFn:l}=ke(),o=G(null),c=x(()=>a.value.modelValue===e.name),m=x(()=>i.platform.is.ios!==!0&&i.platform.is.chrome===!0||c.value!==!0||a.value.vertical!==!0?{}:{onScroll(d){const{target:b}=d;b.scrollTop>0&&(b.scrollTop=0),e.onScroll!==void 0&&r("scroll",d)}}),h=x(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function S(){const d=a.value.vertical;return d===!0&&a.value.keepAlive===!0?g(ue,a.value.keepAliveProps.value,c.value===!0?[g(a.value.needsUniqueKeepAliveWrapper.value===!0?l(h.value,()=>({...J,name:h.value})):J,{key:h.value},t.default)]:void 0):d!==!0||c.value===!0?se(t):void 0}return()=>g("div",{ref:o,class:"q-stepper__step",role:"tabpanel",...m.value},a.value.vertical===!0?[g(re,{stepper:a.value,step:e,goToPanel:a.value.goToPanel}),a.value.animated===!0?g(Ue,S):S()]:[S()])}});const Me=/(-\w)/g;function He(e){const t={};for(const r in e){const i=r.replace(Me,a=>a[1].toUpperCase());t[i]=e[r]}return t}var Ge=R({name:"QStepper",props:{...de,...Fe,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:$e,setup(e,{slots:t}){const r=O(),i=pe(e,r.proxy.$q),{updatePanelsList:a,isValidPanelName:l,updatePanelIndex:o,getPanelContent:c,getPanels:m,panelDirectives:h,goToPanel:S,keepAliveProps:d,needsUniqueKeepAliveWrapper:b}=Ie();me(Z,x(()=>({goToPanel:S,keepAliveProps:d,needsUniqueKeepAliveWrapper:b,...e})));const E=x(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(i.value===!0?" q-stepper--dark q-dark":"")),T=x(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function u(){const s=M(t.message,[]);if(e.vertical===!0){l(e.modelValue)&&o();const p=g("div",{class:"q-stepper__content"},M(t.default));return s===void 0?[p]:s.concat(p)}return[g("div",{class:T.value},m().map(p=>{const q=He(p.props);return g(re,{key:q.name,stepper:e,step:q,goToPanel:S})})),s,ve("div",{class:"q-stepper__content q-panel-parent"},c(),"cont",e.swipeable,()=>h.value)]}return()=>(a(t),g("div",{class:E.value},fe(t.navigation,u())))}});const Oe=P({__name:"BaseRadio",props:{options:{type:Array,required:!0},name:{type:String,required:!0},label:{type:String,required:!0}},setup(e){const t=e,r=_e(t,"name"),{value:i}=Ee(r,void 0,{type:"radio",initialValue:t.options[0].value});return(a,l)=>(y(),k(he,{modelValue:f(i),"onUpdate:modelValue":l[0]||(l[0]=o=>ee(i)?i.value=o:null),type:"radio",options:e.options,inline:"",name:r.value},null,8,["modelValue","options","name"]))}});function ze(){const{data:e,isLoading:t,isError:r,isSuccess:i,refetch:a,isFetched:l}=z([W.CHECK_FOLDER_PERMISSIONS],()=>Be.run(),{select:o=>o});return{permissions:e,isLoading:t,isError:r,isSuccess:i,refetch:a,isFetched:l}}function We(){const{data:e,isLoading:t,error:r,isSuccess:i,refetch:a,isFetched:l}=z([W.CHECK_PHP_REQUIREMENTS],()=>Re.run(),{enabled:!1,select:o=>o});return{requirements:e,isLoading:t,error:r,isSuccess:i,refetch:a,isFetched:l}}function Ye(){const{data:e,isLoading:t,error:r,isSuccess:i,refetch:a,isFetched:l}=z([W.ACADEMIC_ENTITY_ALL,"faculties"],()=>De.run());return{data:e,isLoading:t,error:r,isSuccess:i,refetch:a,isFetched:l}}function Xe(){return ae(e=>Ve.run(e))}function Je(){return ae(e=>je.run(e))}const Ze={class:"row"},et={class:"col-12 row q-col-gutter-y-lg"},tt=_("div",{class:"col-12"},[_("div",{class:"text-h5 text-bold"},"Informaci\xF3n de la cuenta."),_("div",{class:"text-subtitle2"}," Los detalles a continuaci\xF3n se utilizar\xE1n para crear la cuenta principal de administrador. Tambi\xE9n puede cambiar los detalles en cualquier momento despu\xE9s de iniciar sesi\xF3n. ")],-1),at={class:"col-12"},rt=P({__name:"CapellanStep",emits:["next"],setup(e,{emit:t}){const{data:r}=Ye(),i=t,a=Le().shape({names:$().trim().min(2).required().label("Nombres"),username:$().trim().min(2).required().label("Nombre del usuario"),password:$().trim().min(2).required().label("Contrase\xF1a"),surnames:$().trim().required().label("Apellidos"),email:$().trim().email().required().label("Correo"),gender:$().trim().required().label("G\xE9nero"),academic_entity_id:$().trim().required().label("Facultad"),phone:X().typeError("Celular debe ser un numero").test("len","Celular debe tener 9 d\xEDgitos",d=>(d==null?void 0:d.toString().length)===9).integer().positive().required().label("Celular"),university_code:X().typeError("C\xF3digo universitario debe ser un numero").integer().test("len","C\xF3digo universitario debe tener 9 d\xEDgitos",d=>(d==null?void 0:d.toString().length)===9).positive().required().label("C\xF3digo universitario")}),{handleSubmit:l,setErrors:o}=Te({validationSchema:a}),{isLoading:c,mutateAsync:m}=Xe(),h=l(async d=>{await m(d,{onSuccess:async()=>{await Pe.run({name:d.username,password:d.password}),i("next"),ge.success("Usuario guardado correctamente..")},onError:b=>{b.data.errors&&o(b.data.errors)}})}),S=G([]);return be(r,d=>{d&&(S.value=d.filter(b=>b.parent_id===1).map(b=>({label:b.abbreviation||b.name,value:b.id})))},{immediate:!0}),(d,b)=>(y(),w("div",Ze,[_("div",et,[tt,n(Ae,{class:"col-12",onSubmit:f(h)},{actions:v(()=>[n(D,{class:"col-12 justify-start q-pa-none q-pt-md"},{default:v(()=>[n(Q,{color:"primary",loading:f(c),type:"submit",icon:"fas fa-floppy-disk",label:"Guardar y Continuar","no-caps":""},null,8,["loading"])]),_:1})]),default:v(()=>[n(F,{name:"names",label:"Nombres",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),n(F,{name:"surnames",label:"Apellidos",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),n(F,{name:"email",label:"Correo",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),n(F,{name:"phone",label:"Celular",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),n(F,{name:"university_code",label:"C\xF3digo Universitario",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),n(Qe,{options:S.value,name:"academic_entity_id",class:"col-xs-12 col-sm-6",label:"Facultad",loading:f(c),required:""},null,8,["options","loading"]),n(Oe,{class:"col-xs-12 col-sm-6 col-md-6",name:"gender",label:"G\xE9nero",required:"",options:[{label:"Masculino",value:"Masculino"},{label:"Femenino",value:"Femenino"}]}),_("div",at,[n(te)]),n(F,{name:"username",label:"Nombre de usuario",required:"",class:"col-xs-12 col-sm-6 col-md-6"}),n(F,{name:"password",type:"password",label:"Contrase\xF1a",required:"",class:"col-xs-12 col-sm-6 col-md-6"})]),_:1},8,["onSubmit"])])]))}}),st={};function nt(e,t){return y(),w("div",null,[(y(),w(V,null,j(3,r=>n(B,{key:r,dense:""},{default:v(()=>[n(C,null,{default:v(()=>[n(K,{type:"text",width:"50%"})]),_:1}),n(C,{side:""},{default:v(()=>[n(K,{width:"25px"})]),_:1}),n(C,{avatar:""},{default:v(()=>[n(K,{type:"QAvatar",size:"25px"})]),_:1})]),_:2},1024)),64))])}var ot=ye(st,[["render",nt]]);const it={class:"row"},lt={class:"col-xs-12 col-sm-10 col-md-9 row q-col-gutter-y-lg"},ct=_("div",{class:"col-12"},[_("div",{class:"text-h5 text-bold"},"Permisos de las carpetas."),_("div",{class:"text-subtitle2"}," A continuaci\xF3n se muestra la lista de permisos de carpeta necesarios para que la aplicaci\xF3n funcione. Si la verificaci\xF3n de permisos falla, aseg\xFArese de actualizar los permisos de su carpeta. ")],-1),ut={key:1,class:"justify-start col-12"},dt=P({__name:"FolderPermissionsStep",emits:["next","back"],setup(e){const{permissions:t,isFetched:r,isLoading:i,isError:a}=ze();return(l,o)=>(y(),w("div",it,[_("div",lt,[ct,f(i)?(y(),k(ot,{key:0,class:"col-12 justify-start"})):H("",!0),f(r)&&!f(i)&&f(t)?(y(),w("div",ut,[(y(!0),w(V,null,j(f(t).permissions,(c,m)=>(y(),k(B,{key:m,dense:""},{default:v(()=>[n(C,null,{default:v(()=>[I(A(c.folder),1)]),_:2},1024),n(C,{side:""},{default:v(()=>[I(A(c.current_permission),1)]),_:2},1024),n(C,{avatar:""},{default:v(()=>[n(N,{color:c.isSet?"positive":"negative",name:c.isSet?"fas fa-circle-check":"fas fa-circle-xmark"},null,8,["color","name"])]),_:2},1024)]),_:2},1024))),128))])):H("",!0),n(D,{class:"justify-start col-12"},{default:v(()=>{var c;return[n(Q,{color:"primary","no-caps":"",icon:"fas fa-arrow-right",label:"Continuar",disable:((c=f(t))==null?void 0:c.errors)||f(a),onClick:o[0]||(o[0]=m=>{var h;return((h=f(t))==null?void 0:h.errors)===!1&&l.$emit("next")})},null,8,["disable"])]}),_:1})])]))}}),pt={class:"row"},mt={class:"col-12 row q-col-gutter-y-lg"},ft=_("div",{class:"col-12"},[_("div",{class:"text-h5 text-bold"},"Iniciar periodo."),_("div",{class:"text-subtitle2"}," Por favor, ingresa la informaci\xF3n necesaria para definir el inicio y fin del periodo/ciclo. Esta informaci\xF3n ser\xE1 fundamental para la gesti\xF3n de las actividades en el sistema. ")],-1),vt=P({__name:"PeriodStep",setup(e){const{mutate:t,isLoading:r}=Je(),i=async()=>{t({profile_complete:"COMPLETED"},{onSuccess:async()=>{window.location.reload()}})};return(a,l)=>(y(),w("div",pt,[_("div",mt,[ft,n(Ne,{class:"col-xs-12 col-sm-10 col-md-8",onSubmit:i},{actions:v(({isLoading:o})=>[n(D,{class:"col-12 justify-start q-pa-none q-pt-md"},{default:v(()=>[n(Q,{color:"primary",loading:o||f(r),type:"submit",icon:"fas fa-floppy-disk",label:"Guardar y Continuar","no-caps":""},null,8,["loading"])]),_:2},1024)]),_:1})])]))}}),_t={class:"row"},ht={class:"col-xs-12 col-sm-10 col-md-9 row q-col-gutter-y-lg"},gt=_("div",{class:"col-12"},[_("div",{class:"text-h5 text-bold"},"Requisitos del sistema."),I(" Crater tiene algunos requisitos de servidor. Aseg\xFArese de que su servidor tenga la versi\xF3n de php requerida y todas las extensiones mencionadas a continuaci\xF3n. ")],-1),bt={key:0,class:"justify-start col-12"},yt=P({__name:"PhpRequirementsStep",emits:["next","back"],setup(e){const{refetch:t,requirements:r,isLoading:i,isFetched:a}=We(),l=x(()=>{var o;return!!(a.value===!1||((o=r.value)==null?void 0:o.phpSupportInfo.supported)===!1||r.value.errors)});return(o,c)=>(y(),w("div",_t,[_("div",ht,[gt,f(a)&&f(r)?(y(),w("div",bt,[n(B,{dense:""},{default:v(()=>[n(C,null,{default:v(()=>[I(" Php (version "+A(f(r).phpSupportInfo.minimum)+" requerida) ",1)]),_:1}),n(C,{side:""},{default:v(()=>[I(A(f(r).phpSupportInfo.current),1)]),_:1}),n(C,{avatar:""},{default:v(()=>[n(N,{color:f(r).phpSupportInfo.supported?"positive":"negative",name:f(r).phpSupportInfo.supported?"fas fa-circle-check":"fas fa-circle-xmark"},null,8,["color","name"])]),_:1})]),_:1}),n(te,{spaced:"",inset:""}),(y(!0),w(V,null,j(f(r).requirements,(m,h)=>(y(),k(B,{key:h,dense:""},{default:v(()=>[n(C,null,{default:v(()=>[I(A(h),1)]),_:2},1024),n(C,{avatar:""},{default:v(()=>[n(N,{color:m?"positive":"negative",name:m?"fas fa-circle-check":"fas fa-circle-xmark"},null,8,["color","name"])]),_:2},1024)]),_:2},1024))),128))])):H("",!0),n(D,{class:"justify-start col-12"},{default:v(()=>[l.value?(y(),k(Q,{key:0,color:"primary","no-caps":"",label:"Comprobar Requerimientos",loading:f(i),onClick:c[0]||(c[0]=m=>f(t)())},null,8,["loading"])):(y(),k(Q,{key:1,color:"primary","no-caps":"",icon:"fas fa-arrow-right",label:"Continuar",onClick:c[1]||(c[1]=m=>o.$emit("next"))}))]),_:1})])]))}}),xt={class:"row justify-center q-py-xl"},St={class:"col-xs-11 col-sm-10"},qt={class:"row justify-center"},Ct={class:"col-xs-6 col-sm-5 col-md-4"},wt={class:"col-12 q-mt-xl"},kt={components:{1:yt,2:dt,3:rt,4:vt}},Ht=P({...kt,__name:"InstallationIndex",setup(e){const{currentStep:t}=xe(Y()),{nextStep:r}=Y();return(i,a)=>(y(),k(Ce,{class:"bg-grey-4"},{default:v(()=>[_("div",xt,[_("div",St,[_("div",qt,[_("div",Ct,[n(Se,{class:"",src:"/upeu-banner.webp"})]),_("div",wt,[n(Ge,{ref:"stepper",modelValue:f(t),"onUpdate:modelValue":a[1]||(a[1]=l=>ee(t)?t.value=l:null),color:"primary",animated:"","transition-duration":1e3,contracted:""},{default:v(()=>[(y(),w(V,null,j(4,(l,o)=>n(Ke,{key:o,name:l,title:"","done-icon":"fas fa-circle-check",icon:"fas fa-circle",done:o<f(t)},{default:v(()=>[(y(),k(qe(f(t)+""),{onNext:a[0]||(a[0]=c=>f(r)())},null,32))]),_:2},1032,["name","done"])),64))]),_:1},8,["modelValue"])])])])])]),_:1}))}});export{Ht as default};
