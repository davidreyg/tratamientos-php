import{Y as B,o as v,e as y,w as p,a5 as i,ad as f,b3 as ae,aj as D,aE as se,aF as ne,W as re,b4 as de,b5 as ce,f as V,at as j,a2 as l,b6 as ue,a3 as me,b7 as be,av as G,b8 as ve,k as H,a1 as pe,ag as _e,H as L,ak as x,aK as z,a7 as W,a8 as J,aW as S,au as w,ab as K,aX as X,ac as P,x as fe,b9 as he,aQ as Y,a$ as Z,ba as ge,r as T,bb as A,bc as ee,$ as U,a_ as ye,bd as M,aU as k,a0 as O,be as Q,bf as qe,aM as $e,aI as we}from"./index.304978b5.js";import{O as te}from"./OrdenApi.d989ef2b.js";import{_ as Ee}from"./BaseTable.d86732fb.js";const Ce=D("div",{class:"col-12 text-bold text-italic"},"Datos Generales:",-1),ke=D("div",{class:"col-12 text-bold text-italic"}," Datos del Establecimiento de Origen: ",-1),De=D("div",{class:"col-12 text-bold text-italic"},"Datos del Medico:",-1),Ne=D("div",{class:"col-12 text-bold text-italic"},"Datos del paciente:",-1),Ve=B({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},setup(o){return($,b)=>(v(),y(ae,{class:"row"},{default:p(()=>[Ce,i(f,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:o.orden.diagnostico},null,8,["value"]),i(f,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:o.orden.CI10},null,8,["value"]),i(f,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:o.orden.CPN},null,8,["value"]),i(f,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:o.orden.EG},null,8,["value"]),i(f,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:o.orden.codigo_atencion},null,8,["value"]),i(f,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1,value:o.orden.fecha_registro},null,8,["value"]),ke,i(f,{name:"establecimiento_tipo",class:"col-xs-12 col-sm-4",label:"Tipo de Establecimiento",required:"",readonly:"",borderless:"",outlined:!1,value:o.orden.establecimiento?"Jurisdiccion":"Externo"},null,8,["value"]),i(f,{name:"establecimiento_id",class:"col-xs-12 col-sm-8",label:"Establecimiento Origen",required:"",readonly:"",borderless:"",outlined:!1,value:o.orden.establecimiento?o.orden.establecimiento.data.nombre:o.orden.establecimiento_otro},null,8,["value"]),De,i(f,{name:"medico",label:"Nombre",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1,value:o.orden.medico},null,8,["value"]),Ne,i(f,{name:"paciente",label:"Nombre",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:o.orden.paciente.data.nombre_completo},null,8,["value"]),i(f,{name:"documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:o.orden.paciente.data.numero_documento},null,8,["value"])]),_:1}))}});function je(o){const $=async()=>(await te.fetchAll(o.value)).data(),{data:b,isLoading:d,isSuccess:q,isError:h,isFetching:E,refetch:u}=se([ne.ORDEN_ALL,o==null?void 0:o.value],$,{keepPreviousData:!0});return{data:b,isLoading:d,isSuccess:q,isError:h,isFetching:E,refetch:u}}function xe(){return re(({id:o,data:$})=>te.updateExamens(o,$))}const Oe=B({__name:"BaseCheckBox",props:{name:{type:String,required:!0},label:{type:String,required:!0}},setup(o){const b=de(o,"name"),{value:d,handleChange:q,errorMessage:h}=ce(b);return(E,u)=>(v(),y(ve,{color:"black",borderless:"",error:!!l(h),"bottom-slots":"","hide-bottom-space":!l(h)},{error:p(()=>[V(j(l(h)),1)]),default:p(()=>[i(be,ue(E.$attrs,{modelValue:l(d),"onUpdate:modelValue":[u[0]||(u[0]=a=>me(d)?d.value=a:null),u[1]||(u[1]=a=>l(q)(a))],label:o.label}),null,16,["modelValue","label"]),G(E.$slots,"default")]),_:3},8,["error","hide-bottom-space"]))}}),Re={class:"row q-col-gutter-sm q-mb-sm"},Fe={key:0,class:"col-4 row q-col-gutter-sm"},Se={key:1,class:"col-4 row q-col-gutter-sm"},Ae={key:2,class:"col-4 row q-col-gutter-sm"},Qe={class:"row q-col-gutter-sm q-mb-sm"},Be={key:0,class:"row q-mt-md"},Me={class:"row"},Ie=B({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},examens:{type:Array,required:!0},items:{type:Array,required:!0},ordenId:{type:Number,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!0}},emits:["submit","cancel"],setup(o,{emit:$}){const b=$,d=o,q=H(()=>d.examens?d.examens.map(n=>({label:n.nombre,value:Number(n.id)})):[]),h=H(()=>d.items.map(n=>({label:n.nombre,value:Number(n.id)}))),{handleSubmit:E,setFieldValue:u,values:a}=pe({validationSchema:d.validationSchema,initialValues:d.initialValues}),{mutateAsync:I,reset:s,isLoading:e}=xe(),c=E(async(n,{setErrors:r})=>{await I({id:d.ordenId,data:n},{onSuccess:()=>{_e.success("Resultados actualizados correctamente"),b("submit"),s.value()},onError:_=>{s.value(),r(_.data.errors)}})},n=>console.log(n)),m=n=>{let r;return!!a.pivot[n].minimo&&!!a.pivot[n].minimo&&(r=`Min: ${a.pivot[n].minimo} - Max: ${a.pivot[n].maximo}`),r},N=n=>{let r;return!!a.pivot[n].minimo&&!!a.pivot[n].minimo&&(a.pivot[n].resultado>a.pivot[n].minimo&&a.pivot[n].resultado<a.pivot[n].maximo?r="green-2":r="red-2"),r},le=n=>{const r="pivot["+n+"].is_canceled",_=a.pivot[n].is_canceled;a.pivot[n].has_items&&a.pivot[n].items.forEach(g=>{const C="item_orden["+g.pivot_index+"].is_canceled";u(C,!_)}),u(r,!_)};return d.fields.forEach((n,r)=>{L(()=>a.pivot[r].unidad_id,_=>{if(_){const t=d.examens.find(g=>g.id==a.pivot[r].examen_id);if(!!t&&!!_){const g=t.pivot.find(F=>F.unidad_id===_),C="pivot["+r+"].minimo",R="pivot["+r+"].maximo";g&&(u(C,g.minimo),u(R,g.maximo))}}},{deep:!0,immediate:!0}),L(()=>a.pivot[r].is_canceled,_=>{const t="pivot["+r+"].minimo",g="pivot["+r+"].maximo";_&&(u(t,void 0),u(g,void 0)),a.pivot[r].items.forEach(R=>{const F="item_orden["+R.pivot_index+"].is_canceled";u(F,_)})},{deep:!0,immediate:!0}),L(()=>a.pivot[r].is_enabled,_=>{const t="pivot["+r+"].minimo",g="pivot["+r+"].maximo",C="pivot["+r+"].resultado",R="pivot["+r+"].unidad_id",F="pivot["+r+"].motivo";_||(u(t,void 0),u(g,void 0),u(C,null),u(R,null),u(F,null),a.pivot[r].items.forEach(oe=>{const ie="item_orden["+oe.pivot_index+"].is_enabled";u(ie,_)}))},{deep:!0,immediate:!0})}),(n,r)=>(v(),y(ae,{onSubmit:ge(l(c),["prevent"])},{default:p(()=>[i(Y,{bordered:""},{default:p(()=>[(v(!0),x(Z,null,z(o.examens,(_,t)=>(v(),y(W,{key:t},{default:p(()=>[i(J,null,{default:p(()=>[D("div",Re,[i(S,{label:"Examen",name:`pivot[${t}].examen_id`,options:q.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),_.tipo.toLowerCase()==="string"?(v(),x("div",Fe,[l(a).pivot[t].is_canceled?w("",!0):(v(),y(f,{key:0,name:`pivot[${t}].resultado`,"bg-color":N(t),label:"Resultado",class:"col-12",required:"",disable:!l(a).pivot[t].is_enabled},null,8,["name","bg-color","disable"])),l(a).pivot[t].is_canceled?(v(),y(f,{key:1,name:`pivot[${t}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!l(a).pivot[t].is_enabled},null,8,["name","disable"])):w("",!0)])):_.tipo.toLowerCase()==="unidad"?(v(),x("div",Se,[l(a).pivot[t].is_canceled?w("",!0):(v(),y(f,{key:0,name:`pivot[${t}].resultado`,"bg-color":N(t),label:"Resultado",class:"col-6",required:"",disable:!l(a).pivot[t].is_enabled},null,8,["name","bg-color","disable"])),!l(a).pivot[t].is_canceled&&!l(a).pivot[t].has_items?(v(),y(S,{key:1,label:"Unidad",name:`pivot[${t}].unidad_id`,options:l(a).pivot[t].unidads,hint:m(t),class:"col-6",required:"",disable:!l(a).pivot[t].is_enabled},null,8,["name","options","hint","disable"])):w("",!0),l(a).pivot[t].is_canceled?(v(),y(f,{key:2,name:`pivot[${t}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!l(a).pivot[t].is_enabled},null,8,["name","disable"])):w("",!0)])):_.tipo.toLowerCase()==="respuesta"?(v(),x("div",Ae,[l(a).pivot[t].is_canceled?w("",!0):(v(),y(S,{key:0,label:"Respuesta",name:`pivot[${t}].respuesta_id`,options:l(a).pivot[t].respuestas,class:"col-12",required:"",disable:!l(a).pivot[t].is_enabled},null,8,["name","options","disable"])),l(a).pivot[t].is_canceled?(v(),y(f,{key:1,name:`pivot[${t}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!l(a).pivot[t].is_enabled},null,8,["name","disable"])):w("",!0)])):w("",!0),i(f,{label:"Fecha",type:"date",name:`pivot[${t}].fecha_resultado`,required:"",class:"col-2",disable:!l(a).pivot[t].is_enabled},null,8,["name","disable"]),i(K,{class:"col-2 self-center justify-center"},{default:p(()=>[i(Oe,{name:`pivot[${t}].is_enabled`,label:"",dense:""},{default:p(()=>[i(X,null,{default:p(()=>[V(j(l(a).pivot[t].is_enabled?"Deshabilitar.":"Habilitar."),1)]),_:2},1024)]),_:2},1032,["name"]),i(P,{icon:l(a).pivot[t].is_canceled?"fas fa-pen":"fas fa-ban",color:l(a).pivot[t].is_canceled?"warning":"negative",disable:!l(a).pivot[t].is_enabled,round:"",flat:"",size:"sm",onClick:g=>le(t)},{default:p(()=>[i(X,null,{default:p(()=>[V(j(l(a).pivot[t].is_canceled?"Registrar datos.":"Cancelar examen."),1)]),_:2},1024)]),_:2},1032,["icon","color","disable","onClick"])]),_:2},1024)]),fe(i(Y,{bordered:""},{default:p(()=>[(v(!0),x(Z,null,z(l(a).pivot[t].items,(g,C)=>(v(),y(W,{key:C},{default:p(()=>[i(J,null,{default:p(()=>[D("div",Qe,[i(S,{label:"Item",name:`item_orden[${g.pivot_index}].item_id`,options:h.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),i(f,{name:`item_orden[${g.pivot_index}].resultado`,label:"Resultado",class:"col-2",required:"",disable:!l(a).pivot[t].is_enabled},null,8,["name","disable"]),i(S,{label:"Unidad",name:`item_orden[${g.pivot_index}].unidad_id`,options:l(a).item_orden[g.pivot_index].unidads,class:"col-2",required:"",disable:!l(a).pivot[t].is_enabled},null,8,["name","options","disable"])])]),_:2},1024)]),_:2},1024))),128))]),_:2},1536),[[he,l(a).pivot[t].is_enabled&&!l(a).pivot[t].is_canceled]])]),_:2},1024)]),_:2},1024))),128))]),_:1}),o.withObservaciones?(v(),x("div",Be,[i(f,{label:"Observaciones",type:"textarea",name:"observaciones",class:"col-12"})])):w("",!0),D("div",Me,[i(K,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:p(()=>[i(P,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:r[0]||(r[0]=_=>n.$emit("cancel"))}),i(P,{label:"Guardar",type:"submit",icon:"fas fa-floppy-disk",color:"primary",loading:l(e),"no-caps":""},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))}}),Ge=B({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!1,default:!1}},emits:["submit","cancel"],setup(o){const $=H(()=>b.orden.examens.data?b.orden.examens.data.map(s=>({label:s.nombre,value:Number(s.id)})):[]),b=o,d=T([]),q=T(),h=T();d.value=b.orden.pivot.map(s=>{let e=[];const c=b.orden.examens.data.find(m=>Number(m.id)==s.examen_id);return e=[{label:"Examen",name:"examen_id",type:"select",options:$.value},{label:"Resultado",name:"resultado",type:"string"},{label:"Unidad",name:"unidad_id",type:"select",options:c?c.unidads.data.map(m=>({label:m.nombre,value:Number(m.id)})):[]},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Acciones",name:"actions",type:"array"}],e});const E=A().of(ee(()=>{let s={};return s={examen_id:M().required().label("Examen"),resultado:M().when(["tipo"],{is:e=>e=="unidad",then:()=>k().positive().typeError("Debe ingresar un numero").label("Resultado")}).when(["tipo"],{is:e=>e==="string",then:()=>O().trim().label("Resultado")}).when(["tipo"],{is:e=>e==="respuesta",then:()=>O().trim().label("Resultado")}).when(["is_enabled","is_canceled","tipo"],{is:(e,c,m)=>e&&!c&&m.toLowerCase()!=="respuesta",then:e=>e.required(),otherwise:e=>e.nullable()}).transform((e,c)=>c===""?void 0:e),fecha_resultado:O().required().label("Fecha"),unidad_id:k().when(["is_enabled","is_canceled","has_items","tipo"],{is:(e,c,m,N)=>e&&!c&&!m&&N==="unidad",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Unidad"),is_canceled:Q().required().label("Cancelado?"),is_enabled:Q().required().label("Hablitad?"),has_items:Q().required().label("Tiene items?"),motivo:O().when(["is_enabled","is_canceled"],{is:!0,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Motivo"),minimo:k(),maximo:k(),unidads:A(),items:A(),respuestas:A(),tipo:O().required().label("Tipo")},U().shape(s)})),u=A().of(ee(()=>{let s={};return s={item_id:M().required().label("Item"),examen_id:M().required().label("Examen"),resultado:k().positive().when(["is_enabled","is_canceled"],{is:(e,c)=>e&&!c,then:e=>e.required(),otherwise:e=>e.nullable()}).transform((e,c)=>c===""?void 0:e).typeError("Debe ingresar un numero").label("Resultado"),unidad_id:k().when(["is_enabled","is_canceled"],{is:(e,c)=>e&&!c,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Unidad"),minimo:k(),maximo:k(),is_canceled:Q().required().label("Cancelado?"),is_enabled:Q().required().label("Habilitado?"),tipo:O().required().label("Tipo")},U().shape(s)}));q.value=U().shape({pivot:E,item_orden:u});const a=b.orden.pivot.map(s=>{var c;const e=b.orden.examens.data.find(m=>Number(m.id)==s.examen_id);return{examen_id:s.examen_id,resultado:s.resultado,fecha_resultado:(c=s.fecha_resultado)!=null?c:ye.now().toISODate(),unidad_id:s.unidad_id,respuesta_id:s.respuesta_id,is_canceled:s.is_canceled,is_enabled:!0,has_items:e?e.items.data.length>0:!1,tipo:e&&e.tipo.toLowerCase(),motivo:s.motivo,unidads:e?e.unidads.data.map(m=>({label:m.nombre,value:Number(m.id)})):[],respuestas:e?e.respuestas.data.map(m=>({label:m.nombre,value:Number(m.id)})):[],items:b.orden.items.data.map((m,N)=>({pivot_index:N,examen_id:m.examen_id})).filter(m=>m.examen_id===Number(e==null?void 0:e.id))}}),I=b.orden.item_orden.map(s=>{const e=b.orden.items.data.find(c=>Number(c.id)==s.item_id);return{item_id:s.item_id,examen_id:e==null?void 0:e.examen_id,resultado:s.resultado,unidad_id:s.unidad_id,is_canceled:s.is_canceled,is_enabled:!0,unidads:e?e.unidads.data.map(c=>({label:c.nombre,value:Number(c.id)})):[]}});return h.value={pivot:a,item_orden:I,observaciones:b.orden.observaciones},(s,e)=>d.value.length>0&&q.value?(v(),y(Ie,{key:0,fields:d.value,"validation-schema":q.value,"initial-values":h.value,"orden-id":Number(o.orden.id),examens:b.orden.examens.data,items:b.orden.items.data,"with-observaciones":o.withObservaciones,onCancel:e[0]||(e[0]=c=>s.$emit("cancel")),onSubmit:e[1]||(e[1]=c=>s.$emit("submit"))},null,8,["fields","validation-schema","initial-values","orden-id","examens","items","with-observaciones"])):w("",!0)}}),He=B({__name:"OrdenTable",props:{ordens:{type:Array,required:!0},loading:{type:Boolean,required:!1,default:!1},serverPagination:{type:Object,default:void 0}},emits:["request"],setup(o){const{formatDate:$}=we(),b=[{name:"index",label:"#",field:"index"},{name:"codigo_atencion",align:"center",label:"Codigo Atenci\xF3n",field:"codigo_atencion"},{name:"documento",align:"center",label:"N\xB0 Documento",field:d=>d.paciente.data.numero_documento},{name:"nombre_completo",align:"center",label:"Paciente",field:d=>d.paciente.data.nombre_completo},{name:"medico",align:"center",label:"Medico",field:"medico"},{name:"fecha_registro",align:"left",label:"Fecha Registro",field:"fecha_registro",format:d=>$(d)},{name:"diagnostico",align:"center",label:"Diagnostico",field:"diagnostico"},{name:"estado",align:"center",label:"Estado",field:"estado",sortable:!0},{name:"actions",align:"right",label:"Acciones",field:"actions"}];return(d,q)=>(v(),y(Ee,{data:o.ordens,columns:b,loading:o.loading,"row-key":"id","server-pagination":o.serverPagination,onRequest:q[0]||(q[0]=h=>d.$emit("request",h))},{top:p(()=>[G(d.$slots,"top")]),"body-cell-estado":p(({props:h})=>[i($e,{props:h},{default:p(()=>[i(qe,{color:h.row.estado_detalle.color,label:h.row.estado_detalle.label},null,8,["color","label"])]),_:2},1032,["props"])]),customActions:p(({props:h})=>[G(d.$slots,"custom-actions",{props:h})]),_:3},8,["data","loading","server-pagination"]))}});export{He as _,Ve as a,Ge as b,je as u};
