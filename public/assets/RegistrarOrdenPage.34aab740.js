import{W as U,Y as D,k as N,$ as I,a0 as r,b0 as F,aU as v,a1 as O,r as j,ag as W,H as z,o as p,e as h,w as t,a5 as e,ad as l,aW as B,aX as P,f as $,ac as w,aj as C,aS as H,a2 as c,aa as X,b1 as Y,aT as J,aG as Q,b2 as K,ak as Z,ab as ee,b3 as ae,b4 as te,b5 as k,a6 as oe,ae as ie,au as se}from"./index.d215a0e8.js";import{u as ne}from"./establecimientoFetchAllQuery.e7744208.js";import{O as re,u as A}from"./laboratorio.store.b1e5eaea.js";import{u as le}from"./paqueteFetchAllQuery.08c31761.js";import{_ as ce}from"./ExamenCardList.7dae952e.js";import{_ as ue}from"./BaseCheckBoxGroup.5c06bafb.js";import"./PaqueteApi.217fef36.js";function me(){return U(_=>re.create(_))}const de={class:"col-12"},be={class:"col-12"},pe={class:"col-12 row q-col-gutter-sm"},_e=D({__name:"OrdenCreateForm",props:{pacienteId:{type:Number,required:!0}},emits:["submit"],setup(_,{emit:f}){const q=_,m=f,{data:d}=le(),g=N(()=>d.value?d.value.map(a=>({label:a.nombre,value:Number(a.id)})):[]),{data:x}=ne(),y=N(()=>x.value?x.value.map(a=>({label:a.nombre,value:Number(a.id)})):[]),E=I().shape({diagnostico:r().trim().min(2).required().label("Diagnostico"),CI10:r().trim().min(2).required().label("CI10"),CPN:r().trim().min(2).required().label("CPN"),EG:r().trim().min(2).required().label("EG"),codigo_atencion:r().trim().min(2).required().label("Codigo de Atencion"),fecha_registro:r().trim().required().label("Fecha de Registro"),medico:r().trim().required().label("M\xE9dico"),examen_ids:F().of(v().required()).required().label("Examenes"),paquete_ids:F().of(v().required()).required().label("Paquetes"),establecimiento_id:v().when([],{is:()=>u.value,then:a=>a.required(),otherwise:a=>a.optional()}).label("Establecimiento Institucional"),establecimiento_otro:r().when([],{is:()=>!u.value,then:a=>a.required(),otherwise:a=>a.optional()}).label("Otro Establecimiento")}),{values:S,setFieldValue:i,handleSubmit:b}=O({validationSchema:E,initialValues:{examen_ids:[],paquete_ids:[],paciente_id:q.pacienteId}}),u=j(!0),{mutateAsync:T,reset:G,isLoading:L}=me(),R=b(async(a,{setErrors:o,resetForm:s})=>{await T(a,{onSuccess:()=>{W.success("Orden registrada correctamente."),s(),m("submit")},onError:n=>{G.value(),o(n.data.errors)}})});z(()=>S.examen_ids,a=>{var o;if(a){const s=(o=d.value)==null?void 0:o.filter(n=>n.examen_ids.every(M=>a.includes(M)));i("paquete_ids",(s==null?void 0:s.map(n=>Number(n.id)))||[])}});const V=a=>{var o;if(a){const s=(o=d.value)==null?void 0:o.filter(n=>a.includes(Number(n.id))).map(n=>n.examen_ids).flat();i("examen_ids",[...new Set(s)])}};return(a,o)=>(p(),h(X,{loading:c(L),onSubmit:c(R)},{default:t(()=>[e(l,{name:"medico",label:"Medico",class:"col-xs-12 col-sm-6",required:""}),u.value?(p(),h(B,{key:0,options:y.value,name:"establecimiento_id",class:"col-xs-12 col-sm-6",label:"Establecimiento Institucional",loading:!1,required:""},{after:t(()=>[e(w,{round:"",flat:"",icon:"fas fa-building-circle-arrow-right",color:"primary",onClick:o[0]||(o[0]=s=>u.value=!1)},{default:t(()=>[e(P,null,{default:t(()=>[$(" Otro establecimiento ")]),_:1})]),_:1})]),_:1},8,["options"])):(p(),h(l,{key:1,name:"establecimiento_otro",label:"Otro establecimiento",class:"col-xs-12 col-sm-6",required:""},{after:t(()=>[e(w,{round:"",flat:"",icon:"fas fa-building-circle-xmark",color:"negative",onClick:o[1]||(o[1]=s=>u.value=!0)},{default:t(()=>[e(P,null,{default:t(()=>[$(" Establecimiento institucional")]),_:1})]),_:1})]),_:1})),e(l,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:""}),e(l,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:""}),e(l,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:""}),e(l,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:""}),e(l,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:""}),e(l,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:""}),C("div",de,[e(H,{spaced:""}),$(" Paquetes")]),C("div",be,[e(ue,{name:"paquete_ids",label:"Paquetes",options:g.value,onUpdate:V},null,8,["options"])]),C("div",pe,[e(ce)])]),_:1},8,["loading","onSubmit"]))}}),fe={class:"row q-col-gutter-md"},qe={class:"col-12"},Se=D({__name:"RegistrarOrdenPage",setup(_){const{fetchPaciente:f,$reset:q}=A(),{paciente:m,isPacienteLoading:d}=Y(A()),{data:g}=J(),x=N(()=>g.value?g.value.map(i=>({label:i.nombre,value:i.id})):[]),y=I().shape({numero_documento:v().typeError("Debe ingresar un n\xFAmero").min(8).required().label("N\xFAmero de Documento"),tipo_documento_id:r().required().label("Tipo de Documento")}),{handleSubmit:E}=O({validationSchema:y}),S=E(async i=>{await f(i.numero_documento),m.value?Q.fire({title:"Exito!",text:"Paciente encontrado correctamente!",icon:"success"}):Q.fire({title:"Informaci\xF3n!",text:"No se encontro el paciente indicado!",icon:"info"})});return K(()=>{q()}),(i,b)=>(p(),Z("div",fe,[e(ae,{class:"col-12 row q-col-gutter-lg items-start justify-center",onSubmit:c(S)},{default:t(()=>[e(B,{options:x.value,name:"tipo_documento_id",class:"col-xs-12 col-sm-4",label:"Tipo de Documento",loading:!1,required:""},null,8,["options"]),e(l,{name:"numero_documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:""}),e(ee,{class:"col-auto justify-center"},{default:t(()=>[e(w,{color:"primary",outline:"",size:"lg",icon:"search",label:"Buscar","no-caps":"",type:"submit",loading:c(d)},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"]),C("div",qe,[e(k,{icon:"fas fa-person",label:"Datos del Paciente",caption:"Editar / Crear",class:"bg-purple-2"},{default:t(()=>[e(te,{class:"bg-purple-1",paciente:c(m),onCancel:c(q),onSubmit:b[0]||(b[0]=u=>c(f)(u))},null,8,["paciente","onCancel"])]),_:1}),c(m)?(p(),h(k,{key:0,icon:"fas fa-vials",label:"Datos de la Orden de Lab.",caption:"Editar / Crear"},{default:t(()=>[e(ie,null,{default:t(()=>[e(oe,null,{default:t(()=>[e(_e,{"paciente-id":Number(c(m).id),onSubmit:b[1]||(b[1]=u=>i.$router.push({name:"laboratorio.registrar"}))},null,8,["paciente-id"])]),_:1})]),_:1})]),_:1})):se("",!0)])]))}});export{Se as default};
