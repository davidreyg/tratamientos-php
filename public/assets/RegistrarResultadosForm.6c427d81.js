import{W as le,Y as B,o as p,e as h,w as y,a5 as d,ad as v,bc as ee,aj as R,b7 as ne,b8 as re,f as T,at as H,a2 as o,b9 as de,a3 as me,be as ue,av as ce,bb as be,k as P,a1 as pe,ag as ve,H as U,ak as S,aK as G,a7 as z,a8 as W,aW as F,au as q,ab as J,aX as K,ac as j,x as _e,bf as fe,aQ as X,a$ as Y,aL as he,bg as ye,r as A,b0 as I,bh as Z,$ as V,a_ as qe,bi as M,aU as w,a0 as C,bj as L}from"./index.aead979f.js";import{O as ge}from"./OrdenApi.bfe1c23a.js";function $e(){return le(({id:m,data:k})=>ge.updateExamens(m,k))}const we=R("div",{class:"col-12 text-bold text-italic"},"Datos Generales:",-1),Ce=R("div",{class:"col-12 text-bold text-italic"}," Datos del Establecimiento de Origen: ",-1),ke=R("div",{class:"col-12 text-bold text-italic"},"Datos del Medico:",-1),Ee=R("div",{class:"col-12 text-bold text-italic"},"Datos del paciente:",-1),Qe=B({__name:"OrdenDatosForm",props:{orden:{type:Object,required:!0}},setup(m){return(k,f)=>(p(),h(ee,{class:"row"},{default:y(()=>[we,d(v,{name:"diagnostico",label:"Diagnostico",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:m.orden.diagnostico},null,8,["value"]),d(v,{name:"CI10",label:"CI10",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:m.orden.CI10},null,8,["value"]),d(v,{name:"CPN",label:"CPN",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:m.orden.CPN},null,8,["value"]),d(v,{name:"EG",label:"EG",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:m.orden.EG},null,8,["value"]),d(v,{name:"codigo_atencion",label:"Codigo de Atenci\xF3n",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:m.orden.codigo_atencion},null,8,["value"]),d(v,{name:"fecha_registro",label:"Fecha de Registro",class:"col-xs-12 col-sm-4",type:"date",required:"",readonly:"",borderless:"",outlined:!1,value:m.orden.fecha_registro},null,8,["value"]),Ce,d(v,{name:"establecimiento_tipo",class:"col-xs-12 col-sm-4",label:"Tipo de Establecimiento",required:"",readonly:"",borderless:"",outlined:!1,value:m.orden.establecimiento?"Jurisdiccion":"Externo"},null,8,["value"]),d(v,{name:"establecimiento_id",class:"col-xs-12 col-sm-8",label:"Establecimiento Origen",required:"",readonly:"",borderless:"",outlined:!1,value:m.orden.establecimiento?m.orden.establecimiento.data.nombre:m.orden.establecimiento_otro},null,8,["value"]),ke,d(v,{name:"medico",label:"Nombre",class:"col-xs-12 col-sm-6",required:"",readonly:"",borderless:"",outlined:!1,value:m.orden.medico},null,8,["value"]),Ee,d(v,{name:"paciente",label:"Nombre",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:m.orden.paciente.data.nombre_completo},null,8,["value"]),d(v,{name:"documento",label:"N\xB0 de Documento",class:"col-xs-12 col-sm-4",required:"",readonly:"",borderless:"",outlined:!1,value:m.orden.paciente.data.numero_documento},null,8,["value"])]),_:1}))}}),Ne=B({__name:"BaseCheckBox",props:{name:{type:String,required:!0},label:{type:String,required:!0}},setup(m){const f=ne(m,"name"),{value:_,handleChange:E,errorMessage:$}=re(f);return(D,b)=>(p(),h(be,{color:"black",borderless:"",error:!!o($),"bottom-slots":"","hide-bottom-space":!o($)},{error:y(()=>[T(H(o($)),1)]),default:y(()=>[d(ue,de(D.$attrs,{modelValue:o(_),"onUpdate:modelValue":[b[0]||(b[0]=a=>me(_)?_.value=a:null),b[1]||(b[1]=a=>o(E)(a))],label:m.label}),null,16,["modelValue","label"]),ce(D.$slots,"default")]),_:3},8,["error","hide-bottom-space"]))}}),xe={class:"row q-col-gutter-sm q-mb-sm"},Re={key:0,class:"col-4 row q-col-gutter-sm"},De={key:1,class:"col-4 row q-col-gutter-sm"},Oe={key:2,class:"col-4 row q-col-gutter-sm"},Se={class:"row q-col-gutter-sm q-mb-sm"},Fe={key:0,class:"row q-mt-md"},Ie={class:"row"},Me=B({__name:"ResultadoFormDinamico",props:{fields:{type:Array,required:!0},examens:{type:Array,required:!0},items:{type:Array,required:!0},ordenId:{type:Number,required:!0},initialValues:{type:Object,required:!1,default:void 0},validationSchema:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!0}},emits:["submit","cancel"],setup(m,{emit:k}){const f=k,_=m,E=P(()=>_.examens?_.examens.map(t=>({label:t.nombre,value:Number(t.id)})):[]),$=P(()=>_.items.map(t=>({label:t.nombre,value:Number(t.id)}))),{handleSubmit:D,setFieldValue:b,values:a}=pe({validationSchema:_.validationSchema,initialValues:_.initialValues}),{mutateAsync:Q,reset:l,isLoading:e}=$e(),r=D(async(t,{setErrors:s})=>{await Q({id:_.ordenId,data:t},{onSuccess:()=>{ve.success("Resultados actualizados correctamente"),f("submit"),l.value()},onError:c=>{l.value(),s(c.data.errors)}})},t=>console.log(t)),u=t=>{let s;return!!a.pivot[t].minimo&&!!a.pivot[t].minimo&&(s=`Min: ${a.pivot[t].minimo} - Max: ${a.pivot[t].maximo}`),s},O=t=>{let s;return!!a.pivot[t].minimo&&!!a.pivot[t].minimo&&(a.pivot[t].resultado>a.pivot[t].minimo&&a.pivot[t].resultado<a.pivot[t].maximo?s="green-2":s="red-2"),s},ae=t=>{let s;return!!a.item_orden[t].minimo&&!!a.item_orden[t].minimo&&(s=`Min: ${a.item_orden[t].minimo} - Max: ${a.item_orden[t].maximo}`),s},ie=t=>{let s;return!!a.item_orden[t].minimo&&!!a.item_orden[t].minimo&&(a.item_orden[t].resultado>a.item_orden[t].minimo&&a.item_orden[t].resultado<a.item_orden[t].maximo?s="green-2":s="red-2"),s},te=t=>{const s="pivot["+t+"].is_canceled",c=a.pivot[t].is_canceled;a.pivot[t].has_items&&a.pivot[t].items.forEach(n=>{const g="item_orden["+n.pivot_index+"].is_canceled";b(g,!c)}),b(s,!c)};return _.fields.forEach((t,s)=>{U(()=>a.pivot[s].unidad_id,c=>{if(c){const i=_.examens.find(n=>n.id==a.pivot[s].examen_id);if(!!i&&!!c){const n=i.pivot.find(x=>x.unidad_id===c),g="pivot["+s+"].minimo",N="pivot["+s+"].maximo";n&&(b(g,n.minimo),b(N,n.maximo))}}},{deep:!0,immediate:!0}),U(()=>a.pivot[s].is_canceled,c=>{const i="pivot["+s+"].minimo",n="pivot["+s+"].maximo";c&&(b(i,void 0),b(n,void 0)),a.pivot[s].items.forEach(N=>{const x="item_orden["+N.pivot_index+"].is_canceled";b(x,c)})},{deep:!0,immediate:!0}),U(()=>a.pivot[s].is_enabled,c=>{const i="pivot["+s+"].minimo",n="pivot["+s+"].maximo",g="pivot["+s+"].resultado",N="pivot["+s+"].unidad_id",x="pivot["+s+"].motivo";c||(b(i,void 0),b(n,void 0),b(g,null),b(N,null),b(x,null),a.pivot[s].items.forEach(oe=>{const se="item_orden["+oe.pivot_index+"].is_enabled";b(se,c)}))},{deep:!0,immediate:!0})}),_.items.forEach((t,s)=>{U(()=>a.item_orden[s].unidad_id,c=>{if(c){const i=_.items.find(n=>n.id==a.item_orden[s].item_id);if(!!i&&!!c){const n=i.pivot.find(x=>x.unidad_id===c),g="item_orden["+s+"].minimo",N="item_orden["+s+"].maximo";n&&(b(g,n.minimo),b(N,n.maximo))}}},{deep:!0,immediate:!0})}),(t,s)=>(p(),h(ee,{onSubmit:ye(o(r),["prevent"])},{default:y(()=>[d(X,{bordered:""},{default:y(()=>[(p(!0),S(Y,null,G(m.examens,(c,i)=>(p(),h(z,{key:i},{default:y(()=>[d(W,null,{default:y(()=>[R("div",xe,[d(F,{label:"Examen",name:`pivot[${i}].examen_id`,options:E.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),c.tipo.toLowerCase()==="string"?(p(),S("div",Re,[o(a).pivot[i].is_canceled?q("",!0):(p(),h(v,{key:0,name:`pivot[${i}].resultado`,"bg-color":O(i),label:"Resultado",class:"col-12",required:"",disable:!o(a).pivot[i].is_enabled},null,8,["name","bg-color","disable"])),o(a).pivot[i].is_canceled?(p(),h(v,{key:1,name:`pivot[${i}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!o(a).pivot[i].is_enabled},null,8,["name","disable"])):q("",!0)])):c.tipo.toLowerCase()==="unidad"?(p(),S("div",De,[o(a).pivot[i].is_canceled?q("",!0):(p(),h(v,{key:0,name:`pivot[${i}].resultado`,"bg-color":O(i),label:"Resultado",class:"col-6",required:"",disable:!o(a).pivot[i].is_enabled},null,8,["name","bg-color","disable"])),!o(a).pivot[i].is_canceled&&!o(a).pivot[i].has_items?(p(),h(F,{key:1,label:"Unidad",name:`pivot[${i}].unidad_id`,options:o(a).pivot[i].unidads,hint:u(i),class:"col-6",required:"",disable:!o(a).pivot[i].is_enabled},null,8,["name","options","hint","disable"])):q("",!0),o(a).pivot[i].is_canceled?(p(),h(v,{key:2,name:`pivot[${i}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!o(a).pivot[i].is_enabled},null,8,["name","disable"])):q("",!0)])):c.tipo.toLowerCase()==="respuesta"?(p(),S("div",Oe,[o(a).pivot[i].is_canceled?q("",!0):(p(),h(F,{key:0,label:"Respuesta",name:`pivot[${i}].respuesta_id`,options:o(a).pivot[i].respuestas,class:"col-12",required:"",disable:!o(a).pivot[i].is_enabled},null,8,["name","options","disable"])),o(a).pivot[i].is_canceled?(p(),h(v,{key:1,name:`pivot[${i}].motivo`,label:"Motivo",class:"col-12",required:"",disable:!o(a).pivot[i].is_enabled},null,8,["name","disable"])):q("",!0)])):q("",!0),d(v,{label:"Fecha",type:"date",name:`pivot[${i}].fecha_resultado`,required:"",class:"col-2",disable:!o(a).pivot[i].is_enabled},null,8,["name","disable"]),d(J,{class:"col-2 self-center justify-center"},{default:y(()=>[d(Ne,{name:`pivot[${i}].is_enabled`,label:"",dense:""},{default:y(()=>[d(K,null,{default:y(()=>[T(H(o(a).pivot[i].is_enabled?"Deshabilitar.":"Habilitar."),1)]),_:2},1024)]),_:2},1032,["name"]),d(j,{icon:o(a).pivot[i].is_canceled?"fas fa-pen":"fas fa-ban",color:o(a).pivot[i].is_canceled?"warning":"negative",disable:!o(a).pivot[i].is_enabled,round:"",flat:"",size:"sm",onClick:n=>te(i)},{default:y(()=>[d(K,null,{default:y(()=>[T(H(o(a).pivot[i].is_canceled?"Registrar datos.":"Cancelar examen."),1)]),_:2},1024)]),_:2},1032,["icon","color","disable","onClick"])]),_:2},1024)]),_e(d(X,{bordered:""},{default:y(()=>[(p(!0),S(Y,null,G(o(a).pivot[i].items,(n,g)=>(p(),h(z,{key:g},{default:y(()=>[d(W,null,{default:y(()=>[R("div",Se,[d(F,{label:"Item",name:`item_orden[${n.pivot_index}].item_id`,options:$.value,class:"col-4",required:"",borderless:"",readonly:"",outlined:!1},null,8,["name","options"]),o(a).item_orden[n.pivot_index].tipo!=="respuesta"?(p(),h(v,{key:0,name:`item_orden[${n.pivot_index}].resultado`,label:"Resultado",class:he(o(a).item_orden[n.pivot_index].tipo==="unidad"?"col-2":"col-4"),required:"",disable:!o(a).pivot[i].is_enabled,"bg-color":ie(n.pivot_index)},null,8,["name","class","disable","bg-color"])):q("",!0),o(a).item_orden[n.pivot_index].tipo==="unidad"?(p(),h(F,{key:1,label:"Unidad",name:`item_orden[${n.pivot_index}].unidad_id`,options:o(a).item_orden[n.pivot_index].unidads,class:"col-2",required:"",disable:!o(a).pivot[i].is_enabled,hint:ae(n.pivot_index)},null,8,["name","options","disable","hint"])):q("",!0),o(a).item_orden[n.pivot_index].tipo==="respuesta"?(p(),h(F,{key:2,label:"Respuesta",name:`item_orden[${n.pivot_index}].respuesta_id`,options:o(a).item_orden[n.pivot_index].respuestas,class:"col-4",required:"",disable:!o(a).pivot[i].is_enabled},null,8,["name","options","disable"])):q("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:2},1536),[[fe,o(a).pivot[i].is_enabled&&!o(a).pivot[i].is_canceled]])]),_:2},1024)]),_:2},1024))),128))]),_:1}),m.withObservaciones?(p(),S("div",Fe,[d(v,{label:"Observaciones",type:"textarea",name:"observaciones",class:"col-12"})])):q("",!0),R("div",Ie,[d(J,{class:"col-12 justify-end q-pa-none q-pt-md"},{default:y(()=>[d(j,{label:"Cancelar",color:"primary","no-caps":"",outline:"",onClick:s[0]||(s[0]=c=>t.$emit("cancel"))}),d(j,{label:"Guardar",type:"submit",icon:"fas fa-floppy-disk",color:"primary",loading:o(e),"no-caps":""},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))}}),je=B({__name:"RegistrarResultadosForm",props:{orden:{type:Object,required:!0},withObservaciones:{type:Boolean,required:!1,default:!1}},emits:["submit","cancel"],setup(m){const k=P(()=>f.orden.examens.data?f.orden.examens.data.map(l=>({label:l.nombre,value:Number(l.id)})):[]),f=m,_=A([]),E=A(),$=A();_.value=f.orden.pivot.map(l=>{let e=[];const r=f.orden.examens.data.find(u=>Number(u.id)==l.examen_id);return e=[{label:"Examen",name:"examen_id",type:"select",options:k.value},{label:"Resultado",name:"resultado",type:"string"},{label:"Unidad",name:"unidad_id",type:"select",options:r?r.unidads.data.map(u=>({label:u.nombre,value:Number(u.id)})):[]},{label:"Fecha",name:"fecha_resultado",type:"date"},{label:"Acciones",name:"actions",type:"array"}],e});const D=I().of(Z(()=>{let l={};return l={examen_id:M().required().label("Examen"),resultado:M().when(["tipo"],{is:e=>e=="unidad",then:()=>w().positive().typeError("Debe ingresar un numero").label("Resultado")}).when(["tipo"],{is:e=>e==="string",then:()=>C().trim().label("Resultado")}).when(["tipo"],{is:e=>e==="respuesta",then:()=>C().trim().label("Resultado")}).when(["is_enabled","is_canceled","tipo"],{is:(e,r,u)=>e&&!r&&u.toLowerCase()!=="respuesta",then:e=>e.required(),otherwise:e=>e.nullable()}).transform((e,r)=>r===""?void 0:e),fecha_resultado:C().required().label("Fecha"),unidad_id:w().when(["is_enabled","is_canceled","has_items","tipo"],{is:(e,r,u,O)=>e&&!r&&!u&&O==="unidad",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Unidad"),is_canceled:L().required().label("Cancelado?"),is_enabled:L().required().label("Hablitad?"),has_items:L().required().label("Tiene items?"),motivo:C().when(["is_enabled","is_canceled"],{is:!0,then:e=>e.required(),otherwise:e=>e.nullable()}).label("Motivo"),minimo:w(),maximo:w(),unidads:I(),items:I(),respuestas:I(),tipo:C().required().label("Tipo")},V().shape(l)})),b=I().of(Z(()=>{let l={};return l={item_id:M().required().label("Item"),examen_id:M().required().label("Examen"),resultado:M().when(["tipo"],{is:e=>e=="unidad",then:()=>w().positive().typeError("Debe ingresar un numero").label("Resultado")}).when(["tipo"],{is:e=>e==="string",then:()=>C().trim().label("Resultado")}).when(["tipo"],{is:e=>e==="respuesta",then:()=>C().trim().label("Resultado")}).when(["is_enabled","is_canceled","tipo"],{is:(e,r,u)=>e&&!r&&u.toLowerCase()!=="respuesta",then:e=>e.required(),otherwise:e=>e.nullable()}).transform((e,r)=>r===""?void 0:e),unidad_id:w().when(["is_enabled","is_canceled","tipo"],{is:(e,r,u)=>e&&!r&&u==="unidad",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Unidad"),minimo:w(),maximo:w(),is_canceled:L().required().label("Cancelado?"),is_enabled:L().required().label("Habilitado?"),respuestas:I(),tipo:C().required().label("Tipo")},V().shape(l)}));E.value=V().shape({pivot:D,item_orden:b});const a=f.orden.pivot.map(l=>{var r;const e=f.orden.examens.data.find(u=>Number(u.id)==l.examen_id);return{examen_id:l.examen_id,resultado:l.resultado,fecha_resultado:(r=l.fecha_resultado)!=null?r:qe.now().toISODate(),unidad_id:l.unidad_id,respuesta_id:l.respuesta_id,is_canceled:l.is_canceled,is_enabled:!0,has_items:e?e.items.data.length>0:!1,tipo:e&&e.tipo.toLowerCase(),motivo:l.motivo,unidads:e?e.unidads.data.map(u=>({label:u.nombre,value:Number(u.id)})):[],respuestas:e?e.respuestas.data.map(u=>({label:u.nombre,value:Number(u.id)})):[],items:f.orden.items.data.map((u,O)=>({pivot_index:O,examen_id:u.examen_id})).filter(u=>u.examen_id===Number(e==null?void 0:e.id))}}),Q=f.orden.item_orden.map(l=>{const e=f.orden.items.data.find(r=>Number(r.id)==l.item_id);return{item_id:l.item_id,examen_id:e==null?void 0:e.examen_id,resultado:l.resultado,unidad_id:l.unidad_id,respuesta_id:l.respuesta_id,is_canceled:l.is_canceled,is_enabled:!0,tipo:e&&e.tipo.toLowerCase(),unidads:e?e.unidads.data.map(r=>({label:r.nombre,value:Number(r.id)})):[],respuestas:e?e.respuestas.data.map(r=>({label:r.nombre,value:Number(r.id)})):[]}});return $.value={pivot:a,item_orden:Q,observaciones:f.orden.observaciones},(l,e)=>_.value.length>0&&E.value?(p(),h(Me,{key:0,fields:_.value,"validation-schema":E.value,"initial-values":$.value,"orden-id":Number(m.orden.id),examens:f.orden.examens.data,items:f.orden.items.data,"with-observaciones":m.withObservaciones,onCancel:e[0]||(e[0]=r=>l.$emit("cancel")),onSubmit:e[1]||(e[1]=r=>l.$emit("submit"))},null,8,["fields","validation-schema","initial-values","orden-id","examens","items","with-observaciones"])):q("",!0)}});export{Qe as _,je as a};
