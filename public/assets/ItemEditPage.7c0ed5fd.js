import{aH as ge,aI as $e,W as qe,Y as ee,k as v,r as I,$ as B,a0 as U,aV as u,b6 as z,a1 as xe,b7 as Y,H as ke,o as l,ak as d,a5 as a,w as i,aX as b,ad as Q,a2 as s,aj as q,b8 as D,ac as C,at as H,au as c,aQ as J,a9 as K,f as P,aE as W,aK as X,e as x,a8 as G,x as we,a7 as Z,aa as Se,ag as N,b9 as Qe,ay as Ee,ae as Ue}from"./index.cb32cbc7.js";import{_ as Ce}from"./SkeletonForm.61e192aa.js";import{u as Fe}from"./examenFetchAllQuery.a1e5f01b.js";import{u as Ie,a as Ne,b as Ve}from"./unidadTiposFetchAllQuery.f58b68a0.js";import{I as ae}from"./ItemApi.fbfc929f.js";import{u as Re}from"./seccionFetchAllQuery.7abee3bc.js";import{u as Ae}from"./operadoresFetchAllQuery.f77dd1ee.js";import{u as Oe}from"./unidadFetchAllQuery.e5b29af3.js";import"./ExamenApi.cd14626e.js";import"./UnidadApi.e9700d89.js";import"./SeccionApi.5e16f97a.js";function Me(n,m){const _=async()=>(await ae.fetchOne(n)).data().data,{data:p,isLoading:f,isSuccess:h,isError:k,isFetching:y,refetch:g}=ge([$e.ITEM_ALL,n],_,{enabled:m});return{data:p,isLoading:f,isSuccess:h,isError:k,isFetching:y,refetch:g}}function Te(){return qe(({data:n,id:m})=>ae.update(n,m))}const je={class:"row"},Le={key:0,class:"col-xs-12 col-sm-12"},Be={class:"row"},ze={key:0,class:"text-red text-italic"},Ye={class:"row q-col-gutter-sm q-mb-sm"},De={class:"col-auto self-center"},He={key:1,class:"col-xs-12 col-sm-12"},Je={class:"row"},Ke={key:0,class:"text-red text-italic"},Pe={class:"row q-col-gutter-sm q-mb-sm"},We={class:"col-4 self-center"},Xe=ee({__name:"ItemEditForm",props:{item:{type:Object,required:!0}},emits:["submit","cancel"],setup(n,{emit:m}){const _=n,p=m,{data:f}=Re(),h=v(()=>f.value?f.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),k=I({limit:0,search:"is_active:1",searchJoin:"and"}),{data:y}=Fe(k),g=v(()=>y.value?y.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:F}=Ie(),se=v(()=>F.value?Object.values(F.value).map(e=>({label:e,value:e})):[]),{data:V}=Oe(),R=v(()=>V.value?Object.values(V.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:A}=Ne(),O=v(()=>A.value?Object.values(A.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:M}=Ve(),te=v(()=>M.value?Object.values(M.value).map(e=>({label:e,value:e})):[]),{data:T}=Ae(),oe=v(()=>T.value?Object.entries(T.value).map(([e,t])=>({label:`${t} (${e})`,value:e})):[]),w=I(),S=I(),le=B().shape({nombre:U().trim().min(2).required().label("Nombre"),codigo:u().typeError("Codigo debe ser un numero").positive().required().label("Codigo"),tipo:U().trim().min(2).required().label("Tipo"),seccion_id:u().required().label("Seccion"),examen_id:u().required().label("Examen"),pivot:z().when(["tipo"],{is:e=>e==="unidad",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(B().shape({unidad_id:u().typeError("Unidad debe ser un numero").positive().required().label("Unidad"),item_id:u().typeError("Item debe ser un numero").positive().label("Item"),minimo:u().typeError("Minimo debe ser un numero").min(0).required().label("Minimo"),maximo:u().typeError("Maximo debe ser un numero").positive().when(["tipo"],{is:e=>e==="multivalor",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Maximo"),tipo:U().required().label("Tipo"),operador:U().when(["tipo"],{is:e=>e==="operador",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Operador")})).label("Unidades"),respuesta_ids:z().when(["tipo"],{is:e=>e==="respuesta",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(u().required()).label("Respuestas")}),{handleSubmit:re,setErrors:ie,values:$,errors:E,setFieldValue:ne}=xe({validationSchema:le,initialValues:{..._.item}}),{remove:ue,push:de,fields:j}=Y("pivot"),{remove:ce,push:me,fields:L}=Y("respuesta_ids"),pe=e=>{if(j.value.some(r=>r.value.unidad_id===e.value)){N.warn("Ya has agregado este item");return}de({unidad_id:Number(e.value)}),w.value=void 0},ve=e=>{if(L.value.some(r=>r.value===e.value)){N.warn("Ya has agregado este item");return}me(Number(e.value)),S.value=void 0},{isLoading:be,mutate:_e,reset:fe}=Te(),he=re(async e=>{_e({data:e,id:_.item.id},{onSuccess:()=>{p("submit")},onError:t=>{fe.value(),ie(t.data.errors)}})},e=>{console.log(e.errors)});return ke(()=>$.tipo,e=>{e&&ne("pivot",[])}),(e,t)=>(l(),d("div",je,[a(Se,{class:"col-xs-12 col-sm-10",loading:s(be),onSubmit:s(he),onCancel:t[4]||(t[4]=r=>e.$emit("cancel"))},{default:i(()=>[a(b,{options:g.value,name:"examen_id",label:"Examen",class:"col-12"},null,8,["options"]),a(b,{options:h.value,name:"seccion_id",label:"Seccion",class:"col-xs-12 col-sm-6"},null,8,["options"]),a(Q,{name:"codigo",label:"Codigo",class:"col-xs-12 col-sm-6"}),a(Q,{name:"nombre",label:"Nombre",class:"col-xs-12 col-sm-6"}),a(b,{options:se.value,name:"tipo",label:"Tipo",class:"col-xs-12 col-sm-6"},null,8,["options"]),s($).tipo==="unidad"?(l(),d("div",Le,[q("div",Be,[a(D,{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=r=>w.value=r),options:R.value,borderless:"",dense:"",name:"unidadees1",label:"Unidades",class:"col-4 q-mb-md"},{after:i(()=>[a(C,{disable:!w.value,round:"",dense:"",icon:"add",color:"positive",onClick:t[0]||(t[0]=r=>pe(w.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),s(E).pivot?(l(),d("div",ze,H(s(E).pivot),1)):c("",!0),a(J,{bordered:""},{default:i(()=>[a(K,{header:""},{default:i(()=>[P("Seleccionar Unidades")]),_:1}),(l(!0),d(W,null,X(s(j),(r,o)=>(l(),x(Z,{key:o},{default:i(()=>[a(G,null,{default:i(()=>[q("div",Ye,[we(a(Q,{label:"examen",name:`pivot[${o}].examen_id`,class:"col-3",required:""},null,8,["name"]),[[Qe,!1]]),a(b,{label:"Unidades",name:`pivot[${o}].unidad_id`,options:R.value,class:"col-2",required:""},null,8,["name","options"]),s($).pivot[o].tipo==="operador"?(l(),x(b,{key:0,name:`pivot[${o}].operador`,options:oe.value,label:"Operador",class:"col-3"},null,8,["name","options"])):c("",!0),a(Q,{name:`pivot[${o}].minimo`,label:s($).pivot[o].tipo==="multivalor"?"Minimo":"Valor",class:"col-3"},null,8,["name","label"]),s($).pivot[o].tipo==="multivalor"?(l(),x(Q,{key:1,name:`pivot[${o}].maximo`,label:"Maximo",class:"col-3"},null,8,["name"])):c("",!0),a(b,{options:te.value,name:`pivot[${o}].tipo`,label:"Tipo",class:"col-3"},null,8,["options","name"]),q("div",De,[a(C,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:ye=>s(ue)(o)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):c("",!0),s($).tipo==="respuesta"?(l(),d("div",He,[q("div",Je,[a(D,{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=r=>S.value=r),options:O.value,borderless:"",dense:"",name:"respuestas1",label:"Respuesta",class:"col-4 q-mb-md"},{after:i(()=>[a(C,{disable:!S.value,round:"",dense:"",icon:"add",color:"positive",onClick:t[2]||(t[2]=r=>ve(S.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),s(E).respuesta_ids?(l(),d("div",Ke,H(s(E).respuesta_ids),1)):c("",!0),a(J,{bordered:""},{default:i(()=>[a(K,{header:""},{default:i(()=>[P("Seleccionar Respuestas")]),_:1}),(l(!0),d(W,null,X(s(L),(r,o)=>(l(),x(Z,{key:o},{default:i(()=>[a(G,null,{default:i(()=>[q("div",Pe,[a(b,{label:"Respuesta",name:`respuesta_ids[${o}]`,options:O.value,class:"col-8",required:""},null,8,["name","options"]),q("div",We,[a(C,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:ye=>s(ce)(o)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):c("",!0)]),_:1},8,["loading","onSubmit"])]))}}),Ge={class:"row"},da=ee({__name:"ItemEditPage",props:{id:{type:Number,required:!0}},setup(n){const m=n,_=Ee(),{data:p,isSuccess:f,isFetching:h}=Me(m.id,!0),k=()=>{N.success("Registro actualizado correctamente"),_.back()};return(y,g)=>(l(),d("div",Ge,[s(h)?(l(),x(Ue,{key:0,class:"col-xs-12 col-sm-10 q-pa-lg"},{default:i(()=>[a(Ce,{class:"col-12",inputs:3})]),_:1})):c("",!0),s(f)&&!s(h)&&s(p)?(l(),x(Xe,{key:1,class:"col-xs-12 col-sm-10",item:s(p),gol:s(p),onSubmit:k,onCancel:g[0]||(g[0]=F=>y.$router.back())},null,8,["item","gol"])):c("",!0)]))}});export{da as default};
