import{U as fe,X as Z,j as n,r as w,Z as O,$ as g,aU as u,b4 as j,a0 as he,b5 as T,af as C,o as r,aj as d,a4 as a,w as i,aW as c,ac as x,a1 as o,ai as p,b6 as B,ab as k,as as L,at as v,aP as z,a8 as D,e as J,aD as P,aJ as Y,d as h,a7 as W,a6 as X,a9 as $e}from"./index.ddaffeba.js";import{u as ye}from"./examenFetchAllQuery.20d85fdf.js";import{u as qe,a as ge}from"./unidadTiposFetchAllQuery.07a03bff.js";import{I as xe}from"./ItemApi.b2488c9f.js";import{u as ke}from"./respuestaFetchAllQuery.f782036c.js";import{u as Ue}from"./seccionFetchAllQuery.54902bf1.js";import{u as we}from"./operadoresFetchAllQuery.466338b0.js";import{u as Ce}from"./unidadFetchAllQuery.9ce1c223.js";import"./ExamenApi.fd374c57.js";import"./UnidadApi.ac181ce7.js";import"./RespuestaApi.7dfd3c6f.js";import"./SeccionApi.fb2c47e8.js";function Se(){return fe(U=>xe.create(U))}const Ne={class:"row"},Qe={key:0,class:"col-xs-12 col-sm-12"},Ee={class:"row"},Fe={key:0,class:"text-red text-italic"},Ve={class:"row q-col-gutter-sm q-mb-sm"},Re={class:"col-auto self-center"},Ae={key:1,class:"col-xs-12 col-sm-12"},Ie={class:"row"},Me={key:0,class:"text-red text-italic"},Oe={class:"row q-col-gutter-sm q-mb-sm"},je={class:"col-4 self-center"},Te=Z({__name:"ItemCreateForm",emits:["submit","cancel"],setup(U,{emit:$}){const m=$,{data:y}=Ue(),G=n(()=>y.value?y.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),H=w({limit:0,search:"is_active:1",searchJoin:"and"}),{data:S}=ye(H),K=n(()=>S.value?S.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:N}=qe(),ee=n(()=>N.value?Object.values(N.value).map(e=>({label:e,value:e})):[]),{data:Q}=Ce(),E=n(()=>Q.value?Object.values(Q.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:F}=ke(),V=n(()=>F.value?Object.values(F.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:R}=ge(),ae=n(()=>R.value?Object.values(R.value).map(e=>({label:e,value:e})):[]),{data:A}=we(),se=n(()=>A.value?Object.entries(A.value).map(([e,s])=>({label:`${s} (${e})`,value:e})):[]),oe=O().shape({nombre:g().trim().min(2).required().label("Nombre"),codigo:u().typeError("Codigo debe ser un numero").positive().required().label("Codigo"),tipo:g().trim().min(2).required().label("Tipo"),seccion_id:u().required().label("Seccion"),examen_id:u().required().label("Examen"),pivot:j().when(["tipo"],{is:e=>e==="unidad",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(O({unidad_id:u().typeError("Unidad debe ser un numero").positive().required().label("Unidad"),minimo:u().typeError("Minimo debe ser un numero").min(0).required().label("Minimo"),maximo:u().typeError("Maximo debe ser un numero").positive().when(["tipo"],{is:e=>e==="multivalor",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Maximo"),tipo:g().required().label("Tipo"),operador:g().when(["tipo"],{is:e=>e==="operador",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Operador")})).label("Unidades"),respuesta_ids:j().when(["tipo"],{is:e=>e==="respuesta",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(u().required()).label("Respuestas")}),{handleSubmit:te,setErrors:le,values:b,errors:q}=he({validationSchema:oe}),_=w(),f=w(),{remove:re,push:ie,fields:I}=T("pivot"),{remove:ne,push:ue,fields:M}=T("respuesta_ids"),de=e=>{if(I.value.some(l=>l.value.unidad_id===e.value)){C.warn("Ya has agregado este item");return}ie({unidad_id:Number(e.value)}),_.value=void 0},ce=e=>{if(M.value.some(l=>l.value===e.value)){C.warn("Ya has agregado este item");return}ue(Number(e.value)),f.value=void 0},{isLoading:me,mutate:pe,reset:ve}=Se(),be=te(async e=>{pe(e,{onSuccess:()=>{C.success(),m("submit")},onError:s=>{ve.value(),le(s.data.errors)}})},e=>{console.log(e.errors)});return(e,s)=>(r(),d("div",Ne,[a($e,{class:"col-xs-12 col-sm-10",loading:o(me),onSubmit:o(be),onCancel:s[4]||(s[4]=l=>e.$emit("cancel"))},{default:i(()=>[a(c,{options:K.value,name:"examen_id",label:"Examen",class:"col-12"},null,8,["options"]),a(c,{options:G.value,name:"seccion_id",label:"Seccion",class:"col-xs-12 col-sm-6"},null,8,["options"]),a(x,{name:"codigo",label:"Codigo",class:"col-xs-12 col-sm-6"}),a(x,{name:"nombre",label:"Nombre",class:"col-xs-12 col-sm-6"}),a(c,{options:ee.value,name:"tipo",label:"Tipo",class:"col-xs-12 col-sm-6"},null,8,["options"]),o(b).tipo==="unidad"?(r(),d("div",Qe,[p("div",Ee,[a(B,{modelValue:_.value,"onUpdate:modelValue":s[1]||(s[1]=l=>_.value=l),options:E.value,borderless:"",dense:"",name:"unidadees1",label:"Unidades",class:"col-4 q-mb-md"},{after:i(()=>[a(k,{disable:!_.value,round:"",dense:"",icon:"add",color:"positive",onClick:s[0]||(s[0]=l=>de(_.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),o(q).pivot?(r(),d("div",Fe,L(o(q).pivot),1)):v("",!0),a(z,{bordered:""},{default:i(()=>[a(D,{header:""},{default:i(()=>[J("Seleccionar Unidades")]),_:1}),(r(!0),d(P,null,Y(o(I),(l,t)=>(r(),h(X,{key:t},{default:i(()=>[a(W,null,{default:i(()=>[p("div",Ve,[a(c,{label:"Unidades",name:`pivot[${t}].unidad_id`,options:E.value,class:"col-2",required:""},null,8,["name","options"]),o(b).pivot[t].tipo==="operador"?(r(),h(c,{key:0,name:`pivot[${t}].operador`,options:se.value,label:"Operador",class:"col-3"},null,8,["name","options"])):v("",!0),a(x,{name:`pivot[${t}].minimo`,label:o(b).pivot[t].tipo==="multivalor"?"Minimo":"Valor",class:"col-3"},null,8,["name","label"]),o(b).pivot[t].tipo==="multivalor"?(r(),h(x,{key:1,name:`pivot[${t}].maximo`,label:"Maximo",class:"col-3"},null,8,["name"])):v("",!0),a(c,{options:ae.value,name:`pivot[${t}].tipo`,label:"Tipo",class:"col-3"},null,8,["options","name"]),p("div",Re,[a(k,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:_e=>o(re)(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):v("",!0),o(b).tipo==="respuesta"?(r(),d("div",Ae,[p("div",Ie,[a(B,{modelValue:f.value,"onUpdate:modelValue":s[3]||(s[3]=l=>f.value=l),options:V.value,borderless:"",dense:"",name:"respuestas1",label:"Respuesta",class:"col-4 q-mb-md"},{after:i(()=>[a(k,{disable:!f.value,round:"",dense:"",icon:"add",color:"positive",onClick:s[2]||(s[2]=l=>ce(f.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),o(q).respuesta_ids?(r(),d("div",Me,L(o(q).respuesta_ids),1)):v("",!0),a(z,{bordered:""},{default:i(()=>[a(D,{header:""},{default:i(()=>[J("Seleccionar Respuestas")]),_:1}),(r(!0),d(P,null,Y(o(M),(l,t)=>(r(),h(X,{key:t},{default:i(()=>[a(W,null,{default:i(()=>[p("div",Oe,[a(c,{label:"Respuesta",name:`respuesta_ids[${t}]`,options:V.value,class:"col-8",required:""},null,8,["name","options"]),p("div",je,[a(k,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:_e=>o(ne)(t)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):v("",!0)]),_:1},8,["loading","onSubmit"])]))}}),Ke=Z({__name:"ItemCreatePage",setup(U){return($,m)=>(r(),h(Te,{onSubmit:m[0]||(m[0]=y=>$.$router.back()),onCancel:m[1]||(m[1]=y=>$.$router.back())}))}});export{Ke as default};
