import{aG as $e,aH as ge,U as qe,X as ee,j as v,r as N,Z as B,$ as E,aU as u,b4 as z,a0 as xe,b5 as D,G as we,o as r,aj as d,a4 as s,w as i,aW as b,ac as U,a1 as a,ai as q,b6 as G,ab as C,as as J,at as c,aP as P,a8 as Y,e as H,aD as W,aJ as X,d as x,a7 as Z,v as ke,a6 as K,a9 as Se,af as I,b7 as Ue,ax as Qe,ad as Ee}from"./index.ddaffeba.js";import{_ as Ce}from"./SkeletonForm.7322d735.js";import{u as Fe}from"./examenFetchAllQuery.20d85fdf.js";import{u as Ne,a as Ie}from"./unidadTiposFetchAllQuery.07a03bff.js";import{I as se}from"./ItemApi.b2488c9f.js";import{u as Ve}from"./respuestaFetchAllQuery.f782036c.js";import{u as Re}from"./seccionFetchAllQuery.54902bf1.js";import{u as Ae}from"./operadoresFetchAllQuery.466338b0.js";import{u as Oe}from"./unidadFetchAllQuery.9ce1c223.js";import"./ExamenApi.fd374c57.js";import"./UnidadApi.ac181ce7.js";import"./RespuestaApi.7dfd3c6f.js";import"./SeccionApi.fb2c47e8.js";function Me(n,m){const _=async()=>(await se.fetchOne(n)).data().data,{data:p,isLoading:f,isSuccess:h,isError:w,isFetching:y,refetch:$}=$e([ge.ITEM_ALL,n],_,{enabled:m});return{data:p,isLoading:f,isSuccess:h,isError:w,isFetching:y,refetch:$}}function Te(){return qe(({data:n,id:m})=>se.update(n,m))}const je={class:"row"},Le={key:0,class:"col-xs-12 col-sm-12"},Be={class:"row"},ze={key:0,class:"text-red text-italic"},De={class:"row q-col-gutter-sm q-mb-sm"},Ge={class:"col-auto self-center"},Je={key:1,class:"col-xs-12 col-sm-12"},Pe={class:"row"},Ye={key:0,class:"text-red text-italic"},He={class:"row q-col-gutter-sm q-mb-sm"},We={class:"col-4 self-center"},Xe=ee({__name:"ItemEditForm",props:{item:{type:Object,required:!0}},emits:["submit","cancel"],setup(n,{emit:m}){const _=n,p=m,{data:f}=Re(),h=v(()=>f.value?f.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),w=N({limit:0,search:"is_active:1",searchJoin:"and"}),{data:y}=Fe(w),$=v(()=>y.value?y.value.map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:F}=Ne(),ae=v(()=>F.value?Object.values(F.value).map(e=>({label:e,value:e})):[]),{data:V}=Oe(),R=v(()=>V.value?Object.values(V.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:A}=Ve(),O=v(()=>A.value?Object.values(A.value).map(e=>({label:e.nombre,value:Number(e.id)})):[]),{data:M}=Ie(),te=v(()=>M.value?Object.values(M.value).map(e=>({label:e,value:e})):[]),{data:T}=Ae(),oe=v(()=>T.value?Object.entries(T.value).map(([e,t])=>({label:`${t} (${e})`,value:e})):[]),k=N(),S=N(),re=B().shape({nombre:E().trim().min(2).required().label("Nombre"),codigo:u().typeError("Codigo debe ser un numero").positive().required().label("Codigo"),tipo:E().trim().min(2).required().label("Tipo"),seccion_id:u().required().label("Seccion"),examen_id:u().required().label("Examen"),pivot:z().when(["tipo"],{is:e=>e==="unidad",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(B().shape({unidad_id:u().typeError("Unidad debe ser un numero").positive().required().label("Unidad"),item_id:u().typeError("Item debe ser un numero").positive().label("Item"),minimo:u().typeError("Minimo debe ser un numero").min(0).required().label("Minimo"),maximo:u().typeError("Maximo debe ser un numero").positive().when(["tipo"],{is:e=>e==="multivalor",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Maximo"),tipo:E().required().label("Tipo"),operador:E().when(["tipo"],{is:e=>e==="operador",then:e=>e.required(),otherwise:e=>e.nullable()}).label("Operador")})).label("Unidades"),respuesta_ids:z().when(["tipo"],{is:e=>e==="respuesta",then:e=>e.required().min(1),otherwise:e=>e.nullable()}).of(u().required()).label("Respuestas")}),{handleSubmit:le,setErrors:ie,values:g,errors:Q,setFieldValue:ne}=xe({validationSchema:re,initialValues:{..._.item}}),{remove:ue,push:de,fields:j}=D("pivot"),{remove:ce,push:me,fields:L}=D("respuesta_ids"),pe=e=>{if(j.value.some(l=>l.value.unidad_id===e.value)){I.warn("Ya has agregado este item");return}de({unidad_id:Number(e.value)}),k.value=void 0},ve=e=>{if(L.value.some(l=>l.value===e.value)){I.warn("Ya has agregado este item");return}me(Number(e.value)),S.value=void 0},{isLoading:be,mutate:_e,reset:fe}=Te(),he=le(async e=>{_e({data:e,id:_.item.id},{onSuccess:()=>{p("submit")},onError:t=>{fe.value(),ie(t.data.errors)}})},e=>{console.log(e.errors)});return we(()=>g.tipo,e=>{e&&ne("pivot",[])}),(e,t)=>(r(),d("div",je,[s(Se,{class:"col-xs-12 col-sm-10",loading:a(be),onSubmit:a(he),onCancel:t[4]||(t[4]=l=>e.$emit("cancel"))},{default:i(()=>[s(b,{options:$.value,name:"examen_id",label:"Examen",class:"col-12"},null,8,["options"]),s(b,{options:h.value,name:"seccion_id",label:"Seccion",class:"col-xs-12 col-sm-6"},null,8,["options"]),s(U,{name:"codigo",label:"Codigo",class:"col-xs-12 col-sm-6"}),s(U,{name:"nombre",label:"Nombre",class:"col-xs-12 col-sm-6"}),s(b,{options:ae.value,name:"tipo",label:"Tipo",class:"col-xs-12 col-sm-6"},null,8,["options"]),a(g).tipo==="unidad"?(r(),d("div",Le,[q("div",Be,[s(G,{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=l=>k.value=l),options:R.value,borderless:"",dense:"",name:"unidadees1",label:"Unidades",class:"col-4 q-mb-md"},{after:i(()=>[s(C,{disable:!k.value,round:"",dense:"",icon:"add",color:"positive",onClick:t[0]||(t[0]=l=>pe(k.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),a(Q).pivot?(r(),d("div",ze,J(a(Q).pivot),1)):c("",!0),s(P,{bordered:""},{default:i(()=>[s(Y,{header:""},{default:i(()=>[H("Seleccionar Unidades")]),_:1}),(r(!0),d(W,null,X(a(j),(l,o)=>(r(),x(K,{key:o},{default:i(()=>[s(Z,null,{default:i(()=>[q("div",De,[ke(s(U,{label:"examen",name:`pivot[${o}].examen_id`,class:"col-3",required:""},null,8,["name"]),[[Ue,!1]]),s(b,{label:"Unidades",name:`pivot[${o}].unidad_id`,options:R.value,class:"col-2",required:""},null,8,["name","options"]),a(g).pivot[o].tipo==="operador"?(r(),x(b,{key:0,name:`pivot[${o}].operador`,options:oe.value,label:"Operador",class:"col-3"},null,8,["name","options"])):c("",!0),s(U,{name:`pivot[${o}].minimo`,label:a(g).pivot[o].tipo==="multivalor"?"Minimo":"Valor",class:"col-3"},null,8,["name","label"]),a(g).pivot[o].tipo==="multivalor"?(r(),x(U,{key:1,name:`pivot[${o}].maximo`,label:"Maximo",class:"col-3"},null,8,["name"])):c("",!0),s(b,{options:te.value,name:`pivot[${o}].tipo`,label:"Tipo",class:"col-3"},null,8,["options","name"]),q("div",Ge,[s(C,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:ye=>a(ue)(o)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):c("",!0),a(g).tipo==="respuesta"?(r(),d("div",Je,[q("div",Pe,[s(G,{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=l=>S.value=l),options:O.value,borderless:"",dense:"",name:"respuestas1",label:"Respuesta",class:"col-4 q-mb-md"},{after:i(()=>[s(C,{disable:!S.value,round:"",dense:"",icon:"add",color:"positive",onClick:t[2]||(t[2]=l=>ve(S.value))},null,8,["disable"])]),_:1},8,["modelValue","options"])]),a(Q).respuesta_ids?(r(),d("div",Ye,J(a(Q).respuesta_ids),1)):c("",!0),s(P,{bordered:""},{default:i(()=>[s(Y,{header:""},{default:i(()=>[H("Seleccionar Respuestas")]),_:1}),(r(!0),d(W,null,X(a(L),(l,o)=>(r(),x(K,{key:o},{default:i(()=>[s(Z,null,{default:i(()=>[q("div",He,[s(b,{label:"Respuesta",name:`respuesta_ids[${o}]`,options:O.value,class:"col-8",required:""},null,8,["name","options"]),q("div",We,[s(C,{icon:"fas fa-trash-can",color:"negative",round:"",flat:"",size:"sm",onClick:ye=>a(ce)(o)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):c("",!0)]),_:1},8,["loading","onSubmit"])]))}}),Ze={class:"row"},ms=ee({__name:"ItemEditPage",props:{id:{type:Number,required:!0}},setup(n){const m=n,_=Qe(),{data:p,isSuccess:f,isFetching:h}=Me(m.id,!0),w=()=>{I.success("Registro actualizado correctamente"),_.back()};return(y,$)=>(r(),d("div",Ze,[a(h)?(r(),x(Ee,{key:0,class:"col-xs-12 col-sm-10 q-pa-lg"},{default:i(()=>[s(Ce,{class:"col-12",inputs:3})]),_:1})):c("",!0),a(f)&&!a(h)&&a(p)?(r(),x(Xe,{key:1,class:"col-xs-12 col-sm-10",item:a(p),gol:a(p),onSubmit:w,onCancel:$[0]||($[0]=F=>y.$router.back())},null,8,["item","gol"])):c("",!0)]))}});export{ms as default};
